(window.webpackJsonp = window.webpackJsonp || []).push([
    [0], {
        "2zIC": function(e, t) {
            var n = function() {
                var e = function(e, t, n, r) {
                        for (n = n || {}, r = e.length; r--; n[e[r]] = t);
                        return n
                    },
                    t = [1, 75],
                    n = [1, 77],
                    r = [1, 78],
                    o = [1, 81],
                    i = [1, 82],
                    a = [1, 83],
                    s = [1, 84],
                    l = [1, 85],
                    c = [1, 96],
                    u = [1, 88],
                    p = [1, 89],
                    f = [1, 90],
                    h = [1, 91],
                    d = [1, 114],
                    m = [1, 92],
                    y = [1, 115],
                    v = [1, 95],
                    _ = [1, 66],
                    g = [1, 97],
                    b = [1, 98],
                    w = [1, 100],
                    x = [1, 99],
                    S = [1, 111],
                    C = [1, 112],
                    P = [1, 113],
                    E = [1, 101],
                    O = [1, 102],
                    A = [1, 103],
                    T = [1, 104],
                    k = [1, 105],
                    R = [1, 106],
                    I = [1, 107],
                    M = [1, 108],
                    N = [1, 109],
                    L = [1, 110],
                    j = [1, 116],
                    D = [1, 117],
                    V = [1, 118],
                    F = [1, 120],
                    B = [1, 119],
                    z = [1, 72],
                    U = [1, 74],
                    G = [1, 71],
                    H = [1, 73],
                    W = [1, 79],
                    q = [1, 80],
                    Y = [1, 86],
                    X = [1, 87],
                    $ = [1, 93],
                    K = [1, 94],
                    Z = [1, 68],
                    Q = [1, 69],
                    J = [1, 70],
                    ee = [1, 76],
                    te = [1, 130],
                    ne = [1, 126],
                    re = [1, 129],
                    oe = [1, 127],
                    ie = [1, 128],
                    ae = [1, 133],
                    se = [1, 132],
                    le = [1, 149],
                    ce = [1, 157],
                    ue = [1, 164],
                    pe = [1, 165],
                    fe = [1, 202],
                    he = [5, 6, 7, 9, 13, 14, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33, 34, 35, 37, 38, 41, 43, 45, 46, 53, 55, 56, 57, 59, 60, 61, 63, 64, 65, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 78, 79, 80, 81, 83, 84, 86, 87, 88, 92, 93, 95, 98, 99, 102, 104, 105],
                    de = [5, 6, 7, 9, 13, 14, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33, 34, 35, 37, 38, 41, 43, 45, 46, 53, 55, 56, 57, 59, 60, 61, 63, 64, 65, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 83, 84, 86, 87, 88, 92, 93, 95, 98, 99, 102, 104, 105],
                    me = [5, 6, 7, 9, 13, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33, 34, 37, 38, 41, 43, 45, 46, 53, 55, 56, 57, 59, 60, 63, 64, 65, 67, 68, 69, 70, 71, 72, 73, 74, 75, 81, 83, 84, 86, 87, 88, 92, 93, 102],
                    ye = [5, 92, 93],
                    ve = [5, 95],
                    _e = [1, 228],
                    ge = [5, 14, 61, 76, 105],
                    be = [77, 104],
                    we = {
                        trace: function() {},
                        yy: {},
                        symbols_: {
                            error: 2,
                            Program: 3,
                            Command: 4,
                            EOF: 5,
                            RESET: 6,
                            BUILD: 7,
                            ALL: 8,
                            HELP: 9,
                            Path: 10,
                            MOTM: 11,
                            OneArgCommand: 12,
                            GET: 13,
                            STRING: 14,
                            SET: 15,
                            Value: 16,
                            SET_SAVE: 17,
                            SET_RESTORE: 18,
                            SET_RESET: 19,
                            PRESET: 20,
                            AddRepresentation: 21,
                            EditRepresentation: 22,
                            REMOVE: 23,
                            RepresentationReference: 24,
                            HIDE: 25,
                            SHOW: 26,
                            LIST: 27,
                            EXPAND_KEY: 28,
                            SELECTOR_KEY: 29,
                            SELECT: 30,
                            AS: 31,
                            WordAll: 32,
                            SELECTOR: 33,
                            WITHIN: 34,
                            NUMBER: 35,
                            OF: 36,
                            MATERIAL: 37,
                            IDENTIFIER: 38,
                            ModeCMD: 39,
                            ColorCMD: 40,
                            VIEW: 41,
                            BASE_64: 42,
                            UNIT: 43,
                            DSSP: 44,
                            SCALE: 45,
                            ROTATE: 46,
                            AxesList: 47,
                            TRANSLATE: 48,
                            GetURLBranch: 49,
                            Screenshot: 50,
                            SrvCMD: 51,
                            SrvScenarioCMD: 52,
                            LINE: 53,
                            ArgList: 54,
                            LISTOBJ: 55,
                            REMOVEOBJ: 56,
                            URL: 57,
                            VIEW_KEY: 58,
                            SCREENSHOT: 59,
                            FILE_LIST: 60,
                            FILE_KEY: 61,
                            PresetPath: 62,
                            FILE_REGISTER: 63,
                            FILE_DELETE: 64,
                            PRESET_ADD: 65,
                            Word: 66,
                            PRESET_DELETE: 67,
                            PRESET_UPDATE: 68,
                            PRESET_RENAME: 69,
                            PRESET_OPEN: 70,
                            CREATE_SCENARIO: 71,
                            RESET_SCENARIO: 72,
                            DELETE_SCENARIO: 73,
                            LIST_SCENARIO: 74,
                            ADD_SCENARIO_ITEM: 75,
                            DELAY_KEY: 76,
                            "=": 77,
                            DESCRIPTION_KEY: 78,
                            PDB_KEY: 79,
                            PRST_KEY: 80,
                            LOAD: 81,
                            Url: 82,
                            SCRIPT: 83,
                            ADD: 84,
                            Description: 85,
                            REP: 86,
                            MODE: 87,
                            COLOR: 88,
                            Descriptor: 89,
                            RepresentationOwnProperty: 90,
                            RepresentationOwnPropertyOpts: 91,
                            DESC_KEY: 92,
                            DESC_KEY_OPTS: 93,
                            AxesArg: 94,
                            DESC_KEY_AXES: 95,
                            Arg: 96,
                            PathWoDescKey: 97,
                            HEX: 98,
                            BOOL: 99,
                            CommandSetWoDESC_KEY: 100,
                            DescKeys: 101,
                            CLEAR: 102,
                            CommandSet: 103,
                            ".": 104,
                            "/": 105,
                            HexOrNumber: 106,
                            $accept: 0,
                            $end: 1
                        },
                        terminals_: {
                            2: "error",
                            5: "EOF",
                            6: "RESET",
                            7: "BUILD",
                            8: "ALL",
                            9: "HELP",
                            11: "MOTM",
                            13: "GET",
                            14: "STRING",
                            15: "SET",
                            17: "SET_SAVE",
                            18: "SET_RESTORE",
                            19: "SET_RESET",
                            20: "PRESET",
                            23: "REMOVE",
                            25: "HIDE",
                            26: "SHOW",
                            27: "LIST",
                            28: "EXPAND_KEY",
                            29: "SELECTOR_KEY",
                            30: "SELECT",
                            31: "AS",
                            33: "SELECTOR",
                            34: "WITHIN",
                            35: "NUMBER",
                            36: "OF",
                            37: "MATERIAL",
                            38: "IDENTIFIER",
                            41: "VIEW",
                            42: "BASE_64",
                            43: "UNIT",
                            44: "DSSP",
                            45: "SCALE",
                            46: "ROTATE",
                            48: "TRANSLATE",
                            53: "LINE",
                            55: "LISTOBJ",
                            56: "REMOVEOBJ",
                            57: "URL",
                            58: "VIEW_KEY",
                            59: "SCREENSHOT",
                            60: "FILE_LIST",
                            61: "FILE_KEY",
                            63: "FILE_REGISTER",
                            64: "FILE_DELETE",
                            65: "PRESET_ADD",
                            67: "PRESET_DELETE",
                            68: "PRESET_UPDATE",
                            69: "PRESET_RENAME",
                            70: "PRESET_OPEN",
                            71: "CREATE_SCENARIO",
                            72: "RESET_SCENARIO",
                            73: "DELETE_SCENARIO",
                            74: "LIST_SCENARIO",
                            75: "ADD_SCENARIO_ITEM",
                            76: "DELAY_KEY",
                            77: "=",
                            78: "DESCRIPTION_KEY",
                            79: "PDB_KEY",
                            80: "PRST_KEY",
                            81: "LOAD",
                            83: "SCRIPT",
                            84: "ADD",
                            86: "REP",
                            87: "MODE",
                            88: "COLOR",
                            92: "DESC_KEY",
                            93: "DESC_KEY_OPTS",
                            95: "DESC_KEY_AXES",
                            98: "HEX",
                            99: "BOOL",
                            102: "CLEAR",
                            104: ".",
                            105: "/"
                        },
                        productions_: [0, [3, 2],
                            [3, 1],
                            [4, 1],
                            [4, 1],
                            [4, 2],
                            [4, 1],
                            [4, 2],
                            [4, 1],
                            [4, 1],
                            [4, 2],
                            [4, 2],
                            [4, 3],
                            [4, 3],
                            [4, 1],
                            [4, 1],
                            [4, 1],
                            [4, 1],
                            [4, 2],
                            [4, 1],
                            [4, 1],
                            [4, 2],
                            [4, 2],
                            [4, 2],
                            [4, 2],
                            [4, 1],
                            [4, 2],
                            [4, 2],
                            [4, 2],
                            [4, 4],
                            [4, 2],
                            [4, 6],
                            [4, 2],
                            [4, 1],
                            [4, 1],
                            [4, 1],
                            [4, 2],
                            [4, 2],
                            [4, 1],
                            [4, 2],
                            [4, 1],
                            [4, 2],
                            [4, 2],
                            [4, 2],
                            [4, 1],
                            [4, 1],
                            [4, 1],
                            [4, 1],
                            [4, 3],
                            [4, 3],
                            [4, 4],
                            [4, 4],
                            [4, 1],
                            [4, 2],
                            [49, 1],
                            [49, 2],
                            [49, 2],
                            [49, 3],
                            [49, 3],
                            [50, 1],
                            [50, 2],
                            [50, 3],
                            [51, 1],
                            [51, 3],
                            [51, 2],
                            [51, 4],
                            [51, 2],
                            [51, 4],
                            [51, 2],
                            [51, 4],
                            [51, 1],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 3],
                            [51, 3],
                            [51, 3],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [51, 3],
                            [51, 3],
                            [51, 3],
                            [51, 2],
                            [51, 2],
                            [51, 2],
                            [52, 2],
                            [52, 2],
                            [52, 1],
                            [52, 2],
                            [52, 2],
                            [52, 2],
                            [52, 1],
                            [52, 2],
                            [52, 3],
                            [52, 3],
                            [52, 3],
                            [52, 7],
                            [52, 13],
                            [52, 13],
                            [52, 13],
                            [52, 13],
                            [12, 2],
                            [12, 2],
                            [12, 2],
                            [12, 2],
                            [21, 1],
                            [21, 2],
                            [21, 2],
                            [21, 3],
                            [22, 2],
                            [22, 3],
                            [39, 2],
                            [39, 3],
                            [40, 2],
                            [40, 3],
                            [24, 1],
                            [24, 1],
                            [85, 1],
                            [85, 2],
                            [85, 3],
                            [85, 4],
                            [89, 1],
                            [89, 1],
                            [89, 2],
                            [90, 3],
                            [91, 3],
                            [47, 1],
                            [47, 2],
                            [94, 2],
                            [54, 1],
                            [54, 2],
                            [96, 3],
                            [16, 1],
                            [16, 1],
                            [16, 1],
                            [16, 1],
                            [16, 1],
                            [66, 1],
                            [66, 1],
                            [32, 1],
                            [32, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [100, 1],
                            [101, 1],
                            [101, 1],
                            [101, 1],
                            [101, 1],
                            [101, 1],
                            [101, 1],
                            [101, 1],
                            [103, 1],
                            [103, 1],
                            [97, 1],
                            [97, 3],
                            [97, 3],
                            [10, 1],
                            [10, 1],
                            [10, 3],
                            [10, 3],
                            [10, 3],
                            [82, 1],
                            [62, 1],
                            [62, 3],
                            [106, 1],
                            [106, 1]
                        ],
                        performAction: function(e, t, n, r, o, i, a) {
                            var s = i.length - 1;
                            switch (o) {
                                case 1:
                                    return i[s - 1];
                                case 3:
                                    this.$ = r.miew.reset(!1), r.ClearContext(), r.miew.resetReps("empty");
                                    break;
                                case 4:
                                    this.$ = r.miew.rebuild();
                                    break;
                                case 5:
                                    this.$ = r.miew.rebuildAll(), r.miew.rebuild();
                                    break;
                                case 6:
                                    this.$ = r.echo(r.utils.help().toString());
                                    break;
                                case 7:
                                    this.$ = r.echo(r.utils.help(i[s]).toString());
                                    break;
                                case 8:
                                    this.$ = r.miew.motm();
                                    break;
                                case 10:
                                case 11:
                                    this.$ = r.utils.propagateProp(i[s]), r.echo(r.miew.get(i[s]).toString());
                                    break;
                                case 12:
                                case 13:
                                    this.$ = r.miew.set(i[s - 1], r.utils.propagateProp(i[s - 1], i[s]));
                                    break;
                                case 14:
                                    this.$ = r.miew.saveSettings();
                                    break;
                                case 15:
                                    this.$ = r.miew.restoreSettings();
                                    break;
                                case 16:
                                    this.$ = r.miew.resetSettings();
                                    break;
                                case 17:
                                    this.$ = r.miew.resetReps();
                                    break;
                                case 18:
                                    this.$ = r.miew.applyPreset(i[s]);
                                    break;
                                case 21:
                                    this.$ = r.miew.repRemove(i[s]), r.representations.remove(i[s]);
                                    break;
                                case 22:
                                    this.$ = r.miew.repHide(i[s]);
                                    break;
                                case 23:
                                    this.$ = r.miew.repHide(i[s], !1);
                                    break;
                                case 24:
                                    this.$ = r.echo(r.utils.listRep(r.miew, r.representations, i[s], "-e"));
                                    break;
                                case 25:
                                    this.$ = r.echo(r.utils.list(r.miew, r.representations));
                                    break;
                                case 26:
                                    this.$ = r.echo(r.utils.list(r.miew, r.representations, i[s]));
                                    break;
                                case 27:
                                    this.$ = r.echo(r.utils.listSelector(r.miew, r.Context));
                                    break;
                                case 28:
                                    this.$ = r.miew.select(r.utils.checkArg(i[s - 1].toLowerCase(), i[s], !0));
                                    break;
                                case 29:
                                    this.$ = r.Context[i[s].toLowerCase()] = r.utils.checkArg(i[s - 3].toLowerCase(), i[s - 2], !0), r.miew.select(r.Context[i[s].toLowerCase()]);
                                    break;
                                case 30:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        selector: r.utils.checkArg(i[s - 1].toLowerCase(), i[s])
                                    });
                                    break;
                                case 31:
                                    this.$ = r.Context[i[s].toLowerCase()] = r.miew.within(r.utils.checkArg("select", i[s - 2], !0), Number(i[s - 4]));
                                    break;
                                case 32:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        material: r.utils.checkArg(i[s - 1].toLowerCase(), i[s].toUpperCase())
                                    });
                                    break;
                                case 35:
                                    this.$ = r.echo(r.miew.view());
                                    break;
                                case 36:
                                case 37:
                                    this.$ = r.miew.view(i[s]);
                                    break;
                                case 38:
                                    this.$ = r.echo(r.miew.changeUnit());
                                    break;
                                case 39:
                                    this.$ = r.echo(r.miew.changeUnit(i[s]));
                                    break;
                                case 40:
                                    this.$ = r.miew.dssp();
                                    break;
                                case 41:
                                    this.$ = r.miew.scale(i[s]);
                                    break;
                                case 42:
                                    for (var l = 0, c = i[s].length; l < c; l++) r.miew.rotate(i[s][l].x * Math.PI / 180, i[s][l].y * Math.PI / 180, i[s][l].z * Math.PI / 180);
                                    break;
                                case 43:
                                    for (l = 0, c = i[s].length; l < c; l++) r.miew.translate(i[s][l].x || 0, i[s][l].y || 0, i[s][l].z || 0);
                                    break;
                                case 48:
                                case 49:
                                    this.$ = r.miew.addObject({
                                        type: "line",
                                        params: [i[s - 1], i[s]]
                                    }, !0);
                                    break;
                                case 50:
                                case 51:
                                    this.$ = r.miew.addObject({
                                        type: "line",
                                        params: [i[s - 2], i[s - 1]],
                                        opts: i[s].toJSO(r.utils, "objects", "line")
                                    }, !0);
                                    break;
                                case 52:
                                    this.$ = r.echo(r.utils.listObjs(r.miew));
                                    break;
                                case 53:
                                    this.$ = r.miew.removeObject(i[s]);
                                    break;
                                case 54:
                                    this.$ = r.echo(r.miew.getURL({
                                        view: !1,
                                        settings: !1
                                    }));
                                    break;
                                case 55:
                                    this.$ = r.echo(r.miew.getURL({
                                        view: !1,
                                        settings: !0
                                    }));
                                    break;
                                case 56:
                                    this.$ = r.echo(r.miew.getURL({
                                        view: !0,
                                        settings: !1
                                    }));
                                    break;
                                case 57:
                                case 58:
                                    this.$ = r.echo(r.miew.getURL({
                                        view: !0,
                                        settings: !0
                                    }));
                                    break;
                                case 59:
                                    this.$ = r.miew.screenshotSave();
                                    break;
                                case 60:
                                    this.$ = r.miew.screenshotSave("", Number(i[s]));
                                    break;
                                case 61:
                                    this.$ = r.miew.screenshotSave("", Number(i[s - 1]), Number(i[s]));
                                    break;
                                case 62:
                                    this.$ = r.srv.fileList(r.miew, r.echo, r.error);
                                    break;
                                case 63:
                                    this.$ = r.srv.fileList(r.miew, r.echo, r.error, "", i[s]);
                                    break;
                                case 64:
                                    this.$ = r.srv.fileList(r.miew, r.echo, r.error, i[s]);
                                    break;
                                case 65:
                                    this.$ = r.srv.fileList(r.miew, r.echo, r.error, i[s - 2], i[s]);
                                    break;
                                case 66:
                                case 68:
                                    this.$ = r.srv.coroutineWithFileName(r.miew, r.echo, r.error, i[s], r.srv.fileList, r.srv, r.miew, r.echo, r.error);
                                    break;
                                case 67:
                                case 69:
                                    this.$ = r.srv.coroutineWithFileName(r.miew, r.echo, r.error, i[s - 2], r.srv.fileList, r.srv, r.miew, r.echo, r.error, i[s]);
                                    break;
                                case 70:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvTopologyRegister");
                                    break;
                                case 71:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvTopologyDelete", i[s], !1);
                                    break;
                                case 72:
                                case 73:
                                    this.$ = r.srv.coroutineWithFileName(r.miew, r.echo, r.error, i[s], r.miew.srvTopologyDelete, !1);
                                    break;
                                case 74:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvTopologyDelete", i[s - 1], !0);
                                    break;
                                case 75:
                                case 76:
                                    this.$ = r.srv.coroutineWithFileName(r.miew, r.echo, r.error, i[s - 1], r.miew.srvTopologyDelete, !0);
                                    break;
                                case 77:
                                case 78:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvPresetCreate", i[s]);
                                    break;
                                case 79:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvPresetDelete", i[s]);
                                    break;
                                case 80:
                                case 81:
                                    this.$ = r.srv.coroutineWithPresetPath(r.miew, r.echo, r.error, i[s], r.miew.srvPresetDelete);
                                    break;
                                case 82:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvPresetUpdate", i[s]);
                                    break;
                                case 83:
                                case 84:
                                    this.$ = r.srv.coroutineWithPresetPath(r.miew, r.echo, r.error, i[s], r.miew.srvPresetUpdate);
                                    break;
                                case 85:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvPresetRename", i[s - 1], i[s]);
                                    break;
                                case 86:
                                case 87:
                                    this.$ = r.srv.coroutineWithPresetPath(r.miew, r.echo, r.error, i[s - 1], r.miew.srvPresetRename, i[s]);
                                    break;
                                case 88:
                                    this.$ = r.srv.callSrvFunc(r.miew, r.echo, r.error, "srvPresetApply", i[s]), r.representations.clear();
                                    break;
                                case 89:
                                case 90:
                                    this.$ = r.srv.coroutineWithPresetPath(r.miew, r.echo, r.error, i[s], r.miew.srvPresetApply), r.representations.clear();
                                    break;
                                case 91:
                                case 92:
                                    this.$ = r.srv.createScenario(i[s]);
                                    break;
                                case 93:
                                    this.$ = r.srv.resetScenario();
                                    break;
                                case 94:
                                case 95:
                                    this.$ = r.srv.deleteScenario(r.miew, r.echo, r.error, i[s]);
                                    break;
                                case 96:
                                    this.$ = r.srv.deleteScenario(r.miew, r.echo, r.error, Number(i[s]));
                                    break;
                                case 97:
                                    this.$ = r.srv.listScenario(r.miew, r.echo, r.error);
                                    break;
                                case 98:
                                case 99:
                                case 100:
                                case 101:
                                    this.$ = r.srv.listScenario(r.miew, r.echo, r.error, i[s]);
                                    break;
                                case 102:
                                    this.$ = r.srv.addScenarioItem(r.miew, r.echo, r.error, Number(i[s - 3]), i[s]);
                                    break;
                                case 103:
                                    this.$ = r.srv.addScenarioItem(r.miew, r.echo, r.error, Number(i[s - 9]), Number(i[s - 6]), Number(i[s - 3]), i[s]);
                                    break;
                                case 104:
                                    this.$ = r.srv.addScenarioItem(r.miew, r.echo, r.error, i[s - 9], Number(i[s - 6]), Number(i[s - 3]), i[s]);
                                    break;
                                case 105:
                                    this.$ = r.srv.addScenarioItem(r.miew, r.echo, r.error, Number(i[s - 9]), i[s - 6], Number(i[s - 3]), i[s]);
                                    break;
                                case 106:
                                    this.$ = r.srv.addScenarioItem(r.miew, r.echo, r.error, i[s - 9], i[s - 6], Number(i[s - 3]), i[s]);
                                    break;
                                case 107:
                                case 108:
                                case 109:
                                    this.$ = r.utils.load(r.miew, i[s]), r.representations.clear();
                                    break;
                                case 110:
                                    this.$ = r.notimplemented();
                                    break;
                                case 111:
                                    this.$ = r.echo(r.representations.add(r.miew.repAdd()));
                                    break;
                                case 112:
                                    this.$ = r.echo(r.representations.add(i[s], r.miew.repAdd()));
                                    break;
                                case 113:
                                    this.$ = r.echo(r.representations.add(r.miew.repAdd(i[s])));
                                    break;
                                case 114:
                                    this.$ = r.echo(r.representations.add(i[s - 1], r.miew.repAdd(i[s])));
                                    break;
                                case 115:
                                    this.$ = r.miew.rep(i[s]), r.miew.repCurrent(i[s]);
                                    break;
                                case 116:
                                    this.$ = r.miew.rep(i[s - 1], i[s]), r.miew.repCurrent(i[s - 1]);
                                    break;
                                case 117:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        mode: r.utils.checkArg(i[s - 1].toLowerCase(), i[s].toUpperCase())
                                    });
                                    break;
                                case 118:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        mode: new Array(r.utils.checkArg(i[s - 2].toLowerCase(), i[s - 1].toUpperCase()), i[s].toJSO(r.utils, i[s - 2], i[s - 1].toUpperCase()))
                                    });
                                    break;
                                case 119:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        colorer: r.utils.checkArg(i[s - 1].toLowerCase(), i[s].toUpperCase())
                                    });
                                    break;
                                case 120:
                                    this.$ = r.miew.rep(r.miew.repCurrent(), {
                                        colorer: new Array(r.utils.checkArg(i[s - 2].toLowerCase(), i[s - 1].toUpperCase()), i[s].toJSO(r.utils, i[s - 2], i[s - 1].toUpperCase()))
                                    });
                                    break;
                                case 121:
                                    this.$ = Number(r.representations.get(i[s]));
                                    break;
                                case 122:
                                case 138:
                                    this.$ = Number(i[s]);
                                    break;
                                case 123:
                                    this.$ = i[s];
                                    break;
                                case 124:
                                    this.$ = r._.assign(i[s - 1], i[s]);
                                    break;
                                case 125:
                                    this.$ = r._.assign(i[s - 2], i[s - 1], i[s]);
                                    break;
                                case 126:
                                    this.$ = r._.assign(i[s - 3], i[s - 2], i[s - 1], i[s]);
                                    break;
                                case 127:
                                case 128:
                                    this.$ = r.CreateObjectPair(i[s].key, i[s].val);
                                    break;
                                case 129:
                                    this.$ = r.CreateObjectPair(i[s - 1].key, new Array(i[s - 1].val, i[s].toJSO(r.utils, i[s - 1].key, i[s - 1].val)));
                                    break;
                                case 130:
                                case 131:
                                    this.$ = Object.create({
                                        key: r.keyRemap(i[s - 2]),
                                        val: r.utils.checkArg(i[s - 2], i[s])
                                    });
                                    break;
                                case 132:
                                    this.$ = [i[s]];
                                    break;
                                case 133:
                                    this.$ = i[s - 1].concat(i[s]);
                                    break;
                                case 134:
                                    this.$ = r.CreateObjectPair(i[s - 1].toLowerCase(), Number(i[s]));
                                    break;
                                case 135:
                                    this.$ = new r.ArgList(i[s]);
                                    break;
                                case 136:
                                    this.$ = i[s - 1].append(i[s]);
                                    break;
                                case 137:
                                    this.$ = new r.Arg(i[s - 2], i[s]);
                                    break;
                                case 139:
                                    this.$ = parseInt(i[s]);
                                    break;
                                case 140:
                                    this.$ = JSON.parse(i[s]);
                                    break;
                                case 141:
                                case 142:
                                    this.$ = String(i[s]);
                                    break;
                                case 203:
                                case 204:
                                case 207:
                                case 208:
                                case 209:
                                    this.$ = i[s - 2] + i[s - 1] + i[s];
                                    break;
                                case 212:
                                    this.$ = i[s - 2] = i[s - 2] + i[s - 1] + i[s]
                            }
                        },
                        table: [{
                            3: 1,
                            4: 2,
                            5: [1, 3],
                            6: [1, 4],
                            7: [1, 5],
                            9: [1, 6],
                            11: [1, 7],
                            12: 8,
                            13: [1, 9],
                            15: [1, 10],
                            17: [1, 11],
                            18: [1, 12],
                            19: [1, 13],
                            20: [1, 14],
                            21: 15,
                            22: 16,
                            23: [1, 17],
                            25: [1, 18],
                            26: [1, 19],
                            27: [1, 20],
                            30: [1, 21],
                            33: [1, 22],
                            34: [1, 23],
                            37: [1, 24],
                            39: 25,
                            40: 26,
                            41: [1, 27],
                            43: [1, 28],
                            44: [1, 29],
                            45: [1, 30],
                            46: [1, 31],
                            48: [1, 32],
                            49: 33,
                            50: 34,
                            51: 35,
                            52: 36,
                            53: [1, 37],
                            55: [1, 38],
                            56: [1, 39],
                            57: [1, 46],
                            59: [1, 47],
                            60: [1, 48],
                            63: [1, 49],
                            64: [1, 50],
                            65: [1, 51],
                            67: [1, 52],
                            68: [1, 53],
                            69: [1, 54],
                            70: [1, 55],
                            71: [1, 56],
                            72: [1, 57],
                            73: [1, 58],
                            74: [1, 59],
                            75: [1, 60],
                            81: [1, 40],
                            83: [1, 41],
                            84: [1, 42],
                            86: [1, 43],
                            87: [1, 44],
                            88: [1, 45]
                        }, {
                            1: [3]
                        }, {
                            5: [1, 61]
                        }, {
                            1: [2, 2]
                        }, {
                            5: [2, 3]
                        }, {
                            5: [2, 4],
                            8: [1, 62]
                        }, {
                            5: [2, 6],
                            6: t,
                            7: n,
                            9: r,
                            10: 63,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            5: [2, 8]
                        }, {
                            5: [2, 9]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 121,
                            13: o,
                            14: [1, 122],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 123,
                            13: o,
                            14: [1, 124],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            5: [2, 14]
                        }, {
                            5: [2, 15]
                        }, {
                            5: [2, 16]
                        }, {
                            5: [2, 17],
                            14: te,
                            16: 125,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie
                        }, {
                            5: [2, 19]
                        }, {
                            5: [2, 20]
                        }, {
                            24: 131,
                            35: ae,
                            38: se
                        }, {
                            24: 134,
                            35: ae,
                            38: se
                        }, {
                            24: 135,
                            35: ae,
                            38: se
                        }, {
                            5: [2, 25],
                            24: 136,
                            28: [1, 137],
                            29: [1, 138],
                            35: ae,
                            38: se
                        }, {
                            14: [1, 139]
                        }, {
                            14: [1, 140]
                        }, {
                            35: [1, 141]
                        }, {
                            38: [1, 142]
                        }, {
                            5: [2, 33]
                        }, {
                            5: [2, 34]
                        }, {
                            5: [2, 35],
                            14: [1, 143],
                            42: [1, 144]
                        }, {
                            5: [2, 38],
                            35: [1, 145]
                        }, {
                            5: [2, 40]
                        }, {
                            35: [1, 146]
                        }, {
                            47: 147,
                            94: 148,
                            95: le
                        }, {
                            47: 150,
                            94: 148,
                            95: le
                        }, {
                            5: [2, 44]
                        }, {
                            5: [2, 45]
                        }, {
                            5: [2, 46]
                        }, {
                            5: [2, 47]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 152,
                            13: o,
                            14: [1, 151],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            5: [2, 52]
                        }, {
                            35: [1, 153]
                        }, {
                            14: ce,
                            38: [1, 155],
                            61: [1, 156],
                            82: 154
                        }, {
                            14: ce,
                            82: 158
                        }, {
                            5: [2, 111],
                            38: [1, 159],
                            85: 160,
                            89: 161,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, {
                            24: 166,
                            35: ae,
                            38: se
                        }, {
                            38: [1, 167]
                        }, {
                            38: [1, 168]
                        }, {
                            5: [2, 54],
                            29: [1, 169],
                            58: [1, 170]
                        }, {
                            5: [2, 59],
                            35: [1, 171]
                        }, {
                            5: [2, 62],
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 175],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 173],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            61: [1, 172],
                            62: 174,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            5: [2, 70]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 178],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 177],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 179,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            14: [1, 180],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 181,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            100: 67,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 183],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 182],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 184,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 186],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 185],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 187,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 189],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 188],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 190,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            14: [1, 192],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 191],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 193,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            14: [1, 194],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 195,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 93]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            14: [1, 196],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 198],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 197,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 97],
                            28: [1, 199]
                        }, {
                            76: [1, 200],
                            79: [1, 201]
                        }, {
                            1: [2, 1]
                        }, {
                            5: [2, 5]
                        }, {
                            5: [2, 7],
                            104: fe
                        }, e(he, [2, 205]), e(he, [2, 206]), e(de, [2, 143]), e(de, [2, 144]), e(he, [2, 193]), e(he, [2, 194]), e(he, [2, 195]), e(he, [2, 196]), e(he, [2, 197]), e(he, [2, 198]), e(he, [2, 199]), e(de, [2, 147]), e(de, [2, 148]), e(de, [2, 149]), e(de, [2, 150]), e(de, [2, 151]), e(de, [2, 152]), e(de, [2, 153]), e(de, [2, 154]), e(de, [2, 155]), e(de, [2, 156]), e(de, [2, 157]), e(de, [2, 158]), e(de, [2, 159]), e(de, [2, 160]), e(de, [2, 161]), e(de, [2, 162]), e(de, [2, 163]), e(de, [2, 164]), e(de, [2, 165]), e(de, [2, 166]), e(de, [2, 167]), e(de, [2, 168]), e(de, [2, 169]), e(de, [2, 170]), e(de, [2, 171]), e(de, [2, 172]), e(de, [2, 173]), e(de, [2, 174]), e(de, [2, 175]), e(de, [2, 176]), e(de, [2, 177]), e(de, [2, 178]), e(de, [2, 179]), e(de, [2, 180]), e(de, [2, 181]), e(de, [2, 182]), e(de, [2, 183]), e(de, [2, 184]), e(de, [2, 185]), e(de, [2, 186]), e(de, [2, 187]), e(de, [2, 188]), e(de, [2, 189]), e(de, [2, 190]), e(de, [2, 191]), e(de, [2, 192]), {
                            5: [2, 10],
                            104: fe
                        }, {
                            5: [2, 11]
                        }, {
                            14: te,
                            16: 203,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie,
                            104: fe
                        }, {
                            14: te,
                            16: 204,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie
                        }, {
                            5: [2, 18]
                        }, e(me, [2, 138]), e(me, [2, 139]), e(me, [2, 140]), e(me, [2, 141]), e(me, [2, 142]), {
                            5: [2, 21]
                        }, e(ye, [2, 121]), e(ye, [2, 122]), {
                            5: [2, 22]
                        }, {
                            5: [2, 23]
                        }, {
                            5: [2, 24]
                        }, {
                            5: [2, 26]
                        }, {
                            5: [2, 27]
                        }, {
                            5: [2, 28],
                            31: [1, 205]
                        }, {
                            5: [2, 30]
                        }, {
                            36: [1, 206]
                        }, {
                            5: [2, 32]
                        }, {
                            5: [2, 36]
                        }, {
                            5: [2, 37]
                        }, {
                            5: [2, 39]
                        }, {
                            5: [2, 41]
                        }, {
                            5: [2, 42],
                            94: 207,
                            95: le
                        }, e(ve, [2, 132]), {
                            35: [1, 208]
                        }, {
                            5: [2, 43],
                            94: 207,
                            95: le
                        }, {
                            14: [1, 209]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 210,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee,
                            104: fe
                        }, {
                            5: [2, 53]
                        }, {
                            5: [2, 107]
                        }, {
                            5: [2, 108]
                        }, {
                            5: [2, 109]
                        }, {
                            5: [2, 210]
                        }, {
                            5: [2, 110]
                        }, {
                            5: [2, 112],
                            85: 211,
                            89: 161,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, {
                            5: [2, 113]
                        }, {
                            5: [2, 123],
                            89: 212,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, e(ye, [2, 127]), e(ye, [2, 128], {
                            100: 67,
                            54: 213,
                            96: 214,
                            97: 215,
                            66: 216,
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            102: ee
                        }), {
                            77: [1, 217]
                        }, {
                            77: [1, 218]
                        }, {
                            5: [2, 115],
                            85: 219,
                            89: 161,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, {
                            5: [2, 117],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            54: 220,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 214,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 119],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            54: 221,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 214,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 55],
                            58: [1, 222]
                        }, {
                            5: [2, 56],
                            29: [1, 223]
                        }, {
                            5: [2, 60],
                            35: [1, 224]
                        }, {
                            14: [1, 225]
                        }, {
                            5: [2, 64],
                            61: [1, 226]
                        }, {
                            5: [2, 66],
                            61: [1, 227],
                            105: _e
                        }, {
                            5: [2, 68],
                            61: [1, 229]
                        }, e(ge, [2, 211], {
                            104: fe
                        }), {
                            5: [2, 71],
                            61: [1, 230]
                        }, {
                            5: [2, 72],
                            61: [1, 231]
                        }, {
                            5: [2, 73],
                            61: [1, 232],
                            105: _e
                        }, {
                            5: [2, 77]
                        }, {
                            5: [2, 78]
                        }, {
                            5: [2, 79]
                        }, {
                            5: [2, 80]
                        }, {
                            5: [2, 81],
                            105: _e
                        }, {
                            5: [2, 82]
                        }, {
                            5: [2, 83]
                        }, {
                            5: [2, 84],
                            105: _e
                        }, {
                            14: [1, 233]
                        }, {
                            14: [1, 234]
                        }, {
                            14: [1, 235],
                            105: _e
                        }, {
                            5: [2, 88]
                        }, {
                            5: [2, 89]
                        }, {
                            5: [2, 90],
                            105: _e
                        }, {
                            5: [2, 91]
                        }, {
                            5: [2, 92]
                        }, {
                            5: [2, 94]
                        }, {
                            5: [2, 95]
                        }, {
                            5: [2, 96]
                        }, {
                            5: [2, 98],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            14: [1, 238],
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 236],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 237,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            100: 67,
                            102: ee
                        }, {
                            77: [1, 239]
                        }, {
                            77: [1, 240]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 242],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 241,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 243,
                            102: ee
                        }, {
                            5: [2, 12]
                        }, {
                            5: [2, 13]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            32: 244,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 245,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 246,
                            102: ee
                        }, {
                            14: [1, 247]
                        }, e(ve, [2, 133]), e(ve, [2, 134]), {
                            5: [2, 48],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            54: 248,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 214,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 49],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            54: 249,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 214,
                            97: 215,
                            100: 67,
                            102: ee,
                            104: fe
                        }, {
                            5: [2, 114]
                        }, {
                            5: [2, 124],
                            89: 250,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, e(ye, [2, 129], {
                            100: 67,
                            97: 215,
                            66: 216,
                            96: 251,
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            102: ee
                        }), e(me, [2, 135]), {
                            77: [1, 252],
                            104: [1, 253]
                        }, e(be, [2, 202]), {
                            14: te,
                            16: 254,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie
                        }, {
                            14: te,
                            16: 255,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie
                        }, {
                            5: [2, 116]
                        }, {
                            5: [2, 118],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 251,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 120],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 251,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 57]
                        }, {
                            5: [2, 58]
                        }, {
                            5: [2, 61]
                        }, {
                            5: [2, 63]
                        }, {
                            14: [1, 256]
                        }, {
                            14: [1, 257]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 258,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            14: [1, 259]
                        }, {
                            5: [2, 74]
                        }, {
                            5: [2, 75]
                        }, {
                            5: [2, 76]
                        }, {
                            5: [2, 85]
                        }, {
                            5: [2, 86]
                        }, {
                            5: [2, 87]
                        }, {
                            5: [2, 99]
                        }, {
                            5: [2, 100]
                        }, {
                            5: [2, 101]
                        }, {
                            35: [1, 260]
                        }, {
                            35: [1, 261],
                            38: [1, 262]
                        }, e(he, [2, 207]), e(he, [2, 208]), e(he, [2, 209]), {
                            5: [2, 29]
                        }, {
                            5: [2, 145]
                        }, {
                            5: [2, 146]
                        }, {
                            31: [1, 263]
                        }, {
                            5: [2, 50],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 251,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 51],
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 216,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            96: 251,
                            97: 215,
                            100: 67,
                            102: ee
                        }, {
                            5: [2, 125],
                            89: 264,
                            90: 162,
                            91: 163,
                            92: ue,
                            93: pe
                        }, e(me, [2, 136]), {
                            14: te,
                            16: 265,
                            35: ne,
                            38: re,
                            98: oe,
                            99: ie
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 267],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 266,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            100: 67,
                            102: ee
                        }, e(ye, [2, 130]), e(me, [2, 131]), {
                            5: [2, 65]
                        }, {
                            5: [2, 67]
                        }, e(ge, [2, 212], {
                            104: fe
                        }), {
                            5: [2, 69]
                        }, {
                            78: [1, 268]
                        }, {
                            80: [1, 269]
                        }, {
                            80: [1, 270]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            32: 271,
                            33: m,
                            34: y,
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            63: T,
                            64: k,
                            65: R,
                            66: 245,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 246,
                            102: ee
                        }, {
                            5: [2, 126]
                        }, e(me, [2, 137]), e(be, [2, 203]), e(be, [2, 204]), {
                            77: [1, 272]
                        }, {
                            77: [1, 273]
                        }, {
                            77: [1, 274]
                        }, {
                            5: [2, 31]
                        }, {
                            14: [1, 275]
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 276],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 277,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            6: t,
                            7: n,
                            9: r,
                            10: 176,
                            13: o,
                            15: i,
                            17: a,
                            18: s,
                            19: l,
                            20: c,
                            23: u,
                            25: p,
                            26: f,
                            27: h,
                            30: d,
                            33: m,
                            34: y,
                            35: [1, 278],
                            37: v,
                            38: _,
                            41: g,
                            43: b,
                            45: w,
                            46: x,
                            53: S,
                            55: C,
                            56: P,
                            57: E,
                            59: O,
                            60: A,
                            62: 279,
                            63: T,
                            64: k,
                            65: R,
                            66: 64,
                            67: I,
                            68: M,
                            69: N,
                            70: L,
                            71: j,
                            72: D,
                            73: V,
                            74: F,
                            75: B,
                            76: z,
                            78: U,
                            79: G,
                            80: H,
                            81: W,
                            83: q,
                            84: Y,
                            86: X,
                            87: $,
                            88: K,
                            92: Z,
                            93: Q,
                            95: J,
                            100: 67,
                            101: 65,
                            102: ee
                        }, {
                            5: [2, 102]
                        }, {
                            76: [1, 280]
                        }, {
                            76: [1, 281],
                            105: _e
                        }, {
                            76: [1, 282]
                        }, {
                            76: [1, 283],
                            105: _e
                        }, {
                            77: [1, 284]
                        }, {
                            77: [1, 285]
                        }, {
                            77: [1, 286]
                        }, {
                            77: [1, 287]
                        }, {
                            35: [1, 288]
                        }, {
                            35: [1, 289]
                        }, {
                            35: [1, 290]
                        }, {
                            35: [1, 291]
                        }, {
                            78: [1, 292]
                        }, {
                            78: [1, 293]
                        }, {
                            78: [1, 294]
                        }, {
                            78: [1, 295]
                        }, {
                            77: [1, 296]
                        }, {
                            77: [1, 297]
                        }, {
                            77: [1, 298]
                        }, {
                            77: [1, 299]
                        }, {
                            14: [1, 300]
                        }, {
                            14: [1, 301]
                        }, {
                            14: [1, 302]
                        }, {
                            14: [1, 303]
                        }, {
                            5: [2, 103]
                        }, {
                            5: [2, 105]
                        }, {
                            5: [2, 104]
                        }, {
                            5: [2, 106]
                        }],
                        defaultActions: {
                            3: [2, 2],
                            4: [2, 3],
                            7: [2, 8],
                            8: [2, 9],
                            11: [2, 14],
                            12: [2, 15],
                            13: [2, 16],
                            15: [2, 19],
                            16: [2, 20],
                            25: [2, 33],
                            26: [2, 34],
                            29: [2, 40],
                            33: [2, 44],
                            34: [2, 45],
                            35: [2, 46],
                            36: [2, 47],
                            38: [2, 52],
                            49: [2, 70],
                            57: [2, 93],
                            61: [2, 1],
                            62: [2, 5],
                            122: [2, 11],
                            125: [2, 18],
                            131: [2, 21],
                            134: [2, 22],
                            135: [2, 23],
                            136: [2, 24],
                            137: [2, 26],
                            138: [2, 27],
                            140: [2, 30],
                            142: [2, 32],
                            143: [2, 36],
                            144: [2, 37],
                            145: [2, 39],
                            146: [2, 41],
                            153: [2, 53],
                            154: [2, 107],
                            155: [2, 108],
                            156: [2, 109],
                            157: [2, 210],
                            158: [2, 110],
                            160: [2, 113],
                            180: [2, 77],
                            181: [2, 78],
                            182: [2, 79],
                            183: [2, 80],
                            185: [2, 82],
                            186: [2, 83],
                            191: [2, 88],
                            192: [2, 89],
                            194: [2, 91],
                            195: [2, 92],
                            196: [2, 94],
                            197: [2, 95],
                            198: [2, 96],
                            203: [2, 12],
                            204: [2, 13],
                            211: [2, 114],
                            219: [2, 116],
                            222: [2, 57],
                            223: [2, 58],
                            224: [2, 61],
                            225: [2, 63],
                            230: [2, 74],
                            231: [2, 75],
                            232: [2, 76],
                            233: [2, 85],
                            234: [2, 86],
                            235: [2, 87],
                            236: [2, 99],
                            237: [2, 100],
                            238: [2, 101],
                            244: [2, 29],
                            245: [2, 145],
                            246: [2, 146],
                            256: [2, 65],
                            257: [2, 67],
                            259: [2, 69],
                            264: [2, 126],
                            271: [2, 31],
                            275: [2, 102],
                            300: [2, 103],
                            301: [2, 105],
                            302: [2, 104],
                            303: [2, 106]
                        },
                        parseError: function(e, t) {
                            if (!t.recoverable) {
                                var n = new Error(e);
                                throw n.hash = t, n
                            }
                            this.trace(e)
                        },
                        parse: function(e) {
                            var t = this,
                                n = [0],
                                r = [],
                                o = [null],
                                i = [],
                                a = this.table,
                                s = "",
                                l = 0,
                                c = 0,
                                u = 0,
                                p = 1,
                                f = i.slice.call(arguments, 1),
                                h = Object.create(this.lexer),
                                d = {
                                    yy: {}
                                };
                            for (var m in this.yy) Object.prototype.hasOwnProperty.call(this.yy, m) && (d.yy[m] = this.yy[m]);
                            h.setInput(e, d.yy), d.yy.lexer = h, d.yy.parser = this, void 0 === h.yylloc && (h.yylloc = {});
                            var y = h.yylloc;
                            i.push(y);
                            var v = h.options && h.options.ranges;
                            "function" == typeof d.yy.parseError ? this.parseError = d.yy.parseError : this.parseError = Object.getPrototypeOf(this).parseError;
                            for (var _, g, b, w, x, S, C, P, E, O, A = {};;) {
                                if (b = n[n.length - 1], this.defaultActions[b] ? w = this.defaultActions[b] : (null == _ && (O = void 0, "number" != typeof(O = r.pop() || h.lex() || p) && (O instanceof Array && (O = (r = O).pop()), O = t.symbols_[O] || O), _ = O), w = a[b] && a[b][_]), void 0 === w || !w.length || !w[0]) {
                                    var T = "";
                                    for (S in E = [], a[b]) this.terminals_[S] && S > 2 && E.push("'" + this.terminals_[S] + "'");
                                    T = h.showPosition ? "Parse error on line " + (l + 1) + ":\n" + h.showPosition() + "\nExpecting " + E.join(", ") + ", got '" + (this.terminals_[_] || _) + "'" : "Parse error on line " + (l + 1) + ": Unexpected " + (_ == p ? "end of input" : "'" + (this.terminals_[_] || _) + "'"), this.parseError(T, {
                                        text: h.match,
                                        token: this.terminals_[_] || _,
                                        line: h.yylineno,
                                        loc: y,
                                        expected: E
                                    })
                                }
                                if (w[0] instanceof Array && w.length > 1) throw new Error("Parse Error: multiple actions possible at state: " + b + ", token: " + _);
                                switch (w[0]) {
                                    case 1:
                                        n.push(_), o.push(h.yytext), i.push(h.yylloc), n.push(w[1]), _ = null, g ? (_ = g, g = null) : (c = h.yyleng, s = h.yytext, l = h.yylineno, y = h.yylloc, u > 0 && u--);
                                        break;
                                    case 2:
                                        if (C = this.productions_[w[1]][1], A.$ = o[o.length - C], A._$ = {
                                                first_line: i[i.length - (C || 1)].first_line,
                                                last_line: i[i.length - 1].last_line,
                                                first_column: i[i.length - (C || 1)].first_column,
                                                last_column: i[i.length - 1].last_column
                                            }, v && (A._$.range = [i[i.length - (C || 1)].range[0], i[i.length - 1].range[1]]), void 0 !== (x = this.performAction.apply(A, [s, c, l, d.yy, w[1], o, i].concat(f)))) return x;
                                        C && (n = n.slice(0, -1 * C * 2), o = o.slice(0, -1 * C), i = i.slice(0, -1 * C)), n.push(this.productions_[w[1]][0]), o.push(A.$), i.push(A._$), P = a[n[n.length - 2]][n[n.length - 1]], n.push(P);
                                        break;
                                    case 3:
                                        return !0
                                }
                            }
                            return !0
                        }
                    },
                    xe = {
                        EOF: 1,
                        parseError: function(e, t) {
                            if (!this.yy.parser) throw new Error(e);
                            this.yy.parser.parseError(e, t)
                        },
                        setInput: function(e, t) {
                            return this.yy = t || this.yy || {}, this._input = e, this._more = this._backtrack = this.done = !1, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = "", this.conditionStack = ["INITIAL"], this.yylloc = {
                                first_line: 1,
                                first_column: 0,
                                last_line: 1,
                                last_column: 0
                            }, this.options.ranges && (this.yylloc.range = [0, 0]), this.offset = 0, this
                        },
                        input: function() {
                            var e = this._input[0];
                            return this.yytext += e, this.yyleng++, this.offset++, this.match += e, this.matched += e, e.match(/(?:\r\n?|\n).*/g) ? (this.yylineno++, this.yylloc.last_line++) : this.yylloc.last_column++, this.options.ranges && this.yylloc.range[1]++, this._input = this._input.slice(1), e
                        },
                        unput: function(e) {
                            var t = e.length,
                                n = e.split(/(?:\r\n?|\n)/g);
                            this._input = e + this._input, this.yytext = this.yytext.substr(0, this.yytext.length - t), this.offset -= t;
                            var r = this.match.split(/(?:\r\n?|\n)/g);
                            this.match = this.match.substr(0, this.match.length - 1), this.matched = this.matched.substr(0, this.matched.length - 1), n.length - 1 && (this.yylineno -= n.length - 1);
                            var o = this.yylloc.range;
                            return this.yylloc = {
                                first_line: this.yylloc.first_line,
                                last_line: this.yylineno + 1,
                                first_column: this.yylloc.first_column,
                                last_column: n ? (n.length === r.length ? this.yylloc.first_column : 0) + r[r.length - n.length].length - n[0].length : this.yylloc.first_column - t
                            }, this.options.ranges && (this.yylloc.range = [o[0], o[0] + this.yyleng - t]), this.yyleng = this.yytext.length, this
                        },
                        more: function() {
                            return this._more = !0, this
                        },
                        reject: function() {
                            return this.options.backtrack_lexer ? (this._backtrack = !0, this) : this.parseError("Lexical error on line " + (this.yylineno + 1) + ". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n" + this.showPosition(), {
                                text: "",
                                token: null,
                                line: this.yylineno
                            })
                        },
                        less: function(e) {
                            this.unput(this.match.slice(e))
                        },
                        pastInput: function() {
                            var e = this.matched.substr(0, this.matched.length - this.match.length);
                            return (e.length > 20 ? "..." : "") + e.substr(-20).replace(/\n/g, "")
                        },
                        upcomingInput: function() {
                            var e = this.match;
                            return e.length < 20 && (e += this._input.substr(0, 20 - e.length)), (e.substr(0, 20) + (e.length > 20 ? "..." : "")).replace(/\n/g, "")
                        },
                        showPosition: function() {
                            var e = this.pastInput(),
                                t = new Array(e.length + 1).join("-");
                            return e + this.upcomingInput() + "\n" + t + "^"
                        },
                        test_match: function(e, t) {
                            var n, r, o;
                            if (this.options.backtrack_lexer && (o = {
                                    yylineno: this.yylineno,
                                    yylloc: {
                                        first_line: this.yylloc.first_line,
                                        last_line: this.last_line,
                                        first_column: this.yylloc.first_column,
                                        last_column: this.yylloc.last_column
                                    },
                                    yytext: this.yytext,
                                    match: this.match,
                                    matches: this.matches,
                                    matched: this.matched,
                                    yyleng: this.yyleng,
                                    offset: this.offset,
                                    _more: this._more,
                                    _input: this._input,
                                    yy: this.yy,
                                    conditionStack: this.conditionStack.slice(0),
                                    done: this.done
                                }, this.options.ranges && (o.yylloc.range = this.yylloc.range.slice(0))), (r = e[0].match(/(?:\r\n?|\n).*/g)) && (this.yylineno += r.length), this.yylloc = {
                                    first_line: this.yylloc.last_line,
                                    last_line: this.yylineno + 1,
                                    first_column: this.yylloc.last_column,
                                    last_column: r ? r[r.length - 1].length - r[r.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + e[0].length
                                }, this.yytext += e[0], this.match += e[0], this.matches = e, this.yyleng = this.yytext.length, this.options.ranges && (this.yylloc.range = [this.offset, this.offset += this.yyleng]), this._more = !1, this._backtrack = !1, this._input = this._input.slice(e[0].length), this.matched += e[0], n = this.performAction.call(this, this.yy, this, t, this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = !1), n) return n;
                            if (this._backtrack) {
                                for (var i in o) this[i] = o[i];
                                return !1
                            }
                            return !1
                        },
                        next: function() {
                            if (this.done) return this.EOF;
                            var e, t, n, r;
                            this._input || (this.done = !0), this._more || (this.yytext = "", this.match = "");
                            for (var o = this._currentRules(), i = 0; i < o.length; i++)
                                if ((n = this._input.match(this.rules[o[i]])) && (!t || n[0].length > t[0].length)) {
                                    if (t = n, r = i, this.options.backtrack_lexer) {
                                        if (!1 !== (e = this.test_match(n, o[i]))) return e;
                                        if (this._backtrack) {
                                            t = !1;
                                            continue
                                        }
                                        return !1
                                    }
                                    if (!this.options.flex) break
                                } return t ? !1 !== (e = this.test_match(t, o[r])) && e : "" === this._input ? this.EOF : this.parseError("Lexical error on line " + (this.yylineno + 1) + ". Unrecognized text.\n" + this.showPosition(), {
                                text: "",
                                token: null,
                                line: this.yylineno
                            })
                        },
                        lex: function() {
                            var e = this.next();
                            return e || this.lex()
                        },
                        begin: function(e) {
                            this.conditionStack.push(e)
                        },
                        popState: function() {
                            return this.conditionStack.length - 1 > 0 ? this.conditionStack.pop() : this.conditionStack[0]
                        },
                        _currentRules: function() {
                            return this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1] ? this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules : this.conditions.INITIAL.rules
                        },
                        topState: function(e) {
                            return (e = this.conditionStack.length - 1 - Math.abs(e || 0)) >= 0 ? this.conditionStack[e] : "INITIAL"
                        },
                        pushState: function(e) {
                            this.begin(e)
                        },
                        stateStackSize: function() {
                            return this.conditionStack.length
                        },
                        options: {
                            "case-insensitive": !0
                        },
                        performAction: function(e, t, n, r) {
                            switch (n) {
                                case 0:
                                    break;
                                case 1:
                                case 2:
                                    return "";
                                case 3:
                                    return 42;
                                case 4:
                                    return 35;
                                case 5:
                                    return 98;
                                case 6:
                                case 7:
                                    return 99;
                                case 8:
                                    return 8;
                                case 9:
                                    return 6;
                                case 10:
                                    return 102;
                                case 11:
                                    return 7;
                                case 12:
                                    return 9;
                                case 13:
                                    return 81;
                                case 14:
                                    return 83;
                                case 15:
                                    return 13;
                                case 16:
                                    return 15;
                                case 17:
                                    return 17;
                                case 18:
                                    return 18;
                                case 19:
                                    return 19;
                                case 20:
                                    return 20;
                                case 21:
                                    return 11;
                                case 22:
                                    return 84;
                                case 23:
                                    return 86;
                                case 24:
                                    return 23;
                                case 25:
                                    return 25;
                                case 26:
                                    return 26;
                                case 27:
                                    return 27;
                                case 28:
                                    return 30;
                                case 29:
                                    return 34;
                                case 30:
                                    return 33;
                                case 31:
                                    return 87;
                                case 32:
                                    return 88;
                                case 33:
                                    return 37;
                                case 34:
                                    return 41;
                                case 35:
                                    return 43;
                                case 36:
                                    return 53;
                                case 37:
                                    return 55;
                                case 38:
                                    return 56;
                                case 39:
                                    return 46;
                                case 40:
                                    return 48;
                                case 41:
                                    return 45;
                                case 42:
                                    return 57;
                                case 43:
                                    return 59;
                                case 44:
                                    return 44;
                                case 45:
                                    return 60;
                                case 46:
                                    return 63;
                                case 47:
                                    return 64;
                                case 48:
                                    return 65;
                                case 49:
                                    return 67;
                                case 50:
                                    return 68;
                                case 51:
                                    return 69;
                                case 52:
                                    return 70;
                                case 53:
                                    return 71;
                                case 54:
                                    return 72;
                                case 55:
                                    return 73;
                                case 56:
                                    return 75;
                                case 57:
                                    return 74;
                                case 58:
                                case 59:
                                    return 92;
                                case 60:
                                case 61:
                                    return 93;
                                case 62:
                                case 63:
                                case 64:
                                    return 95;
                                case 65:
                                    return 31;
                                case 66:
                                    return 36;
                                case 67:
                                    return 79;
                                case 68:
                                    return 76;
                                case 69:
                                    return 80;
                                case 70:
                                    return 78;
                                case 71:
                                    return t.yytext = e.utils.unquoteString(t.yytext), 14;
                                case 72:
                                    return 38;
                                case 73:
                                    return 5;
                                case 74:
                                    return 104;
                                case 75:
                                    return 105;
                                case 76:
                                    return "\\";
                                case 77:
                                    return 28;
                                case 78:
                                    return 61;
                                case 79:
                                    return 29;
                                case 80:
                                    return 58;
                                case 81:
                                    return 77
                            }
                        },
                        rules: [/^(?:\s+)/i, /^(?:[#].*)/i, /^(?:\/\/.*)/i, /^(?:([_A-Z0-9\/\+]+==))/i, /^(?:-?[0-9]+(\.[0-9]+)?\b)/i, /^(?:0[xX][0-9A-F]+\b)/i, /^(?:false\b)/i, /^(?:true\b)/i, /^(?:all\b)/i, /^(?:reset\b)/i, /^(?:clear\b)/i, /^(?:build\b)/i, /^(?:help\b)/i, /^(?:load\b)/i, /^(?:script\b)/i, /^(?:get\b)/i, /^(?:set\b)/i, /^(?:set_save\b)/i, /^(?:set_restore\b)/i, /^(?:set_reset\b)/i, /^(?:preset\b)/i, /^(?:motm\b)/i, /^(?:add\b)/i, /^(?:rep\b)/i, /^(?:remove\b)/i, /^(?:hide\b)/i, /^(?:show\b)/i, /^(?:list\b)/i, /^(?:select\b)/i, /^(?:within\b)/i, /^(?:selector\b)/i, /^(?:mode\b)/i, /^(?:color\b)/i, /^(?:material\b)/i, /^(?:view\b)/i, /^(?:unit\b)/i, /^(?:line\b)/i, /^(?:listobj\b)/i, /^(?:removeobj\b)/i, /^(?:rotate\b)/i, /^(?:translate\b)/i, /^(?:scale\b)/i, /^(?:url\b)/i, /^(?:screenshot\b)/i, /^(?:dssp\b)/i, /^(?:file_list\b)/i, /^(?:file_register\b)/i, /^(?:file_delete\b)/i, /^(?:preset_add\b)/i, /^(?:preset_delete\b)/i, /^(?:preset_update\b)/i, /^(?:preset_rename\b)/i, /^(?:preset_open\b)/i, /^(?:create_scenario\b)/i, /^(?:reset_scenario\b)/i, /^(?:delete_scenario\b)/i, /^(?:add_scenario_item\b)/i, /^(?:list_scenario\b)/i, /^(?:s\b)/i, /^(?:mt\b)/i, /^(?:m\b)/i, /^(?:c\b)/i, /^(?:x\b)/i, /^(?:y\b)/i, /^(?:z\b)/i, /^(?:as\b)/i, /^(?:of\b)/i, /^(?:pdb\b)/i, /^(?:delay\b)/i, /^(?:prst\b)/i, /^(?:desc\b)/i, /^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i, /^(?:([_A-Z0-9]+))/i, /^(?:$)/i, /^(?:\.)/i, /^(?:\/)/i, /^(?:\\)/i, /^(?:-e\b)/i, /^(?:-f\b)/i, /^(?:-s\b)/i, /^(?:-v\b)/i, /^(?:=)/i],
                        conditions: {
                            INITIAL: {
                                rules: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81],
                                inclusive: !0
                            }
                        }
                    };

                function Se() {
                    this.yy = {}
                }
                return we.lexer = xe, Se.prototype = we, we.Parser = Se, new Se
            }();
            e.exports = {
                parser: n
            }
        },
        "4oJk": function(e, t) {
            var n = function() {
                var e = function(e, t, n, r) {
                        for (n = n || {}, r = e.length; r--; n[e[r]] = t);
                        return n
                    },
                    t = [1, 4],
                    n = [1, 5],
                    r = [1, 6],
                    o = [1, 7],
                    i = [1, 8],
                    a = [1, 9],
                    s = [1, 11],
                    l = [1, 12],
                    c = [5, 7, 8, 11],
                    u = [1, 17],
                    p = [1, 22],
                    f = [1, 20],
                    h = [1, 21],
                    d = [5, 7, 8, 11, 19],
                    m = {
                        trace: function() {},
                        yy: {},
                        symbols_: {
                            error: 2,
                            Program: 3,
                            Expression: 4,
                            EOF: 5,
                            Selector: 6,
                            OR: 7,
                            AND: 8,
                            NOT: 9,
                            "(": 10,
                            ")": 11,
                            SELECTOR: 12,
                            NAMED_SELECTOR: 13,
                            SELECTOR_RANGED: 14,
                            RangeList: 15,
                            SELECTOR_NAMED: 16,
                            NameList: 17,
                            Range: 18,
                            ",": 19,
                            NUMBER: 20,
                            ":": 21,
                            Name: 22,
                            IDENTIFIER: 23,
                            STRING: 24,
                            $accept: 0,
                            $end: 1
                        },
                        terminals_: {
                            2: "error",
                            5: "EOF",
                            7: "OR",
                            8: "AND",
                            9: "NOT",
                            10: "(",
                            11: ")",
                            12: "SELECTOR",
                            13: "NAMED_SELECTOR",
                            14: "SELECTOR_RANGED",
                            16: "SELECTOR_NAMED",
                            19: ",",
                            20: "NUMBER",
                            21: ":",
                            23: "IDENTIFIER",
                            24: "STRING"
                        },
                        productions_: [0, [3, 2],
                            [4, 1],
                            [4, 3],
                            [4, 3],
                            [4, 2],
                            [4, 3],
                            [6, 1],
                            [6, 1],
                            [6, 2],
                            [6, 2],
                            [15, 1],
                            [15, 3],
                            [18, 1],
                            [18, 3],
                            [17, 1],
                            [17, 3],
                            [22, 1],
                            [22, 1],
                            [22, 1]
                        ],
                        performAction: function(e, t, n, r, o, i, a) {
                            var s = i.length - 1;
                            switch (o) {
                                case 1:
                                    return i[s - 1];
                                case 3:
                                    this.$ = r.keyword("or")(i[s - 2], i[s]);
                                    break;
                                case 4:
                                    this.$ = r.keyword("and")(i[s - 2], i[s]);
                                    break;
                                case 5:
                                    this.$ = r.keyword("not")(i[s]);
                                    break;
                                case 6:
                                    this.$ = i[s - 1];
                                    break;
                                case 7:
                                    this.$ = r.keyword(i[s])();
                                    break;
                                case 8:
                                    this.$ = r.GetSelector(i[s].toLowerCase().slice(1, i[s].length));
                                    break;
                                case 9:
                                case 10:
                                    this.$ = r.keyword(i[s - 1])(i[s]);
                                    break;
                                case 11:
                                    this.$ = new r.RangeList(i[s]);
                                    break;
                                case 12:
                                case 16:
                                    this.$ = i[s - 2].append(i[s]);
                                    break;
                                case 13:
                                    this.$ = new r.Range(Number(i[s]));
                                    break;
                                case 14:
                                    this.$ = new r.Range(Number(i[s - 2]), Number(i[s]));
                                    break;
                                case 15:
                                    this.$ = new r.ValueList(i[s])
                            }
                        },
                        table: [{
                            3: 1,
                            4: 2,
                            6: 3,
                            9: t,
                            10: n,
                            12: r,
                            13: o,
                            14: i,
                            16: a
                        }, {
                            1: [3]
                        }, {
                            5: [1, 10],
                            7: s,
                            8: l
                        }, e(c, [2, 2]), {
                            4: 13,
                            6: 3,
                            9: t,
                            10: n,
                            12: r,
                            13: o,
                            14: i,
                            16: a
                        }, {
                            4: 14,
                            6: 3,
                            9: t,
                            10: n,
                            12: r,
                            13: o,
                            14: i,
                            16: a
                        }, e(c, [2, 7]), e(c, [2, 8]), {
                            15: 15,
                            18: 16,
                            20: u
                        }, {
                            17: 18,
                            20: p,
                            22: 19,
                            23: f,
                            24: h
                        }, {
                            1: [2, 1]
                        }, {
                            4: 23,
                            6: 3,
                            9: t,
                            10: n,
                            12: r,
                            13: o,
                            14: i,
                            16: a
                        }, {
                            4: 24,
                            6: 3,
                            9: t,
                            10: n,
                            12: r,
                            13: o,
                            14: i,
                            16: a
                        }, e(c, [2, 5]), {
                            7: s,
                            8: l,
                            11: [1, 25]
                        }, e(c, [2, 9], {
                            19: [1, 26]
                        }), e(d, [2, 11]), e(d, [2, 13], {
                            21: [1, 27]
                        }), e(c, [2, 10], {
                            19: [1, 28]
                        }), e(d, [2, 15]), e(d, [2, 17]), e(d, [2, 18]), e(d, [2, 19]), e([5, 7, 11], [2, 3], {
                            8: l
                        }), e(c, [2, 4]), e(c, [2, 6]), {
                            18: 29,
                            20: u
                        }, {
                            20: [1, 30]
                        }, {
                            20: p,
                            22: 31,
                            23: f,
                            24: h
                        }, e(d, [2, 12]), e(d, [2, 14]), e(d, [2, 16])],
                        defaultActions: {
                            10: [2, 1]
                        },
                        parseError: function(e, t) {
                            if (!t.recoverable) {
                                var n = new Error(e);
                                throw n.hash = t, n
                            }
                            this.trace(e)
                        },
                        parse: function(e) {
                            var t = this,
                                n = [0],
                                r = [],
                                o = [null],
                                i = [],
                                a = this.table,
                                s = "",
                                l = 0,
                                c = 0,
                                u = 0,
                                p = 1,
                                f = i.slice.call(arguments, 1),
                                h = Object.create(this.lexer),
                                d = {
                                    yy: {}
                                };
                            for (var m in this.yy) Object.prototype.hasOwnProperty.call(this.yy, m) && (d.yy[m] = this.yy[m]);
                            h.setInput(e, d.yy), d.yy.lexer = h, d.yy.parser = this, void 0 === h.yylloc && (h.yylloc = {});
                            var y = h.yylloc;
                            i.push(y);
                            var v = h.options && h.options.ranges;
                            "function" == typeof d.yy.parseError ? this.parseError = d.yy.parseError : this.parseError = Object.getPrototypeOf(this).parseError;
                            for (var _, g, b, w, x, S, C, P, E, O, A = {};;) {
                                if (b = n[n.length - 1], this.defaultActions[b] ? w = this.defaultActions[b] : (null == _ && (O = void 0, "number" != typeof(O = r.pop() || h.lex() || p) && (O instanceof Array && (O = (r = O).pop()), O = t.symbols_[O] || O), _ = O), w = a[b] && a[b][_]), void 0 === w || !w.length || !w[0]) {
                                    var T = "";
                                    for (S in E = [], a[b]) this.terminals_[S] && S > 2 && E.push("'" + this.terminals_[S] + "'");
                                    T = h.showPosition ? "Parse error on line " + (l + 1) + ":\n" + h.showPosition() + "\nExpecting " + E.join(", ") + ", got '" + (this.terminals_[_] || _) + "'" : "Parse error on line " + (l + 1) + ": Unexpected " + (_ == p ? "end of input" : "'" + (this.terminals_[_] || _) + "'"), this.parseError(T, {
                                        text: h.match,
                                        token: this.terminals_[_] || _,
                                        line: h.yylineno,
                                        loc: y,
                                        expected: E
                                    })
                                }
                                if (w[0] instanceof Array && w.length > 1) throw new Error("Parse Error: multiple actions possible at state: " + b + ", token: " + _);
                                switch (w[0]) {
                                    case 1:
                                        n.push(_), o.push(h.yytext), i.push(h.yylloc), n.push(w[1]), _ = null, g ? (_ = g, g = null) : (c = h.yyleng, s = h.yytext, l = h.yylineno, y = h.yylloc, u > 0 && u--);
                                        break;
                                    case 2:
                                        if (C = this.productions_[w[1]][1], A.$ = o[o.length - C], A._$ = {
                                                first_line: i[i.length - (C || 1)].first_line,
                                                last_line: i[i.length - 1].last_line,
                                                first_column: i[i.length - (C || 1)].first_column,
                                                last_column: i[i.length - 1].last_column
                                            }, v && (A._$.range = [i[i.length - (C || 1)].range[0], i[i.length - 1].range[1]]), void 0 !== (x = this.performAction.apply(A, [s, c, l, d.yy, w[1], o, i].concat(f)))) return x;
                                        C && (n = n.slice(0, -1 * C * 2), o = o.slice(0, -1 * C), i = i.slice(0, -1 * C)), n.push(this.productions_[w[1]][0]), o.push(A.$), i.push(A._$), P = a[n[n.length - 2]][n[n.length - 1]], n.push(P);
                                        break;
                                    case 3:
                                        return !0
                                }
                            }
                            return !0
                        }
                    },
                    y = {
                        EOF: 1,
                        parseError: function(e, t) {
                            if (!this.yy.parser) throw new Error(e);
                            this.yy.parser.parseError(e, t)
                        },
                        setInput: function(e, t) {
                            return this.yy = t || this.yy || {}, this._input = e, this._more = this._backtrack = this.done = !1, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = "", this.conditionStack = ["INITIAL"], this.yylloc = {
                                first_line: 1,
                                first_column: 0,
                                last_line: 1,
                                last_column: 0
                            }, this.options.ranges && (this.yylloc.range = [0, 0]), this.offset = 0, this
                        },
                        input: function() {
                            var e = this._input[0];
                            return this.yytext += e, this.yyleng++, this.offset++, this.match += e, this.matched += e, e.match(/(?:\r\n?|\n).*/g) ? (this.yylineno++, this.yylloc.last_line++) : this.yylloc.last_column++, this.options.ranges && this.yylloc.range[1]++, this._input = this._input.slice(1), e
                        },
                        unput: function(e) {
                            var t = e.length,
                                n = e.split(/(?:\r\n?|\n)/g);
                            this._input = e + this._input, this.yytext = this.yytext.substr(0, this.yytext.length - t), this.offset -= t;
                            var r = this.match.split(/(?:\r\n?|\n)/g);
                            this.match = this.match.substr(0, this.match.length - 1), this.matched = this.matched.substr(0, this.matched.length - 1), n.length - 1 && (this.yylineno -= n.length - 1);
                            var o = this.yylloc.range;
                            return this.yylloc = {
                                first_line: this.yylloc.first_line,
                                last_line: this.yylineno + 1,
                                first_column: this.yylloc.first_column,
                                last_column: n ? (n.length === r.length ? this.yylloc.first_column : 0) + r[r.length - n.length].length - n[0].length : this.yylloc.first_column - t
                            }, this.options.ranges && (this.yylloc.range = [o[0], o[0] + this.yyleng - t]), this.yyleng = this.yytext.length, this
                        },
                        more: function() {
                            return this._more = !0, this
                        },
                        reject: function() {
                            return this.options.backtrack_lexer ? (this._backtrack = !0, this) : this.parseError("Lexical error on line " + (this.yylineno + 1) + ". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n" + this.showPosition(), {
                                text: "",
                                token: null,
                                line: this.yylineno
                            })
                        },
                        less: function(e) {
                            this.unput(this.match.slice(e))
                        },
                        pastInput: function() {
                            var e = this.matched.substr(0, this.matched.length - this.match.length);
                            return (e.length > 20 ? "..." : "") + e.substr(-20).replace(/\n/g, "")
                        },
                        upcomingInput: function() {
                            var e = this.match;
                            return e.length < 20 && (e += this._input.substr(0, 20 - e.length)), (e.substr(0, 20) + (e.length > 20 ? "..." : "")).replace(/\n/g, "")
                        },
                        showPosition: function() {
                            var e = this.pastInput(),
                                t = new Array(e.length + 1).join("-");
                            return e + this.upcomingInput() + "\n" + t + "^"
                        },
                        test_match: function(e, t) {
                            var n, r, o;
                            if (this.options.backtrack_lexer && (o = {
                                    yylineno: this.yylineno,
                                    yylloc: {
                                        first_line: this.yylloc.first_line,
                                        last_line: this.last_line,
                                        first_column: this.yylloc.first_column,
                                        last_column: this.yylloc.last_column
                                    },
                                    yytext: this.yytext,
                                    match: this.match,
                                    matches: this.matches,
                                    matched: this.matched,
                                    yyleng: this.yyleng,
                                    offset: this.offset,
                                    _more: this._more,
                                    _input: this._input,
                                    yy: this.yy,
                                    conditionStack: this.conditionStack.slice(0),
                                    done: this.done
                                }, this.options.ranges && (o.yylloc.range = this.yylloc.range.slice(0))), (r = e[0].match(/(?:\r\n?|\n).*/g)) && (this.yylineno += r.length), this.yylloc = {
                                    first_line: this.yylloc.last_line,
                                    last_line: this.yylineno + 1,
                                    first_column: this.yylloc.last_column,
                                    last_column: r ? r[r.length - 1].length - r[r.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + e[0].length
                                }, this.yytext += e[0], this.match += e[0], this.matches = e, this.yyleng = this.yytext.length, this.options.ranges && (this.yylloc.range = [this.offset, this.offset += this.yyleng]), this._more = !1, this._backtrack = !1, this._input = this._input.slice(e[0].length), this.matched += e[0], n = this.performAction.call(this, this.yy, this, t, this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = !1), n) return n;
                            if (this._backtrack) {
                                for (var i in o) this[i] = o[i];
                                return !1
                            }
                            return !1
                        },
                        next: function() {
                            if (this.done) return this.EOF;
                            var e, t, n, r;
                            this._input || (this.done = !0), this._more || (this.yytext = "", this.match = "");
                            for (var o = this._currentRules(), i = 0; i < o.length; i++)
                                if ((n = this._input.match(this.rules[o[i]])) && (!t || n[0].length > t[0].length)) {
                                    if (t = n, r = i, this.options.backtrack_lexer) {
                                        if (!1 !== (e = this.test_match(n, o[i]))) return e;
                                        if (this._backtrack) {
                                            t = !1;
                                            continue
                                        }
                                        return !1
                                    }
                                    if (!this.options.flex) break
                                } return t ? !1 !== (e = this.test_match(t, o[r])) && e : "" === this._input ? this.EOF : this.parseError("Lexical error on line " + (this.yylineno + 1) + ". Unrecognized text.\n" + this.showPosition(), {
                                text: "",
                                token: null,
                                line: this.yylineno
                            })
                        },
                        lex: function() {
                            var e = this.next();
                            return e || this.lex()
                        },
                        begin: function(e) {
                            this.conditionStack.push(e)
                        },
                        popState: function() {
                            return this.conditionStack.length - 1 > 0 ? this.conditionStack.pop() : this.conditionStack[0]
                        },
                        _currentRules: function() {
                            return this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1] ? this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules : this.conditions.INITIAL.rules
                        },
                        topState: function(e) {
                            return (e = this.conditionStack.length - 1 - Math.abs(e || 0)) >= 0 ? this.conditionStack[e] : "INITIAL"
                        },
                        pushState: function(e) {
                            this.begin(e)
                        },
                        stateStackSize: function() {
                            return this.conditionStack.length
                        },
                        options: {
                            "case-insensitive": !0
                        },
                        performAction: function(e, t, n, r) {
                            switch (n) {
                                case 0:
                                    break;
                                case 1:
                                    return 20;
                                case 2:
                                    return 7;
                                case 3:
                                    return 8;
                                case 4:
                                    return 9;
                                case 5:
                                    return 12;
                                case 6:
                                    return 16;
                                case 7:
                                    return 14;
                                case 8:
                                    return 10;
                                case 9:
                                    return 11;
                                case 10:
                                    return 19;
                                case 11:
                                    return 21;
                                case 12:
                                    return "<=";
                                case 13:
                                    return ">=";
                                case 14:
                                    return "<";
                                case 15:
                                    return ">";
                                case 16:
                                    return t.yytext = t.yytext.substr(1, t.yyleng - 2), 24;
                                case 17:
                                    return 13;
                                case 18:
                                    return 23;
                                case 19:
                                    return 5;
                                case 20:
                                    return "INVALID"
                            }
                        },
                        rules: [/^(?:\s+)/i, /^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i, /^(?:OR\b)/i, /^(?:AND\b)/i, /^(?:NOT\b)/i, /^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i, /^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i, /^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i, /^(?:\()/i, /^(?:\))/i, /^(?:,)/i, /^(?::)/i, /^(?:<=)/i, /^(?:>=)/i, /^(?:<)/i, /^(?:>)/i, /^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i, /^(?:(@[_A-Z0-9]+))/i, /^(?:([_A-Z0-9]+))/i, /^(?:$)/i, /^(?:.)/i],
                        conditions: {
                            INITIAL: {
                                rules: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
                                inclusive: !0
                            }
                        }
                    };

                function v() {
                    this.yy = {}
                }
                return m.lexer = y, v.prototype = m, m.Parser = v, new v
            }();
            e.exports = {
                parser: n
            }
        },
        mDBS: function(e, t, n) {},
        xGHL: function(e, t, n) {
            "use strict";
            n.r(t);
            n("+eM2"), n("D89A"), n("YeN5"), n("A3U8"), n("mDBS"), n("55Il");
            var r = n("EVdn"),
                o = n.n(r),
                i = n("hUol"),
                a = n.n(i),
                s = n("LvDl"),
                l = n.n(s),
                c = n("Womt"),
                u = n("RnbG");

            function p(e, t) {
                return !e || e === t
            }

            function f() {
                this._handlers = {}
            }
            f.prototype.addEventListener = function(e, t, n) {
                var r = this._handlers[e];
                r || (this._handlers[e] = [], r = this._handlers[e]);
                var o = [t, n];
                void 0 === l.a.find(r, function(e) {
                    return e[0] === o[0] && e[1] === o[1]
                }) && r.push(o)
            }, f.prototype.removeEventListener = function(e, t, n) {
                var r = this;
                l.a.forEach(r._handlers, function(o, i) {
                    l.a.remove(o, function(o) {
                        return p(e, i) && p(t, o[0]) && p(n, o[1] || r)
                    })
                }), this._handlers = l.a.omitBy(r._handlers, function(e) {
                    return 0 === e.length
                })
            }, f.prototype.dispatchEvent = function(e) {
                var t = this;
                l.a.forEach(this._handlers[e.type], function(n) {
                    var r = n[1] || t;
                    n[0].apply(r, [e])
                })
            };
            var h = f,
                d = {
                    debug: 0,
                    info: 1,
                    report: 2,
                    warn: 3,
                    error: 4
                };

            function m() {
                h.call(this), this.console = !1, this._level = d.warn
            }
            m.prototype = Object.create(h.prototype), m.prototype.constructor = m, m.prototype.instantiate = function() {
                return new m
            }, Object.defineProperty(m.prototype, "level", {
                get: function() {
                    var e = this;
                    return l.a.findKey(d, function(t) {
                        return t === e._level
                    })
                },
                set: function(e) {
                    var t = d[e];
                    if (!l.a.isNumber(t)) throw new Error("Wrong log level specified!");
                    this._level = t
                }
            }), m.prototype.levels = function() {
                return Object.keys(d)
            }, m.prototype.message = function(e, t) {
                var n = d[e];
                if (!l.a.isNumber(n)) throw new Error("Wrong log level specified!");
                this._message(n, t)
            }, m.prototype.debug = function(e) {
                this._message(d.debug, e)
            }, m.prototype.info = function(e) {
                this._message(d.info, e)
            }, m.prototype.report = function(e) {
                this._message(d.report, e)
            }, m.prototype.warn = function(e) {
                this._message(d.warn, e)
            }, m.prototype.error = function(e) {
                this._message(d.error, e)
            }, m.prototype._message = function(e, t) {
                if (!(e < this._level)) {
                    var n = l.a.findKey(d, function(t) {
                        return t === e
                    });
                    if (t = String(t), this.console) {
                        var r = "miew:".concat(n, ": ").concat(t);
                        "error" === n ? console.error(r) : "warning" === n ? console.warn(r) : console.log(r)
                    }
                    this.dispatchEvent({
                        type: "message",
                        level: n,
                        message: t
                    })
                }
            };
            var y, v = new m;

            function _(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function g() {
                this.startTime = 0, this.oldTime = 0, this.elapsedTime = 0, this.running = !1
            }

            function b(e) {
                return decodeURIComponent(e.replace(/\+/g, " "))
            }

            function w(e) {
                for (var t, n = (e = e || window.location.search).substring(e.indexOf("?") + 1), r = /([^&=]+)=?([^&]*)/g, o = []; null !== (t = r.exec(n));) o.push([b(t[1]), b(t[2])]);
                return o
            }

            function x(e) {
                var t = !1;
                this.enable = function(e) {
                    t = e
                };
                var n = 0,
                    r = Object.keys(e);

                function o(e, r) {
                    return function() {
                        var o = x.spaces.substr(0, 2 * n);
                        t && v.debug("".concat(o + r, " {")), n++;
                        for (var i = arguments.length, a = new Array(i), s = 0; s < i; s++) a[s] = arguments[s];
                        var l = e.apply(this, a);
                        return n--, t && v.debug("".concat(o, "} // ").concat(r)), l
                    }
                }
                for (var i = 0, a = r.length; i < a; ++i) {
                    var s = r[i],
                        l = e[s];
                    l instanceof Function && "constructor" !== s && (e[s] = o(l, s))
                }
            }

            function S(e) {
                Error.call(this), this.name = "OutOfMemoryError", this.message = e
            }

            function C(e) {
                for (var t = new Uint8Array(e), n = "", r = 0; r < t.byteLength; r++) n += String.fromCharCode(t[r]);
                return window.btoa(n)
            }

            function P(e) {
                for (var t = window.atob(e), n = new Uint8Array(t.length), r = 0; r < n.length; ++r) n[r] = t[r].charCodeAt(0);
                return n.buffer
            }

            function E(e) {
                if (l.a.isPlainObject(e)) return !0;
                var t = e && Object.getPrototypeOf(e);
                return !!t && !t.hasOwnProperty("constructor") && E(t)
            }

            function O(e) {
                return e.slice(Math.max(0, e.lastIndexOf(".")) || 1 / 0)
            }

            function A(e) {
                var t = e.split(/[:;,]/),
                    n = t.length;
                return n >= 3 && "base64" === t[n - 2] ? new Blob([P(t[n - 1])]) : null
            }
            g.now = (y = "undefined" != typeof window && window.performance) && y.now ? y.now.bind(y) : Date.now, g.prototype = {
                constructor: g,
                start: function() {
                    this.startTime = g.now(), this.oldTime = this.startTime, this.running = !0
                },
                stop: function() {
                    this.getElapsedTime(), this.running = !1
                },
                getElapsedTime: function() {
                    return this.update(), this.elapsedTime
                },
                update: function() {
                    var e = 0;
                    if (this.running) {
                        var t = g.now();
                        e = .001 * (t - this.oldTime), this.oldTime = t, this.elapsedTime += e
                    }
                    return e
                }
            }, x.spaces = "                                                                                          ", S.prototype = Object.create(Error.prototype);
            var T = /^[a-zA-Z0-9_]*$/,
                k = ['"', "", '"'];
            var R = {
                Timer: g,
                encodeQueryComponent: function(e, t) {
                    return encodeURIComponent(e).replace(t, function(e) {
                        return String.fromCharCode(parseInt(e.substr(1), 16))
                    }).replace(/%20/g, "+")
                },
                decodeQueryComponent: b,
                getUrlParameters: w,
                getUrlParametersAsDict: function(e) {
                    for (var t = {}, n = w(e), r = 0; r < n.length; ++r) {
                        var o = _(n[r], 2),
                            i = o[0],
                            a = o[1];
                        t[i] = a
                    }
                    return t
                },
                resolveURL: function(e) {
                    if ("undefined" != typeof URL) try {
                        return "undefined" != typeof window ? new URL(e, window.location).href : new URL(e).href
                    } catch (e) {}
                    if ("undefined" != typeof document) {
                        var t = document.createElement("a");
                        return t.href = e, t.href
                    }
                    return e
                },
                generateRegExp: function(e) {
                    for (var t = [], n = 0, r = e.length; n < r; ++n) t[t.length] = e[n].charCodeAt(0).toString(16);
                    var o = t.join("|");
                    return new RegExp("%(?:".concat(o, ")"), "gi")
                },
                createElement: function(e, t, n) {
                    var r, o, i = document.createElement(e);
                    if (t) {
                        var a = Object.keys(t);
                        for (r = 0, o = a.length; r < o; ++r) {
                            var s = a[r];
                            i.setAttribute(s, t[s])
                        }
                    }
                    if (n)
                        for (n instanceof Array || (n = [n]), r = 0, o = n.length; r < o; ++r) {
                            var l = n[r];
                            "string" == typeof l ? i.appendChild(document.createTextNode(l)) : l instanceof HTMLElement && i.appendChild(l)
                        }
                    return i
                },
                deriveClass: function(e, t, n, r) {
                    return e.prototype = l.a.assign(Object.create(t.prototype), {
                        constructor: e
                    }, n), r && l.a.assign(e, r), e
                },
                deriveDeep: function e(t, n) {
                    var r, o, i = t;
                    if (t instanceof Array)
                        for (i = new Array(t.length), r = 0, o = t.length; r < o; ++r) i[r] = e(t[r]);
                    else if (t instanceof Object) {
                        i = Object.create(t);
                        var a = Object.keys(t);
                        for (r = 0, o = a.length; r < o; ++r) {
                            var s = a[r],
                                l = t[s],
                                c = e(l);
                            c !== l && (i[s] = c)
                        }
                        n && Object.keys(i).length > 0 && (i = Object.create(i))
                    }
                    return i
                },
                hexColor: function(e) {
                    var t = "0000000".concat(e.toString(16)).substr(-6);
                    return "#".concat(t)
                },
                DebugTracer: x,
                OutOfMemoryError: S,
                allocateTyped: function(e, t) {
                    var n = null;
                    try {
                        n = new e(t)
                    } catch (e) {
                        throw e instanceof RangeError ? new S(e.message) : e
                    }
                    return n
                },
                bytesFromBase64: P,
                bytesToBase64: C,
                arrayFromBase64: function(e, t) {
                    return Array.prototype.slice.call(new t(P(e)))
                },
                arrayToBase64: function(e, t) {
                    return C(new t(e).buffer)
                },
                compareOptionsWithDefaults: function(e, t) {
                    var n = [];
                    if (t && e) {
                        for (var r = Object.keys(e), o = 0; o < r.length; ++o) {
                            var i = r[o],
                                a = e[i];
                            a instanceof Object || void 0 === t[i] || t[i] === a || n.push("".concat(i, ":").concat(a))
                        }
                        if (n.length > 0) return "!".concat(n.join())
                    }
                    return ""
                },
                objectsDiff: function e(t, n) {
                    var r = {};
                    return l.a.forIn(t, function(t, o) {
                        var i = n[o];
                        if (E(t) && E(i)) {
                            var a = e(t, i);
                            l.a.isEmpty(a) || (r[o] = a)
                        } else l.a.isEqual(t, i) || (r[o] = t)
                    }), r
                },
                forInRecursive: function(e, t) {
                    ! function e(n, r) {
                        l.a.forIn(n, function(n, o) {
                            var i = r + (r.length > 0 ? "." : "");
                            n instanceof Object ? e(n, i + o) : void 0 !== n && t(n, i + o)
                        })
                    }(e, "")
                },
                enquoteString: function(e) {
                    return l.a.isString(e) ? '"'.concat(e.replace(/"/g, '\\"'), '"') : e
                },
                unquoteString: function(e) {
                    if (!l.a.isString(e)) return e;
                    if ('"' === e[0] && '"' === e[e.length - 1]) return (e = e.slice(1, e.length - 1)).replace(/\\"/g, '"');
                    if ("'" === e[0] && "'" === e[e.length - 1]) return (e = e.slice(1, e.length - 1)).replace(/\\'/g, "'");
                    throw new SyntaxError("Incorrect string format, can't unqute it")
                },
                shotOpen: function(e) {
                    "undefined" != typeof window && window.open().document.write('<body style="margin:0"><img src="'.concat(e, '" /></body>'))
                },
                shotDownload: function(e, t) {
                    if (e && "data:" === e.substr(0, 5))
                        if (t || (t = ["screenshot-", +new Date, ".png"].join("")), "undefined" != typeof window && window.navigator && window.navigator.msSaveBlob) window.navigator.msSaveBlob(A(e), t);
                        else if ("undefined" != typeof document) {
                        var n = document.createElement("a");
                        n.download = t, n.innerHTML = "download", n.href = window.URL.createObjectURL(A(e)), document.body.appendChild(n), n.click(), document.body.removeChild(n)
                    }
                },
                copySubArrays: function(e, t, n, r) {
                    for (var o = 0, i = n.length; o < i; ++o)
                        for (var a = 0; a < r; ++a) t[o * r + a] = e[n[o] * r + a]
                },
                shallowCloneNode: function(e) {
                    var t = e.cloneNode(!0);
                    return t.worldPos = e.worldPos, t
                },
                correctSelectorIdentifier: function(e) {
                    return T.test(e) ? e : (k[1] = e, k.join(""))
                },
                getFileExtension: O,
                splitFileName: function(e) {
                    var t = O(e);
                    return [e.slice(0, e.length - t.length), t]
                },
                download: function(e, t, n) {
                    var r = new Blob([e]);
                    if (t || (t = ["data", +new Date].join("")), t += n ? ".".concat(n) : r.type || ".bin", "undefined" != typeof window && window.navigator && window.navigator.msSaveBlob) window.navigator.msSaveBlob(r, t);
                    else if ("undefined" != typeof document) {
                        var o = document.createElement("a");
                        o.download = t, o.innerHTML = "download", o.href = window.URL.createObjectURL(r), document.body.appendChild(o), o.click(), document.body.removeChild(o)
                    }
                }
            };

            function I(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var M = R.Timer.now;

            function N(e, t, n) {
                var r = document.createElement(e);
                return r.id = t, r.style.cssText = n, r
            }
            var L = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this.domElement = N("div", "stats", "padding:8px"), this._text = N("p", "fps", "margin:0;color:silver;font-size:large"), this.domElement.appendChild(this._text), this._startTime = M(), this._prevTime = this._startTime, this._deltas = new Array(20), this._index = 0, this._total = 0, this._count = 0
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "end",
                    value: function() {
                        var e = M(),
                            t = e - this._startTime;
                        return this._count < this._deltas.length ? this._count++ : this._total -= this._deltas[this._index], this._total += t, this._deltas[this._index] = t, this._index = (this._index + 1) % this._deltas.length, this.ms = this._total / this._count, this.fps = 1e3 / this.ms, e > this._prevTime + 1e3 && (this._text.textContent = this.fps.toPrecision(2), this._prevTime = e), e
                    }
                }, {
                    key: "update",
                    value: function() {
                        this._startTime = this.end()
                    }
                }, {
                    key: "show",
                    value: function(e) {
                        void 0 === e && (e = !0), this.domElement.style.display = e ? "block" : "none"
                    }
                }]) && I(t.prototype, n), r && I(t, r), e
            }();

            function j(e) {
                return (j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function D(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function V(e, t) {
                return !t || "object" !== j(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function F(e) {
                return (F = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function B(e, t) {
                return (B = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var z = function(e) {
                    function t() {
                        var e;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (e = V(this, F(t).call(this)))._shouldCancel = !1, e
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && B(e, t)
                    }(t, h), n = t, (r = [{
                        key: "cancel",
                        value: function() {
                            this._shouldCancel = !0, this.dispatchEvent({
                                type: "cancel"
                            })
                        }
                    }, {
                        key: "shouldCancel",
                        value: function() {
                            return this._shouldCancel
                        }
                    }, {
                        key: "notify",
                        value: function(e) {
                            this.dispatchEvent({
                                type: "notification",
                                slaveEvent: e
                            })
                        }
                    }]) && D(n.prototype, r), o && D(n, o), t
                }(),
                U = {
                    modes: {
                        BS: {
                            atom: .23,
                            bond: .15,
                            space: .5,
                            multibond: !0,
                            aromrad: .1,
                            showarom: !0,
                            polyComplexity: {
                                poor: 2,
                                low: 4,
                                medium: 6,
                                high: 12,
                                ultra: 32
                            }
                        },
                        VW: {
                            polyComplexity: {
                                poor: 4,
                                low: 6,
                                medium: 8,
                                high: 16,
                                ultra: 32
                            }
                        },
                        LN: {
                            multibond: !0,
                            showarom: !0,
                            offsarom: .2,
                            chunkarom: 10,
                            atom: .23,
                            lineWidth: 2
                        },
                        LC: {
                            bond: .2,
                            space: 0,
                            multibond: !0,
                            aromrad: .1,
                            showarom: !0,
                            polyComplexity: {
                                poor: 3,
                                low: 4,
                                medium: 6,
                                high: 12,
                                ultra: 32
                            }
                        },
                        SA: {
                            zClip: !1,
                            probeRadius: 1.5,
                            subset: "",
                            wireframe: !1,
                            polyComplexity: {
                                poor: 6,
                                low: 8,
                                medium: 16,
                                high: 30,
                                ultra: 60
                            }
                        },
                        SE: {
                            zClip: !1,
                            probeRadius: 1.5,
                            subset: "",
                            wireframe: !1,
                            polyComplexity: {
                                poor: 6,
                                low: 8,
                                medium: 16,
                                high: 30,
                                ultra: 60
                            }
                        },
                        QS: {
                            isoValue: .5,
                            gaussLim: {
                                poor: 1.5,
                                low: 2,
                                medium: 2.5,
                                high: 3,
                                ultra: 4
                            },
                            scale: 1,
                            wireframe: !1,
                            gridSpacing: {
                                poor: 2,
                                low: 1.5,
                                medium: 1,
                                high: .5,
                                ultra: .25
                            },
                            subset: "",
                            zClip: !1
                        },
                        CS: {
                            probeRadius: 1.4,
                            isoValue: 1.5,
                            wireframe: !1,
                            probePositions: 30,
                            polyComplexity: {
                                poor: .5,
                                low: 1,
                                medium: 1.5,
                                high: 1.75,
                                ultra: 2
                            },
                            subset: "",
                            zClip: !1
                        },
                        TR: {
                            radius: .3,
                            polyComplexity: {
                                poor: 12,
                                low: 16,
                                medium: 32,
                                high: 64,
                                ultra: 64
                            }
                        },
                        TU: {
                            radius: .3,
                            heightSegmentsRatio: 1.5,
                            tension: -.7,
                            polyComplexity: {
                                poor: 5,
                                low: 6,
                                medium: 10,
                                high: 18,
                                ultra: 34
                            }
                        },
                        CA: {
                            radius: .3,
                            depth: .25,
                            ss: {
                                helix: {
                                    width: 1,
                                    arrow: 2
                                },
                                strand: {
                                    width: 1,
                                    arrow: 2
                                }
                            },
                            heightSegmentsRatio: 1.5,
                            tension: -.7,
                            polyComplexity: {
                                poor: 5,
                                low: 6,
                                medium: 10,
                                high: 18,
                                ultra: 34
                            }
                        },
                        TX: {
                            template: "{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",
                            horizontalAlign: "center",
                            verticalAlign: "middle",
                            dx: 0,
                            dy: 0,
                            dz: 1,
                            fg: "none",
                            bg: "0x202020",
                            showBg: !0
                        },
                        VD: {
                            kSigma: 1,
                            kSigmaMed: 2,
                            kSigmaMax: 4
                        }
                    },
                    colorers: {
                        EL: {
                            carbon: -1
                        },
                        UN: {
                            color: 16777215
                        },
                        CO: {
                            subset: "charged",
                            color: 16711680,
                            baseColor: 16777215
                        },
                        CB: {
                            color: 9474192,
                            factor: .6
                        },
                        SQ: {
                            gradient: "rainbow"
                        },
                        TM: {
                            gradient: "temp",
                            min: 5,
                            max: 40
                        },
                        OC: {
                            gradient: "reds"
                        },
                        HY: {
                            gradient: "blue-red"
                        },
                        MO: {
                            gradient: "rainbow"
                        }
                    },
                    labels: "no",
                    antialias: !0,
                    camFov: 45,
                    camNear: .5,
                    camFar: 100,
                    camDistance: 2.5,
                    radiusToFit: 1,
                    fogNearFactor: .5,
                    fogFarFactor: 1,
                    fogAlpha: 1,
                    fogColor: 0,
                    fogColorEnable: !1,
                    palette: "JM",
                    resolution: "medium",
                    autoResolution: !1,
                    autoPreset: !0,
                    preset: "default",
                    presets: {
                        default: [{
                            mode: "BS",
                            colorer: "EL",
                            selector: "all",
                            material: "SF"
                        }],
                        empty: [],
                        wire: [{
                            mode: "LN",
                            colorer: "EL",
                            selector: "all",
                            material: "SF"
                        }],
                        small: [{
                            mode: "BS",
                            colorer: "EL",
                            selector: "all",
                            material: "SF"
                        }],
                        macro: [{
                            mode: "CA",
                            colorer: "SS",
                            selector: "not hetatm",
                            material: "SF"
                        }, {
                            mode: "BS",
                            colorer: "EL",
                            selector: "hetatm and not water",
                            material: "SF"
                        }]
                    },
                    objects: {
                        line: {
                            color: 4294967295,
                            dashSize: .3,
                            gapSize: .05
                        }
                    },
                    theme: "dark",
                    themes: {
                        dark: 2105376,
                        light: 13421772
                    },
                    bg: {
                        color: 2105376,
                        transparent: !1
                    },
                    draft: {
                        clipPlane: !1,
                        clipPlaneFactor: .5,
                        clipPlaneSpeed: 3e-5,
                        waterBondingHack: !1
                    },
                    plugins: {},
                    axes: !0,
                    fog: !0,
                    fps: !0,
                    zSprites: !0,
                    isoSurfaceFakeOpacity: !0,
                    suspendRender: !0,
                    nowater: !1,
                    autobuild: !0,
                    fxaa: !0,
                    outline: {
                        on: !1,
                        color: 0,
                        threshold: .1
                    },
                    ao: !1,
                    shadow: {
                        on: !1,
                        type: "random",
                        radius: 1
                    },
                    autoRotation: 0,
                    maxfps: 30,
                    fbxprec: 4,
                    autoRotationAxisFixed: !0,
                    zooming: !0,
                    panning: !1,
                    inversePanning: !1,
                    picking: !0,
                    pick: "atom",
                    editing: !1,
                    aromatic: !1,
                    singleUnit: !0,
                    stereo: "NONE",
                    interpolateViews: !0,
                    transparency: "prepass",
                    translationSpeed: 2,
                    debug: {
                        example: 3.5,
                        text: "hello!",
                        good: !0,
                        ssaoKernelRadius: .7,
                        ssaoFactor: .7,
                        stereoBarrel: .25
                    },
                    use: {
                        multiFile: !1
                    }
                };

            function G() {
                h.call(this), this.old = null, this.now = {}, this._changed = {}, this.reset()
            }
            R.deriveClass(G, h, {
                defaults: U,
                set: function(e, t) {
                    if (l.a.isString(e)) {
                        l.a.get(this.now, e) !== t && (l.a.set(this.now, e, t), this._notifyChange(e, t))
                    } else {
                        var n = R.objectsDiff(e, this.now);
                        l.a.isEmpty(n) || (l.a.merge(this.now, n), this._notifyChanges(n))
                    }
                },
                get: function(e, t) {
                    return l.a.get(this.now, e, t)
                },
                reset: function() {
                    var e = R.objectsDiff(U, this.now);
                    this.now = l.a.cloneDeep(U), this.old = null, this._notifyChanges(e), this._changed = {}
                },
                checkpoint: function() {
                    this.old = l.a.cloneDeep(this.now), this._changed = {}
                },
                _notifyChange: function(e, t) {
                    this._changed[e] = !0, this.dispatchEvent({
                        type: "change:".concat(e),
                        value: t
                    })
                },
                _notifyChanges: function(e) {
                    var t = this;
                    R.forInRecursive(e, function(e, n) {
                        t._notifyChange(n, e)
                    })
                },
                changed: function() {
                    if (!this.old) return [];
                    var e = this.old,
                        t = this.now;
                    return l.a.filter(Object.keys(this._changed), function(n) {
                        return l.a.get(e, n) !== l.a.get(t, n)
                    })
                },
                override: function(e) {
                    this.set(e)
                },
                applyDiffs: function(e) {
                    if (e.hasOwnProperty("VERSION") && 0 !== e.VERSION) throw new Error("Settings version does not match!");
                    delete e.VERSION, this.reset(), this.set(e)
                },
                getDiffs: function(e) {
                    var t = R.objectsDiff(this.now, U);
                    return e && (t.VERSION = 0), t
                },
                setPluginOpts: function(e, t) {
                    U.plugins[e] = l.a.cloneDeep(t), this.now.plugins[e] = l.a.cloneDeep(t)
                }
            });
            var H = new G;

            function W(e) {
                return (W = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function q(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }
            var Y = 0;

            function X(e) {
                return !(!e || "0" === e || l.a.isString(e) && "false" === e.toLowerCase())
            }
            var $ = {
                    string: String,
                    number: Number,
                    boolean: X
                },
                K = "=",
                Z = "!",
                Q = ":",
                J = ",",
                ee = "$;@/?";
            var te = R.generateRegExp(ee + ":,");

            function ne(e) {
                return R.encodeQueryComponent(e, te)
            }
            var re = R.generateRegExp(ee + " ");

            function oe(e) {
                return R.encodeQueryComponent(e, re)
            }

            function ie(e) {
                var t = e.reps;
                if (!t) {
                    var n = H.now.presets,
                        r = e.preset || H.now.preset;
                    if (!(t = n[r])) v.warn('Unknown preset "'.concat(r, '"')), t = n[r = q(Object.keys(n), 1)[0]];
                    e.preset = r, e.reps = R.deriveDeep(t, !0)
                }
            }

            function ae(e, t, n) {
                ie(e);
                var r = e.reps[Y];
                r.hasOwnProperty(t) && ++Y >= e.reps.length && (e.reps[Y] = R.deriveDeep(r, !0)), void 0 !== n && (e.reps[Y][t] = n)
            }

            function se(e, t, n) {
                if (e) {
                    var r = e.indexOf(Z),
                        o = function(e, t) {
                            var n = e.indexOf(",");
                            return n >= 0 ? (t.push(e.substr(n + 1).split(",")), e.substr(0, n)) : e
                        }(e.substr(0, r >= 0 ? r : void 0), n);
                    if (r >= 0) {
                        var i = e.substr(r + 1).split(J);
                        if (e = o, t) {
                            var a = t[e],
                                s = R.deriveDeep(a, !0);
                            i.forEach(function(t) {
                                var n = t.split(Q, 2),
                                    r = decodeURIComponent(n[0]),
                                    o = decodeURIComponent(n[1]),
                                    i = $[W(l.a.get(a, r))];
                                i ? l.a.set(s, r, i(o)) : v.warn('Unknown argument "'.concat(r, '" for option "').concat(e, '"'))
                            }), Object.keys(s).length > 0 && (e = [e, s])
                        }
                    } else e = o
                }
                return e
            }
            var le = {
                l: "load",
                load: String,
                t: "type",
                type: String,
                v: "view",
                view: String,
                u: "unit",
                unit: Number,
                menu: X,
                o: "object",
                object: function(e, t) {
                    var n = [],
                        r = se(e, H.defaults.objects, n);
                    Array.isArray(r) || (r = [r]),
                        function(e, t, n) {
                            void 0 === e._objects && (e._objects = []);
                            var r = q(n, 2),
                                o = r[0],
                                i = r[1],
                                a = {
                                    type: o,
                                    params: t
                                };
                            void 0 !== i && (a.opts = i), e._objects[e._objects.length] = a
                        }(t, n[0], r)
                },
                p: "preset",
                preset: function(e, t) {
                    t.preset = e, t.reps = null, ie(t)
                },
                r: "rep",
                rep: function(e, t) {
                    ie(t), (Y = (Y = Number(e)) <= t.reps.length ? Y < 0 ? 0 : Y : t.reps.length) === t.reps.length && (t.reps[Y] = Y > 0 ? R.deriveDeep(t.reps[Y - 1], !0) : R.deriveDeep(H.defaults.presets.default[0], !0))
                },
                s: "select",
                select: function(e, t) {
                    ae(t, "selector", e)
                },
                m: "mode",
                mode: function(e, t) {
                    ae(t, "mode", se(e, H.defaults.modes))
                },
                c: "color",
                color: function(e, t) {
                    ae(t, "colorer", se(e, H.defaults.colorers))
                },
                mt: "material",
                material: function(e, t) {
                    ae(t, "material", se(e, H.defaults.materials))
                },
                dup: function(e, t) {
                    ie(t);
                    var n = t.reps,
                        r = n[Y];
                    ++Y >= n.length && (n[Y] = R.deriveDeep(r, !0))
                },
                ar: "autoResolution",
                background: "theme"
            };

            function ce(e) {
                Y = 0;
                for (var t = {}, n = 0, r = e.length; n < r; ++n) {
                    for (var o = e[n], i = o[0], a = o[1], s = le[i]; l.a.isString(s);) s = le[i = s];
                    if (s) {
                        if (l.a.isFunction(s)) {
                            var c = s(a, t);
                            void 0 !== c && (t[i] = c)
                        }
                    } else {
                        var u = $[W(l.a.get(H.defaults, i))];
                        u ? l.a.set(t, "settings.".concat(i), u(a)) : v.warn('Unknown option "'.concat(i, '"'))
                    }
                }
                return t
            }

            function ue(e) {
                var t = [],
                    n = 0;
                return R.forInRecursive(e, function(e, r) {
                    t[n++] = oe(r) + Q + oe(e)
                }), t.join(J)
            }

            function pe(e) {
                return l.a.isArray(e) ? e[0] + (e.length < 2 ? "" : Z + ue(e[1])) : e
            }

            function fe(e) {
                if (e && e.type) {
                    var t = e.type;
                    return l.a.isArray(e.params) && e.params.length > 0 && (t += ",".concat(e.params.join(","))), e.opts && (t += Z + ue(e.opts)), t
                }
            }

            function he(e) {
                var t = [],
                    n = 0;
                return R.forInRecursive(e, function(e, r) {
                    t[n++] = "".concat(r, "=").concat(R.enquoteString(e))
                }), t.join(" ")
            }

            function de(e) {
                return l.a.isArray(e) ? e[0] + (e.length < 2 ? "" : " ".concat(he(e[1]))) : e
            }

            function me(e) {
                if (e && e.type) {
                    var t = e.type;
                    return l.a.isArray(e.params) && e.params.length > 0 && (t += " ".concat(e.params.map(R.enquoteString).join(" "))), e.opts && (t += " ".concat(he(e.opts))), t
                }
            }

            function ye(e, t) {
                var n = [],
                    r = 0;

                function o(e, t) {
                    null != t && (n[r++] = e + t)
                }
                return l.a.isEmpty(e) ? null : (o("", t), o("s=", R.enquoteString(e.selector)), o("m=", de(e.mode)), o("c=", de(e.colorer)), o("mt=", de(e.material)), n.join(" "))
            }
            var ve = {
                fromURL: function(e) {
                    return ce(R.getUrlParameters(e))
                },
                fromAttr: function(e) {
                    return ce(R.getUrlParameters("?".concat(e || "")))
                },
                adapters: $,
                toURL: function(e) {
                    var t = [],
                        n = 0;

                    function r(e, r) {
                        null != r && (t[n++] = ne(e) + K + ne(r))
                    }
                    r("l", e.load), r("u", e.unit), r("p", e.preset),
                        function(e) {
                            if (e)
                                for (var t = 0, n = e.length; t < n; ++t) l.a.isEmpty(e[t]) || (r("r", t), r("s", e[t].selector), r("m", pe(e[t].mode)), r("c", pe(e[t].colorer)), r("mt", pe(e[t].material)))
                        }(e.reps),
                        function(e) {
                            if (e)
                                for (var t = 0, n = e.length; t < n; ++t) r("o", fe(e[t]))
                        }(e._objects), r("v", e.view), R.forInRecursive(e.settings, function(e, t) {
                            "preset" !== t && r(t, e)
                        });
                    var o = "";
                    if ("undefined" != typeof window) {
                        var i = window.location;
                        o = "".concat(i.protocol, "//").concat(i.host).concat(i.pathname)
                    }
                    return t.length > 0 && (o += "?".concat(t.join("&"))), o
                },
                toScript: function(e) {
                    var t = [],
                        n = 0;

                    function r(e, r, o) {
                        if (null != r) {
                            var i = "string" == typeof r && o ? '"' : "";
                            t[n++] = "".concat(e, " ").concat(i).concat(r).concat(i)
                        }
                    }
                    return r("set", "autobuild false"), r("load", e.load, !0), r("unit", e.unit), r("preset", e.preset),
                        function(e) {
                            if (e)
                                for (var t = 0, n = e.length; t < n; ++t) r("rep", ye(e[t], t))
                        }(e.reps),
                        function(e) {
                            if (e)
                                for (var t = 0, n = e.length; t < n; ++t) r("", me(e[t]))
                        }(e._objects), R.forInRecursive(e.settings, function(e, t) {
                            "preset" !== t && r("set ".concat(t), e, !0)
                        }), r("view", e.view), r("set", "autobuild true"), t.join("\n")
                }
            };

            function _e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var ge = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._node = n || null, this._name = t || null, null === this._node && null === this._name && (this._name = "Unknown")
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getString",
                    value: function() {
                        return this._name || "unknown"
                    }
                }, {
                    key: "getNode",
                    value: function() {
                        return this._node || null
                    }
                }]) && _e(t.prototype, n), r && _e(t, r), e
            }();

            function be(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var we = function e(t, n, r, o, i, a, s) {
                ! function(e, t) {
                    if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                }(this, e), this.number = t, this.name = n, this.fullName = r, this.weight = o, this.radius = i, this.radiusBonding = a, this.hydrogenValency = s
            };
            be(we, "Constants", {
                    U1: 1,
                    Lead: 2,
                    U2: 3,
                    Wing: 4,
                    U18: 18
                }), be(we, "Role", {
                    N: we.Constants.U1,
                    CA: we.Constants.Lead,
                    C: we.Constants.U2,
                    O: we.Constants.Wing,
                    SG: we.Constants.U18
                }), be(we, "ByAtomicNumber", [null, new we(1, "H", "Hydrogen", 1.008, 1.2, .23, [1]), new we(2, "HE", "Helium", 4.003, 1.4, .93, [0]), new we(3, "LI", "Lithium", 6.941, 1.82, .68, [1]), new we(4, "BE", "Beryllium", 9.012, 1.7, .35, [2]), new we(5, "B", "Boron", 10.81, 2.08, .83, [3]), new we(6, "C", "Carbon", 12.011, 1.95, .68, [4]), new we(7, "N", "Nitrogen", 14.007, 1.85, .68, [3, 5]), new we(8, "O", "Oxygen", 15.999, 1.7, .68, [2, 4]), new we(9, "F", "Fluorine", 18.998, 1.73, .64, [1]), new we(10, "NE", "Neon", 20.18, 1.54, 1.12, [0]), new we(11, "NA", "Sodium", 22.99, 2.27, .97, [1]), new we(12, "MG", "Magnesium", 24.305, 1.73, 1.1, [2]), new we(13, "AL", "Aluminum", 26.981, 2.05, 1.35, [3]), new we(14, "SI", "Silicon", 28.086, 2.1, 1.2, [4]), new we(15, "P", "Phosphorus", 30.974, 2.08, .75, [3, 5]), new we(16, "S", "Sulfur", 32.07, 2, 1.02, [2, 4, 6]), new we(17, "CL", "Chlorine", 35.453, 1.97, .99, [1, 3, 5, 7]), new we(18, "AR", "Argon", 39.948, 1.88, 1.57, [0]), new we(19, "K", "Potassium", 39.1, 2.75, 1.33, [1]), new we(20, "CA", "Calcium", 40.08, 1.973, .99, [2]), new we(21, "SC", "Scandium", 44.956, 1.7, 1.44, [0]), new we(22, "TI", "Titanium", 47.88, 1.7, 1.47, [0]), new we(23, "V", "Vanadium", 50.941, 1.7, 1.33, [0]), new we(24, "CR", "Chromium", 52, 1.7, 1.35, [0]), new we(25, "MN", "Manganese", 54.938, 1.7, 1.35, [0]), new we(26, "FE", "Iron", 55.847, 1.7, 1.34, [0]), new we(27, "CO", "Cobalt", 58.93, 1.7, 1.33, [0]), new we(28, "NI", "Nickel", 58.69, 1.63, 1.5, [0]), new we(29, "CU", "Copper", 63.55, 1.4, 1.52, [0]), new we(30, "ZN", "Zinc", 65.39, 1.39, 1.45, [0]), new we(31, "GA", "Gallium", 69.72, 1.87, 1.22, [3]), new we(32, "GE", "Germanium", 72.61, 1.7, 1.17, [4]), new we(33, "AS", "Arsenic", 74.92, 1.85, 1.21, [3, 5]), new we(34, "SE", "Selenium", 78.96, 1.9, 1.22, [2, 4, 6]), new we(35, "BR", "Bromine", 79.9, 2.1, 1.21, [1, 3, 5, 7]), new we(36, "KR", "Krypton", 83.8, 2.02, 1.91, [0]), new we(37, "RB", "Rubidium", 85.47, 1.7, 1.47, [1]), new we(38, "SR", "Strontium", 87.62, 1.7, 1.12, [2]), new we(39, "Y", "Yttrium", 88.91, 1.7, 1.78, [0]), new we(40, "ZR", "Zirconium", 91.22, 1.7, 1.56, [0]), new we(41, "NB", "Niobium", 92.91, 1.7, 1.48, [0]), new we(42, "MO", "Molybdenum", 95.94, 1.7, 1.47, [0]), new we(43, "TC", "Technetium", 98.91, 1.7, 1.35, [0]), new we(44, "RU", "Ruthenium", 101.07, 1.7, 1.4, [0]), new we(45, "RH", "Rhodium", 102.91, 1.7, 1.45, [0]), new we(46, "PD", "Palladium", 106.42, 1.63, 1.5, [0]), new we(47, "AG", "Silver", 107.87, 1.72, 1.59, [0]), new we(48, "CD", "Cadmium", 112.41, 1.58, 1.69, [0]), new we(49, "IN", "Indium", 114.82, 1.93, 1.63, [3]), new we(50, "SN", "Tin", 118.71, 2.17, 1.46, [2, 4]), new we(51, "SB", "Antimony", 121.75, 2.2, 1.46, [3, 5]), new we(52, "TE", "Tellurium", 127.6, 2.06, 1.47, [2, 4, 6]), new we(53, "I", "Iodine", 126.91, 2.15, 1.4, [1, 3, 5, 7]), new we(54, "XE", "Xenon", 131.29, 2.16, 1.98, [0]), new we(55, "CS", "Cesium", 132.91, 1.7, 1.67, [1]), new we(56, "BA", "Barium", 137.33, 1.7, 1.34, [2]), new we(57, "LA", "Lanthanum", 138.91, 1.7, 1.87, [0]), new we(58, "CE", "Cerium", 140.12, 1.7, 1.83, [0]), new we(59, "PR", "Praseodymium", 140.91, 1.7, 1.82, [0]), new we(60, "ND", "Neodymium", 144.24, 1.7, 1.81, [0]), new we(61, "PM", "Promethium", 144.9, 1.7, 1.8, [0]), new we(62, "SM", "Samarium", 150.36, 1.7, 1.8, [0]), new we(63, "EU", "Europium", 151.96, 1.7, 1.99, [0]), new we(64, "GD", "Gadolinium", 157.25, 1.7, 1.79, [0]), new we(65, "TB", "Terbium", 158.93, 1.7, 1.76, [0]), new we(66, "DY", "Dysprosium", 162.5, 1.7, 1.75, [0]), new we(67, "HO", "Holmium", 164.93, 1.7, 1.74, [0]), new we(68, "ER", "Erbium", 167.26, 1.7, 1.73, [0]), new we(69, "TM", "Thulium", 168.93, 1.7, 1.72, [0]), new we(70, "YB", "Ytterbium", 173.04, 1.7, 1.94, [0]), new we(71, "LU", "Lutetium", 174.97, 1.7, 1.72, [0]), new we(72, "HF", "Hafnium", 178.49, 1.7, 1.57, [0]), new we(73, "TA", "Tantalum", 180.95, 1.7, 1.43, [0]), new we(74, "W", "Tungsten", 183.85, 1.7, 1.37, [0]), new we(75, "RE", "Rhenium", 186.21, 1.7, 1.35, [0]), new we(76, "OS", "Osmium", 190.2, 1.7, 1.37, [0]), new we(77, "IR", "Iridium", 192.22, 1.7, 1.32, [0]), new we(78, "PT", "Platinum", 195.08, 1.72, 1.5, [0]), new we(79, "AU", "Gold", 196.97, 1.66, 1.5, [0]), new we(80, "HG", "Mercury", 200.59, 1.55, 1.7, [0]), new we(81, "TL", "Thallium", 204.38, 1.96, 1.55, [1, 3]), new we(82, "PB", "Lead", 207.2, 2.02, 1.54, [2, 4]), new we(83, "BI", "Bismuth", 208.98, 1.7, 1.54, [3, 5]), new we(84, "PO", "Polonium", 210, 1.7, 1.68, [2, 4, 6]), new we(85, "AT", "Astatine", 210, 1.7, 1.7, [1, 3, 5, 7]), new we(86, "RN", "Radon", 222, 1.7, 2.4, [0]), new we(87, "FR", "Francium", 223, 1.7, 2, [1]), new we(88, "RA", "Radium", 226.03, 1.7, 1.9, [2]), new we(89, "AC", "Actinium", 227.03, 1.7, 1.88, [0]), new we(90, "TH", "Thorium", 232.04, 1.7, 1.79, [0]), new we(91, "PA", "Protactinium", 231.04, 1.7, 1.61, [0]), new we(92, "U", "Uranium", 238.03, 1.86, 1.58, [0]), new we(93, "NP", "Neptunium", 237.05, 1.7, 1.55, [0]), new we(94, "PU", "Plutonium", 239.1, 1.7, 1.53, [0]), new we(95, "AM", "Americium", 243.1, 1.7, 1.51, [0]), new we(96, "CM", "Curium", 247.1, 1.7, 1.5, [0]), new we(97, "BK", "Berkelium", 247.1, 1.7, 1.5, [0]), new we(98, "CF", "Californium", 252.1, 1.7, 1.5, [0]), new we(99, "ES", "Einsteinium", 252.1, 1.7, 1.5, [0]), new we(100, "FM", "Fermium", 257.1, 1.7, 1.5, [0]), new we(101, "MD", "Mendelevium", 256.1, 1.7, 1.5, [0]), new we(102, "NO", "Nobelium", 259.1, 1.7, 1.5, [0]), new we(103, "LR", "Lawrencium", 260.1, 1.7, 1.5, [0]), new we(104, "RF", "Rutherfordium", 261, 1.7, 1.6, [0]), new we(105, "DB", "Dubnium", 262, 1.7, 1.6, [0]), new we(106, "SG", "Seaborgium", 263, 1.7, 1.6, [0]), new we(107, "BH", "Bohrium", 262, 1.7, 1.6, [0]), new we(108, "HS", "Hassium", 265, 1.7, 1.6, [0]), new we(109, "MT", "Meitnerium", 268, 1.7, 1.6, [0])]), be(we, "ByName", {
                    D: new we(1, "D", "Deuterium", 2.014, 1.2, .23, [1]),
                    T: new we(1, "T", "Tritium", 3.016, 1.2, .23, [1])
                }),
                function() {
                    for (var e = we.ByAtomicNumber, t = we.ByName, n = 0, r = e.length; n < r; ++n) {
                        var o = e[n];
                        o && (t[o.name] = o)
                    }
                }(), we.getByName = function(e) {
                    var t = we.ByName[e];
                    return t || (t = we.ByName[e] = new we(0, e, "Unknown", 0, 1, .01, [0])), t
                };
            var xe = we;

            function Se(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Ce, Pe, Ee, Oe = function() {
                function e(t, n, r, o, i, a, s, l, c, u, p) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._index = -1, this._residue = t, this._name = n instanceof ge ? n : new ge(n), this.element = r, this._position = o, this._role = i, this._mask = 1, this._index = -1, this._het = a, this._serial = s, this._location = (l || " ").charCodeAt(0), this._occupancy = c || 1, this._temperature = u, this._charge = p, this._hydrogenCount = -1, this._radicalCount = 0, this._valence = -1, this._bonds = [], this.flags = 0, "H" === r.name ? this.flags |= e.Flags.HYDROGEN : "C" === r.name && (this.flags |= e.Flags.CARBON)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getName",
                    value: function() {
                        return this._name
                    }
                }, {
                    key: "getPosition",
                    value: function() {
                        return this._position
                    }
                }, {
                    key: "getResidue",
                    value: function() {
                        return this._residue
                    }
                }, {
                    key: "getSerial",
                    value: function() {
                        return this._serial
                    }
                }, {
                    key: "getBonds",
                    value: function() {
                        return this._bonds
                    }
                }, {
                    key: "isHet",
                    value: function() {
                        return this._het
                    }
                }, {
                    key: "isHydrogen",
                    value: function() {
                        return 1 === this.element.number
                    }
                }, {
                    key: "getValence",
                    value: function() {
                        return -1 === this._valence ? 0 : this._valence
                    }
                }, {
                    key: "getVisualName",
                    value: function() {
                        var e = this.getName();
                        return e.getString().length > 0 ? e.getString() : this.element.name.trim()
                    }
                }, {
                    key: "forEachBond",
                    value: function(e) {
                        for (var t = this._bonds, n = 0, r = t.length; n < r; ++n) e(t[n])
                    }
                }, {
                    key: "isLabelVisible",
                    value: function() {
                        if (null !== this.getName().getNode()) return !0;
                        if (null === this.element) return !1;
                        if (this.element.number === xe.ByName.C.number) {
                            var e = this.getVisualName();
                            if (null === e) return !1;
                            if (1 === e.length && 67 === e.charCodeAt(0) && 0 !== this.getBonds().length) return !1
                        }
                        return !0
                    }
                }, {
                    key: "getHydrogenCountBoron",
                    value: function() {
                        var e = 3 - this.getCharge() - this.getAtomBondsCount() - this._radicalCount;
                        return Math.max(0, e)
                    }
                }, {
                    key: "getHydrogenCountTin",
                    value: function() {
                        var e = this._valence; - 1 === e && (e = this.getAtomBondsCount() - Math.abs(this.getCharge()) + this._radicalCount);
                        var t = this.findSuitableValence(e);
                        return 0 !== this.getCharge() && (t = 4), Math.max(0, t - e)
                    }
                }, {
                    key: "getHydrogenCountMetal",
                    value: function() {
                        return 0
                    }
                }, {
                    key: "getHydrogenCountGroup14",
                    value: function() {
                        var e = this._valence; - 1 === e && (e = this.getAtomBondsCount() - Math.abs(this.getCharge()) + this._radicalCount);
                        var t = this.findSuitableValence(e);
                        return Math.max(0, t - e)
                    }
                }, {
                    key: "getHydrogenCountNonMetal",
                    value: function() {
                        var e = this._valence; - 1 === e && (e = this.getAtomBondsCount() - this.getCharge() + this._radicalCount);
                        var t = this.findSuitableValence(e);
                        return Math.max(0, t - e)
                    }
                }, {
                    key: "getHydrogenCountHydrogen",
                    value: function() {
                        return 0 === this.getAtomBondsCount() && 0 === this.getCharge() && 0 === this.getValence() && 0 === this._radicalCount ? 1 : 0
                    }
                }, {
                    key: "getHydrogenCount",
                    value: function() {
                        if (this._hydrogenCount >= 0) return this._hydrogenCount;
                        var e = this.element,
                            t = e.hydrogenValency;
                        if (1 === t.length && 0 === t[0]) return 0;
                        switch (e.number) {
                            case 1:
                                return this.getHydrogenCountHydrogen();
                            case 3:
                            case 11:
                            case 19:
                            case 37:
                            case 55:
                            case 87:
                            case 4:
                            case 12:
                            case 20:
                            case 38:
                            case 56:
                            case 88:
                            case 13:
                            case 31:
                            case 49:
                            case 41:
                            case 82:
                            case 83:
                                return this.getHydrogenCountMetal();
                            case 6:
                            case 14:
                            case 32:
                            case 51:
                                return this.getHydrogenCountGroup14();
                            case 50:
                                return this.getHydrogenCountTin();
                            case 7:
                            case 8:
                            case 9:
                            case 15:
                            case 16:
                            case 17:
                            case 33:
                            case 34:
                            case 35:
                            case 53:
                            case 85:
                                return this.getHydrogenCountNonMetal();
                            case 5:
                                return this.getHydrogenCountBoron();
                            default:
                                return 0
                        }
                    }
                }, {
                    key: "getAtomBondsCount",
                    value: function() {
                        for (var e, t = this.getBonds(), n = 0, r = 0; r < t.length; r++) n += (e = t[r].getOrder()) < 2 ? 1 : e;
                        return n
                    }
                }, {
                    key: "findSuitableValence",
                    value: function(e) {
                        for (var t = this.element.hydrogenValency, n = t[t.length - 1], r = 0; r < t.length; r++)
                            if (t[r] >= e) {
                                n = t[r];
                                break
                            } return n
                    }
                }, {
                    key: "getCharge",
                    value: function() {
                        return this._charge
                    }
                }, {
                    key: "getLocation",
                    value: function() {
                        return this._location
                    }
                }, {
                    key: "getFullName",
                    value: function() {
                        var e = "";
                        return null !== this._residue && (null !== this._residue._chain && (e += "".concat(this._residue._chain.getName(), ".")), e += "".concat(this._residue._sequence, ".")), e += this._name.getString()
                    }
                }]) && Se(t.prototype, n), r && Se(t, r), e
            }();
            Ee = {
                CARBON: 1,
                HYDROGEN: 8,
                NONPOLARH: 4104
            }, (Pe = "Flags") in (Ce = Oe) ? Object.defineProperty(Ce, Pe, {
                value: Ee,
                enumerable: !0,
                configurable: !0,
                writable: !0
            }) : Ce[Pe] = Ee;
            var Ae = Oe;

            function Te(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var ke = {
                UNKNOWN: 0,
                COVALENT: 1,
                AROMATIC: 2
            };

            function Re(e) {
                return e._position
            }
            var Ie = function() {
                function e(t, n, r, o, i) {
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._left = t, this._right = n, this._fixed = i, this._index = -1, t > n) throw new Error("In a bond atom indices must be in increasing order");
                    this._order = r, this._type = o
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getLeft",
                    value: function() {
                        return this._left
                    }
                }, {
                    key: "getRight",
                    value: function() {
                        return this._right
                    }
                }, {
                    key: "getOrder",
                    value: function() {
                        return this._order
                    }
                }, {
                    key: "calcLength",
                    value: function() {
                        return this._left._position.distanceTo(this._right._position)
                    }
                }, {
                    key: "_forEachNeighbour",
                    value: function(e, t) {
                        for (var n = e._bonds, r = 0, o = n.length; r < o; ++r) t(n[r]._left !== e ? n[r]._left : n[r]._right)
                    }
                }, {
                    key: "forEachLevelOne",
                    value: function(e) {
                        var t = this._left,
                            n = this._right;
                        this._forEachNeighbour(t, function(t) {
                            t !== n && e(t)
                        }), this._forEachNeighbour(n, function(n) {
                            n !== t && e(n)
                        })
                    }
                }, {
                    key: "forEachLevelTwo",
                    value: function(e) {
                        var t = this._left,
                            n = this._right,
                            r = this;
                        r._forEachNeighbour(t, function(o) {
                            o !== n && r._forEachNeighbour(o, function(n) {
                                n !== t && e(n)
                            })
                        }), r._forEachNeighbour(n, function(o) {
                            o !== t && r._forEachNeighbour(o, function(t) {
                                t !== n && e(t)
                            })
                        })
                    }
                }, {
                    key: "_fixDir",
                    value: function(e, t, n) {
                        var r = 0,
                            o = 0,
                            i = e.clone();

                        function a(a) {
                            i.copy(n(a)), i.sub(e), t.dot(i) > 0 ? ++r : ++o
                        }

                        function s(e) {
                            "C" === e.element.name && a(e)
                        }
                        for (var l = [
                                [this.forEachLevelOne, s],
                                [this.forEachLevelOne, a],
                                [this.forEachLevelTwo, s],
                                [this.forEachLevelTwo, a]
                            ], c = 0; c < l.length; ++c) {
                            if (l[c][0].call(this, l[c][1]), o > r) return t.multiplyScalar(-1);
                            if (o < r) return t
                        }
                        return t
                    }
                }, {
                    key: "calcNormalDir",
                    value: function(e) {
                        var t = this._left,
                            n = this._right,
                            r = t,
                            o = n;
                        e = void 0 === e ? Re : e, t._bonds.length > n._bonds.length && (r = n, o = t);
                        for (var i = r, a = 0, s = o._bonds, l = 0, c = s.length; l < c; ++l) {
                            var u = s[l]._left;
                            s[l]._left === o && (u = s[l]._right), u._bonds.length > a && u !== r && (i = u, a = u._bonds.length)
                        }
                        var p = e(o),
                            f = e(r).clone().sub(p),
                            h = e(i).clone().sub(p);
                        return h.crossVectors(f, h), h.lengthSq() < 1e-4 && h.set(0, 1, 0), f.normalize(), h.normalize(), f.crossVectors(h, f), f.lengthSq() < 1e-4 && f.set(0, 1, 0), f.normalize(), this._fixDir(p, f, e)
                    }
                }]) && Te(t.prototype, n), r && Te(t, r), e
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Ie, "BondType", ke), Ie.prototype.BondType = ke;
            var Me = Ie;

            function Ne(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Le(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var je = function() {
                function e(t, n, r) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._name = t, this._fullName = n, this.letterCode = r, this.flags = 0
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getName",
                    value: function() {
                        return this._name
                    }
                }]) && Ne(t.prototype, n), r && Ne(t, r), e
            }();

            function De(e, t) {
                for (var n = 0, r = t.length; n < r; ++n) {
                    var o = je.StandardTypes[t[n]];
                    o && (o.flags |= e)
                }
            }
            Le(je, "StandardTypes", {
                ALA: new je("ALA", "Alanine", "A"),
                ARG: new je("ARG", "Arginine", "R"),
                ASN: new je("ASN", "Asparagine", "N"),
                ASP: new je("ASP", "Aspartic Acid", "D"),
                CYS: new je("CYS", "Cysteine", "C"),
                GLN: new je("GLN", "Glutamine", "Q"),
                GLU: new je("GLU", "Glutamic Acid", "E"),
                GLY: new je("GLY", "Glycine", "G"),
                HIS: new je("HIS", "Histidine", "H"),
                ILE: new je("ILE", "Isoleucine", "I"),
                LEU: new je("LEU", "Leucine", "L"),
                LYS: new je("LYS", "Lysine", "K"),
                MET: new je("MET", "Methionine", "M"),
                PHE: new je("PHE", "Phenylalanine", "F"),
                PRO: new je("PRO", "Proline", "P"),
                PYL: new je("PYL", "Pyrrolysine", "O"),
                SEC: new je("SEC", "Selenocysteine", "U"),
                SER: new je("SER", "Serine", "S"),
                THR: new je("THR", "Threonine", "T"),
                TRP: new je("TRP", "Tryptophan", "W"),
                TYR: new je("TYR", "Tyrosine", "Y"),
                VAL: new je("VAL", "Valine", "V"),
                A: new je("A", "Adenine", "A"),
                C: new je("C", "Cytosine", "C"),
                G: new je("G", "Guanine", "G"),
                I: new je("I", "Inosine", "I"),
                T: new je("T", "Thymine", "T"),
                U: new je("U", "Uracil", "U"),
                DA: new je("DA", "Adenine", "A"),
                DC: new je("DC", "Cytosine", "C"),
                DG: new je("DG", "Guanine", "G"),
                DI: new je("DI", "Inosine", "I"),
                DT: new je("DT", "Thymine", "T"),
                DU: new je("DU", "Uracil", "U"),
                "+A": new je("+A", "Adenine", "A"),
                "+C": new je("+C", "Cytosine", "C"),
                "+G": new je("+G", "Guanine", "G"),
                "+I": new je("+I", "Inosine", "I"),
                "+T": new je("+T", "Thymine", "T"),
                "+U": new je("+U", "Uracil", "U"),
                WAT: new je("WAT", "Water", ""),
                H2O: new je("H2O", "Water", ""),
                HOH: new je("HOH", "Water", ""),
                DOD: new je("DOD", "Water", ""),
                UNK: new je("UNK", "Unknown", ""),
                UNL: new je("UNL", "Unknown Ligand", "")
            }), Le(je, "Flags", {
                PROTEIN: 1,
                BASIC: 2,
                ACIDIC: 4,
                POLAR: 8,
                NONPOLAR: 16,
                AROMATIC: 32,
                NUCLEIC: 256,
                PURINE: 512,
                PYRIMIDINE: 1024,
                DNA: 2048,
                RNA: 4096,
                WATER: 65536
            });
            var Ve = je.Flags;
            De(Ve.WATER, ["WAT", "H2O", "HOH", "DOD"]), De(Ve.PROTEIN, ["ALA", "ARG", "ASN", "ASP", "CYS", "GLY", "GLU", "GLN", "HIS", "ILE", "LEU", "LYS", "MET", "PHE", "PRO", "PYL", "SEC", "SER", "THR", "TRP", "TYR", "VAL"]), De(Ve.BASIC, ["ARG", "HIS", "LYS"]), De(Ve.ACIDIC, ["ASP", "GLU"]), De(Ve.POLAR, ["ASN", "CYS", "GLN", "SER", "THR", "TYR"]), De(Ve.NONPOLAR, ["ALA", "ILE", "LEU", "MET", "PHE", "PRO", "TRP", "VAL", "GLY"]), De(Ve.AROMATIC, ["PHE", "TRP", "TYR"]), De(Ve.NUCLEIC, ["A", "G", "I", "DA", "DG", "DI", "+A", "+G", "+I", "C", "T", "U", "DC", "DT", "DU", "+C", "+T", "+U"]), De(Ve.PURINE, ["A", "G", "I", "DA", "DG", "DI", "+A", "+G", "+I"]), De(Ve.PYRIMIDINE, ["C", "T", "U", "DC", "DT", "DU", "+C", "+T", "+U"]), De(Ve.DNA, ["DA", "DG", "DI", "DC", "DT", "DU"]), De(Ve.RNA, ["A", "G", "I", "C", "T", "U"]);
            ! function(e, t) {
                for (var n = Object.keys(t), r = 0, o = n.length; r < o; ++r) {
                    var i = n[r],
                        a = t[i];
                    je.StandardTypes[i][e] = a
                }
            }("hydrophobicity", {
                ILE: 4.5,
                VAL: 4.2,
                LEU: 3.8,
                PHE: 2.8,
                CYS: 2.5,
                MET: 1.9,
                ALA: 1.8,
                GLY: -.4,
                THR: -.7,
                SER: -.8,
                TRP: -.9,
                TYR: -1.3,
                PRO: -1.6,
                HIS: -3.2,
                GLU: -3.5,
                GLN: -3.5,
                ASP: -3.5,
                ASN: -3.5,
                LYS: -3.9,
                ARG: -4.5
            });
            var Fe = je;

            function Be(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function ze(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Ue = ["C3'", "C3*", "P", "H5T", "H3T"],
                Ge = ["OP1", "O1P"],
                He = ["OP2", "O2P"],
                We = ["C3'", "C3*", "C1", "C1'", "C1*", "P"],
                qe = [{
                    types: ["A", "DA", "G", "DG"],
                    atoms: ["N1"]
                }, {
                    types: ["C", "DC"],
                    atoms: ["N3"]
                }, {
                    types: ["T", "DT", "U", "DU"],
                    atoms: ["O4"]
                }],
                Ye = function() {
                    function e(t, n, r, o) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._chain = t, this._component = null, this._type = n, this._sequence = r, this._icode = o, this._mask = 1, this._index = -1, this._atoms = [], this._secondary = null, this._firstAtom = null, this._leadAtom = null, this._wingAtom = null, this._lastAtom = null, this._controlPoint = null, this._midPoint = null, this._wingVector = null, this._cylinders = null, this._isValid = !0, this._het = !1, this._molecule = null, this.temperature = null, this.occupancy = null
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "getChain",
                        value: function() {
                            return this._chain
                        }
                    }, {
                        key: "getMolecule",
                        value: function() {
                            return this._molecule
                        }
                    }, {
                        key: "getType",
                        value: function() {
                            return this._type
                        }
                    }, {
                        key: "getSequence",
                        value: function() {
                            return this._sequence
                        }
                    }, {
                        key: "getSecondary",
                        value: function() {
                            return this._secondary
                        }
                    }, {
                        key: "getICode",
                        value: function() {
                            return this._icode
                        }
                    }, {
                        key: "addAtom",
                        value: function(e, t, n, r, o, i, a, s, l, c) {
                            var u = new Ae(this, e, t, n, r, o, i, a, s, l, c);
                            return this._chain.getComplex().addAtom(u), this._atoms.push(u), this._het = this._het || o, u
                        }
                    }, {
                        key: "getAtomCount",
                        value: function() {
                            return this._atoms.length
                        }
                    }, {
                        key: "forEachAtom",
                        value: function(e) {
                            for (var t = this._atoms, n = 0, r = t.length; n < r && !e(t[n]); ++n);
                        }
                    }, {
                        key: "_findAtomByName",
                        value: function(e) {
                            var t = null;
                            return this.forEachAtom(function(n) {
                                return n._name._name === e && (t = n, !0)
                            }), t
                        }
                    }, {
                        key: "_findFirstAtomInList",
                        value: function(e) {
                            for (var t = null, n = 0; n < e.length; ++n)
                                if (null !== (t = this._findAtomByName(e[n]))) return t;
                            return t
                        }
                    }, {
                        key: "collectMask",
                        value: function() {
                            for (var e = 4294967295, t = this._atoms, n = 0, r = t.length; n < r; ++n) e &= t[n]._mask;
                            this._mask = e
                        }
                    }, {
                        key: "getCylinderTargetList",
                        value: function() {
                            for (var e = this._type._name, t = 0, n = qe.length; t < n; ++t)
                                for (var r = 0, o = qe[t].types.length; r < o; ++r)
                                    if (e === qe[t].types[r]) return qe[t].atoms;
                            return null
                        }
                    }, {
                        key: "_detectLeadWing",
                        value: function(e, t, n) {
                            var r = this._findFirstAtomInList(Ue),
                                o = this._findFirstAtomInList(Ge),
                                i = this._findFirstAtomInList(He);
                            if (null === o && null !== t && (o = t._findFirstAtomInList(Ge)), null === i && null !== t && (i = t._findFirstAtomInList(He)), null !== r && null !== o && null !== i) {
                                e._leadAtom = r, e._controlPoint = n(r), e._wingVector = n(i).clone().sub(n(o)), e._isValid = !0;
                                var a = this._findFirstAtomInList(We),
                                    s = this.getCylinderTargetList(),
                                    l = null !== s ? this._findFirstAtomInList(s) : null;
                                null !== a && null !== l && (e._cylinders = [n(a), n(l)])
                            }
                        }
                    }, {
                        key: "calcWing",
                        value: function(e, t, n, r) {
                            var o = t.clone().sub(e),
                                i = e.clone().sub(n);
                            return i.crossVectors(o, i), i.crossVectors(o, i).normalize(), null !== r && Math.abs(r.angleTo(i)) > Math.PI / 2 && i.negate(), i
                        }
                    }, {
                        key: "_innerFinalize",
                        value: function(e, t, n, r, o) {
                            var i = null === t,
                                a = o(this._leadAtom),
                                s = new c.Vector3(a.x, a.y, a.z);
                            if (0 == (this._type.flags & Fe.Flags.NUCLEIC)) {
                                if (i) r._midPoint = o(this._firstAtom).clone();
                                else {
                                    var l = t._controlPoint;
                                    r._midPoint = l.clone().lerp(s, .5), r._wingVector = this.calcWing(l, s, o(e._wingAtom), t._wingVector)
                                }
                                r._controlPoint = s
                            } else this._detectLeadWing(r, n, o)
                        }
                    }, {
                        key: "_finalize2",
                        value: function(e, t) {
                            this._innerFinalize(e, e, t, this, function(e) {
                                return e._position
                            })
                        }
                    }, {
                        key: "isConnected",
                        value: function(e) {
                            if (this._chain !== e._chain) return !1;
                            if (this === e) return !0;
                            var t = !1;
                            return this.forEachAtom(function(n) {
                                for (var r = n._bonds, o = 0, i = r.length; o < i; ++o) {
                                    var a = r[o];
                                    if (a._left._residue === e || a._right._residue === e) return t = !0, !0
                                }
                                return !1
                            }), t
                        }
                    }, {
                        key: "_finalize",
                        value: function() {
                            var e = this,
                                t = Be(this._atoms, 1);
                            this._firstAtom = t[0], this._lastAtom = this._atoms[this._atoms.length - 1], this._leadAtom = null, this._wingAtom = null;
                            var n = 0,
                                r = 0,
                                o = 0,
                                i = 0;
                            this.forEachAtom(function(t) {
                                return null === e._leadAtom && t._role === xe.Constants.Lead && (e._leadAtom = t), null === e._wingAtom && t._role === xe.Constants.Wing && (e._wingAtom = t), t._temperature && (r += t._temperature, n++), t._occupancy && (i += t._occupancy, o++), null !== e._leadAtom && null !== e._wingAtom
                            }), n > 0 && (this.temperature = r / n), o > 0 && (this.occupancy = i / o), null !== this._leadAtom && null !== this._wingAtom || (this._isValid = !1), null === this._leadAtom && (this._leadAtom = this._firstAtom), null === this._wingAtom && (this._wingAtom = this._lastAtom)
                        }
                    }]) && ze(t.prototype, n), r && ze(t, r), e
                }();

            function Xe(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var $e, Ke = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._complex = t, this._name = n, this._mask = 1, this._index = -1, this._residues = [], this.minSequence = Number.POSITIVE_INFINITY, this.maxSequence = Number.NEGATIVE_INFINITY
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getComplex",
                    value: function() {
                        return this._complex
                    }
                }, {
                    key: "getName",
                    value: function() {
                        return this._name
                    }
                }, {
                    key: "getResidues",
                    value: function() {
                        return this._residues
                    }
                }, {
                    key: "findResidue",
                    value: function(e, t) {
                        for (var n = this._residues, r = 0, o = n.length; r < o; ++r) {
                            var i = n[r];
                            if (i._sequence === e && i._icode === t) return [i, r]
                        }
                        return null
                    }
                }, {
                    key: "_finalize",
                    value: function() {
                        for (var e = this._residues, t = null, n = 0, r = e.length; n < r; ++n) {
                            var o = n + 1 < r ? e[n + 1] : null,
                                i = e[n];
                            i._finalize2(t, o), t = i
                        }
                        if (e.length > 1) {
                            var a = e[1]._wingVector;
                            e[0]._wingVector = new c.Vector3(a.x, a.y, a.z)
                        } else e.length > 0 && (e[0]._wingVector = new c.Vector3(1, 0, 0))
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        var t = this._residues,
                            n = null,
                            r = null,
                            o = e._residues,
                            i = t.length;

                        function a(t) {
                            return e.getAtomPos(t._index)
                        }
                        for (var s = 0; s < i; ++s) {
                            var l = t[s],
                                u = o[l._index],
                                p = s + 1 < i ? t[s + 1] : null;
                            l._innerFinalize(n, r, p, u, a), n = l, r = u
                        }
                        o[t[0]._index]._wingVector = i > 1 ? o[t[1]._index]._wingVector : new c.Vector3(1, 0, 0)
                    }
                }, {
                    key: "addResidue",
                    value: function(e, t, n) {
                        var r = this._complex.getResidueType(e);
                        null === r && (r = this._complex.addResidueType(e));
                        var o = new Ye(this, r, t, n);
                        return this._complex.addResidue(o), this._residues.push(o), r.flags & (Fe.Flags.NUCLEIC | Fe.Flags.PROTEIN) && (this.maxSequence < t && (this.maxSequence = t), this.minSequence > t && (this.minSequence = t)), o
                    }
                }, {
                    key: "getResidueCount",
                    value: function() {
                        return this._residues.length
                    }
                }, {
                    key: "forEachResidue",
                    value: function(e) {
                        for (var t = this._residues, n = 0, r = t.length; n < r; ++n) e(t[n])
                    }
                }, {
                    key: "collectMask",
                    value: function() {
                        for (var e = 4294967295, t = this._residues, n = 0, r = t.length; n < r; ++n) e &= t[n]._mask;
                        this._mask = e
                    }
                }]) && Xe(t.prototype, n), r && Xe(t, r), e
            }();

            function Ze(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }

            function Qe(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Je = function() {
                function e(t, n, r) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this.type = t, this.generic = e.genericByType[this.type] || "loop", this.init = n, this.term = r
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "_finalize",
                    value: function(e, t, n) {
                        if (!(this.init instanceof Ye && this.term instanceof Ye)) {
                            for (var r = n.splitUnifiedSerial(this.init), o = n.splitUnifiedSerial(this.term), i = r.chain; i <= o.chain; i++)
                                for (var a = r.serial; a <= o.serial; a++)
                                    for (var s = r.iCode; s <= o.iCode; s++) {
                                        var l = n.getUnifiedSerial(i, a, s);
                                        t[l] && (t[l]._secondary = this)
                                    }
                            this.init = t[this.init], this.term = t[this.term]
                        }
                    }
                }]) && Qe(t.prototype, n), r && Qe(t, r), e
            }();
            Je.Type = {
                STRAND: "E",
                BRIDGE: "B",
                HELIX_310: "G",
                HELIX_ALPHA: "H",
                HELIX_PI: "I",
                HELIX: "X",
                TURN_310: "3",
                TURN_ALPHA: "4",
                TURN_PI: "5",
                TURN: "T",
                BEND: "S",
                COIL: "C"
            }, Je.Generic = {
                STRAND: "strand",
                HELIX: "helix",
                LOOP: "loop"
            };
            var et = Je.Type,
                tt = Je.Generic;
            Je.genericByType = (Ze($e = {}, et.STRAND, tt.STRAND), Ze($e, et.HELIX_310, tt.HELIX), Ze($e, et.HELIX_ALPHA, tt.HELIX), Ze($e, et.HELIX_PI, tt.HELIX), Ze($e, et.HELIX, tt.HELIX), $e);
            var nt = Je;

            function rt(e) {
                return (rt = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ot(e, t) {
                return !t || "object" !== rt(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function it(e) {
                return (it = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function at(e, t) {
                return (at = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var st = nt.Type,
                lt = {
                    1: st.HELIX_ALPHA,
                    3: st.HELIX_PI,
                    5: st.HELIX_310
                },
                ct = function(e) {
                    function t(e, n, r, o, i, a, s) {
                        var l;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (l = ot(this, it(t).call(this, lt[e] || nt.Type.HELIX, n, r))).serial = o, l.name = i, l.comment = a, l.length = s, l
                    }
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && at(e, t)
                    }(t, nt), t
                }();

            function ut(e) {
                return (ut = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function pt(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ft(e, t) {
                return !t || "object" !== ut(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ht(e, t, n) {
                return (ht = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = dt(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function dt(e) {
                return (dt = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function mt(e, t) {
                return (mt = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var yt = function(e) {
                function t(e, n, r, o, i, a) {
                    var s;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (s = ft(this, dt(t).call(this, nt.Type.STRAND, n, r))).sheet = e, s.sense = o, s.atomCur = i, s.atomPrev = a, s
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && mt(e, t)
                }(t, nt), n = t, (r = [{
                    key: "_finalize",
                    value: function(e, n, r) {
                        ht(dt(t.prototype), "_finalize", this).call(this, e, n, r);
                        var o = this.atomCur;
                        null === o || Number.isNaN(o) || (this.atomCur = e[o]), null === (o = this.atomPrev) || Number.isNaN(o) || (this.atomPrev = e[o])
                    }
                }]) && pt(n.prototype, r), o && pt(n, o), t
            }();

            function vt(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var _t = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._name = t, this._width = n, this._strands = []
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getName",
                    value: function() {
                        return this._name
                    }
                }, {
                    key: "getWidth",
                    value: function() {
                        return this._width
                    }
                }, {
                    key: "addStrand",
                    value: function(e) {
                        this._strands.push(e), this._width = this._strands.length
                    }
                }, {
                    key: "addEmptyStrand",
                    value: function() {
                        this._strands.push(new yt(null, null, null, null, null, null))
                    }
                }, {
                    key: "_finalize",
                    value: function(e, t, n) {
                        for (var r = this._strands, o = 0, i = r.length; o < i; ++o) r[o]._finalize(e, t, n);
                        if (this._width || (this._width = r.length), r.length !== this._width) throw new Error("Sheet ".concat(this._name, " is inconsistent."))
                    }
                }]) && vt(t.prototype, n), r && vt(t, r), e
            }();

            function gt(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var bt = function() {
                    function e(t, n, r, o, i) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._id = t, this._name = n, this._position = r || new c.Vector3, this._atoms = o || [], this._charge = 0, this._repeat = 1, this._center = null, this.xmlNodeRef = i || null
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "getName",
                        value: function() {
                            return this._name
                        }
                    }, {
                        key: "getPosition",
                        value: function() {
                            return this._position
                        }
                    }, {
                        key: "getCentralPoint",
                        value: function() {
                            return this._center
                        }
                    }, {
                        key: "_rebuildSGroupOnAtomChange",
                        value: function() {
                            if (null !== this._center) {
                                for (var e = new c.Vector3(1e8, 1e8, 1e8), t = new c.Vector3(-1e8, -1e8, -1e8), n = 0, r = this._atoms.length; n < r; n++) {
                                    var o = this._atoms[n].getPosition();
                                    e.set(Math.min(e.x, o.x), Math.min(e.y, o.y), Math.min(e.z, o.z)), t.set(Math.max(t.x, o.x), Math.max(t.y, o.y), Math.max(t.z, o.z))
                                }
                                this._center.addVectors(e, t), this._center.multiplyScalar(.5)
                            }
                        }
                    }, {
                        key: "buildChemicalFormula",
                        value: function(e, t) {
                            var n = 0,
                                r = 0,
                                o = e._buildFormulaSimple(t, function(e, t) {
                                    r = e, n = t
                                }),
                                i = this._charge + n;
                            return 0 !== i ? (this._repeat > 1 ? o = r > 1 ? "".concat(this._repeat.toString(), "(").concat(o, ")") : this._repeat.toString() + o : r > 1 && (o = "(".concat(o, ")")), i > 1 && (o += "^".concat(i.toString(), "+")), 1 === i && (o += "^+"), i < -1 && (o += "^".concat(Math.abs(i).toString(), "-")), -1 === i && (o += "^-")) : this._repeat > 1 && (o = this._repeat.toString() + o), o
                        }
                    }]) && gt(t.prototype, n), r && gt(t, r), e
                }(),
                wt = n("4oJk");

            function xt(e) {
                return (xt = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function St(e, t) {
                return !t || "object" !== xt(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ct(e) {
                return (Ct = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Pt(e, t) {
                if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                e.prototype = Object.create(t && t.prototype, {
                    constructor: {
                        value: e,
                        writable: !0,
                        configurable: !0
                    }
                }), t && kt(e, t)
            }

            function Et(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function Ot(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function At(e, t, n) {
                return t && Ot(e.prototype, t), n && Ot(e, n), e
            }

            function Tt(e, t, n) {
                return (Tt = function() {
                    if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
                    if (Reflect.construct.sham) return !1;
                    if ("function" == typeof Proxy) return !0;
                    try {
                        return Date.prototype.toString.call(Reflect.construct(Date, [], function() {})), !0
                    } catch (e) {
                        return !1
                    }
                }() ? Reflect.construct : function(e, t, n) {
                    var r = [null];
                    r.push.apply(r, t);
                    var o = new(Function.bind.apply(e, r));
                    return n && kt(o, n.prototype), o
                }).apply(null, arguments)
            }

            function kt(e, t) {
                return (kt = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Rt = {};

            function It(e, t) {
                var n = e.toLowerCase();
                t.prototype.keyword = n, t.prototype.name = e;
                var r = function() {
                    for (var e = arguments.length, n = new Array(e), r = 0; r < e; r++) n[r] = arguments[r];
                    return Tt(t, n)
                };
                return r.SelectorClass = t, Rt[n] = r, t
            }
            var Mt = function() {
                    function e(t, n) {
                        Et(this, e), this.min = t, this.max = void 0 === n ? t : n
                    }
                    return At(e, [{
                        key: "includes",
                        value: function(e) {
                            return this.min <= e && e <= this.max
                        }
                    }, {
                        key: "toString",
                        value: function() {
                            var e = this.min,
                                t = this.max;
                            return e === t ? String(e) : [e, t].join(":")
                        }
                    }, {
                        key: "toJSON",
                        value: function() {
                            return [this.min, this.max]
                        }
                    }]), e
                }(),
                Nt = function() {
                    function e(t) {
                        if (Et(this, e), t instanceof this.constructor) return t;
                        t instanceof Array ? this._values = t.slice(0) : this._values = t ? [t] : []
                    }
                    return At(e, [{
                        key: "append",
                        value: function(e) {
                            var t = this._values;
                            return t[t.length] = e, this
                        }
                    }, {
                        key: "remove",
                        value: function(e) {
                            var t = this._values,
                                n = t.indexOf(e);
                            return n >= 0 && t.splice(n, 1), this
                        }
                    }, {
                        key: "toString",
                        value: function() {
                            return this._values.join(",")
                        }
                    }, {
                        key: "toJSON",
                        value: function() {
                            for (var e = this._values, t = [], n = 0, r = e.length; n < r; ++n) {
                                var o = e[n];
                                t[n] = o.toJSON ? o.toJSON() : o
                            }
                            return t
                        }
                    }]), e
                }(),
                Lt = function(e) {
                    function t() {
                        return Et(this, t), St(this, Ct(t).apply(this, arguments))
                    }
                    return Pt(t, Nt), At(t, [{
                        key: "includes",
                        value: function(e) {
                            for (var t = this._values, n = 0, r = t.length; n < r; ++n)
                                if (t[n].includes(e)) return !0;
                            return !1
                        }
                    }]), t
                }(),
                jt = [],
                Dt = function(e) {
                    function t(e, n) {
                        var r;
                        Et(this, t);
                        var o = r = St(this, Ct(t).call(this, e));
                        if (n)
                            for (var i = o._values, a = 0, s = i.length; a < s; ++a) {
                                var l = i[a];
                                "string" == typeof l && (i[a] = l.toUpperCase())
                            }
                        return St(r, o)
                    }
                    return Pt(t, Nt), At(t, [{
                        key: "includes",
                        value: function(e) {
                            return -1 !== this._values.indexOf(e)
                        }
                    }, {
                        key: "toString",
                        value: function() {
                            var e = this._values;
                            jt.length = 0;
                            for (var t = 0, n = e.length; t < n; ++t) jt[t] = R.correctSelectorIdentifier(String(e[t]));
                            return jt.join(",")
                        }
                    }]), t
                }(),
                Vt = function() {
                    function e() {
                        Et(this, e)
                    }
                    return At(e, [{
                        key: "toString",
                        value: function() {
                            return this.keyword
                        }
                    }, {
                        key: "toJSON",
                        value: function() {
                            return [this.name]
                        }
                    }]), e
                }();
            Vt.prototype.name = "Error", Vt.prototype.keyword = "error";
            var Ft = function(e) {
                    function t(e) {
                        var n;
                        return Et(this, t), (n = St(this, Ct(t).call(this))).list = e, n
                    }
                    return Pt(t, Vt), At(t, [{
                        key: "toString",
                        value: function() {
                            return "".concat(this.keyword, " ").concat(this.list)
                        }
                    }, {
                        key: "toJSON",
                        value: function() {
                            return [this.name, this.list.toJSON()]
                        }
                    }]), t
                }(),
                Bt = function(e) {
                    function t(e) {
                        return Et(this, t), St(this, Ct(t).call(this, new Lt(e)))
                    }
                    return Pt(t, Ft), t
                }(),
                zt = function(e) {
                    function t(e, n) {
                        return Et(this, t), St(this, Ct(t).call(this, new Dt(e, !n)))
                    }
                    return Pt(t, Ft), t
                }();
            It("Serial", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Bt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._serial)
                    }
                }]), t
            }()), It("Name", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._name.getString())
                    }
                }]), t
            }()), It("AltLoc", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(String.fromCharCode(e._location))
                    }
                }]), t
            }()), It("Elem", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e.element.name)
                    }
                }]), t
            }()), It("Residue", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._residue._type._name)
                    }
                }]), t
            }()), It("Sequence", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Bt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._residue._sequence)
                    }
                }]), t
            }()), It("ICode", function(e) {
                function t(e) {
                    return Et(this, t), St(this, Ct(t).call(this, e, !0))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._residue._icode)
                    }
                }]), t
            }()), It("ResIdx", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Bt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._residue._index)
                    }
                }]), t
            }()), It("Chain", function(e) {
                function t(e) {
                    return Et(this, t), St(this, Ct(t).call(this, e, !0))
                }
                return Pt(t, zt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.list.includes(e._residue._chain._name)
                    }
                }]), t
            }()), It("Hetatm", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Vt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return e._het
                    }
                }]), t
            }()), It("PolarH", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Vt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return (e.flags & Ae.Flags.NONPOLARH) === Ae.Flags.HYDROGEN
                    }
                }]), t
            }()), It("NonPolarH", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Vt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return (e.flags & Ae.Flags.NONPOLARH) === Ae.Flags.NONPOLARH
                    }
                }]), t
            }()), It("All", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Vt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return !0
                    }
                }]), t
            }()), It("None", function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Vt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return !1
                    }
                }]), t
            }());
            var Ut = Rt.none();

            function Gt(e, t) {
                return It(t, function(t) {
                    function n() {
                        return Et(this, n), St(this, Ct(n).apply(this, arguments))
                    }
                    return Pt(n, Vt), At(n, [{
                        key: "includesAtom",
                        value: function(t) {
                            return 0 != (t._residue._type.flags & e)
                        }
                    }]), n
                }())
            }

            function Ht(e, t, n) {
                return n.prototype.priority = t, It(e, n)
            }
            Gt(Fe.Flags.PROTEIN, "Protein"), Gt(Fe.Flags.BASIC, "Basic"), Gt(Fe.Flags.ACIDIC, "Acidic"), Gt(Fe.Flags.BASIC | Fe.Flags.ACIDIC, "Charged"), Gt(Fe.Flags.POLAR, "Polar"), Gt(Fe.Flags.NONPOLAR, "NonPolar"), Gt(Fe.Flags.AROMATIC, "Aromatic"), Gt(Fe.Flags.NUCLEIC, "Nucleic"), Gt(Fe.Flags.PURINE, "Purine"), Gt(Fe.Flags.PYRIMIDINE, "Pyrimidine"), Gt(Fe.Flags.WATER, "Water");
            var Wt = function(e) {
                function t(e) {
                    var n;
                    return Et(this, t), (n = St(this, Ct(t).call(this))).rhs = e || Ut, n
                }
                return Pt(t, Vt), At(t, [{
                    key: "toString",
                    value: function() {
                        var e = this.rhs.priority && this.rhs.priority > this.priority ? "(".concat(this.rhs, ")") : this.rhs;
                        return "".concat(this.keyword, " ").concat(e)
                    }
                }, {
                    key: "toJSON",
                    value: function() {
                        return [this.name, this.rhs.toJSON()]
                    }
                }]), t
            }();
            Wt.prototype.priority = 1;
            var qt = function(e) {
                function t(e, n) {
                    var r;
                    return Et(this, t), (r = St(this, Ct(t).call(this))).lhs = e || Ut, r.rhs = n || Ut, r
                }
                return Pt(t, Vt), At(t, [{
                    key: "toString",
                    value: function() {
                        var e = this.lhs.priority && this.lhs.priority > this.priority ? "(".concat(this.lhs, ")") : this.lhs,
                            t = this.rhs.priority && this.rhs.priority > this.priority ? "(".concat(this.rhs, ")") : this.rhs;
                        return "".concat(e, " ").concat(this.keyword, " ").concat(t)
                    }
                }, {
                    key: "toJSON",
                    value: function() {
                        return [this.name, this.lhs.toJSON(), this.rhs.toJSON()]
                    }
                }]), t
            }();
            qt.prototype.priority = 1e3, Ht("Not", 1, function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, Wt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return !this.rhs.includesAtom(e)
                    }
                }]), t
            }()), Ht("And", 2, function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, qt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.lhs.includesAtom(e) && this.rhs.includesAtom(e)
                    }
                }]), t
            }()), Ht("Or", 3, function(e) {
                function t() {
                    return Et(this, t), St(this, Ct(t).apply(this, arguments))
                }
                return Pt(t, qt), At(t, [{
                    key: "includesAtom",
                    value: function(e) {
                        return this.lhs.includesAtom(e) || this.rhs.includesAtom(e)
                    }
                }]), t
            }());
            var Yt = Object.create(Rt);
            Yt.Selector = Vt, Yt.RangeListSelector = Bt, Yt.ValueListSelector = zt, Yt.Range = Mt, Yt.RangeList = Lt, Yt.ValueList = Dt, Yt.PrefixOperator = Wt, Yt.InfixOperator = qt, Yt.Context = Object.create({}), Yt.GetSelector = function(e) {
                if (!Yt.Context.hasOwnProperty(e)) throw {
                    message: "selector ".concat(e, " is not registered")
                };
                return Yt.Context[e] || Ut
            }, Yt.ClearContext = function() {
                Object.keys(Yt.Context).forEach(function(e) {
                    delete Yt.Context[e]
                })
            }, Yt.keyword = function(e) {
                return Rt[e.toLowerCase()] || Rt.none
            }, Yt.parse = function(e) {
                var t = {};
                try {
                    t.selector = wt.parser.parse(e)
                } catch (e) {
                    t.selector = Ut, t.error = e.message
                }
                return t
            }, wt.parser.yy = Yt, wt.parser.yy.parseError = wt.parser.parseError;
            var Xt = Yt;

            function $t(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Kt = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._complex = t, this._selector = Xt.keyword("All")(), this._boundaries = {
                        boundingBox: new c.Box3,
                        boundingSphere: new c.Sphere
                    }
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "computeBoundaries",
                    value: function() {
                        var e = this._complex._atoms,
                            t = e.length,
                            n = this._selector,
                            r = this._boundaries.boundingBox;
                        if (r.makeEmpty(), 1 === t) {
                            r.expandByPoint(e[0]._position);
                            var o = new c.Vector3;
                            r.getCenter(o);
                            var i = 2 * e[0].element.radius;
                            r.setFromCenterAndSize(o, new c.Vector3(i, i, i))
                        } else
                            for (var a = 0; a < t; ++a) n.includesAtom(e[a]) && r.expandByPoint(e[a]._position);
                        var s = 0,
                            l = new c.Vector3;
                        if (r.getCenter(l), 1 === t) this._boundaries.boundingSphere.set(l, e[0].element.radius);
                        else {
                            for (var u = 0; u < t; ++u)
                                if (n.includesAtom(e[u])) {
                                    var p = e[u]._position,
                                        f = l.distanceToSquared(p);
                                    s < f && (s = f)
                                } this._boundaries.boundingSphere.set(l, Math.sqrt(s))
                        }
                    }
                }, {
                    key: "getTransforms",
                    value: function() {
                        return []
                    }
                }, {
                    key: "getSelector",
                    value: function() {
                        return this._selector
                    }
                }, {
                    key: "getBoundaries",
                    value: function() {
                        return this._boundaries
                    }
                }, {
                    key: "finalize",
                    value: function() {}
                }]) && $t(t.prototype, n), r && $t(t, r), e
            }();

            function Zt(e) {
                return (Zt = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Qt(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Jt(e, t) {
                return !t || "object" !== Zt(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function en(e, t, n) {
                return (en = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = tn(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function tn(e) {
                return (tn = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function nn(e, t) {
                return (nn = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var rn = function(e) {
                function t(e) {
                    var n;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = Jt(this, tn(t).call(this, e))).chains = [], n.matrices = [], n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && nn(e, t)
                }(t, Kt), n = t, (r = [{
                    key: "computeBoundaries",
                    value: function() {
                        en(tn(t.prototype), "computeBoundaries", this).call(this);
                        var e = this.matrices,
                            n = this._boundaries.boundingSphere.center,
                            r = this._boundaries.boundingSphere.radius,
                            o = this._boundaries.boundingBox = new c.Box3;
                        o.makeEmpty();
                        for (var i = 0, a = e.length; i < a; ++i) o.expandByPoint(n.clone().applyMatrix4(e[i]));
                        var s = o.max.distanceTo(o.min) / 2 + r,
                            l = new c.Vector3;
                        o.getCenter(l), this._boundaries.boundingSphere = (new c.Sphere).set(l, s), o.max.addScalar(r), o.min.subScalar(r)
                    }
                }, {
                    key: "addChain",
                    value: function(e) {
                        this.chains[this.chains.length] = e
                    }
                }, {
                    key: "addMatrix",
                    value: function(e) {
                        this.matrices[this.matrices.length] = e
                    }
                }, {
                    key: "getTransforms",
                    value: function() {
                        return this.matrices
                    }
                }, {
                    key: "finalize",
                    value: function() {
                        this.chains.length > 0 ? this._selector = Xt.keyword("Chain")(this.chains) : this._selector = Xt.keyword("None")()
                    }
                }]) && Qt(n.prototype, r), o && Qt(n, o), t
            }();

            function on(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var an = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._complex = t, this._index = -1, this._residueIndices = [], this._cycles = [], this._subDivs = [], this._residueCount = 0
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getResidues",
                    value: function() {
                        return this._complex._residues
                    }
                }, {
                    key: "getResidueCount",
                    value: function() {
                        return this._residueCount
                    }
                }, {
                    key: "forEachResidue",
                    value: function(e) {
                        for (var t = this._complex._residues, n = this._residueIndices, r = 0, o = n.length; r < o; ++r)
                            for (var i = n[r].start, a = n[r].end; i <= a; ++i) e(t[i])
                    }
                }, {
                    key: "setSubDivs",
                    value: function(e) {
                        this._subDivs = e;
                        for (var t = 0, n = [], r = 0, o = 0, i = e.length; o < i; ++o)
                            if (o === i - 1 || e[o].end + 1 !== e[o + 1].start) {
                                var a = e[t].start,
                                    s = e[o].end;
                                n[n.length] = {
                                    start: a,
                                    end: s
                                }, r += s - a + 1, t = o + 1
                            } this._residueIndices = n, this._residueCount = r
                    }
                }, {
                    key: "getComplex",
                    value: function() {
                        return this._complex
                    }
                }, {
                    key: "forEachBond",
                    value: function(e) {
                        for (var t = this._complex._bonds, n = 0, r = t.length; n < r; ++n) {
                            var o = t[n];
                            o._left._residue._component === this && e(o)
                        }
                    }
                }, {
                    key: "update",
                    value: function() {
                        this.forEachCycle(function(e) {
                            e.update()
                        })
                    }
                }, {
                    key: "forEachAtom",
                    value: function(e) {
                        this.forEachResidue(function(t) {
                            t.forEachAtom(e)
                        })
                    }
                }, {
                    key: "addCycle",
                    value: function(e) {
                        this._cycles.push(e)
                    }
                }, {
                    key: "forEachCycle",
                    value: function(e) {
                        for (var t = this._cycles, n = 0, r = t.length; n < r; ++n) e(t[n])
                    }
                }, {
                    key: "markResidues",
                    value: function() {
                        var e = this;
                        e.forEachResidue(function(t) {
                            t._component = e
                        })
                    }
                }, {
                    key: "_forEachSubChain",
                    value: function(e, t) {
                        for (var n = this._complex._residues, r = this._subDivs, o = 0, i = r.length; o < i; ++o)
                            for (var a = r[o].start, s = r[o].end; a <= s; ++a) {
                                var l = n[a];
                                if (e & l._mask && l._isValid) {
                                    for (var c = a + 1; c <= s; ++c) {
                                        var u = n[c];
                                        if (!(e & u._mask && u._isValid)) break
                                    }
                                    t(o, a, c - 1), a = c
                                }
                            }
                    }
                }, {
                    key: "getMaskedSequences",
                    value: function(e) {
                        var t = [],
                            n = 0;
                        return this._forEachSubChain(e, function(e, r, o) {
                            t[n++] = {
                                start: r,
                                end: o
                            }
                        }), t
                    }
                }, {
                    key: "getMaskedSubdivSequences",
                    value: function(e) {
                        var t = [],
                            n = -1,
                            r = -1,
                            o = this._subDivs;
                        return this._forEachSubChain(e, function(e, i, a) {
                            r !== e && (t[++n] = {
                                arr: [],
                                boundaries: o[e]
                            }, r = e), t[n].arr[t[n].arr.length] = {
                                start: i,
                                end: a
                            }
                        }), t
                    }
                }]) && on(t.prototype, n), r && on(t, r), e
            }();

            function sn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var ln = 32,
                cn = 1048576,
                un = 4,
                pn = -1,
                fn = function() {
                    function e(t) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this.numPairs = 0, this.numMaxPairs = t, this.intBuffer = R.allocateTyped(Int32Array, t * un);
                        for (var n = 0; n < t * un; n++) this.intBuffer[n] = pn;
                        this.hashBuffer = R.allocateTyped(Int32Array, cn * ln);
                        for (var r = 0; r < cn * ln; r++) this.hashBuffer[r] = pn
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "destroy",
                        value: function() {
                            this.intBuffer = null, this.hashBuffer = null
                        }
                    }, {
                        key: "addPair",
                        value: function(e, t) {
                            for (var n = e < t ? e : t, r = e > t ? e : t, o = n + (r << 14), i = (n + 89237 * r & cn - 1) * ln, a = 0; a < ln; a++) {
                                var s = this.hashBuffer[i + a];
                                if (s === pn) break;
                                if (s === o) return !1
                            }
                            if (a >= ln) throw new Error("addPair: increase cMaxPairsForHashCode");
                            if (this.hashBuffer[i + a] = o, this.numPairs >= this.numMaxPairs) throw new Error("addPair: increase num pairs");
                            return i = this.numPairs * un, this.intBuffer[i] = n, this.intBuffer[i + 1] = r, this.intBuffer[i + 2] = o, this.numPairs++, !0
                        }
                    }]) && sn(t.prototype, n), r && sn(t, r), e
                }();

            function hn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function dn(e) {
                var t = e.element;
                if (t) return t.radiusBonding;
                throw new Error("_getBondingRadius: Logic error.")
            }

            function mn(e) {
                return !e.isHet() || e._bonds && 0 === e._bonds.length
            }

            function yn(e) {
                return "HOH" !== e._residue._type._name && !e.isHet()
            }
            var vn = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._complex = t, this._maxRad = 1.8;
                    var n = this._complex.getDefaultBoundaries().boundingBox;
                    this._vBoxMin = n.min.clone(), this._vBoxMax = n.max.clone(), this._pairCollection = null
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "_addExistingPairs",
                    value: function() {
                        for (var e = this._complex.getAtoms(), t = e.length, n = 0, r = this._pairCollection; n < t; n++)
                            for (var o = e[n]._bonds, i = o.length, a = 0; a < i; a++) {
                                var s = o[a];
                                s._left._index === n && r.addPair(n, s._right._index)
                            }
                        return 0
                    }
                }, {
                    key: "_findPairs",
                    value: function() {
                        var e = this._complex.getVoxelWorld();
                        if (null !== e)
                            for (var t, n, r, o, i, a = this._complex._atoms, s = a.length, l = this.isAtomEligible, c = this, u = function(e) {
                                    if (!n || !e.isHydrogen()) {
                                        var a = e.getLocation();
                                        if (32 === o || 32 === a || o === a) {
                                            var s = r.distanceToSquared(e._position),
                                                l = e.element.radiusBonding,
                                                u = t + l + .45;
                                            s > u * u || s < .001 || c._pairCollection.addPair(i._index, e._index)
                                        }
                                    }
                                }, p = 0; p < s; ++p) l(i = a[p]) && (t = i.element.radiusBonding, n = i.isHydrogen(), r = i._position, o = i.getLocation(), e.forEachAtomWithinRadius(r, 2 * this._maxRad + .45, u))
                    }
                }, {
                    key: "_addPairs",
                    value: function() {
                        for (var e = this._complex._atoms, t = 0, n = 0; t < this._pairCollection.numPairs; t++, n += 4) {
                            var r = this._pairCollection.intBuffer[n],
                                o = this._pairCollection.intBuffer[n + 1];
                            this._addPair(e[r], e[o])
                        }
                    }
                }, {
                    key: "_addPair",
                    value: function(e, t) {
                        for (var n = e._bonds, r = e._index, o = t._index, i = 0, a = n.length; i < a; ++i) {
                            var s = n[i];
                            if (s._left._index === o || s._right._index === o) return
                        }
                        var l = r < o ? e : t,
                            c = r < o ? t : e,
                            u = this._complex.addBond(l, c, 0, Me.BondType.UNKNOWN, !1);
                        n.push(u), t.getBonds().push(u)
                    }
                }, {
                    key: "build",
                    value: function() {
                        this._buildInner(), H.now.draft.waterBondingHack && this._complex && function(e) {
                            for (var t = Me.BondType.UNKNOWN, n = e._residues, r = 0, o = n.length; r < o; r++) {
                                var i = n[r];
                                if ("HOH" === i._type._name) {
                                    var a = i._atoms,
                                        s = a[0],
                                        l = a[1],
                                        c = a[2];
                                    if (!l || !c) continue;
                                    var u = e.addBond(s, l, 0, t, !0),
                                        p = e.addBond(s, c, 0, t, !0);
                                    s._bonds[0] = u, s._bonds[1] = p, l._bonds[0] = u, c._bonds[0] = p
                                }
                            }
                        }(this._complex)
                    }
                }, {
                    key: "_buildInner",
                    value: function() {
                        var e = this._complex._atoms;
                        if (!(e.length < 2)) {
                            if (e[0]._index < 0) throw new Error("AutoBond: Atoms in complex were not indexed.");
                            this.isAtomEligible = H.now.draft.waterBondingHack ? yn : mn, this._calcBoundingBox(), this._pairCollection = new fn(4 * e.length), this._addExistingPairs(), this._findPairs(), this._addPairs()
                        }
                    }
                }, {
                    key: "_calcBoundingBox",
                    value: function() {
                        for (var e = this._complex._atoms, t = e.length, n = dn(e[0]), r = 1; r < t; ++r) n = Math.max(n, dn(e[r]));
                        this._vBoxMax.addScalar(n), this._vBoxMin.addScalar(-n), this._maxRad = 1.2 * n
                    }
                }, {
                    key: "destroy",
                    value: function() {
                        this._pairCollection && this._pairCollection.destroy()
                    }
                }]) && hn(t.prototype, n), r && hn(t, r), e
            }();

            function _n(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function gn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function bn(e, t, n) {
                return t && gn(e.prototype, t), n && gn(e, n), e
            }
            var wn, xn, Sn, Cn = Me.BondType.AROMATIC,
                Pn = [xe.ByName.C.number, xe.ByName.N.number],
                En = (wn = new c.Vector3, xn = new c.Vector3, Sn = new c.Vector3, function(e, t) {
                    return wn.copy(e).normalize(), xn.copy(t).normalize(), Sn.crossVectors(wn, xn), !(Sn.length() > .1) && wn.dot(xn) >= 0
                });

            function On(e, t) {
                for (var n = 0; n < e.length && e[n] < t;) ++n;
                e.splice(n, 0, t)
            }

            function An(e, t) {
                return e._left === t ? e._right : e._left
            }

            function Tn(e) {
                e._type = Cn
            }
            var kn = function() {
                function e(t) {
                    _n(this, e), this.atoms = t, this.update()
                }
                return bn(e, [{
                    key: "update",
                    value: function() {
                        for (var e = this.atoms, t = new c.Vector3, n = e.length, r = 0; r < n; ++r) t.add(e[r]._position);
                        t.multiplyScalar(1 / n), this.center = t, this.radius = t.distanceTo(e[0]._position.clone().lerp(e[1]._position, .5))
                    }
                }, {
                    key: "forEachBond",
                    value: function(e) {
                        var t, n = this.atoms,
                            r = n.length,
                            o = n[0];

                        function i(n) {
                            n._left !== t && n._right !== t || e(n)
                        }
                        for (var a = 0; a < r; ++a) t = n[(a + 1) % r], o.forEachBond(i), o = t
                    }
                }]), e
            }();

            function Rn(e) {
                return e._type === Cn
            }

            function In(e) {
                if (e.type === Cn) return !0;
                var t = Pn.indexOf(e._right.element.number),
                    n = Pn.indexOf(e._left.element.number);
                return -1 !== t && -1 !== n
            }

            function Mn(e) {
                return e.length > 3
            }

            function Nn(e) {
                return console.assert(e.length > 2), !0
            }
            var Ln = function() {
                function e(t) {
                    _n(this, e), this._complex = t;
                    for (var n = new Array(t._bonds.length), r = new Array(t._bonds.length), o = 0, i = n.length; o < i; ++o) n[o] = [], r[o] = !1;
                    this._bondsData = n, this._bondMarks = r, this._resetCycles()
                }
                return bn(e, [{
                    key: "_resetCycles",
                    value: function() {
                        this._cycles = [], this._currIdx = -1
                    }
                }, {
                    key: "_haveSameCycle",
                    value: function(e, t, n) {
                        for (var r = e[t._index], o = e[n._index], i = r.length, a = o.length, s = 0, l = 0; s < i && l < a;) {
                            if (r[s] === o[l]) return !0;
                            r[s] > o[l] ? ++l : ++s
                        }
                        return !1
                    }
                }, {
                    key: "_tryBond",
                    value: function(e, t, n) {
                        var r = [],
                            o = this._bondsData,
                            i = An(e, t),
                            a = t._position.clone().sub(i._position),
                            s = this._currStart,
                            l = this,
                            u = this._bondMarks,
                            p = this._checkBond;
                        u[e._index] = !0, p = void 0 === p ? Rn : p, t.forEachBond(function(i) {
                            if (p(i) && i !== e && !u[i._index] && !l._haveSameCycle(o, e, i)) {
                                var f, h, d, m = An(i, t),
                                    y = m._position.clone().sub(t._position),
                                    v = m === s ? -2 : 1 - (h = y, d = (f = a).dot(h) / Math.sqrt(f.lengthSq() * h.lengthSq()), c.Math.clamp(d, -1, 1)),
                                    _ = y.cross(a);
                                if (En(_, n)) {
                                    for (var g = 0; g < r.length && r[g].val < v;) ++g;
                                    r.splice(g, 0, {
                                        bond: i,
                                        val: v,
                                        dir: _
                                    })
                                }
                            }
                        });
                        for (var f = 0, h = r.length; f < h; ++f) {
                            var d = r[f].bond,
                                m = d._left === t ? d._right : d._left;
                            if (m === s) return ++this._currIdx, this._cycles.push([t]), u[e._index] = !1, !0;
                            if (this._tryBond(d, m, r[f].dir)) return On(o[d._index], this._currIdx), this._cycles[this._currIdx].push(t), u[e._index] = !1, !0
                        }
                        return u[e._index] = !1, !1
                    }
                }, {
                    key: "_startCycle",
                    value: function(e) {
                        this._currStart = e._left, this._tryBond(e, e._right, new c.Vector3) && (On(this._bondsData[e._index], this._currIdx), this._cycles[this._currIdx].push(e._left))
                    }
                }, {
                    key: "_findLoops",
                    value: function(e, t) {
                        this._checkBond = e;
                        var n = this._complex,
                            r = this;
                        n.forEachComponent(function(n) {
                            r._resetCycles(), n.forEachBond(function(t) {
                                e(t) && r._startCycle(t)
                            });
                            for (var o = r._cycles, i = 0, a = o.length; i < a; ++i) {
                                var s = o[i];
                                if (t(s)) {
                                    var l = new kn(s);
                                    l.forEachBond(Tn), n.addCycle(l)
                                }
                            }
                        })
                    }
                }, {
                    key: "markCycles",
                    value: function() {
                        this._findLoops(Rn, Mn)
                    }
                }, {
                    key: "detectCycles",
                    value: function() {
                        this._findLoops(In, Nn)
                    }
                }]), e
            }();

            function jn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Dn(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }

            function Vn(e, t, n, r) {
                var o = n - e.z,
                    i = r - e.z,
                    a = Math.sqrt(Math.max(t * t - o * o, 0)),
                    s = Math.sqrt(Math.max(t * t - i * i, 0));
                return [Math.min(a, s), n <= e.z && r >= e.z ? t : Math.max(a, s)]
            }

            function Fn(e, t, n, r) {
                var o = n - e.y,
                    i = r - e.y,
                    a = Math.sqrt(Math.max(t * t - o * o, 0)),
                    s = Math.sqrt(Math.max(t * t - i * i, 0));
                return [Math.min(a, s), n <= e.y && r >= e.y ? t : Math.max(a, s)]
            }
            var Bn = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._box = t.clone();
                    var r = new c.Vector3;
                    t.getSize(r), this._count = r.clone().divide(n).floor().max(new c.Vector3(1, 1, 1)), this._last = this._count.clone().subScalar(1), this._cellSize = r.clone().divide(this._count), this._cellInnerR = .5 * Math.min(Math.min(this._cellSize.x, this._cellSize.y), this._cellSize.z), this._cellOuterR = .5 * Math.sqrt(this._cellSize.dot(this._cellSize));
                    var o = this._count.x * this._count.y * this._count.z;
                    this._voxels = R.allocateTyped(Int32Array, o);
                    for (var i = 0; i < o; ++i) this._voxels[i] = -1;
                    this._atoms = []
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "addAtoms",
                    value: function(e) {
                        var t = this,
                            n = this._atoms.length;
                        this._atoms.length = this._atoms.length + 2 * e.getAtomCount(), e.forEachAtom(function(e) {
                            var r = t._findVoxel(e._position);
                            t._atoms[n] = e, t._atoms[n + 1] = t._voxels[r], t._voxels[r] = n, n += 2
                        })
                    }
                }, {
                    key: "_findVoxel",
                    value: function(t) {
                        var n = e._zero,
                            r = e._voxel;
                        return r.copy(t).sub(this._box.min).divide(this._cellSize).floor().clamp(n, this._last), r.x + this._count.x * (r.y + this._count.y * r.z)
                    }
                }, {
                    key: "_forEachAtomInVoxel",
                    value: function(e, t) {
                        for (var n = this._voxels[e]; n >= 0; n = this._atoms[n + 1]) t(this._atoms[n])
                    }
                }, {
                    key: "_forEachVoxelWithinRadius",
                    value: function(t, n, r) {
                        var o = e._xRange,
                            i = e._yRange,
                            a = e._zRange;
                        if (n / this._cellInnerR < 10) this._forEachVoxelWithinRadiusSimple(t, n, r);
                        else {
                            var s, l, c, u, p, f, h, d;
                            a.set(t.z - n, t.z + n), a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0, this._count.z - 1);
                            for (var m = a.x; m <= a.y; ++m) {
                                p = [this._box.min.z + m * this._cellSize.z, this._box.min.z + (m + 1) * this._cellSize.z], d = t.z - n <= p[0] && p[1] <= t.z + n, s = Vn(t, n, p[0], p[1]), i.set(t.y - s[1], t.y + s[1]), i.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0, this._count.y - 1);
                                for (var y = i.x; y <= i.y; ++y) {
                                    u = [this._box.min.y + y * this._cellSize.y, this._box.min.y + (y + 1) * this._cellSize.y], h = t.y - s[0] <= u[0] && u[1] <= t.y + s[0], l = Fn(t, s[1], u[0], u[1]), o.set(t.x - l[1], t.x + l[1]), o.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0, this._count.x - 1);
                                    for (var v = o.x; v <= o.y; ++v) c = [this._box.min.x + v * this._cellSize.x, this._box.min.x + (v + 1) * this._cellSize.x], f = t.x - l[0] <= c[0] && c[1] <= t.x + l[0], r(v + this._count.x * (y + this._count.y * m), f && h && d)
                                }
                            }
                        }
                    }
                }, {
                    key: "_forEachVoxelWithinRadiusSimple",
                    value: function(t, n, r) {
                        var o = e._xRange,
                            i = e._yRange,
                            a = e._zRange,
                            s = e._vCenter,
                            l = (n + this._cellOuterR) * (n + this._cellOuterR),
                            c = -1;
                        n > this._cellOuterR && (c = (n - this._cellOuterR) * (n - this._cellOuterR)), o.set(t.x - n, t.x + n), o.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(), o.x = Math.min(Math.max(o.x, 0), this._count.x - 1), o.y = Math.min(Math.max(o.y, 0), this._count.x - 1), i.set(t.y - n, t.y + n), i.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(), i.x = Math.min(Math.max(i.x, 0), this._count.y - 1), i.y = Math.min(Math.max(i.y, 0), this._count.y - 1), a.set(t.z - n, t.z + n), a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(), a.x = Math.min(Math.max(a.x, 0), this._count.z - 1), a.y = Math.min(Math.max(a.y, 0), this._count.z - 1);
                        for (var u = a.x; u <= a.y; ++u) {
                            var p = [this._box.min.z + u * this._cellSize.z, this._box.min.z + (u + 1) * this._cellSize.z];
                            s.z = .5 * (p[0] + p[1]);
                            for (var f = i.x; f <= i.y; ++f) {
                                var h = [this._box.min.y + f * this._cellSize.y, this._box.min.y + (f + 1) * this._cellSize.y];
                                s.y = .5 * (h[0] + h[1]);
                                for (var d = o.x; d <= o.y; ++d) {
                                    var m = [this._box.min.x + d * this._cellSize.x, this._box.min.x + (d + 1) * this._cellSize.x];
                                    s.x = .5 * (m[0] + m[1]);
                                    var y = t.distanceToSquared(s);
                                    y <= l && r(d + this._count.x * (f + this._count.y * u), y <= c)
                                }
                            }
                        }
                    }
                }, {
                    key: "forEachAtomWithinRadius",
                    value: function(e, t, n) {
                        var r = this,
                            o = t * t;
                        r._forEachVoxelWithinRadius(e, t, function(t, i) {
                            i ? r._forEachAtomInVoxel(t, n) : r._forEachAtomInVoxel(t, function(t) {
                                e.distanceToSquared(t._position) <= o && n(t)
                            })
                        })
                    }
                }, {
                    key: "forEachAtomWithinDistFromMasked",
                    value: function(e, t, n, r) {
                        this._forEachAtomWithinDistFromGroup(function(n) {
                            e.forEachAtom(function(e) {
                                0 != (e._mask & t) && n(e)
                            })
                        }, n, r)
                    }
                }, {
                    key: "forEachAtomWithinDistFromSelected",
                    value: function(e, t, n, r) {
                        this._forEachAtomWithinDistFromGroup(function(n) {
                            e.forEachAtom(function(e) {
                                t.includesAtom(e) && n(e)
                            })
                        }, n, r)
                    }
                }, {
                    key: "_forEachAtomWithinDistFromGroup",
                    value: function(e, t, n) {
                        var r, o = this,
                            i = t * t,
                            a = [],
                            s = [],
                            l = 0;
                        e(function(e) {
                            o._forEachVoxelWithinRadius(e._position, t, function(t, n) {
                                n ? a[t] = -1 : void 0 === a[t] ? (s.push(e), s.push(-1), a[t] = l, l += 2) : -1 !== a[t] && (s.push(e), s.push(a[t]), a[t] = l, l += 2)
                            })
                        });
                        var c = function(e) {
                            if (void 0 !== a[r])
                                if (-1 !== (l = a[r])) {
                                    for (; l >= 0; l = s[l + 1])
                                        if (e._position.distanceToSquared(s[l]._position) < i) {
                                            n(e);
                                            break
                                        }
                                } else n(e)
                        };
                        for (r in a) a.hasOwnProperty(r) && o._forEachAtomInVoxel(r, c)
                    }
                }]) && jn(t.prototype, n), r && jn(t, r), e
            }();
            Dn(Bn, "_zero", new c.Vector3(0, 0, 0)), Dn(Bn, "_voxel", new c.Vector3), Dn(Bn, "_xRange", new c.Vector2), Dn(Bn, "_yRange", new c.Vector2), Dn(Bn, "_zRange", new c.Vector2), Dn(Bn, "_vCenter", new c.Vector3);
            var zn = Bn;

            function Un(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Gn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Hn = 1e3,
                Wn = function() {
                    function e(t) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._complex = t, this._hbonds = [], this._complex._residues.length > Hn ? this._buildVW() : this._build()
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "isBond",
                        value: function(e, t) {
                            if (this._hbonds[e]) {
                                var n = Un(this._hbonds[e].acceptor, 2),
                                    r = n[0],
                                    o = n[1];
                                if (r && r.residue === t && r.energy < -.5) return !0;
                                if (o && o.residue === t && o.energy < -.5) return !0
                            }
                            return !1
                        }
                    }, {
                        key: "_build",
                        value: function() {
                            for (var e = 0; e < this._complex._residues.length - 1; ++e) {
                                var t = this._complex._residues[e];
                                if (0 != (t.getType().flags & Fe.Flags.PROTEIN)) {
                                    var n = null;
                                    e > 0 && this._complex._residues[e - 1].getType().flags & Fe.Flags.PROTEIN && t._sequence === this._complex._residues[e - 1]._sequence + 1 && (n = this._complex._residues[e - 1]);
                                    for (var r = e + 1; r < this._complex._residues.length; ++r) {
                                        var o = this._complex._residues[r];
                                        if (0 != (o.getType().flags & Fe.Flags.PROTEIN)) {
                                            var i = null;
                                            this._complex._residues[r - 1].getType().flags & Fe.Flags.PROTEIN && o._sequence === this._complex._residues[r - 1]._sequence + 1 && (i = this._complex._residues[r - 1]), this._calcHBondEnergy(n, t, o), r !== e + 1 && this._calcHBondEnergy(i, o, t)
                                        }
                                    }
                                }
                            }
                        }
                    }, {
                        key: "_buildVW",
                        value: function() {
                            var e, t, n = this,
                                r = this._complex._residues,
                                o = this._complex.getVoxelWorld();
                            if (null !== o)
                                for (var i = new fn(this._complex._residues.length * this._complex._residues.length / 2), a = 0; a < r.length - 1; ++a) 0 != ((e = r[a]).getType().flags & Fe.Flags.PROTEIN) && (!(t = a > 0 ? r[a - 1] : null) || 0 != (t.getType().flags & Fe.Flags.PROTEIN) && e._sequence === t._sequence + 1 || (t = null), o.forEachAtomWithinRadius(this._residueGetCAlpha(e), 5, s));

                            function s(o) {
                                var a = o._residue;
                                if (a._index !== e._index && 0 != (a.getType().flags & Fe.Flags.PROTEIN) && i.addPair(e._index, a._index)) {
                                    var s = a._index > 0 ? r[a._index - 1] : null;
                                    !s || 0 != (s.getType().flags & Fe.Flags.PROTEIN) && a._sequence === s._sequence + 1 || (s = null), n._calcHBondEnergy(t, e, a), a._index !== e._index + 1 && n._calcHBondEnergy(s, a, e)
                                }
                            }
                        }
                    }, {
                        key: "_residueGetCAlpha",
                        value: function(e) {
                            for (var t = 0; t < e._atoms.length; ++t) {
                                var n = e._atoms[t].getName().getString();
                                if ("CA" === n || "C1" === n) return e._atoms[t].getPosition()
                            }
                            return null
                        }
                    }, {
                        key: "_residueGetCO",
                        value: function(e) {
                            var t = null,
                                n = null;
                            return e.forEachAtom(function(e) {
                                "C" === e.getName().getString() ? t = e.getPosition() : "O" === e.getName().getString() && (n = e.getPosition())
                            }), [t, n]
                        }
                    }, {
                        key: "_residueGetNH",
                        value: function(e, t) {
                            var n, r = Un(this._residueGetCO(e), 2),
                                o = r[0],
                                i = r[1];
                            if (t.forEachAtom(function(e) {
                                    "N" === e.getName().getString() && (n = e.getPosition())
                                }), o && i && n) {
                                var a = o.clone();
                                return a.sub(i), a.multiplyScalar(1 / a.length()), a.add(n), [n, a]
                            }
                            return [null, null]
                        }
                    }, {
                        key: "_calcHBondEnergy",
                        value: function(e, t, n) {
                            var r = 0;
                            if (null === e) return r;
                            if ("PRO" !== t.getType().getName()) {
                                var o = Un(this._residueGetNH(e, t), 2),
                                    i = o[0],
                                    a = o[1],
                                    s = Un(this._residueGetCO(n), 2),
                                    l = s[0],
                                    c = s[1];
                                if (null === i || null === a || null === l || null === c) return r;
                                var u = a.distanceTo(c),
                                    p = a.distanceTo(l),
                                    f = i.distanceTo(l),
                                    h = i.distanceTo(c);
                                r = u < .5 || p < .5 || f < .5 || h < .5 ? -9.9 : -27.888 / u - -27.888 / p + -27.888 / f - -27.888 / h, (r = Math.round(1e3 * r) / 1e3) < -9.9 && (r = -9.9)
                            }
                            void 0 === this._hbonds[t._index] && (this._hbonds[t._index] = {
                                donor: [],
                                acceptor: []
                            });
                            var d = this._hbonds[t._index];
                            d.acceptor.length < 2 && d.acceptor.push({
                                residue: n._index,
                                energy: r
                            }), d.acceptor.length > 1 && (r < d.acceptor[0].energy ? (d.acceptor[1].residue = d.acceptor[0].residue, d.acceptor[1].energy = d.acceptor[0].energy, d.acceptor[0].residue = n._index, d.acceptor[0].energy = r) : r < d.acceptor[1].energy && (d.acceptor[1].residue = n._index, d.acceptor[1].energy = r)), void 0 === this._hbonds[n._index] && (this._hbonds[n._index] = {
                                donor: [],
                                acceptor: []
                            });
                            var m = this._hbonds[n._index];
                            return m.donor.length < 2 && m.donor.push({
                                residue: t._index,
                                energy: r
                            }), m.donor.length > 1 && (r < m.donor[0].energy ? (m.donor[1].residue = m.donor[0].residue, m.donor[1].energy = m.donor[0].energy, m.donor[0].residue = t._index, m.donor[0].energy = r) : r < m.donor[1].energy && (m.donor[1].residue = t._index, m.donor[1].energy = r)), r
                        }
                    }]) && Gn(t.prototype, n), r && Gn(t, r), e
                }();

            function qn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Yn, Xn, $n = Object.freeze({
                    NO_BRIDGE: 0,
                    PARALLEL: 1,
                    ANTI_PARALLEL: 2
                }),
                Kn = Object.freeze({
                    START: 1,
                    MIDDLE: 2,
                    END: 3,
                    START_AND_END: 4
                }),
                Zn = Object.freeze({
                    STRAND: "E",
                    BRIDGE: "B",
                    HELIX_310: "G",
                    HELIX_ALPHA: "H",
                    HELIX_PI: "I",
                    TURN: "T",
                    BEND: "S",
                    LOOP: " "
                }),
                Qn = function() {
                    function e(t) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._complex = t, this._build()
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "_build",
                        value: function() {
                            this._hbonds = new Wn(this._complex), this._ss = [], this._sheet = [], this._betaPartners = [], this._bend = [];
                            for (var e = 0; e < this._complex.getResidues().length; ++e) this._betaPartners[e] = [];
                            this._helixFlags = [], this._helixFlags[3] = [], this._helixFlags[4] = [], this._helixFlags[5] = [], this._chainLengths = [];
                            for (var t = 0; t < this._complex._chains.length; ++t) {
                                for (var n = this._complex._chains[t].getResidues(), r = 0; r < n.length && 0 != (n[r].getType().flags & Fe.Flags.PROTEIN); ++r);
                                this._chainLengths[t] = r
                            }
                            this._buildBetaSheets();
                            for (var o = 0; o < this._complex._chains.length; ++o) this._buildAlphaHelices(this._complex._chains[o].getResidues(), this._chainLengths[o], !1)
                        }
                    }, {
                        key: "_buildAlphaHelices",
                        value: function(e, t, n) {
                            for (var r = 3; r <= 5 && !(e.length < r); ++r)
                                for (var o = 0; o + r < t; ++o)
                                    if (this._hbonds.isBond(e[o + r]._index, e[o]._index)) {
                                        this._helixFlags[r][e[o + r]._index] = Kn.END;
                                        for (var i = o + 1; i < o + r; ++i) void 0 === this._helixFlags[r][e[i]._index] && (this._helixFlags[r][e[i]._index] = Kn.MIDDLE);
                                        this._helixFlags[r][e[o]._index] === Kn.END ? this._helixFlags[r][e[o]._index] = Kn.START_AND_END : this._helixFlags[r][e[o]._index] = Kn.START
                                    } for (var a = 2; a < t - 2; ++a) {
                                var s = this._kappa(e[a - 2], e[a], e[a + 2]);
                                this._bend[e[a]._index] = 360 !== s && s > 70
                            }
                            for (var l = 1; l + 4 < t; ++l)
                                if (this._isHelixStart(e[l]._index, 4) && this._isHelixStart(e[l - 1]._index, 4))
                                    for (var c = l; c <= l + 3; ++c) this._ss[e[c]._index] = Zn.HELIX_ALPHA;
                            for (var u = 1; u + 3 < t; ++u)
                                if (this._isHelixStart(e[u]._index, 3) && this._isHelixStart(e[u - 1]._index, 3)) {
                                    for (var p = !0, f = u; p && f <= u + 2; ++f) p = void 0 === this._ss[e[f]._index] || this._ss[e[f]._index] === Zn.HELIX_310;
                                    if (p)
                                        for (var h = u; h <= u + 2; ++h) this._ss[e[h]._index] = Zn.HELIX_310
                                } for (var d = 1; d + 5 < t; ++d)
                                if (this._isHelixStart(e[d]._index, 5) && this._isHelixStart(e[d - 1]._index, 5)) {
                                    for (var m = !0, y = d; m && y <= d + 4; ++y) m = void 0 === this._ss[e[y]._index] || this._ss[e[y]._index] === Zn.HELIX_PI || n && this._ss[e[y]._index] === Zn.HELIX_ALPHA;
                                    if (m)
                                        for (var v = d; v <= d + 4; ++v) this._ss[e[v]._index] = Zn.HELIX_PI
                                } for (var _ = 1; _ + 1 < t; ++_)
                                if (void 0 === this._ss[e[_]._index]) {
                                    for (var g = !1, b = 3; b <= 5 && !g; ++b)
                                        for (var w = 1; w < b && !g; ++w) g = _ >= w && this._isHelixStart(e[_ - w]._index, b);
                                    g ? this._ss[e[_]._index] = Zn.TURN : this._bend[e[_]._index] && (this._ss[e[_]._index] = Zn.BEND)
                                }
                        }
                    }, {
                        key: "_residueGetCAlpha",
                        value: function(e) {
                            for (var t = 0; t < e._atoms.length; ++t) {
                                var n = e._atoms[t].getName().getString();
                                if ("CA" === n || "C1" === n) return e._atoms[t].getPosition()
                            }
                            return null
                        }
                    }, {
                        key: "_cosinusAngle",
                        value: function(e, t, n, r) {
                            var o = e.clone();
                            o.sub(t);
                            var i = n.clone();
                            i.sub(r);
                            var a = 0,
                                s = o.dot(o) * i.dot(i);
                            return s > 0 && (a = o.dot(i) / Math.sqrt(s)), a
                        }
                    }, {
                        key: "_kappa",
                        value: function(e, t, n) {
                            var r = this._residueGetCAlpha(t),
                                o = this._residueGetCAlpha(e),
                                i = this._residueGetCAlpha(n);
                            if (null === r || null === o || null === i) return 180;
                            var a = this._cosinusAngle(r, o, i, r),
                                s = Math.sqrt(1 - a * a);
                            return 180 * Math.atan2(s, a) / Math.PI
                        }
                    }, {
                        key: "_isHelixStart",
                        value: function(e, t) {
                            return this._helixFlags[t][e] === Kn.START || this._helixFlags[t][e] === Kn.START_AND_END
                        }
                    }, {
                        key: "_buildBetaSheets",
                        value: function() {
                            for (var e = [], t = 0; t < this._complex._chains.length; ++t) {
                                var n = this._chainLengths[t];
                                if (!(n <= 4))
                                    for (var r = this._complex._chains[t].getResidues(), o = t; o < this._complex._chains.length; ++o) {
                                        var i = this._chainLengths[o];
                                        if (!(i <= 4))
                                            for (var a = this._complex._chains[o].getResidues(), s = 1; s + 1 < n; ++s) {
                                                var l = r[s],
                                                    c = 1;
                                                for (o === t && (c = s + 3); c + 1 < i; ++c) {
                                                    var u = a[c],
                                                        p = this._testBridge(r, s, a, c);
                                                    if (p !== $n.NO_BRIDGE) {
                                                        for (var f = !1, h = 0, d = e; h < d.length; h++) {
                                                            var m = d[h];
                                                            if (p === m.type && l._index === m.i[m.i.length - 1] + 1) {
                                                                if (p === $n.PARALLEL && m.j[m.j.length - 1] + 1 === u._index) {
                                                                    m.i.push(l._index), m.j.push(u._index), f = !0;
                                                                    break
                                                                }
                                                                if (p === $n.ANTI_PARALLEL && m.j[0] - 1 === u._index) {
                                                                    m.i.push(l._index), m.j.unshift(u._index), f = !0;
                                                                    break
                                                                }
                                                            }
                                                        }
                                                        f || e.push({
                                                            type: p,
                                                            i: [l._index],
                                                            chainI: l.getChain()._index,
                                                            j: [u._index],
                                                            chainJ: u.getChain()._index
                                                        })
                                                    }
                                                }
                                            }
                                    }
                            }
                            e.sort(function(e, t) {
                                return e.chainI < t.chainI || e.chainI === t.chainI && e.i[0] < t.i[0] ? -1 : 1
                            });
                            for (var y = 0; y < e.length; ++y)
                                for (var v = y + 1; v < e.length; ++v) {
                                    var _ = e[y].i[0],
                                        g = e[y].i[e[y].i.length - 1],
                                        b = e[y].j[0],
                                        w = e[y].j[e[y].j.length - 1],
                                        x = e[v].i[0],
                                        S = e[v].i[e[v].i.length - 1],
                                        C = e[v].j[0],
                                        P = e[v].j[e[v].j.length - 1];
                                    if (!(e[y].type !== e[v].type || this._hasChainBreak(Math.min(_, x), Math.max(g, S)) || this._hasChainBreak(Math.min(b, C), Math.max(w, P)) || x - g >= 6 || g >= x && _ <= S)) {
                                        (e[y].type === $n.PARALLEL ? C - w < 6 && x - g < 3 || C - w < 3 : b - P < 6 && x - g < 3 || b - P < 3) && (e[y].i = e[y].i.concat(e[v].i), e[y].type === $n.PARALLEL ? e[y].j = e[y].j.concat(e[v].j) : e[y].j = e[v].j.concat(e[y].j), e.splice(v--, 1))
                                    }
                                }
                            for (var E = new Set, O = 0; O < e.length; ++O) E.add(e[O]);
                            for (var A = 1, T = 0; E.size > 0;) {
                                var k = E.values().next().value;
                                E.delete(k);
                                var R = new Set;
                                R.add(k);
                                var I = void 0;
                                do {
                                    I = new Set;
                                    var M = !0,
                                        N = !1,
                                        L = void 0;
                                    try {
                                        for (var j, D = R.values()[Symbol.iterator](); !(M = (j = D.next()).done); M = !0) {
                                            var V = j.value,
                                                F = !0,
                                                B = !1,
                                                z = void 0;
                                            try {
                                                for (var U, G = E.values()[Symbol.iterator](); !(F = (U = G.next()).done); F = !0) {
                                                    var H = U.value;
                                                    this._areBridgesLinked(V, H) && I.add(H)
                                                }
                                            } catch (e) {
                                                B = !0, z = e
                                            } finally {
                                                try {
                                                    F || null == G.return || G.return()
                                                } finally {
                                                    if (B) throw z
                                                }
                                            }
                                        }
                                    } catch (e) {
                                        N = !0, L = e
                                    } finally {
                                        try {
                                            M || null == D.return || D.return()
                                        } finally {
                                            if (N) throw L
                                        }
                                    }
                                    var W = !0,
                                        q = !1,
                                        Y = void 0;
                                    try {
                                        for (var X, $ = I.values()[Symbol.iterator](); !(W = (X = $.next()).done); W = !0) k = X.value, R.add(k), E.delete(k)
                                    } catch (e) {
                                        q = !0, Y = e
                                    } finally {
                                        try {
                                            W || null == $.return || $.return()
                                        } finally {
                                            if (q) throw Y
                                        }
                                    }
                                } while (I.size > 0);
                                var K = !0,
                                    Z = !1,
                                    Q = void 0;
                                try {
                                    for (var J, ee = R.values()[Symbol.iterator](); !(K = (J = ee.next()).done); K = !0)(k = J.value).ladder = T, k.sheet = A, k.link = R, ++T
                                } catch (e) {
                                    Z = !0, Q = e
                                } finally {
                                    try {
                                        K || null == ee.return || ee.return()
                                    } finally {
                                        if (Z) throw Q
                                    }
                                }++A
                            }
                            for (var te = 0; te < e.length; ++te) {
                                for (var ne = e[te], re = 0, oe = 0, ie = 0; ie < ne.i.length; ++ie)
                                    if (this._betaPartners[ne.i[ie]][0]) {
                                        re = 1;
                                        break
                                    } for (var ae = 0; ae < ne.j.length; ++ae)
                                    if (this._betaPartners[ne.j[ae]][0]) {
                                        oe = 1;
                                        break
                                    } var se = Zn.BRIDGE;
                                if (ne.i.length > 1 && (se = Zn.STRAND), ne.type === $n.PARALLEL) {
                                    for (var le = 0, ce = 0; ce < ne.i.length; ++ce) this._betaPartners[ne.i[ce]][re] = {
                                        residue: ne.j[le++],
                                        ladder: ne.ladder,
                                        parallel: !0
                                    };
                                    le = 0;
                                    for (var ue = 0; ue < ne.j.length; ++ue) this._betaPartners[ne.j[ue]][oe] = {
                                        residue: ne.i[le++],
                                        ladder: ne.ladder,
                                        parallel: !0
                                    }
                                } else {
                                    for (var pe = ne.j.length - 1, fe = 0; fe < ne.i.length; ++fe) this._betaPartners[ne.i[fe]][re] = {
                                        residue: ne.j[pe--],
                                        ladder: ne.ladder,
                                        parallel: !1
                                    };
                                    pe = ne.i.length - 1;
                                    for (var he = 0; he < ne.j.length; ++he) this._betaPartners[ne.j[he]][oe] = {
                                        residue: ne.i[pe--],
                                        ladder: ne.ladder,
                                        parallel: !1
                                    }
                                }
                                for (var de = ne.i[0]; de <= ne.i[ne.i.length - 1]; ++de) this._ss[de] !== Zn.STRAND && (this._ss[de] = se, this._sheet[de] = ne.sheet);
                                for (var me = ne.j[0]; me <= ne.j[ne.j.length - 1]; ++me) this._ss[me] !== Zn.STRAND && (this._ss[me] = se, this._sheet[me] = ne.sheet)
                            }
                        }
                    }, {
                        key: "_testBridge",
                        value: function(e, t, n, r) {
                            var o = $n.NO_BRIDGE,
                                i = e[t - 1]._index,
                                a = e[t]._index,
                                s = e[t + 1]._index,
                                l = n[r - 1]._index,
                                c = n[r]._index,
                                u = n[r + 1]._index,
                                p = this._hbonds.isBond.bind(this._hbonds);
                            return p(s, c) && p(c, i) || p(u, a) && p(a, l) ? o = $n.PARALLEL : (p(s, l) && p(u, i) || p(c, a) && p(a, c)) && (o = $n.ANTI_PARALLEL), o
                        }
                    }, {
                        key: "_areBridgesLinked",
                        value: function(e, t) {
                            var n = new Set(e.i),
                                r = new Set(e.j),
                                o = !0,
                                i = !1,
                                a = void 0;
                            try {
                                for (var s, l = t.i[Symbol.iterator](); !(o = (s = l.next()).done); o = !0) {
                                    var c = s.value;
                                    if (n.has(c) || r.has(c)) return !0
                                }
                            } catch (e) {
                                i = !0, a = e
                            } finally {
                                try {
                                    o || null == l.return || l.return()
                                } finally {
                                    if (i) throw a
                                }
                            }
                            var u = !0,
                                p = !1,
                                f = void 0;
                            try {
                                for (var h, d = t.j[Symbol.iterator](); !(u = (h = d.next()).done); u = !0) {
                                    var m = h.value;
                                    if (n.has(m) || r.has(m)) return !0
                                }
                            } catch (e) {
                                p = !0, f = e
                            } finally {
                                try {
                                    u || null == d.return || d.return()
                                } finally {
                                    if (p) throw f
                                }
                            }
                            return !1
                        }
                    }, {
                        key: "_hasChainBreak",
                        value: function(e, t) {
                            for (var n = e + 1; n <= t; ++n)
                                if (this._complex._residues[n]._sequence !== this._complex._residues[n - 1]._sequence + 1) return !0;
                            return !1
                        }
                    }]) && qn(t.prototype, n), r && qn(t, r), e
                }();

            function Jn(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function er(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            Qn.StructureType = Zn;
            var tr = Qn.StructureType,
                nr = nt.Type,
                rr = (er(Yn = {}, tr.HELIX_ALPHA, 1), er(Yn, tr.HELIX_PI, 3), er(Yn, tr.HELIX_310, 5), Yn),
                or = (er(Xn = {}, tr.BRIDGE, nr.BRIDGE), er(Xn, tr.TURN, nr.TURN), er(Xn, tr.BEND, nr.BEND), er(Xn, tr.LOOP, nr.COIL), Xn),
                ir = function() {
                    function e() {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), er(this, "getCurrentStructure", e.prototype.getCurrentUnit), er(this, "resetCurrentStructure", e.prototype.resetCurrentUnit), er(this, "setCurrentStructure", e.prototype.setCurrentUnit), this._chains = [], this._components = [], this._helices = [], this._sheets = [], this.structures = [], this._residueTypes = Object.create(Fe.StandardTypes), this._atoms = [], this._residues = [], this._bonds = [], this._sgroups = [], this._molecules = [], this._maskNeedsUpdate = !1, this.metadata = {}, this.symmetry = [], this.units = [new Kt(this)], this._currentUnit = 0
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "addAtom",
                        value: function(e) {
                            var t = this._atoms.length;
                            return this._atoms.push(e), t
                        }
                    }, {
                        key: "addSheet",
                        value: function(e) {
                            var t = this._sheets.length;
                            return this._sheets.push(e), t
                        }
                    }, {
                        key: "addHelix",
                        value: function(e) {
                            var t = this._helices.length;
                            return this._helices.push(e), t
                        }
                    }, {
                        key: "getAtoms",
                        value: function() {
                            return this._atoms
                        }
                    }, {
                        key: "getBonds",
                        value: function() {
                            return this._bonds
                        }
                    }, {
                        key: "getAtomCount",
                        value: function() {
                            return this._atoms.length
                        }
                    }, {
                        key: "addResidue",
                        value: function(e) {
                            var t = this._residues.length;
                            return this._residues.push(e), t
                        }
                    }, {
                        key: "updateToFrame",
                        value: function(e) {
                            this.forEachChain(function(t) {
                                t.updateToFrame(e)
                            })
                        }
                    }, {
                        key: "addResidueType",
                        value: function(e) {
                            return this._residueTypes[e] = new Fe(e, "Unknown", "")
                        }
                    }, {
                        key: "getResidueCount",
                        value: function() {
                            return this._residues.length
                        }
                    }, {
                        key: "getResidues",
                        value: function() {
                            return this._residues
                        }
                    }, {
                        key: "getSGroupCount",
                        value: function() {
                            return this._sgroups.length
                        }
                    }, {
                        key: "getSGroups",
                        value: function() {
                            return this._sgroups
                        }
                    }, {
                        key: "getAtomByFullname",
                        value: function(e) {
                            var t = e.split(".");
                            if (3 !== t.length) return null;
                            var n = t[0],
                                r = parseInt(t[1], 10);
                            if (Number.isNaN(r)) return null;
                            var o = t[2].toUpperCase(),
                                i = null;
                            return this.forEachChain(function(e) {
                                i || 0 === e._name.localeCompare(n) && e.forEachResidue(function(e) {
                                    i || e._sequence === r && e.forEachAtom(function(e) {
                                        i || 0 === o.localeCompare(e._name.getString()) && (i = e)
                                    })
                                })
                            }), i
                        }
                    }, {
                        key: "addChain",
                        value: function(e) {
                            var t = new Ke(this, e);
                            return this._chains.push(t), t
                        }
                    }, {
                        key: "getChain",
                        value: function(e) {
                            for (var t = 0, n = this._chains.length; t < n; ++t) {
                                var r = this._chains[t];
                                if (r.getName() === e) return r
                            }
                            return null
                        }
                    }, {
                        key: "getChainCount",
                        value: function() {
                            return this._chains.length
                        }
                    }, {
                        key: "getMolecules",
                        value: function() {
                            return this._molecules
                        }
                    }, {
                        key: "getMoleculeCount",
                        value: function() {
                            return this._molecules.length
                        }
                    }, {
                        key: "forEachAtom",
                        value: function(e) {
                            for (var t = this._atoms, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachBond",
                        value: function(e) {
                            for (var t = this._bonds, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachResidue",
                        value: function(e) {
                            for (var t = this._residues, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachChain",
                        value: function(e) {
                            for (var t = this._chains, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachMolecule",
                        value: function(e) {
                            for (var t = this._molecules, n = t.length, r = 0; r < n; ++r) e(t[r])
                        }
                    }, {
                        key: "forEachSGroup",
                        value: function(e) {
                            for (var t = this._sgroups, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachComponent",
                        value: function(e) {
                            for (var t = this._components, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "forEachVisibleComponent",
                        value: function(e) {
                            for (var t = this._components, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "addBond",
                        value: function(e, t, n, r, o) {
                            var i = new Me(e, t, n, r, o);
                            return this._bonds.push(i), i
                        }
                    }, {
                        key: "getBondCount",
                        value: function() {
                            return this._bonds.length
                        }
                    }, {
                        key: "getResidueType",
                        value: function(e) {
                            return this._residueTypes[e] || null
                        }
                    }, {
                        key: "_atomNameCompare",
                        value: function(e, t, n) {
                            var r = xe.ByName.H.name,
                                o = xe.ByName.C.name;

                            function i(e) {
                                return e === o ? String.fromCharCode(1) : e === r ? String.fromCharCode(n) : e
                            }
                            var a = i(e),
                                s = i(t);
                            return a < s ? -1 : a > s ? 1 : 0
                        }
                    }, {
                        key: "_atomNameCompareCWithH",
                        value: function(e, t) {
                            return this._atomNameCompare(e, t, 2)
                        }
                    }, {
                        key: "_atomNameCompareCWithoutH",
                        value: function(e, t) {
                            return this._atomNameCompare(e, t, 254)
                        }
                    }, {
                        key: "_buildFormulaSimple",
                        value: function(e, t) {
                            var n = e.atoms,
                                r = null,
                                o = {},
                                i = "",
                                a = this,
                                s = xe.ByName.H.name,
                                l = 0;
                            n.forEach(function(e) {
                                var t = e.getHydrogenCount();
                                r = e.element, o[r.name] ? o[r.name] += 1 : o[r.name] = 1, t > 0 && (o[s] ? o[s] += t : o[s] = t), l += e.getCharge()
                            });
                            var c = Object.keys(o);
                            return o.C ? c.sort(this._atomNameCompareCWithH.bind(this)) : c.sort(function(e, t) {
                                return a._atomNameCompare(e, t, "H".charCodeAt(0))
                            }), c.forEach(function(e) {
                                var t = e.substr(0, 1).toUpperCase() + e.substr(1).toLowerCase();
                                o[e] > 1 ? i += t + o[e].toString() : i += t
                            }), null === t ? (0 !== l && (c.length > 1 && (i = "(".concat(i, ")")), l > 1 && (i += "^{".concat(l.toString(), "+}")), 1 === l && (i += "^+"), l < -1 && (i += "^{".concat(Math.abs(l).toString(), "-}")), -1 === l && (i += "^-")), e.repeatCount > 1 && (i = e.repeatCount.toString(10) + i)) : t(c.length, l), i
                        }
                    }, {
                        key: "_buildPartFormula",
                        value: function(t) {
                            return t.owner instanceof e || t.owner instanceof an ? this._buildFormulaSimple(t, null) : t.owner instanceof bt ? t.owner.buildChemicalFormula(this, t) : ""
                        }
                    }, {
                        key: "_partCompareFunc",
                        value: function(e, t) {
                            return this._partCompareFuncInt(e, t, !0)
                        }
                    }, {
                        key: "_getCumulativeCharge",
                        value: function(e) {
                            for (var t = e.length, n = 0, r = 0; r < t; r++) n += e[r].getCharge();
                            return n
                        }
                    }, {
                        key: "_partCompareFuncInt",
                        value: function(e, t, n) {
                            var r = this,
                                o = xe.ByName.H.name;

                            function i(e, t) {
                                var n = {};
                                e.forEach(function(e) {
                                    if (n[e.element.name] ? n[e.element.name] += 1 : n[e.element.name] = 1, !t) {
                                        var r = e.getHydrogenCount();
                                        r > 0 && (n[o] ? n[o] += r : n[o] = r)
                                    }
                                });
                                var i = Object.keys(n);
                                return i.sort(r._atomNameCompareCWithoutH.bind(r)), {
                                    seq: i,
                                    data: n
                                }
                            }
                            for (var a, s = [n, !1], l = 0; l < s.length; l++) {
                                for (var c = s[l], u = i(e.atoms, c), p = i(t.atoms, c), f = 0, h = 0; f < u.seq.length && h < p.seq.length;) {
                                    if (u.seq[f] !== p.seq[h]) return r._atomNameCompareCWithoutH(u.seq[f], p.seq[h]);
                                    if (u.data[u.seq[f]] !== p.data[p.seq[h]]) return a = p.data[p.seq[h]] - u.data[u.seq[f]];
                                    f += 1, h += 1
                                }
                                if (0 !== (a = u.seq.length - p.seq.length) || !c) return 0 === a ? this._getCumulativeCharge(e.atoms) - this._getCumulativeCharge(t.atoms) : a
                            }
                            return this._getCumulativeCharge(e.atoms) - this._getCumulativeCharge(t.atoms)
                        }
                    }, {
                        key: "_checkFormulaBuildable",
                        value: function() {
                            for (var e = this.getAtoms(), t = e.length, n = 0; n < t; n++) {
                                if (e[n].element.number > xe.ByName.MT.number) return "}\\text{Could not create chemical formula for this structure.}{"
                            }
                            return ""
                        }
                    }, {
                        key: "buildChemicalFormula",
                        value: function() {
                            var t = [],
                                n = null,
                                r = null,
                                o = {},
                                i = null,
                                a = this,
                                s = this._checkFormulaBuildable();
                            if ("" !== s) return s;
                            this.forEachAtom(function(e) {
                                o[e.getSerial()] && v.warn("Broken complex. Formula can be invalid..."), o[e.getSerial()] = {
                                    atom: e,
                                    taken: null
                                }
                            }), this.forEachSGroup(function(e) {
                                0 === e._charge && 1 === e._repeat || (r = (n = {
                                    owner: e,
                                    atoms: [],
                                    repeatCount: 1
                                }).atoms, e._atoms.forEach(function(t) {
                                    null === (i = o[t.getSerial()]).taken && (r.push(t), i.taken = e)
                                }), n.atoms.length > 0 && t.push(n), n = null)
                            }), this.forEachComponent(function(e) {
                                r = (n = {
                                    owner: e,
                                    atoms: [],
                                    repeatCount: 1
                                }).atoms, e.forEachResidue(function(t) {
                                    t._atoms.forEach(function(t) {
                                        null === (i = o[t.getSerial()]).taken && (r.push(t), i.taken = e)
                                    })
                                }), n.atoms.length > 0 && t.push(n), n = null
                            }), Object.keys(o).forEach(function(e) {
                                null === e.taken && (null === n && (n = {
                                    owner: a,
                                    atoms: [],
                                    repeatCount: 1
                                }), n.atoms.push(e.atom), e.taken = a)
                            }), null !== n && n.atoms.length > 0 && t.push(n), t.sort(function(e, t) {
                                return a._partCompareFunc(e, t)
                            });
                            for (var l = t.length - 1, c = t.length - 2; l >= 0 && c >= 0;) {
                                var u = t[l],
                                    p = t[c];
                                u.owner instanceof e || u.owner instanceof an ? p.owner instanceof e || p.owner instanceof an ? (0 === this._partCompareFuncInt(p, u, !1) && (p.repeatCount += u.repeatCount, t.splice(l, 1)), c--, l--) : c-- : --l === c && c--
                            }
                            return t.forEach(function(e) {
                                var t = a._buildPartFormula(e);
                                t.length > 0 && (s.length > 0 && (s += "*"), s += t)
                            }), s
                        }
                    }, {
                        key: "getUnifiedSerial",
                        value: function(e, t, n) {
                            return t + 65536 * n + 16777216 * e
                        }
                    }, {
                        key: "splitUnifiedSerial",
                        value: function(e) {
                            var t = Math.floor(e / 16777216),
                                n = e - 16777216 * t,
                                r = Math.floor(n / 65536);
                            return {
                                chain: t,
                                serial: n - 65536 * r,
                                iCode: r
                            }
                        }
                    }, {
                        key: "_fillCmpEdit",
                        value: function() {
                            var e = this,
                                t = this._components;

                            function n() {
                                var n = new an(e);
                                return n._index = t.length, t[n._index] = n, n
                            }
                            this.forEachChain(function(e) {
                                var t = e._residues,
                                    r = t.length;
                                if (!(r < 1))
                                    for (var o = n(), i = t[0]._index, a = 0; a < r; ++a) {
                                        var s = t[a];
                                        s._component = o;
                                        var l = a === r - 1 ? null : t[a + 1];
                                        l && s.isConnected(l) && s._index === l._index - 1 || (o.setSubDivs([{
                                            start: i,
                                            end: s._index
                                        }]), l && (i = l._index, o = n()))
                                    }
                            })
                        }
                    }, {
                        key: "_fillCmpNoedit",
                        value: function() {
                            var e = new an(this);
                            e._index = 0;
                            var t = this._residues,
                                n = t.length;
                            if (0 !== n) {
                                for (var r = [], o = 0, i = 0; i < n; ++i) {
                                    var a = t[i];
                                    a._component = e;
                                    var s = i === n - 1 ? null : t[i + 1];
                                    s && a.isConnected(s) || (r[r.length] = {
                                        start: o,
                                        end: i
                                    }, s && (o = i + 1))
                                }
                                e.setSubDivs(r), this._components[e._index] = e
                            }
                        }
                    }, {
                        key: "_fillComponents",
                        value: function(e) {
                            e ? this._fillCmpEdit() : this._fillCmpNoedit()
                        }
                    }, {
                        key: "getCurrentUnit",
                        value: function() {
                            return this._currentUnit
                        }
                    }, {
                        key: "getDefaultBoundaries",
                        value: function() {
                            return this.units[0].getBoundaries()
                        }
                    }, {
                        key: "getBoundaries",
                        value: function() {
                            return this.units[this._currentUnit].getBoundaries()
                        }
                    }, {
                        key: "getTransforms",
                        value: function() {
                            return this.units[this._currentUnit].getTransforms()
                        }
                    }, {
                        key: "getSelector",
                        value: function() {
                            return this.units[this._currentUnit].getSelector()
                        }
                    }, {
                        key: "resetCurrentUnit",
                        value: function() {
                            this._currentUnit = 0, this.setCurrentUnit(1)
                        }
                    }, {
                        key: "setCurrentUnit",
                        value: function(e) {
                            return null != e && e !== this._currentUnit && e >= 0 && e < this.units.length && (this._currentUnit = e, !0)
                        }
                    }, {
                        key: "_computeBounds",
                        value: function() {
                            for (var e = this.units, t = 0, n = e.length; t < n; ++t) e[t].computeBoundaries()
                        }
                    }, {
                        key: "onAtomPositionChanged",
                        value: function() {
                            this.forEachChain(function(e) {
                                e._finalize()
                            }), this.forEachComponent(function(e) {
                                e.update()
                            }), this._computeBounds(), this._finalizeBonds(), this.forEachSGroup(function(e) {
                                e._rebuildSGroupOnAtomChange()
                            })
                        }
                    }, {
                        key: "update",
                        value: function() {
                            this._maskNeedsUpdate && (this.updateStructuresMask(), this._maskNeedsUpdate = !1)
                        }
                    }, {
                        key: "_finalizeBonds",
                        value: function() {
                            for (var e = this.getBonds(), t = e.length, n = 0; n < t; ++n) e[n]._index = n
                        }
                    }, {
                        key: "finalize",
                        value: function(e) {
                            e = e || {};
                            var t, n, r = this._bonds;
                            for (t = r.length - 1; t >= 0; t--) {
                                var o = r[t];
                                null === o._left || null === o._right ? r.splice(t, 1) : (o._left._bonds.push(o), o._right._bonds.push(o))
                            }
                            var i = this._residues;
                            for (t = 0, n = i.length; t < n; ++t) i[t]._finalize();
                            this.forEachChain(function(e) {
                                e._finalize()
                            });
                            var a = this.units;
                            for (t = 0, n = a.length; t < n; ++t) a[t].finalize();
                            this.setCurrentUnit(1);
                            var s = {};
                            for (t = 0, n = i.length; t < n; ++t) {
                                var l = i[t];
                                s[this.getUnifiedSerial(l.getChain().getName().charCodeAt(0), l.getSequence(), l.getICode().charCodeAt(0))] = l
                            }
                            var c = this.structures;
                            for (t = 0, n = c.length; t < n; ++t) c[t]._finalize(e.serialAtomMap, s, this);
                            var u = this._helices;
                            for (t = 0, n = u.length; t < n; ++t) u[t]._finalize(e.serialAtomMap, s, this);
                            var p = this._sheets;
                            for (t = 0, n = p.length; t < n; ++t) p[t]._finalize(e.serialAtomMap, s, this);
                            this._computeBounds();
                            var f = this._atoms;
                            for (t = 0, n = f.length; t < n; ++t) {
                                f[t]._index = t
                            }
                            if (e.needAutoBonding) {
                                var h = new vn(this);
                                h.build(), h.destroy()
                            }
                            var d = this._chains;
                            for (t = 0, n = d.length; t < n; ++t) d[t]._index = t;
                            for (t = 0, n = i.length; t < n; ++t) i[t]._index = t;
                            for (t = 0, n = f.length; t < n; ++t) {
                                var m = f[t];
                                if (m.flags & Ae.Flags.HYDROGEN && 1 === m._bonds.length) {
                                    var y = m._bonds[0];
                                    (y._left !== m && y._left || y._right).flags & Ae.Flags.CARBON && (m.flags |= Ae.Flags.NONPOLARH)
                                }
                            }
                            this._finalizeBonds(), this._fillComponents(e.enableEditing);
                            var v = new Ln(this);
                            v.markCycles(), e.detectAromaticLoops && v.detectCycles(), this._finalizeMolecules()
                        }
                    }, {
                        key: "_finalizeMolecules",
                        value: function() {
                            for (var e = 0; e < this._molecules.length; e++)
                                for (var t = this._molecules[e], n = t._residues.length, r = 0; r < n; r++) {
                                    t._residues[r]._molecule = t
                                }
                        }
                    }, {
                        key: "updateStructuresMask",
                        value: function() {
                            var e = function(e) {
                                return e.collectMask()
                            };
                            this.forEachResidue(e), this.forEachChain(e), this.forEachMolecule(e)
                        }
                    }, {
                        key: "countAtomsByMask",
                        value: function(e) {
                            var t = 0;
                            return this.forEachAtom(function(n) {
                                0 != (n._mask & e) && t++
                            }), t
                        }
                    }, {
                        key: "getNumAtomsBySelector",
                        value: function(e) {
                            var t = 0;
                            return this.forEachAtom(function(n) {
                                e.includesAtom(n) && t++
                            }), t
                        }
                    }, {
                        key: "resetAtomMask",
                        value: function(e) {
                            this.forEachAtom(function(t) {
                                t._mask = e
                            })
                        }
                    }, {
                        key: "markAtoms",
                        value: function(e, t) {
                            var n = t,
                                r = ~n,
                                o = 0,
                                i = Xt.keyword("And")(e, this.getSelector());
                            return this.forEachAtom(function(e) {
                                i.includesAtom(e) ? (e._mask |= n, o++) : e._mask &= r
                            }), this._maskNeedsUpdate = !0, o
                        }
                    }, {
                        key: "markAtomsAdditionally",
                        value: function(e, t) {
                            var n = t,
                                r = 0;
                            return this.forEachAtom(function(o) {
                                e.includesAtom(o) && (o._mask & t) !== t && (o._mask |= n, r++)
                            }), r
                        }
                    }, {
                        key: "clearAtomBits",
                        value: function(e) {
                            var t = ~e,
                                n = function(e) {
                                    e._mask &= t
                                };
                            this.forEachAtom(n), this.forEachResidue(n), this.forEachChain(n), this.forEachMolecule(n)
                        }
                    }, {
                        key: "getAtomNames",
                        value: function() {
                            if (this.hasOwnProperty("_atomNames")) return this._atomNames;
                            var e = {};
                            return this.forEachAtom(function(t) {
                                e[t._name._name] = 1
                            }), this._atomNames = Object.keys(e), this._atomNames
                        }
                    }, {
                        key: "getElements",
                        value: function() {
                            if (this.hasOwnProperty("_elements")) return this._elements;
                            var e = {};
                            return this.forEachAtom(function(t) {
                                e[t.element.name] = 1
                            }), this._elements = Object.keys(e), this._elements
                        }
                    }, {
                        key: "getResidueNames",
                        value: function() {
                            if (this.hasOwnProperty("_residueNames")) return this._residueNames;
                            var e = {};
                            return this.forEachResidue(function(t) {
                                e[t._type._name] = 1
                            }), this._residueNames = Object.keys(e), this._residueNames
                        }
                    }, {
                        key: "getChainNames",
                        value: function() {
                            if (this.hasOwnProperty("_chainNames")) return this._chainNames;
                            var e = {};
                            return this.forEachChain(function(t) {
                                e[t._name] = 1
                            }), this._chainNames = Object.keys(e), this._chainNames
                        }
                    }, {
                        key: "getAltLocNames",
                        value: function() {
                            if (this.hasOwnProperty("_altlocNames")) return this._altlocNames;
                            var e = {};
                            return this.forEachAtom(function(t) {
                                e[String.fromCharCode(t._location)] = 1
                            }), this._altlocNames = Object.keys(e), this._altlocNames
                        }
                    }, {
                        key: "getVoxelWorld",
                        value: function() {
                            if (!this.hasOwnProperty("_voxelWorld")) try {
                                this._voxelWorld = new zn(this.getDefaultBoundaries().boundingBox, new c.Vector3(5, 5, 5)), this._voxelWorld.addAtoms(this)
                            } catch (e) {
                                v.warn("Unable to create voxel world"), this._voxelWorld = null
                            }
                            return this._voxelWorld
                        }
                    }, {
                        key: "joinComplexes",
                        value: function(e) {
                            var t, n;
                            this._chains = [], this._components = [], this._helices = [], this._sheets = [], this.structures = [], this._atoms = [], this._residues = [], this._bonds = [], this._sgroups = [];
                            var r = 0,
                                o = 0,
                                i = 0,
                                a = 0,
                                s = 0;
                            for (t = 0; t < e.length; ++t) {
                                var l = e[t];
                                for (n = 0; n < l._atoms.length; ++n) {
                                    var c = l._atoms[n];
                                    c._serial += r, c._index += r, this._atoms.push(c)
                                }
                                for (n = 0; n < l._bonds.length; ++n) {
                                    var u = l._bonds[n];
                                    u._index += o, this._bonds.push(u)
                                }
                                for (n = 0; n < l._residues.length; ++n) {
                                    var p = l._residues[n];
                                    p._index += i, this._residues.push(p)
                                }
                                for (n = 0; n < l._chains.length; ++n) {
                                    var f = l._chains[n];
                                    f._complex = this, f._index += a, this._chains.push(f)
                                }
                                for (n = 0; n < l.structures.length; ++n) this.structures.push(l.structures[n]);
                                for (n = 0; n < l._sheets.length; ++n) this._sheets.push(l._sheets[n]);
                                for (n = 0; n < l._helices.length; ++n) this._helices.push(l._helices[n]);
                                for (n = 0; n < l._sgroups.length; ++n) this._sgroups.push(l._sgroups[n]);
                                for (n = 0; n < l._components.length; ++n) {
                                    var h = l._components[n];
                                    h._complex = this, h._index += s, this._components.push(h)
                                }
                                for (var d in l._residueTypes) l._residueTypes.hasOwnProperty(d) && (this._residueTypes[d] = l._residueTypes[d]);
                                r += l._atoms.length, o += l._bonds.length, i += l._residues.length, a += l._chains.length, s += l._components.length
                            }
                            this._computeBounds()
                        }
                    }, {
                        key: "dssp",
                        value: function() {
                            for (var e, t, n, r, o = new Qn(this), i = this.structures = [], a = this._helices = [], s = this._sheets = [], l = 0, c = null, u = 0, p = this._residues.length; u < p; ++u) {
                                var f = o._ss[u],
                                    h = this._residues[u],
                                    d = o._sheet[u];
                                if (f !== e || d !== t) {
                                    var m = rr[f],
                                        y = or[f];
                                    if (f === tr.STRAND) {
                                        var v = (r = void 0, (r = s[n = d]) || (r = s[n] = new _t(String(n), 0)), r);
                                        c = new yt(v, h, h, 0, null, null), v.addStrand(c)
                                    } else void 0 !== m ? (c = new ct(m, h, h, ++l, String(l), "", 1), a.push(c)) : c = void 0 !== y ? new nt(y, h, h) : null;
                                    c && i.push(c), h._secondary = c, e = f, t = d
                                } else h._secondary = c, c && (c.term = h), c instanceof ct && c.length++
                            }
                            this._sheets = s.filter(function(e) {
                                return !0
                            })
                        }
                    }]) && Jn(t.prototype, n), r && Jn(t, r), e
                }();
            ir.prototype.id = "Complex", ir.prototype.name = "";
            var ar = ir;

            function sr(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function lr(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function cr(e) {
                var t = 2;
                for (e = e - 1 >> 1; e;) t <<= 1, e >>= 1;
                return t
            }
            var ur = function() {
                function e(t, n, r, o, i, a) {
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._box = r.clone(), this._dimVec = Math.max(Math.floor(o || 1), 1), this._volumeInfo = a, n instanceof Array) {
                        var s = sr(n, 3);
                        this._dimX = s[0], this._dimY = s[1], this._dimZ = s[2]
                    } else this._dimX = n.x, this._dimY = n.y, this._dimZ = n.z;
                    switch (this._dimX = Math.max(Math.floor(this._dimX), 1), this._dimY = Math.max(Math.floor(this._dimY), 1), this._dimZ = Math.max(Math.floor(this._dimZ), 1), this._rowElements = this._dimVec * this._dimX, this._planeElements = this._rowElements * this._dimY, this._totalElements = this._planeElements * this._dimZ, this._data = i || R.allocateTyped(t, this._totalElements), this._dimVec) {
                        case 1:
                            break;
                        case 2:
                            this.getValue = function(e, t, n) {
                                var r = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                return [this._data[r], this._data[r + 1]]
                            }, this.setValue = function(e, t, n, r, o) {
                                var i = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                this._data[i] = r, this._data[i + 1] = o
                            }, this.addValue = function(e, t, n, r, o) {
                                var i = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                this._data[i] += r, this._data[i + 1] += o
                            };
                            break;
                        case 3:
                            this.getValue = function(e, t, n) {
                                var r = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                return [this._data[r], this._data[r + 1], this._data[r + 2]]
                            }, this.setValue = function(e, t, n, r, o, i) {
                                var a = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                this._data[a] = r, this._data[a + 1] = o, this._data[a + 2] = i
                            }, this.addValue = function(e, t, n, r, o, i) {
                                var a = e * this._dimVec + t * this._rowElements + n * this._planeElements;
                                this._data[a] += r, this._data[a + 1] += o, this._data[a + 2] += i
                            };
                            break;
                        default:
                            throw new Error("Volume: invalid vector dimension")
                    }
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getValue",
                    value: function(e, t, n) {
                        return this._data[e + t * this._rowElements + n * this._planeElements]
                    }
                }, {
                    key: "setValue",
                    value: function(e, t, n, r) {
                        this._data[e + t * this._rowElements + n * this._planeElements] = r
                    }
                }, {
                    key: "addValue",
                    value: function(e, t, n, r) {
                        this._data[e + t * this._rowElements + n * this._planeElements] += r
                    }
                }, {
                    key: "getDimensions",
                    value: function() {
                        return [this._dimX, this._dimY, this._dimZ]
                    }
                }, {
                    key: "getBox",
                    value: function() {
                        return this._box
                    }
                }, {
                    key: "getVolumeInfo",
                    value: function() {
                        return this._volumeInfo
                    }
                }, {
                    key: "getCellSize",
                    value: function() {
                        var e = new c.Vector3;
                        this._box.getSize(e);
                        var t = new c.Vector3;
                        return t.x = this._dimX > 1 ? e.x / (this._dimX - 1) : 0, t.y = this._dimY > 1 ? e.y / (this._dimY - 1) : 0, t.z = this._dimZ > 1 ? e.z / (this._dimZ - 1) : 0, t
                    }
                }, {
                    key: "computeGradient",
                    value: function() {
                        if (1 !== this._dimVec) return null;
                        var t = new e(Float32Array, [this._dimX, this._dimY, this._dimZ], this._box, 3),
                            n = this.getCellSize(),
                            r = new c.Vector3(-.5 / n.x, -.5 / n.y, -.5 / n.z);

                        function o(e, t, n) {
                            return Math.min(n, Math.max(t, e))
                        }
                        var i = this._dimX,
                            a = this._dimY,
                            s = this._dimZ,
                            l = this._data;

                        function u(e, t, n) {
                            return l[n * i * a + t * i + e]
                        }
                        for (var p = 0; p < s; ++p)
                            for (var f = o(p - 1, 0, s - 1), h = o(p + 1, 0, s - 1), d = 0; d < a; ++d)
                                for (var m = o(d - 1, 0, a - 1), y = o(d + 1, 0, a - 1), v = 0; v < i; ++v) {
                                    var _ = o(v - 1, 0, i - 1),
                                        g = o(v + 1, 0, i - 1);
                                    t.setValue(v, d, p, (u(g, d, p) - u(_, d, p)) * r.x, (u(v, y, p) - u(v, m, p)) * r.y, (u(v, d, h) - u(v, d, f)) * r.z)
                                }
                        return t
                    }
                }, {
                    key: "normalize",
                    value: function() {
                        for (var e = this._data, t = e[0], n = e[0], r = 1; r < e.length; ++r) t = Math.min(t, e[r]), n = Math.max(n, e[r]);
                        var o = 1 / (n - t);
                        if (0 !== o)
                            for (var i = 0; i < e.length; ++i) e[i] = o * (e[i] - t)
                    }
                }, {
                    key: "getTiledTextureStride",
                    value: function() {
                        return [this._dimX + 2, this._dimY + 2]
                    }
                }, {
                    key: "buildTiledTexture",
                    value: function() {
                        var e = Math.ceil(Math.sqrt(this._dimZ * this._dimY / this._dimX)),
                            t = e * (this._dimX + 2) - 1;
                        t = cr(t), e = Math.floor(t / (this._dimX + 2));
                        var n = Math.ceil(this._dimZ / e),
                            r = n * (this._dimY + 2) - 1;
                        r = cr(r);
                        for (var o, i, a = new Uint8Array(t * r), s = 0; s < n; ++s)
                            for (var l = 0; l < this._dimY; ++l) {
                                o = s * e * this._planeElements + l * this._rowElements, i = t * (s * (this._dimY + 2) + l);
                                for (var u = 0; u < e; ++u) {
                                    for (var p = 0; p < this._dimX; ++p) a[i++] = 255 * this._data[o++];
                                    a[i++] = 255 * this._data[o - 1], u < e - 1 && (o += this._planeElements - this._rowElements, a[i++] = 255 * this._data[o])
                                }
                            }
                        for (var f = 0; f < n; ++f) {
                            i = (o = t * (f * (this._dimY + 2) + this._dimY - 1)) + t;
                            for (var h = 0; h < t; ++h) a[i++] = a[o++];
                            if (f < n - 1) {
                                i = (o = t * (f + 1) * (this._dimY + 2)) - t;
                                for (var d = 0; d < t; ++d) a[i++] = a[o++]
                            }
                        }
                        var m = new c.DataTexture(a, t, r, c.LuminanceFormat, c.UnsignedByteType, c.UVMapping, c.ClampToEdgeWrapping, c.ClampToEdgeWrapping, c.LinearFilter, c.LinearFilter);
                        return m.needsUpdate = !0, m
                    }
                }, {
                    key: "getData",
                    value: function() {
                        return this._data
                    }
                }, {
                    key: "getDirectIdx",
                    value: function(e, t, n) {
                        return e * this._dimVec + t * this._rowElements + n * this._planeElements
                    }
                }, {
                    key: "getStrideX",
                    value: function() {
                        return this._dimVec
                    }
                }, {
                    key: "getStrideY",
                    value: function() {
                        return this._rowElements
                    }
                }, {
                    key: "getStrideZ",
                    value: function() {
                        return this._planeElements
                    }
                }]) && lr(t.prototype, n), r && lr(t, r), e
            }();
            ur.prototype.id = "Volume";
            var pr = ur;

            function fr(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var hr = {
                Atom: Ae,
                Element: xe,
                AtomName: ge,
                Bond: Me,
                Residue: Ye,
                ResidueType: Fe,
                Chain: Ke,
                Helix: ct,
                Strand: yt,
                Sheet: _t,
                SGroup: bt,
                Assembly: rn,
                Complex: ar,
                Volume: pr,
                VoxelWorld: zn,
                selectors: Xt,
                Molecule: function() {
                    function e(t, n, r) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._complex = t, this._name = n || "", this._residues = [], this._mask = 1, this._index = r || -1
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "getComplex",
                        value: function() {
                            return this._complex
                        }
                    }, {
                        key: "getName",
                        value: function() {
                            return this._name
                        }
                    }, {
                        key: "getResidues",
                        value: function() {
                            return this._residues
                        }
                    }, {
                        key: "getIndex",
                        value: function() {
                            return this._index
                        }
                    }, {
                        key: "forEachResidue",
                        value: function(e) {
                            for (var t = this._residues, n = 0, r = t.length; n < r; ++n) e(t[n])
                        }
                    }, {
                        key: "collectMask",
                        value: function() {
                            for (var e = 4294967295, t = this._residues, n = 0, r = t.length; n < r; ++n) e &= t[n]._mask;
                            this._mask = e
                        }
                    }]) && fr(t.prototype, n), r && fr(t, r), e
                }()
            };

            function dr(e) {
                return (dr = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function mr(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function yr(e) {
                return (yr = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function vr(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function _r(e, t) {
                return (_r = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var gr = function(e) {
                function t(e) {
                    var n;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), n = function(e, t) {
                        return !t || "object" !== dr(t) && "function" != typeof t ? vr(e) : t
                    }(this, yr(t).call(this));
                    var r = vr(n);
                    return n._element = e, n._element.style.position = "absolute", n.addEventListener("removed", function() {
                        null !== r._element.parentNode && r._element.parentNode.removeChild(r._element)
                    }), n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && _r(e, t)
                }(t, c["Object3D"]), n = t, (r = [{
                    key: "getElement",
                    value: function() {
                        return this._element
                    }
                }, {
                    key: "setTransparency",
                    value: function(e) {
                        var t = this.getElement();
                        if (null !== t)
                            if (1 !== e) {
                                t.style.display = "inline";
                                var n = 1 - e,
                                    r = n.toString(),
                                    o = 100 * n;
                                t.style.opacity = r, t.style.filter = "alpha(opacity=".concat(o, ")")
                            } else t.style.display = "none"
                    }
                }, {
                    key: "clone",
                    value: function() {
                        var e = new t(this._element);
                        return e.copy(this), e
                    }
                }]) && mr(n.prototype, r), o && mr(n, o), t
            }();

            function br(e) {
                return (br = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function wr(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function xr(e, t) {
                return !t || "object" !== br(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Sr(e) {
                return (Sr = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Cr(e, t) {
                return (Cr = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Pr = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), xr(this, Sr(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Cr(e, t)
                    }(t, c["Group"]), n = t, (r = [{
                        key: "raycast",
                        value: function(e, t) {
                            if (this.visible)
                                for (var n = this.children, r = 0, o = n.length; r < o; ++r) n[r].raycast(e, t)
                        }
                    }, {
                        key: "enableSubset",
                        value: function(e, t) {
                            for (var n = this.children, r = 0, o = n.length; r < o; ++r) n[r].enableSubset && n[r].enableSubset(e, t)
                        }
                    }, {
                        key: "disableSubset",
                        value: function(e, t) {
                            for (var n = this.children, r = 0, o = n.length; r < o; ++r) n[r].disableSubset && n[r].disableSubset(e, t)
                        }
                    }, {
                        key: "isEmpty",
                        value: function() {
                            return 0 === this.children.length
                        }
                    }, {
                        key: "updateToFrame",
                        value: function(e) {
                            for (var t = this.children, n = 0, r = t.length; n < r; ++n) t[n].updateToFrame && t[n].updateToFrame(e)
                        }
                    }, {
                        key: "getSubset",
                        value: function(e, t) {
                            for (var n = [], r = this.children, o = 0, i = r.length; o < i; ++o) r[o].getSubset && Array.prototype.push.apply(n, r[o].getSubset(e, t));
                            return n
                        }
                    }]) && wr(n.prototype, r), o && wr(n, o), t
                }(),
                Er = "float INSTANCED_SPRITE_OVERSCALE = 1.3;\n\nattribute vec3 normal;\n\n#ifdef NORMALS_TO_G_BUFFER\n  varying vec3 viewNormal;\n#endif\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\n  varying vec3 vNormal;\n#endif\n\n#ifdef THICK_LINE\n  attribute vec4 position; // W contains vert pos or neg offset\n#else\n  attribute vec3 position;\n#endif\n\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;\n\n#ifdef ATTR_ALPHA_COLOR\n  attribute float alphaColor;\n  varying float alphaCol;\n#endif\n\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\n\t#endif\n#endif\n\n#ifdef ATTR_COLOR\n  attribute vec3 color;\n  varying vec3 vColor;\n#endif\n\n#ifdef ATTR_COLOR2\n  attribute vec3 color2;\n  varying vec3 vColor2;\n  attribute vec2 uv;\n  #ifndef CYLINDER_SPRITE\n    varying vec2 vUv;\n  #endif\n#endif\n\n#ifdef INSTANCED_POS\n  attribute vec4 offset;\n  #ifdef SPHERE_SPRITE\n    varying vec4 instOffset;\n  varying vec4 spritePosEye;\n  #endif\n#endif\n\n#ifdef INSTANCED_MATRIX\n  attribute vec4 matVector1;\n  attribute vec4 matVector2;\n  attribute vec4 matVector3;\n  attribute vec4 invmatVector1;\n  attribute vec4 invmatVector2;\n  attribute vec4 invmatVector3;\n\n  #ifdef CYLINDER_SPRITE\n    varying vec4 matVec1;\n    varying vec4 matVec2;\n    varying vec4 matVec3;\n    varying vec4 invmatVec1;\n    varying vec4 invmatVec2;\n    varying vec4 invmatVec3;\n  #endif\n#endif\n\nuniform mat4 modelViewMatrix; // optional\nuniform mat4 projectionMatrix; // optional\nuniform mat3 normalMatrix; // optional\nuniform mat4 modelMatrix; // optional\nuniform mat4 projMatrixInv; // TODO move to thick line\n\n#ifdef DASHED_LINE\n  attribute float lineDistance;\n  varying float vLineDistance;\n#endif\n\n#ifdef THICK_LINE\n  attribute vec3 direction;\n  uniform vec2 viewport;\n  uniform float lineWidth;\n\n  vec4 transform(vec4 coord){\n    return projectionMatrix * modelViewMatrix * coord;\n  }\n\n  vec2 project(vec4 device){\n    vec3 device_normal = device.xyz/device.w;\n    vec2 clip_pos = (device_normal*0.5+0.5).xy;\n    return clip_pos * viewport;\n  }\n\n  vec4 unproject(vec2 screen, float z, float w){\n    vec2 clip_pos = screen/viewport;\n    vec2 device_normal = clip_pos*2.0-1.0;\n    return vec4(device_normal*w, z, w);\n  }\n#endif\n\n\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\nvoid main() {\n\n#ifdef ATTR_ALPHA_COLOR\n  alphaCol = alphaColor;\n#endif\n\n  vec3 objectNormal = vec3( normal );\n#ifdef INSTANCED_MATRIX\n  vec3 transformedNormal = vec3(\n    dot(objectNormal, matVector1.xyz),\n    dot(objectNormal, matVector2.xyz),\n    dot(objectNormal, matVector3.xyz));\n  transformedNormal = normalMatrix * transformedNormal;\n#else\n  vec3 transformedNormal = normalMatrix * objectNormal;\n#endif\n\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\n  vNormal = normalize(transformedNormal);\n#endif\n\n#ifdef NORMALS_TO_G_BUFFER\n  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\n#endif\n\n  vec4 localPos = vec4(position.xyz, 1.0);\n  vec4 worldPos = modelMatrix * localPos;\n  vec4 mvPosition = modelViewMatrix * localPos;\n\n// make thick line offset\n#ifdef THICK_LINE\n   // get screen pos\n   vec4 dPos = transform(vec4(position.xyz, 1.0));\n   vec2 sPos = project(dPos);\n   // move pos forward\n   vec3 position2 = position.xyz + direction.xyz * 0.5;\n   // get screen offset pos\n   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\n   vec2 sPos2 = project(dPos2);\n   // screen line direction\n   vec2 sDir = normalize(sPos2 - sPos);\n   // vertex offset (orthogonal to line direction)\n   vec2 offset1 = vec2(-sDir.y, sDir.x);\n   // move screen vertex\n   vec2 newPos = sPos + offset1 * position.w * lineWidth;\n   // get moved pos in view space\n   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\n   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\n#endif // THICK_LINE\n\n#ifdef INSTANCED_POS\n  #ifdef SPHERE_SPRITE\n    instOffset = offset;\n\n    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\n    float scale = length(modelViewMatrix[0]);\n    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\n    posEye.w = offset.w * scale;\n\n    spritePosEye = posEye;\n #else\n    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\n    worldPos = modelMatrix * localPos;\n    mvPosition = modelViewMatrix * localPos;\n  #endif\n#endif\n\n#ifdef INSTANCED_MATRIX\n  #ifdef CYLINDER_SPRITE\n    matVec1 = matVector1;\n    matVec2 = matVector2;\n    matVec3 = matVector3;\n    invmatVec1 = invmatVector1;\n    invmatVec2 = invmatVector2;\n    invmatVec3 = invmatVector3;\n\n    // calculate eye coords of cylinder endpoints\n    vec4 v = vec4(0, -0.5, 0, 1);\n    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\n    v.y = 0.5;\n    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\n\n    // sprite is placed at the center of cylinder\n    vec4 posEye;\n    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\n    posEye.w = 1.0;\n\n    // basic sprite size at screen plane (covers only cylinder axis)\n    vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\n\n    // cylinder radius in eye space\n    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\n\n    // full sprite size in eye coords\n    float minZ = min(abs(p1.z), abs(p2.z));\n    vec2 spriteSize = INSTANCED_SPRITE_OVERSCALE  * abs(posEye.z) *\n      (spriteSizeScreen + 2.0 * rad / minZ);\n\n    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\n  #else\n    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\n    worldPos = modelMatrix * localPos;\n    mvPosition = modelViewMatrix * localPos;\n  #endif\n#endif\n\n  gl_Position = projectionMatrix * mvPosition;\n\n  vWorldPosition = worldPos.xyz;\n  vViewPosition = - mvPosition.xyz;\n\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\n\t#if NUM_DIR_LIGHTS > 0\n\t  vec4 worldPosition;\n\t  // see THREE.WebGLProgram.unrollLoops\n\t  #pragma unroll_loop\n\t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\n      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\n\t  }\n\t#endif\n#endif\n\n#ifdef ATTR_COLOR\n  vColor = color.xyz;\n#endif\n\n#ifdef ATTR_COLOR2\n  vColor2 = color2;\n  #ifndef CYLINDER_SPRITE\n    vUv = uv;\n  #endif\n#endif\n\n#ifdef DASHED_LINE\n  vLineDistance = lineDistance;\n#endif\n}\n",
                Or = "#if defined (NORMALS_TO_G_BUFFER)\n  #define fragColor gl_FragData[0]\n#else\n  #define fragColor gl_FragColor\n#endif\n\n#ifdef ATTR_ALPHA_COLOR\n  varying float alphaCol;\n#endif\n\n#ifdef COLOR_FROM_POS\n  uniform mat4 world2colorMatrix;\n#endif\n\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\n\n    #ifdef SHADOWMAP_PCF_RAND\n\t\t  #define MAX_SAMPLES_COUNT 4\n      uniform vec2 samplesKernel[MAX_SAMPLES_COUNT];\n      uniform sampler2D noiseTex;\n      uniform vec2 noiseTexelSize;\n      uniform vec2 srcTexelSize;\n      uniform mat4 projectionMatrix;\n    #endif\n\t#endif\n#endif\n\n#ifdef ATTR_COLOR\n  varying vec3 vColor;\n#endif\n\n#ifdef ATTR_COLOR2\n  varying vec3 vColor2;\n  #ifndef CYLINDER_SPRITE\n    varying vec2 vUv;\n  #endif\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform vec3 fixedColor;\nuniform float opacity;\nuniform float zClipValue;\nuniform float clipPlaneValue;\n\n#ifdef NORMALS_TO_G_BUFFER\n  varying vec3 viewNormal;\n#endif\n\n#define PI 3.14159265359\n#define RECIPROCAL_PI 0.31830988618\n#define saturate(a) clamp( a, 0.0, 1.0 )\n\n#ifdef USE_FOG\n  uniform vec3 fogColor;\n  uniform float fogAlpha;\n  uniform float fogNear;\n  uniform float fogFar;\n#endif\n\nvarying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\nvarying vec3 vViewPosition;\n\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\n  varying vec3 vNormal;\n#endif\n\n/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\n#ifdef SPHERE_SPRITE\n  varying vec4 spritePosEye;\n#endif\n\n#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\n  uniform float zOffset;\n  uniform mat4 projectionMatrix;\n\n  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\n    vec4 pixelPosScreen = projMatrix * pixelPosEye;\n    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\n  }\n#endif\n\n#ifdef SPHERE_SPRITE\n  varying vec4 instOffset;\n  uniform mat4 modelMatrix;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 invModelViewMatrix;\n  uniform mat3 normalMatrix;\n\n  float intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point) {\n\n    // intersect XZ-projected ray with circle\n    float a = dot(ray, ray);\n    float b = dot(ray, origin);\n    float c = dot(origin, origin) - 1.0;\n    float det = b * b - a * c;\n    if (det < 0.0) return -1.0;\n    float t1 = (-b - sqrt(det)) / a;\n    float t2 = (-b + sqrt(det)) / a;\n\n    // calculate both intersection points\n    vec3 p1 = origin + ray * t1;\n    vec3 p2 = origin + ray * t2;\n\n    // choose nearest point\n    if (t1 >= 0.0) {\n      point = p1;\n      return t1;\n    }\n    if (t2 >= 0.0) {\n      point = p2;\n      return t2;\n    }\n\n    return -1.0;\n  }\n\n  float get_sphere_point(in vec3 pixelPosEye, out vec3 point) {\n    // transform camera pos into sphere local coords\n    vec4 v = invModelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n    vec3 origin = (v.xyz - instOffset.xyz) / instOffset.w;\n\n    // transform (camera -> pixel) ray into cylinder local coords\n    v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\n    vec3 ray = normalize(v.xyz);\n\n    return intersect_ray_sphere(origin, ray, point);\n  }\n#endif\n\n#ifdef CYLINDER_SPRITE\n  varying vec4 matVec1;\n  varying vec4 matVec2;\n  varying vec4 matVec3;\n  varying vec4 invmatVec1;\n  varying vec4 invmatVec2;\n  varying vec4 invmatVec3;\n\n  uniform mat4 modelMatrix;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 invModelViewMatrix;\n  uniform mat3 normalMatrix;\n\n  float intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point) {\n\n    // intersect XZ-projected ray with circle\n    float a = dot(ray.xz, ray.xz);\n    float b = dot(ray.xz, origin.xz);\n    float c = dot(origin.xz, origin.xz) - 1.0;\n    float det = b * b - a * c;\n    if (det < 0.0) return -1.0;\n    float t1 = (-b - sqrt(det)) / a;\n    float t2 = (-b + sqrt(det)) / a;\n\n    // calculate both intersection points\n    vec3 p1 = origin + ray * t1;\n    vec3 p2 = origin + ray * t2;\n\n    // choose nearest point\n    float halfHeight = 0.5;\n    if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\n      point = p1;\n      return t1;\n    }\n    if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\n      point = p2;\n      return t2;\n    }\n\n    return -1.0;\n  }\n\n  float get_cylinder_point(in vec3 pixelPosEye, out vec3 point) {\n    // transform camera pos into cylinder local coords\n    vec4 v = invModelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n    vec3 origin = vec3(\n      dot(v, invmatVec1),\n      dot(v, invmatVec2),\n      dot(v, invmatVec3));\n\n    // transform (camera -> pixel) ray into cylinder local coords\n    v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\n    vec3 ray = vec3(\n      dot(v, invmatVec1),\n      dot(v, invmatVec2),\n      dot(v, invmatVec3));\n    ray = normalize(ray);\n\n    return intersect_ray_cylinder(origin, ray, point);\n  }\n#endif\n\n///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n  vec4 r = vec4( fract( v * PackFactors ), v );\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n  return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n  return dot( v, UnpackFactors );\n}\n\n////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\n#ifdef TOON_SHADING\n  #define LOW_TOON_BORDER 0.0\n  #define MEDIUM_TOON_BORDER 0.7\n  #define HIGH_TOON_BORDER 1.0\n\n  #define MEDIUM_TOON_RANGE 0.5\n  #define HIGH_TOON_RANGE 0.95\n#endif\n#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\n  struct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n  };\n\n  struct BlinnPhongMaterial {\n    vec3  diffuseColor;\n    vec3  specularColor;\n    float specularShininess;\n  };\n\n  struct GeometricContext {\n    vec3 normal;\n    vec3 viewDir;\n  };\n\n  struct DirectionalLight {\n    vec3 direction;\n    vec3 color;\n\n    int shadow;\n    vec2 shadowMapSize;\n    float shadowBias;\n    float shadowRadius;\n  };\n\n  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n  uniform vec3 ambientLightColor;\n\n  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\n\n  #if defined(SHADOWMAP)\n  \tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n  \t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n  \t}\n\n    float getShadow( sampler2D shadowMap, DirectionalLight dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\n   \t  float shadow = 0.0;\n\n      shadowCoord.xyz += dirLight.shadowBias * vNormal; //TODO use normals as it done for G-buffer (for sprites)\n      shadowCoord.xyz /= shadowCoord.w;\n\n      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n      bool inFrustum = all( inFrustumVec );\n      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n      bool frustumTest = all( frustumTestVec );\n\n      if ( frustumTest ) {\n        #ifdef SHADOWMAP_BASIC\n      \t  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n      \t#endif\n\n      \t#ifdef SHADOWMAP_PCF_SHARP\n      \t  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\n\n            float dx0 = - texelSize.x * dirLight.shadowRadius;\n            float dy0 = - texelSize.y * dirLight.shadowRadius;\n            float dx1 = + texelSize.x * dirLight.shadowRadius;\n            float dy1 = + texelSize.y * dirLight.shadowRadius;\n\n            shadow = (\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n            ) * ( 1.0 / 9.0 );\n        #endif\n\n        #ifdef SHADOWMAP_PCF_RAND\n          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\n\n          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\n          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\n\n          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\n          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\n\n          // see THREE.WebGLProgram.unrollLoops\n          #pragma unroll_loop\n            for ( int i = 0; i < MAX_SAMPLES_COUNT; i ++ ) {\n              vec2 offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\n              shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\n            }\n          shadow /= float( MAX_SAMPLES_COUNT );\n        #endif\n      }\n      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\n   }\n  #endif\n\n  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\n\n  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n    return RECIPROCAL_PI * diffuseColor;\n  } // validated\n\n  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n    // Original approximation by Christophe Schlick '94\n    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n    return ( 1.0 - specularColor ) * fresnel + specularColor;\n  } // validated\n\n  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n    return 0.25;\n  }\n\n  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\n    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n  }\n\n  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n    float dotNH = saturate(dot( geometry.normal, halfDir ));\n    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\n\n    vec3 F = F_Schlick( specularColor, dotLH );\n    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n    float D = D_BlinnPhong( shininess, dotNH );\n\n    return F * ( G * D );\n  } // validated\n\n  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\n\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\n    #ifdef TOON_SHADING\n      if(dotNL < MEDIUM_TOON_RANGE){\n        dotNL = LOW_TOON_BORDER;\n      }\n      else if(dotNL < HIGH_TOON_RANGE){\n        dotNL = MEDIUM_TOON_BORDER;\n      }\n      else{\n        dotNL = HIGH_TOON_BORDER;\n      }\n    #endif\n\n    vec3 irradiance = dotNL * directLight.color * PI;\n    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\n  }\n\n  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n  }\n\n  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\n    vec3 irradiance = ambientLightColor * PI;\n\n    float shadowMask = 1.0;\n    // see THREE.WebGLProgram.unrollLoops\n  \t#pragma unroll_loop\n  \t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n  \t    #ifdef SHADOWMAP\n  \t    if ( directionalLights[ i ].shadow > 0 ) shadowMask = getShadow( directionalShadowMap[ i ], directionalLights[ i ], vDirectionalShadowCoord[ i ], vViewPosition, vDirectionalShadowNormal[ i ] );\n  \t    #endif\n\n  \t\t  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\n  \t\t}\n\n    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\n\n    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\n  }\n#endif\n\n/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\n#ifdef DASHED_LINE\n  uniform float dashedLineSize;\n  uniform float dashedLinePeriod;\n  varying float vLineDistance;\n#endif\n\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\nvoid main() {\n\n#ifdef CLIP_PLANE\n  if (vViewPosition.z < clipPlaneValue) discard;\n#endif\n\n#ifdef ZCLIP\n  if (vViewPosition.z < zClipValue) discard;\n#endif\n\n  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\n  vec4 pixelPosEye;\n\n#ifdef SPHERE_SPRITE\n\n  vec3 viewNormalSprites;\n  vec3 normal;\n\n/* quick-and-dirty method\n  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\n  float r2 = dot(normal.xy, normal.xy);\n  if (r2 > 1.0) discard;\n  float normalZ = sqrt(1.0 - r2);\n  normal.z = normalZ;\n  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\n  pixelPosEye.z += spritePosEye.w * normalZ;\n*/\n\n  // ray-trace sphere surface\n  {\n    vec3 p;\n    if (get_sphere_point(-vViewPosition, p) < 0.0) discard;\n    pixelPosWorld = modelMatrix * vec4(instOffset.xyz + p * instOffset.w, 1.0);\n    // pixelPosEye = modelViewMatrix * vec4(instOffset.xyz + p * instOffset.w, 1.0);\n    pixelPosEye = vec4(spritePosEye.xyz, 1.0);\n    pixelPosEye.z += instOffset.w *\n      (modelViewMatrix[0][2] * p.x +\n       modelViewMatrix[1][2] * p.y +\n       modelViewMatrix[2][2] * p.z);\n    normal = normalize(normalMatrix * p);\n    #ifdef NORMALS_TO_G_BUFFER\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\n    #endif\n  }\n\n#endif\n\n#ifdef CYLINDER_SPRITE\n  vec3 normal;\n  vec3 viewNormalSprites;\n  float cylinderY = 0.0;\n\n    // ray-trace cylinder surface\n    {\n      vec3 p;\n      if (get_cylinder_point(-vViewPosition, p) < 0.0) discard;\n\n      cylinderY = 0.5 * (p.y + 1.0);\n\n      vec4 v = vec4(p, 1.0);\n      v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\n      pixelPosWorld = modelMatrix * v;\n      pixelPosEye = modelViewMatrix * v;\n\n      vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\n      normal = vec3(\n        dot(localNormal, matVec1.xyz),\n        dot(localNormal, matVec2.xyz),\n        dot(localNormal, matVec3.xyz));\n      #ifdef NORMALS_TO_G_BUFFER\n        viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\n      #endif\n      normal = normalize(normalMatrix * normal);\n    }\n#endif\n\n  #ifdef ATTR_COLOR\n    vec3 vertexColor = vColor;\n  #else\n    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\n  #endif\n\n  #ifdef ATTR_COLOR2\n    #ifdef CYLINDER_SPRITE\n      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\n    #else\n      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\n    #endif\n      // choose either color or color2\n    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\n  #endif\n\n  // negative red component is a special condition\n  if (vertexColor.x < 0.0) discard;\n\n  #ifdef DASHED_LINE\n    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\n  #endif\n\n  // transparency prepass writes only z, so we don't need to calc the color\n  #ifdef PREPASS_TRANSP\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\n    #endif\n    return;\n  #endif\n\n    float totalOpacity = opacity;\n\n  #ifdef ATTR_ALPHA_COLOR\n    totalOpacity *= alphaCol;\n  #endif\n\n  // discard fully transparent pixels\n  if (totalOpacity == 0.0) discard;\n\n  #ifdef FAKE_OPACITY\n    // discard pixels in checker pattern\n    vec2 dm_coord = floor(gl_FragCoord.xy);\n    dm_coord = fract(dm_coord * 0.5);\n    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\n    vec4 diffuseColor = vec4(diffuse, 1.0);\n  #else\n    vec4 diffuseColor = vec4(diffuse, totalOpacity);\n  #endif\n\n  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\n    #ifdef DOUBLE_SIDED\n      float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    #else\n      float flipNormal = 1.0;\n    #endif\n    vec3 normal = normalize( vNormal ) * flipNormal;\n  #endif\n\n    diffuseColor.rgb *= vertexColor;\n\n  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\n    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\n  #endif\n\n  #ifdef NORMALS_TO_G_BUFFER\n    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\n      vec3 viewNormaInColor = 0.5*viewNormalSprites+0.5;\n    #else\n      vec3 viewNormaInColor = 0.5*viewNormal+0.5;\n    #endif\n    // [-1, 1] -> [0, 1]\n    gl_FragData[1] = vec4(viewNormaInColor, 1.0);\n  #endif\n\n  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\n    GeometricContext geometry = GeometricContext(normal, normalize( vViewPosition ));\n    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\n    vec3 outgoingLight = calcLighting(geometry, material, vViewPosition);\n  #else\n    vec3 outgoingLight = diffuseColor.rgb;\n  #endif\n\n  #ifdef COLOR_FROM_DEPTH\n    float depth = 0.0;\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\n      depth = gl_FragDepthEXT;\n    #else\n      depth = gl_FragCoord.z;\n    #endif\n    fragColor = packDepthToRGBA(depth);\n    return;\n  #endif\n\n  #ifdef COLOR_FROM_POS\n    fragColor = world2colorMatrix * pixelPosWorld;\n  #else\n    #ifdef OVERRIDE_COLOR\n      fragColor = vec4(fixedColor, diffuseColor.a);\n    #else\n      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\n    #endif\n\n    #ifdef USE_FOG\n      float viewDistance;\n      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\n        viewDistance = abs(pixelPosEye.z);\n      #else\n        viewDistance = vViewPosition.z;\n      #endif\n      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\n      #ifdef FOG_TRANSPARENT\n        fragColor.a = fragColor.a * (1.0 - fogFactor);\n      #else\n        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\n      #endif\n    #endif\n\n  #endif\n}\n",
                Ar = {
                    precision: "mediump",
                    init: function(e) {
                        this.precision = e.capabilities.getMaxPrecision("highp")
                    }
                },
                Tr = new Uint8Array([24, 52, 0, 254, 145, 0, 122, 0, 0, 7, 170, 0, 34, 214, 0, 173, 8, 0, 86, 249, 0, 160, 4, 0, 226, 46, 0, 224, 211, 0, 3, 157, 0, 174, 247, 0, 12, 182, 0, 220, 216, 0, 1, 109, 0, 253, 154, 0]),
                kr = c.RepeatWrapping,
                Rr = c.RepeatWrapping,
                Ir = c.NearestFilter,
                Mr = c.NearestFilter,
                Nr = c.UVMapping,
                Lr = new c.DataTexture(Tr, 4, 4, c.RGBFormat, c.UnsignedByteType, Nr, kr, Rr, Mr, Ir, 1);
            Lr.needsUpdate = !0;
            var jr = {
                    noiseWidth: 4,
                    noiseHeight: 4,
                    noiseTexture: Lr
                },
                Dr = [new c.Vector2(-.541978, .840393), new c.Vector2(.125533, -.992089), new c.Vector2(.374329, .927296), new c.Vector2(-.105475, .994422)],
                Vr = c.UniformsUtils.merge([c.UniformsLib.common, c.UniformsLib.fog, c.UniformsLib.lights, {
                    specular: {
                        type: "c",
                        value: new c.Color(1118481)
                    },
                    shininess: {
                        type: "f",
                        value: 30
                    },
                    fixedColor: {
                        type: "c",
                        value: new c.Color(16777215)
                    },
                    zOffset: {
                        type: "f",
                        value: 0
                    },
                    zClipValue: {
                        type: "f",
                        value: 0
                    },
                    clipPlaneValue: {
                        type: "f",
                        value: 0
                    },
                    invModelViewMatrix: {
                        type: "4fv",
                        value: new c.Matrix4
                    },
                    world2colorMatrix: {
                        type: "4fv",
                        value: new c.Matrix4
                    },
                    dashedLineSize: {
                        type: "f",
                        value: .1
                    },
                    dashedLinePeriod: {
                        type: "f",
                        value: .2
                    },
                    projMatrixInv: {
                        type: "4fv",
                        value: new c.Matrix4
                    },
                    viewport: {
                        type: "v2",
                        value: new c.Vector2
                    },
                    lineWidth: {
                        type: "f",
                        value: 2
                    },
                    fogAlpha: {
                        type: "f",
                        value: 1
                    },
                    samplesKernel: {
                        type: "v2v",
                        value: null
                    },
                    noiseTex: {
                        type: "t",
                        value: null
                    },
                    noiseTexelSize: {
                        type: "v2",
                        value: null
                    },
                    srcTexelSize: {
                        type: "v2",
                        value: null
                    }
                }]),
                Fr = ["shininess", "opacity", "zOffset", "diffuse", "specular", "fixedColor", "zClipCoef", "zClipValue", "clipPlaneValue", "world2colorMatrix", "dashedLineSize", "dashedLinePeriod", "projMatrixInv", "viewport", "lineWidth", "fogAlpha", "samplesKernel", "noiseTex", "noiseTexelSize", "srcTexelSize"];

            function Br(e) {
                c.RawShaderMaterial.call(this), this.fog = !0, this.instancedPos = !1, this.instancedMatrix = !1, this.attrColor = !1, this.attrColor2 = !1, this.attrAlphaColor = !1, this.overrideColor = !1, this.sphereSprite = !1, this.cylinderSprite = !1, this.zClip = !1, this.clipPlane = !1, this.fakeOpacity = !1, this.prepassTransparancy = !1, this.colorFromPos = !1, this.shadowmap = !1, this.shadowmapType = "random", this.colorFromDepth = !1, this.dashedLine = !1, this.transparent = !0, this.thickLine = !1, this.fogTransparent = !1, this.normalsToGBuffer = !1, this.toonShading = !1, this.uberOptions = Object.create(Br.prototype.uberOptions), c.RawShaderMaterial.prototype.setValues.call(this, {
                    uniforms: c.UniformsUtils.clone(Vr),
                    vertexShader: this.precisionString() + Er,
                    fragmentShader: this.precisionString() + Or,
                    lights: !0,
                    fog: !0,
                    side: c.DoubleSide
                }), this.setValues(e)
            }
            Br.prototype = Object.create(c.RawShaderMaterial.prototype), Br.prototype.constructor = Br, Br.prototype.precisionString = function() {
                var e = Ar.precision;
                return "precision ".concat(e, " float;\n") + "precision ".concat(e, " int;\n\n")
            }, Br.prototype.uberOptions = {
                diffuse: new c.Color(16777215),
                specular: new c.Color(1118481),
                shininess: 30,
                opacity: 1,
                fixedColor: new c.Color(16777215),
                zOffset: 0,
                zClipCoef: 2,
                zClipValue: 0,
                clipPlaneValue: 0,
                world2colorMatrix: new c.Matrix4,
                dashedLineSize: .1,
                dashedLinePeriod: .3,
                projMatrixInv: new c.Matrix4,
                viewport: new c.Vector2(800, 600),
                lineWidth: 2,
                fogAlpha: 1,
                samplesKernel: Dr,
                noiseTex: jr.noiseTexture,
                noiseTexelSize: new c.Vector2(1 / jr.noiseWidth, 1 / jr.noiseHeight),
                srcTexelSize: new c.Vector2(1 / 800, 1 / 600),
                copy: function(e) {
                    this.diffuse.copy(e.diffuse), this.specular.copy(e.specular), this.shininess = e.shininess, this.opacity = e.opacity, this.fixedColor.copy(e.fixedColor), this.zOffset = e.zOffset, this.zClipCoef = e.zClipCoef, this.zClipValue = e.zClipValue, this.clipPlaneValue = e.clipPlaneValue, this.world2colorMatrix.copy(e.world2colorMatrix), this.dashedLineSize = e.dashedLineSize, this.dashedLinePeriod = e.dashedLinePeriod, this.projMatrixInv = e.projMatrixInv, this.viewport = e.viewport, this.lineWidth = e.lineWidth, this.toonShading = e.toonShading, this.fogAlpha = e.fogAlpha, this.samplesKernel = e.samplesKernel, this.noiseTex = e.noiseTex, this.noiseTexelSize = e.noiseTexelSize, this.srcTexelSize = e.srcTexelSize
                }
            }, Br.prototype.copy = function(e) {
                return c.ShaderMaterial.prototype.copy.call(this, e), this.fog = e.fog, this.instancedPos = e.instancedPos, this.instancedMatrix = e.instancedMatrix, this.attrColor = e.attrColor, this.attrColor2 = e.attrColor2, this.attrAlphaColor = e.attrAlphaColor, this.overrideColor = e.overrideColor, this.sphereSprite = e.sphereSprite, this.cylinderSprite = e.cylinderSprite, this.zClip = e.zClip, this.clipPlane = e.clipPlane, this.fakeOpacity = e.fakeOpacity, this.colorFromPos = e.colorFromPos, this.shadowmap = e.shadowmap, this.shadowmapType = e.shadowmapType, this.colorFromDepth = e.colorFromDepth, this.prepassTransparancy = e.prepassTransparancy, this.dashedLine = e.dashedLine, this.thickLine = e.thickLine, this.fogTransparent = e.fogTransparent, this.normalsToGBuffer = e.normalsToGBuffer, this.toonShading = e.toonShading, this.uberOptions.copy(e.uberOptions), this
            }, Br.prototype.createInstance = function() {
                var e = new Br;
                return e.copy(this), e.uberOptions = Object.create(this.uberOptions), e
            }, Br.prototype.setValues = function(e) {
                if (void 0 !== e) {
                    c.RawShaderMaterial.prototype.setValues.call(this, e);
                    var t = {},
                        n = {};
                    this.fog && (t.USE_FOG = 1), this.instancedPos && (t.INSTANCED_POS = 1), this.instancedMatrix && (t.INSTANCED_MATRIX = 1), this.attrColor && (t.ATTR_COLOR = 1), this.attrColor2 && (t.ATTR_COLOR2 = 1), this.attrAlphaColor && (t.ATTR_ALPHA_COLOR = 1), this.overrideColor && (t.OVERRIDE_COLOR = 1), this.sphereSprite && (t.SPHERE_SPRITE = 1, n.fragDepth = 1), this.cylinderSprite && (t.CYLINDER_SPRITE = 1, n.fragDepth = 1), this.zClip && (t.ZCLIP = 1), this.clipPlane && (t.CLIP_PLANE = 1), this.fakeOpacity && (t.FAKE_OPACITY = 1), this.lights && (t.USE_LIGHTS = 1), this.colorFromPos && (t.COLOR_FROM_POS = 1), this.shadowmap && (t.SHADOWMAP = 1, "pcf" === this.shadowmapType ? t.SHADOWMAP_PCF_SHARP = 1 : "random" === this.shadowmapType ? t.SHADOWMAP_PCF_RAND = 1 : t.SHADOWMAP_BASIC = 1), this.colorFromDepth && (t.COLOR_FROM_DEPTH = 1), this.prepassTransparancy && (t.PREPASS_TRANSP = 1), this.dashedLine && (t.DASHED_LINE = 1), this.thickLine && (t.THICK_LINE = 1), this.fogTransparent && (t.FOG_TRANSPARENT = 1), this.normalsToGBuffer && (n.drawBuffers = 1, t.NORMALS_TO_G_BUFFER = 1), this.toonShading && (t.TOON_SHADING = 1), this.defines = t, this.extensions = n
                }
            }, Br.prototype.setUberOptions = function(e) {
                if (void 0 !== e)
                    for (var t in e) e.hasOwnProperty(t) && (this.uberOptions[t] instanceof c.Color ? this.uberOptions[t] = e[t].clone() : this.uberOptions[t] = e[t])
            }, Br.prototype.clone = function(e) {
                return e ? this.createInstance() : c.Material.prototype.clone.call(this)
            }, Br.prototype.updateUniforms = function() {
                var e = this;
                Fr.forEach(function(t) {
                    e.uniforms.hasOwnProperty(t) && (e.uberOptions[t] instanceof c.Color || e.uberOptions[t] instanceof c.Matrix4 ? e.uniforms[t].value = e.uberOptions[t].clone() : e.uniforms[t].value = e.uberOptions[t])
                })
            };
            var zr, Ur, Gr = Br,
                Hr = {
                    DEFAULT: 0,
                    VOLUME: 1,
                    TRANSPARENT: 2,
                    PREPASS_TRANSPARENT: 3,
                    VOLUME_BFPLANE: 4,
                    COLOR_FROM_POSITION: 5
                };

            function Wr(e, t) {
                ! function e(n) {
                    n instanceof c.Mesh && t(n);
                    for (var r = 0, o = n.children.length; r < o; r++) e(n.children[r])
                }(e)
            }

            function qr(e) {
                e.traverse(function(e) {
                        e instanceof c.Mesh && e.geometry.dispose()
                    }),
                    function(e) {
                        for (var t = e.children, n = 0, r = t.length; n < r; ++n) {
                            var o = t[n];
                            o.parent = null, o.dispatchEvent({
                                type: "removed"
                            })
                        }
                        e.children = []
                    }(e)
            }

            function Yr(e, t) {
                var n = [];
                return e.traverse(function(e) {
                    for (var r = 0; r < t.length; r++)
                        if (e instanceof t[r]) {
                            n[n.length] = e;
                            break
                        }
                }), n
            }

            function Xr(e) {
                if (e.castShadow) {
                    var t = e.material.createInstance();
                    t.setValues({
                        colorFromDepth: !0,
                        lights: !1,
                        shadowmap: !1,
                        fog: !1
                    }), e.customDepthMaterial = t
                }!e.receiveShadow && e.material.shadowmap && e.material.setValues({
                    shadowmap: !1
                })
            }
            c.Object3D.prototype.resetTransform = function() {
                this.position.set(0, 0, 0), this.quaternion.set(0, 0, 0, 1), this.scale.set(1, 1, 1)
            }, c.Object3D.prototype.updateMatrixWorldRecursive = function() {
                null != this.parent && this.parent.updateMatrixWorldRecursive(), this.updateMatrixWorld()
            }, c.Object3D.prototype.addSavingWorldTransform = (zr = new c.Matrix4, function(e) {
                e instanceof c.Object3D && (zr.getInverse(this.matrixWorld), zr.multiply(e.matrixWorld), e.matrix.copy(zr), e.matrix.decompose(e.position, e.quaternion, e.scale), this.add(e))
            }), c.WebGLRenderer.prototype.renderDummyQuad = function() {
                var e = new c.MeshBasicMaterial({
                        transparent: !0,
                        opacity: 0,
                        depthWrite: !1
                    }),
                    t = new c.Scene,
                    n = new c.Mesh(new c.PlaneBufferGeometry(.01, .01), e);
                t.add(n);
                var r = new c.OrthographicCamera(-.5, .5, .5, -.5, -1e4, 1e4);
                return r.position.z = 100,
                    function() {
                        this.render(t, r)
                    }
            }(), c.WebGLRenderer.prototype.renderScreenQuad = function() {
                var e = new c.Scene,
                    t = new c.Mesh(new c.PlaneBufferGeometry(1, 1));
                e.add(t);
                var n = new c.OrthographicCamera(-.5, .5, .5, -.5, -1e4, 1e4);
                return n.position.z = 100,
                    function(r) {
                        t.material = r, this.render(e, n)
                    }
            }(), c.WebGLRenderer.prototype.renderScreenQuadFromTex = (Ur = new c.ShaderMaterial({
                uniforms: {
                    srcTex: {
                        type: "t",
                        value: null
                    },
                    opacity: {
                        type: "f",
                        value: 1
                    }
                },
                vertexShader: "varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }",
                fragmentShader: "varying vec2 vUv; uniform sampler2D srcTex; uniform float opacity;void main() { vec4 color = texture2D(srcTex, vUv); gl_FragColor = vec4(color.xyz, color.a * opacity); }",
                transparent: !0,
                depthTest: !1,
                depthWrite: !1
            }), function(e, t) {
                Ur.uniforms.srcTex.value = e, Ur.transparent = t < 1, Ur.uniforms.opacity.value = t, this.renderScreenQuad(Ur)
            }), c.WebGLRenderer.prototype.renderScreenQuadFromTexDepth = function() {
                var e = new c.ShaderMaterial({
                    uniforms: {
                        srcTex: {
                            type: "t",
                            value: null
                        },
                        opacity: {
                            type: "f",
                            value: 1
                        }
                    },
                    vertexShader: "varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }",
                    fragmentShader: "const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1);\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. )\n;const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. )\n;float unpackRGBAToDepth( const in vec4 v ) {\n  return dot( v, UnpackFactors );\n}\nvarying vec2 vUv; uniform sampler2D srcTex; uniform float opacity;\nvoid main() { \n  vec4 color = texture2D(srcTex, vUv); \n  float depth = unpackRGBAToDepth(color);\n  gl_FragColor = vec4(depth, depth, depth, opacity);\n }\n",
                    transparent: !0,
                    depthTest: !1,
                    depthWrite: !1
                });
                return function(t, n) {
                    e.uniforms.srcTex.value = t, e.transparent = n < 1, e.uniforms.opacity.value = n, this.renderScreenQuad(e)
                }
            }(), c.WebGLRenderer.prototype.renderScreenQuadFromTexWithDistortion = function() {
                var e = new c.ShaderMaterial({
                    uniforms: {
                        srcTex: {
                            type: "t",
                            value: null
                        },
                        coef: {
                            type: "f",
                            value: 1
                        }
                    },
                    vertexShader: "varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }",
                    fragmentShader: "varying vec2 vUv; uniform sampler2D srcTex; uniform float coef;void main() {vec2 uv = vUv * 2.0 - 1.0;float r2 = dot(uv, uv);vec2 tc = uv * (1.0 + coef * r2);if (!all(lessThan(abs(tc), vec2(1.0)))) discard;tc = 0.5 * (tc + 1.0);gl_FragColor = texture2D(srcTex, tc);}",
                    transparent: !1,
                    depthTest: !1,
                    depthWrite: !1
                });
                return function(t, n) {
                    e.uniforms.srcTex.value = t, e.uniforms.coef.value = n, this.renderScreenQuad(e)
                }
            }(), c.PerspectiveCamera.prototype.setMinimalFov = function(e) {
                this.aspect >= 1 ? this.fov = e : this.fov = c.Math.radToDeg(2 * Math.atan(Math.tan(.5 * c.Math.degToRad(e)) / this.aspect))
            }, c.PerspectiveCamera.prototype.setDistanceToFit = function(e, t) {
                this.position.z = e / Math.sin(.5 * c.Math.degToRad(t))
            }, c.BufferAttribute.prototype.copyAtList = function(e, t) {
                console.assert(this.itemSize === e.itemSize, "DEBUG: BufferAttribute.copyAtList buffers have different item size.");
                for (var n = this.itemSize, r = 0, o = t.length; r < o; ++r)
                    for (var i = 0; i < n; ++i) this.array[r * n + i] = e.array[t[r] * n + i];
                return this
            };
            var $r = {
                    calcCylinderMatrix: function(e, t, n) {
                        var r = e.clone().lerp(t, .5),
                            o = new c.Matrix4;
                        o.makeScale(n, e.distanceTo(t), n);
                        var i = new c.Matrix4;
                        i.makeRotationX(Math.PI / 2);
                        var a = new c.Matrix4,
                            s = new c.Vector3(0, 1, 0);
                        return a.lookAt(r, t, s), a.multiply(i), a.multiply(o), a.setPosition(r), a
                    },
                    calcChunkMatrix: function(e, t, n, r) {
                        var o = new c.Matrix4;
                        o.makeScale(r.x, r.y, 0);
                        var i = new c.Matrix4;
                        return i.lookAt(e, t, n), i.multiply(o), i.setPosition(e), i
                    },
                    forEachMeshInGroup: Wr,
                    countTriangles: function(e) {
                        var t = 0;
                        return Wr(e, function(e) {
                            t += function(e) {
                                var t = e.geometry;
                                if (t instanceof c.InstancedBufferGeometry) {
                                    var n = t.attributes;
                                    for (var r in n)
                                        if (n.hasOwnProperty(r) && n[r] instanceof c.InstancedBufferAttribute) {
                                            var o = n[r];
                                            return (t.index ? t.index.array.length / 3 : 0) * o.array.length / o.itemSize
                                        } return 0
                                }
                                return t instanceof c.BufferGeometry ? t.index ? t.index.array.length / 3 : 0 : t.faces ? t.faces.length : 0
                            }(e)
                        }), t
                    },
                    groupHasGeometryToRender: function(e) {
                        var t = !1;
                        return e.traverse(function(e) {
                            (e.hasOwnProperty("geometry") || e instanceof gr) && (t = !0)
                        }), t
                    },
                    buildDistorionMesh: function(e, t, n) {
                        function r(e) {
                            for (var t = 0, r = e, o = 1; Math.abs(r - t) > 1e-5;) t = r, r = e / ((o = 1 + n * r) * o);
                            return 1 / o
                        }
                        for (var o = new c.PlaneBufferGeometry(2, 2, e, t), i = o.getAttribute("position"), a = 0; a < i.count; ++a) {
                            var s = i.array[3 * a],
                                l = i.array[3 * a + 1],
                                u = r(s * s + l * l);
                            i.setXY(a, u * s, u * l)
                        }
                        return o
                    },
                    RCGroup: Pr,
                    fillArray: function(e, t, n, r) {
                        n = void 0 !== n ? n : 0, r = void 0 !== r ? r : e.length;
                        for (var o = n; o < r; ++o) e[o] = t
                    },
                    clearTree: qr,
                    destroyObject: function(e) {
                        qr(e), e.parent ? e.parent.remove(e) : e.dispatchEvent({
                            type: "removed"
                        })
                    },
                    applyTransformsToMeshes: function(e, t) {
                        var n = t.length;
                        if (!(n < 1))
                            for (var r = Yr(e, [c.Mesh, c.LineSegments, c.Line]), o = 0, i = r.length; o < i; ++o) {
                                var a = r[o],
                                    s = a.parent;
                                if (s) {
                                    a.applyMatrix(t[0]);
                                    for (var l = 1; l < n; ++l) {
                                        var u = new a.constructor(a.geometry, a.material);
                                        s.add(u), u.applyMatrix(t[l])
                                    }
                                }
                            }
                    },
                    processTransparentMaterial: function(e, t) {
                        if (t instanceof Gr)
                            for (var n = Yr(e, [c.Mesh, c.LineSegments]), r = function(e, t) {
                                    var r = n[e],
                                        o = r.parent;
                                    if (!o) return "continue";
                                    r.material.setValues({
                                        prepassTransparancy: !1,
                                        fakeOpacity: !1
                                    }), r.material.needsUpdate = !0, r.layers.set(Hr.TRANSPARENT);
                                    var i = r.material.createInstance();
                                    i.setValues({
                                        prepassTransparancy: !0,
                                        fakeOpacity: !1
                                    });
                                    var a = new r.constructor(r.geometry, i);
                                    l.a.forEach(["transparent", "colorFromDepth", "lights", "shadowmap", "fog"], function(e) {
                                        a.material[e] = !1
                                    }), a.material.needsUpdate = !0, a.applyMatrix(r.matrix), a.layers.set(Hr.PREPASS_TRANSPARENT), o.add(a)
                                }, o = 0, i = n.length; o < i; ++o) r(o)
                    },
                    processColFromPosMaterial: function(e, t) {
                        if (t instanceof Gr)
                            for (var n = Yr(e, [c.Mesh, c.LineSegments]), r = function(e, t) {
                                    var r = n[e],
                                        o = r.parent;
                                    if (!o) return "continue";
                                    var i = r.material.createInstance();
                                    i.setValues({
                                        colorFromPos: !0
                                    });
                                    var a = new r.constructor(r.geometry, i);
                                    l.a.forEach(["transparent", "colorFromDepth", "lights", "shadowmap", "fog", "overrideColor", "fogTransparent", "attrColor", "attrColor2", "attrAlphaColor", "fakeOpacity"], function(e) {
                                        a.material[e] = !1
                                    }), a.material.needsUpdate = !0, a.applyMatrix(r.matrix), a.layers.set(Hr.COLOR_FROM_POSITION), o.add(a)
                                }, o = 0, i = n.length; o < i; ++o) r(o)
                    },
                    prepareObjMaterialForShadow: Xr,
                    processMaterialForShadow: function(e, t) {
                        t instanceof Gr && e.traverse(function(e) {
                            e instanceof c.Mesh && Xr(e)
                        })
                    },
                    makeVisibleMeshes: function(e, t) {
                        e && e.traverse && e.traverse(function(e) {
                            e instanceof c.Mesh && (e.visible = t(e))
                        })
                    },
                    applySelectionMaterial: function(e) {
                        e.traverse(function(e) {
                            "material" in e && (e.material = e.material.clone(!0), e.material.setValues({
                                depthFunc: c.LessEqualDepth,
                                overrideColor: !0,
                                fog: !1
                            }), e.material.setUberOptions({
                                fixedColor: new c.Color(16776960),
                                zOffset: -1e-6
                            }))
                        })
                    },
                    getMiddlePoint: function(e, t, n) {
                        var r = n || new c.Vector3;
                        return r.set(0, 0, 0), r.addScaledVector(e, .5), r.addScaledVector(t, .5), r
                    },
                    LAYERS: Hr
                },
                Kr = {
                    boundingBox: new c.Box3(new c.Vector3(-1, -1, -1), new c.Vector3(1, 1, 1)),
                    boundingSphere: new c.Sphere(new c.Vector3(0, 0, 0), 1)
                };

            function Zr(e, t) {
                $r.RCGroup.call(this), this.name = e, this._dataSource = t
            }
            R.deriveClass(Zr, $r.RCGroup), Zr.prototype.release = function() {
                this.parent && this.parent.remove(this)
            }, Zr.prototype.getDataSource = function() {
                return this._dataSource
            }, Zr.prototype.getBoundaries = function() {
                return Kr
            };
            var Qr = Zr;

            function Jr(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }

            function eo(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function to(e) {
                return null == e || Array.isArray(e) ? e : [e]
            }
            var no = function() {
                function e() {
                    var t = this,
                        n = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [],
                        r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : ["id"];
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._list = [], this._dict = {}, this._indices = Jr(r), this._indices.forEach(function(e) {
                        t._dict[e] = {}
                    }), n.forEach(function(e) {
                        return t.register(e)
                    })
                }
                var t, n, r;
                return t = e, r = [{
                    key: "registerInList",
                    value: function(e, t) {
                        e.includes(t) || e.push(t)
                    }
                }, {
                    key: "unregisterFromList",
                    value: function(e, t) {
                        var n = e.indexOf(t); - 1 !== n && e.splice(n, 1)
                    }
                }, {
                    key: "registerInDict",
                    value: function(e, t, n) {
                        t.forEach(function(t) {
                            t = t.toLowerCase();
                            var r = e[t] = e[t] || [];
                            r.includes(n) || r.push(n)
                        })
                    }
                }, {
                    key: "unregisterFromDict",
                    value: function(e, t, n) {
                        t.forEach(function(t) {
                            t = t.toLowerCase();
                            var r = e[t];
                            if (r) {
                                var o = r.indexOf(n); - 1 !== o && r.splice(o, 1), 0 === r.length && delete e[t]
                            }
                        })
                    }
                }], (n = [{
                    key: "register",
                    value: function(t) {
                        var n = this;
                        e.registerInList(this._list, t), this._indices.forEach(function(r) {
                            e.registerInDict(n._dict[r], to(t[r]), t)
                        })
                    }
                }, {
                    key: "unregister",
                    value: function(t) {
                        var n = this;
                        e.unregisterFromList(this._list, t), this._indices.forEach(function(r) {
                            e.unregisterFromDict(n._dict[r], to(t[r]), t)
                        })
                    }
                }, {
                    key: "keys",
                    value: function(e) {
                        return Object.keys(this._dict[e || this._indices[0]])
                    }
                }, {
                    key: "get",
                    value: function(e, t) {
                        var n = this._dict[t || this._indices[0]];
                        if (n) {
                            var r = n[e && e.toLowerCase()];
                            return r && r.length > 0 ? r[0] : void 0
                        }
                    }
                }, {
                    key: "all",
                    get: function() {
                        return Jr(this._list)
                    }
                }, {
                    key: "first",
                    get: function() {
                        return this._list[0]
                    }
                }]) && eo(t.prototype, n), r && eo(t, r), e
            }();
            var ro = function(e) {
                Object.defineProperties(e, {
                    logger: {
                        get: function() {
                            return this.context && this.context.logger ? this.context.logger : v
                        }
                    },
                    settings: {
                        get: function() {
                            return this.context && this.context.settings ? this.context.settings : H
                        }
                    }
                })
            };

            function oo(e) {
                return (oo = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function io(e, t) {
                return !t || "object" !== oo(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ao(e) {
                return (ao = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function so(e, t) {
                return (so = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function lo(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function co(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function uo(e, t, n) {
                return t && co(e.prototype, t), n && co(e, n), e
            }
            var po = function() {
                function e(t, n) {
                    lo(this, e), this._position = t, this._radius = n
                }
                return uo(e, [{
                    key: "raycast",
                    value: function(t) {
                        var n = e._sphere;
                        n.set(this._position, this._radius);
                        var r = new c.Vector3;
                        return t.ray.intersectSphere(n, r) ? {
                            distance: t.ray.origin.distanceTo(r),
                            point: r
                        } : null
                    }
                }]), e
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(po, "_sphere", new c.Sphere);
            var fo = function(e) {
                return function(t) {
                    function n(e) {
                        var t, r;
                        lo(this, n);
                        for (var o = arguments.length, i = new Array(o > 1 ? o - 1 : 0), a = 1; a < o; a++) i[a - 1] = arguments[a];
                        return (r = io(this, (t = ao(n)).call.apply(t, [this].concat(i))))._objects = new Array(e), r.boundingSphere = null, r.boundingBox = null, r
                    }
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && so(e, t)
                    }(n, e), uo(n, [{
                        key: "setSphere",
                        value: function(e, t, n) {
                            this._objects[e] = new po(t, n)
                        }
                    }, {
                        key: "raycast",
                        value: function(e, t) {
                            for (var n = 0, r = this._objects.length; n < r; ++n) {
                                var o = this._objects[n].raycast(e);
                                o && (o.chunkIdx = n, t.push(o))
                            }
                        }
                    }, {
                        key: "computeBoundingBox",
                        value: function() {
                            var e = this._objects,
                                t = this.boundingBox;
                            null === t && (this.boundingBox = t = new c.Box3), t.makeEmpty();
                            for (var n = 0, r = e.length; n < r; ++n) t.expandByPoint(e[n]._position)
                        }
                    }, {
                        key: "computeBoundingSphere",
                        value: function() {
                            this.computeBoundingBox();
                            var e = this._objects,
                                t = this.boundingBox,
                                n = 0,
                                r = new c.Vector3;
                            t.getCenter(r);
                            for (var o = 0, i = e.length; o < i; ++o) {
                                var a = e[o]._position,
                                    s = r.distanceToSquared(a);
                                n < s && (n = s)
                            }
                            null === this.boundingSphere && (this.boundingSphere = new c.Sphere), this.boundingSphere.set(r, Math.sqrt(n))
                        }
                    }]), n
                }()
            };

            function ho(e) {
                return (ho = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function mo(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function yo(e, t) {
                return !t || "object" !== ho(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function vo(e) {
                return (vo = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function _o(e, t) {
                return (_o = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var go = new c.Color,
                bo = R.copySubArrays;
            var wo = function(e) {
                function t(e, n, r) {
                    var o;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (o = yo(this, vo(t).call(this, e)))._sphGeometry = r ? new c.PlaneBufferGeometry(2, 2, 1, 1) : new c.SphereBufferGeometry(1, 2 * n, n, 0, 2 * Math.PI, 0, Math.PI), o._init(e, o._sphGeometry), o
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && _o(e, t)
                }(t, fo(c["InstancedBufferGeometry"])), n = t, (r = [{
                    key: "setItem",
                    value: function(e, t, n) {
                        var r, o, i, a, s, l;
                        r = this._offsets, o = 4 * e, i = t.x, a = t.y, s = t.z, l = n, r[o] = i, r[o + 1] = a, r[o + 2] = s, r[o + 3] = l, this.setSphere(e, t, n)
                    }
                }, {
                    key: "setColor",
                    value: function(e, t) {
                        var n, r, o, i, a;
                        go.set(t), n = this._colors, r = 3 * e, o = go.r, i = go.g, a = go.b, n[r] = o, n[r + 1] = i, n[r + 2] = a
                    }
                }, {
                    key: "startUpdate",
                    value: function() {
                        return !0
                    }
                }, {
                    key: "finishUpdate",
                    value: function() {
                        this.getAttribute("offset").needsUpdate = !0, this.getAttribute("color").needsUpdate = !0
                    }
                }, {
                    key: "finalize",
                    value: function() {
                        this.finishUpdate(), this.computeBoundingSphere()
                    }
                }, {
                    key: "setOpacity",
                    value: function(e, t) {
                        for (var n = this._alpha, r = 0, o = e.length; r < o; ++r) n[e[r]] = t;
                        this.getAttribute("alphaColor").needsUpdate = !0
                    }
                }, {
                    key: "getSubset",
                    value: function(e) {
                        var t = e.length,
                            n = new c.InstancedBufferGeometry;
                        return this._init.call(n, t, this._sphGeometry), bo(this._offsets, n._offsets, e, 4), bo(this._colors, n._colors, e, 3), n.boundingSphere = this.boundingSphere, n.boundingBox = this.boundingBox, [n]
                    }
                }, {
                    key: "_init",
                    value: function(e, t) {
                        this.copy(t), this._offsets = R.allocateTyped(Float32Array, 4 * e), this._colors = R.allocateTyped(Float32Array, 3 * e);
                        var n = this._alpha = R.allocateTyped(Float32Array, e);
                        l.a.fill(n, 1), this.addAttribute("offset", new c.InstancedBufferAttribute(this._offsets, 4, !1, 1)), this.addAttribute("color", new c.InstancedBufferAttribute(this._colors, 3, !1, 1)), this.addAttribute("alphaColor", new c.InstancedBufferAttribute(n, 1, !1, 1))
                    }
                }]) && mo(n.prototype, r), o && mo(n, o), t
            }();

            function xo(e) {
                return (xo = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function So(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Co(e, t) {
                return !t || "object" !== xo(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Po(e) {
                return (Po = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Eo(e, t) {
                return (Eo = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Oo(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var Ao = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Co(this, Po(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Eo(e, t)
                }(t, c["BufferGeometry"]), n = t, (r = [{
                    key: "uvIntersection",
                    value: function(e, n, r, o, i, a, s) {
                        var l = t._barycoord;
                        return c.Triangle.barycoordFromPoint(e, n, r, o, l), i.multiplyScalar(l.x), a.multiplyScalar(l.y), s.multiplyScalar(l.z), i.add(a).add(s), i.clone()
                    }
                }, {
                    key: "checkIntersection",
                    value: function(e, t, n, r, o, i, a) {
                        return null === n.intersectTriangle(r, o, i, !1, a) ? null : {
                            point: a.clone()
                        }
                    }
                }, {
                    key: "checkBufferGeometryIntersection",
                    value: function(e, n, r, o, i, a, s, l) {
                        var u = t._vA,
                            p = t._vB,
                            f = t._vC,
                            h = t._intersectionPoint;
                        u.fromBufferAttribute(o, a), p.fromBufferAttribute(o, s), f.fromBufferAttribute(o, l);
                        var d = this.checkIntersection(e, n, r, u, p, f, h);
                        if (d) {
                            if (i) {
                                var m = t._uvA,
                                    y = t._uvB,
                                    v = t._uvC;
                                m.fromBufferAttribute(i, a), y.fromBufferAttribute(i, s), v.fromBufferAttribute(i, l), d.uv = this.uvIntersection(h, u, p, f, m, y, v)
                            }
                            var _ = new c.Vector3;
                            c.Triangle.getNormal(u, p, f, _), d.face = new c.Face3(a, s, l, _), d.faceIndex = a
                        }
                        return d
                    }
                }, {
                    key: "raycast",
                    value: function(e, t) {
                        var n = e.ray;
                        if (null === this.boundingSphere && this.computeBoundingSphere(), !1 !== e.ray.intersectsSphere(this.boundingSphere) && (null === this.boundingBox || !1 !== n.intersectsBox(this.boundingBox))) {
                            var r, o, i, a = this.index,
                                s = this.attributes,
                                l = s.position,
                                c = s.uv;
                            if (null !== a)
                                for (var u = 0, p = a.count; u < p; u += 3) {
                                    r = a.getX(u), o = a.getX(u + 1), i = a.getX(u + 2);
                                    var f = this.checkBufferGeometryIntersection(this, e, n, l, c, r, o, i);
                                    f && (f.faceIndex = Math.floor(u / 3), t.push(f))
                                }
                        }
                    }
                }]) && So(n.prototype, r), o && So(n, o), t
            }();
            Oo(Ao, "_vA", new c.Vector3), Oo(Ao, "_vB", new c.Vector3), Oo(Ao, "_vC", new c.Vector3), Oo(Ao, "_uvA", new c.Vector2), Oo(Ao, "_uvB", new c.Vector2), Oo(Ao, "_uvC", new c.Vector2), Oo(Ao, "_barycoord", new c.Vector3), Oo(Ao, "_intersectionPoint", new c.Vector3);
            var To = Ao;

            function ko(e) {
                return (ko = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ro(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Io(e, t) {
                return !t || "object" !== ko(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Mo(e, t, n) {
                return (Mo = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = No(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function No(e) {
                return (No = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Lo(e, t) {
                return (Lo = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var jo = new c.Color,
                Do = function(e) {
                    function t(e, n) {
                        var r;
                        if (function(e, t) {
                                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                            }(this, t), (r = Io(this, No(t).call(this))).constructor === t) throw new Error("Can not instantiate abstract class!");
                        return r._chunkGeo = e, r._init(e, n), r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Lo(e, t)
                    }(t, To), n = t, (r = [{
                        key: "startUpdate",
                        value: function() {
                            return !0
                        }
                    }, {
                        key: "finishUpdate",
                        value: function() {
                            this.getAttribute("position").needsUpdate = !0, this.getAttribute("normal").needsUpdate = !0, this.getAttribute("color").needsUpdate = !0
                        }
                    }, {
                        key: "setColor",
                        value: function(e, t) {
                            jo.set(t);
                            for (var n = this._colors, r = this._chunkSize, o = e * r, i = o + r; o < i; ++o) {
                                var a = 3 * o;
                                n[a] = jo.r, n[a + 1] = jo.g, n[a + 2] = jo.b
                            }
                        }
                    }, {
                        key: "finalize",
                        value: function() {
                            this.finishUpdate(), this.computeBoundingSphere()
                        }
                    }, {
                        key: "setOpacity",
                        value: function(e, t) {
                            for (var n = this._alpha, r = this._chunkSize, o = 0, i = e.length; o < i; ++o) {
                                var a = e[o] * r;
                                l.a.fill(n, t, a, a + r)
                            }
                            this.getAttribute("alphaColor").needsUpdate = !0
                        }
                    }, {
                        key: "raycast",
                        value: function(e, n) {
                            var r = [];
                            Mo(No(t.prototype), "raycast", this).call(this, e, r);
                            for (var o = this._chunkGeo.index.count / 3, i = 0, a = r.length; i < a; ++i) r[i].hasOwnProperty("faceIndex") && (r[i].chunkIdx = Math.floor(r[i].faceIndex / o), n.push(r[i]))
                        }
                    }, {
                        key: "getSubset",
                        value: function(e) {
                            var t = e.length,
                                n = new c.BufferGeometry;
                            this._init.call(n, this._chunkGeo, t);
                            for (var r = this._positions, o = this._normals, i = this._colors, a = n._positions, s = n._normals, l = n._colors, u = 3 * this._chunkSize, p = 0, f = e.length; p < f; ++p) {
                                var h = p * u,
                                    d = e[p] * u,
                                    m = d + u;
                                a.set(r.subarray(d, m), h), s.set(o.subarray(d, m), h), l.set(i.subarray(d, m), h)
                            }
                            return n.boundingSphere = this.boundingSphere, n.boundingBox = this.boundingBox, [n]
                        }
                    }, {
                        key: "_init",
                        value: function(e, t) {
                            var n = this._chunkSize = e.attributes.position.count,
                                r = e.index.array,
                                o = r.length,
                                i = this._chunkSize * t,
                                a = i > 65535,
                                s = o * t,
                                u = this._index = R.allocateTyped(a ? Uint32Array : Uint16Array, s);
                            this._positions = R.allocateTyped(Float32Array, 3 * i), this._normals = R.allocateTyped(Float32Array, 3 * i), this._colors = R.allocateTyped(Float32Array, 3 * i);
                            var p = this._alpha = R.allocateTyped(Float32Array, i);
                            l.a.fill(p, 1);
                            for (var f = 0; f < t; ++f) {
                                var h = f * o,
                                    d = f * n;
                                u.set(r, h);
                                for (var m = 0; m < o; ++m) u[h + m] += d
                            }
                            this.setIndex(new c.BufferAttribute(this._index, 1)), this.addAttribute("position", new c.BufferAttribute(this._positions, 3)), this.addAttribute("normal", new c.BufferAttribute(this._normals, 3)), this.addAttribute("color", new c.BufferAttribute(this._colors, 3)), this.addAttribute("alphaColor", new c.BufferAttribute(p, 1))
                        }
                    }]) && Ro(n.prototype, r), o && Ro(n, o), t
                }();

            function Vo(e) {
                return (Vo = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Fo(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Bo(e, t) {
                return !t || "object" !== Vo(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function zo(e) {
                return (zo = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Uo(e, t) {
                return (Uo = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Go = 3,
                Ho = function(e) {
                    function t(e, n) {
                        var r;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t);
                        var o = new c.SphereBufferGeometry(1, 2 * n, n, 0, 2 * Math.PI, 0, Math.PI),
                            i = (r = Bo(this, zo(t).call(this, e, o, e)))._normals,
                            a = o.attributes.normal.array,
                            s = r._chunkSize;
                        r._chunkPos = r._chunkGeo.attributes.position.array, r._tmpPositions = R.allocateTyped(Float32Array, s * Go);
                        for (var l = 0; l < e; ++l) i.set(a, s * Go * l);
                        return r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Uo(e, t)
                    }(t, fo(Do)), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n) {
                            for (var r = this._tmpPositions, o = this._chunkSize, i = this._chunkPos, a = 0; a < o; ++a) {
                                var s = 3 * a;
                                r[s] = t.x + i[s] * n, r[s + 1] = t.y + i[s + 1] * n, r[s + 2] = t.z + i[s + 2] * n
                            }
                            this._positions.set(r, o * e * Go), this.setSphere(e, t, n)
                        }
                    }]) && Fo(n.prototype, r), o && Fo(n, o), t
                }();

            function Wo(e) {
                return (Wo = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function qo(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Yo(e, t) {
                return !t || "object" !== Wo(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Xo(e, t, n) {
                return (Xo = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = $o(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function $o(e) {
                return ($o = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ko(e, t) {
                return (Ko = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Zo = 3,
                Qo = new c.Vector3,
                Jo = new c.Vector3,
                ei = new c.Matrix3,
                ti = function(e) {
                    function t(e, n) {
                        var r;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t);
                        var o = new c.CylinderBufferGeometry(1, 1, 1, Math.max(3, n), 2, !0),
                            i = (r = Yo(this, $o(t).call(this, o, 2 * e)))._chunkSize;
                        return r._chunkPos = r._chunkGeo.attributes.position.array, r._chunkNorms = r._chunkGeo.attributes.normal.array, r._tmpVector = R.allocateTyped(Float32Array, i * Zo), r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Ko(e, t)
                    }(t, Do), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n, r) {
                            var o = this._chunkSize,
                                i = 2 * o * e * Zo,
                                a = i + o * Zo,
                                s = this._tmpVector,
                                l = this._chunkPos,
                                c = this._chunkNorms;
                            Qo.lerpVectors(t, n, .5);
                            var u, p = $r.calcCylinderMatrix(t, Qo, r);
                            ei.getNormalMatrix(p);
                            for (var f = 0; f < o; ++f) u = f * Zo, Jo.fromArray(l, u), Jo.applyMatrix4(p), Jo.toArray(s, u);
                            this._positions.set(s, i), Qo.sub(t);
                            for (var h = 0; h < o; ++h) s[u = h * Zo] += Qo.x, s[u + 1] += Qo.y, s[u + 2] += Qo.z;
                            this._positions.set(s, a);
                            for (var d = 0; d < o; ++d) u = d * Zo, Jo.fromArray(c, u), Jo.applyMatrix3(ei), Jo.toArray(s, u);
                            this._normals.set(s, i), this._normals.set(s, a)
                        }
                    }, {
                        key: "setColor",
                        value: function(e, n, r) {
                            var o = 2 * e;
                            Xo($o(t.prototype), "setColor", this).call(this, o, n);
                            var i = o + 1;
                            Xo($o(t.prototype), "setColor", this).call(this, i, r)
                        }
                    }]) && qo(n.prototype, r), o && qo(n, o), t
                }();

            function ni(e) {
                return (ni = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ri(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function oi(e, t) {
                return !t || "object" !== ni(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ii(e) {
                return (ii = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ai(e, t) {
                return (ai = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var si = 65536,
                li = 3,
                ci = function(e) {
                    function t(e, n, r, o, i, a) {
                        var s;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), s = oi(this, ii(t).call(this));
                        var l = 2 * Math.PI;
                        s.type = "CylinderBufferGeometry", s.parameters = {
                            radiusTop: e,
                            radiusBottom: n,
                            height: r,
                            radialSegments: o,
                            heightSegments: i,
                            openEnded: a
                        };
                        var u = !1 === a && e > 0,
                            p = !1 === a && n > 0,
                            f = (i + 1) * o + u * (o + 1) + p * (o + 1),
                            h = (2 * i + u + p) * o,
                            d = r / 2,
                            m = new c.BufferAttribute(R.allocateTyped(Float32Array, 3 * f), 3),
                            y = new c.BufferAttribute(R.allocateTyped(Float32Array, 3 * f), 3),
                            v = new c.Uint16BufferAttribute(R.allocateTyped(Uint16Array, h * li), 1),
                            _ = new c.BufferAttribute(R.allocateTyped(Float32Array, 2 * f), 2);
                        console.assert(f < si, "DEBUG: Cylinder Geometry has too many vertices (65536 max).");
                        for (var g = 0, b = 0, w = -(n - e) / r, x = 0; x <= i; x++) {
                            if (x !== i)
                                for (var S = 0; S < o; S++) {
                                    var C = g + S,
                                        P = g + o + S,
                                        E = g + o + (S + 1) % o,
                                        O = g + (S + 1) % o;
                                    v.setXYZ(b * li, C, O, P), b++, v.setXYZ(b * li, P, O, E), b++
                                }
                            for (var A = x / i, T = A * (n - e) + e, k = 0; k < o; k++) {
                                var I = k / o,
                                    M = T * Math.sin(I * l + 0),
                                    N = A * r - d,
                                    L = T * Math.cos(I * l + 0),
                                    j = new c.Vector3(M, Math.sqrt(M * M + L * L) * w, L).normalize();
                                m.setXYZ(g, M, N, L), y.setXYZ(g, j.x, j.y, j.z), _.setXY(g, I, A), ++g
                            }
                        }
                        if (u) {
                            for (var D = g, V = g + o, F = 0; F < o; ++F) {
                                var B = g - o;
                                m.setXYZ(g, m.getX(B), m.getY(B), m.getZ(B)), y.setXYZ(g, 0, 1, 0), _.setXY(g, 1, 1);
                                var z = D + (F + 1) % o;
                                v.setXYZ(b * li, g, z, V), b++, g++
                            }
                            m.setXYZ(g, 0, d, 0), y.setXYZ(g, 0, 1, 0), _.setXY(g, 1, 1), ++g
                        }
                        if (p) {
                            for (var U = g, G = g + o, H = 0; H < o; ++H) {
                                var W = H;
                                m.setXYZ(g, m.getX(W), m.getY(W), m.getZ(W)), y.setXYZ(g, 0, -1, 0), _.setXY(g, 0, 0);
                                var q = U + (H + 1) % o;
                                v.setXYZ(b * li, q, g, G), b++, g++
                            }
                            m.setXYZ(g, 0, -d, 0), y.setXYZ(g, 0, -1, 0), _.setXY(g, 0, 0)
                        }
                        return s.setIndex(v), s.addAttribute("position", m), s.addAttribute("normal", y), s.addAttribute("uv", _), s
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && ai(e, t)
                    }(t, c["BufferGeometry"]), n = t, (r = [{
                        key: "clone",
                        value: function() {
                            var e = this.parameters;
                            return new t(e.radiusTop, e.radiusBottom, e.height, e.radialSegments, e.heightSegments, e.openEnded)
                        }
                    }]) && ri(n.prototype, r), o && ri(n, o), t
                }();

            function ui(e) {
                return (ui = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function pi(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function fi(e, t) {
                return !t || "object" !== ui(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function hi(e) {
                return (hi = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function di(e, t) {
                return (di = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var mi = new c.Color,
                yi = new c.Matrix4,
                vi = 3,
                _i = R.copySubArrays;

            function gi(e, t, n, r, o) {
                e[t] = n, e[t + 1] = r, e[t + 2] = o
            }

            function bi(e, t, n, r, o, i) {
                e[t] = n, e[t + 1] = r, e[t + 2] = o, e[t + 3] = i
            }

            function wi(e, t) {
                return e - t
            }
            var xi = function(e) {
                function t(e, n, r, o) {
                    var i;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (i = fi(this, hi(t).call(this)))._useZSprites = r, i._cylGeometry = r ? new c.PlaneBufferGeometry(2, 2, 1, 1) : new ci(1, 1, 1, Math.max(3, n), 2, o), i._init(e, i._cylGeometry, i._useZSprites), i._collisionGeo = new ti(e, 3), i
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && di(e, t)
                }(t, c["InstancedBufferGeometry"]), n = t, (r = [{
                    key: "setItem",
                    value: function(e, t, n, r) {
                        var o = $r.calcCylinderMatrix(t, n, r),
                            i = o.elements,
                            a = 4 * e;
                        this._collisionGeo.setItem(e, t, n, r), bi(this._matVector1, a, i[0], i[4], i[8], i[12]), bi(this._matVector2, a, i[1], i[5], i[9], i[13]), bi(this._matVector3, a, i[2], i[6], i[10], i[14]), this._useZSprites && (yi.getInverse(o), i = yi.elements, bi(this._invmatVector1, a, i[0], i[4], i[8], i[12]), bi(this._invmatVector2, a, i[1], i[5], i[9], i[13]), bi(this._invmatVector3, a, i[2], i[6], i[10], i[14]))
                    }
                }, {
                    key: "setColor",
                    value: function(e, t, n) {
                        var r = e * vi;
                        mi.set(t), gi(this._color1, r, mi.r, mi.g, mi.b), mi.set(n), gi(this._color2, r, mi.r, mi.g, mi.b)
                    }
                }, {
                    key: "computeBoundingSphere",
                    value: function() {
                        this._collisionGeo.computeBoundingSphere(), this.boundingSphere = this._collisionGeo.boundingSphere
                    }
                }, {
                    key: "computeBoundingBox",
                    value: function() {
                        this._collisionGeo.computeBoundingBox(), this.boundingBox = this._collisionGeo.boundingBox
                    }
                }, {
                    key: "raycast",
                    value: function(e, t) {
                        this._collisionGeo.raycast(e, t)
                    }
                }, {
                    key: "startUpdate",
                    value: function() {
                        return !0
                    }
                }, {
                    key: "finishUpdate",
                    value: function() {
                        this.getAttribute("matVector1").needsUpdate = !0, this.getAttribute("matVector2").needsUpdate = !0, this.getAttribute("matVector3").needsUpdate = !0, this.getAttribute("color").needsUpdate = !0, this.getAttribute("color2").needsUpdate = !0, this.getAttribute("alphaColor").needsUpdate = !0, this._useZSprites && (this.getAttribute("invmatVector1").needsUpdate = !0, this.getAttribute("invmatVector2").needsUpdate = !0, this.getAttribute("invmatVector3").needsUpdate = !0), this._collisionGeo.finishUpdate()
                    }
                }, {
                    key: "finalize",
                    value: function() {
                        this.finishUpdate(), this.computeBoundingSphere()
                    }
                }, {
                    key: "setOpacity",
                    value: function(e, t) {
                        for (var n = this._alpha, r = 0, o = e.length; r < o; ++r) n[Math.floor(e[r] / 2)] = t;
                        this.getAttribute("alphaColor").needsUpdate = !0
                    }
                }, {
                    key: "getSubset",
                    value: function(e) {
                        var t = function(e) {
                                e.sort(wi);
                                for (var t = [], n = [], r = 0, o = e.length; r < o; ++r) {
                                    var i = e[r],
                                        a = {
                                            first: !1,
                                            second: !1
                                        };
                                    (0 | i) % 2 == 0 ? (a.first = !0, a.second = r + 1 < o && e[r + 1] === e[r] + 1, a.second && ++r) : a.second = !0, t.push(Math.floor(i / 2)), n.push(a)
                                }
                                return {
                                    indices: t,
                                    cylinderInfo: n
                                }
                            }(e),
                            n = t.indices,
                            r = n.length,
                            o = new c.InstancedBufferGeometry;
                        return this._init.call(o, r, this._cylGeometry, this._useZSprites), _i(this._matVector1, o._matVector1, n, 4), _i(this._matVector2, o._matVector2, n, 4), _i(this._matVector3, o._matVector3, n, 4), this._useZSprites && (_i(this._invmatVector1, o._invmatVector1, n, 4), _i(this._invmatVector2, o._invmatVector2, n, 4), _i(this._invmatVector3, o._invmatVector3, n, 4)), _i(this._color1, o._color1, n, vi), _i(this._color2, o._color2, n, vi),
                            function(e, t, n) {
                                for (var r = 0, o = e.length; r < o; ++r) {
                                    var i = e[r];
                                    i.first || (t[vi * r] = -.5), i.second || (n[vi * r] = -.5)
                                }
                            }(t.cylinderInfo, o._color1, o._color2), o.boundingSphere = this.boundingSphere, o.boundingBox = this.boundingBox, [o]
                    }
                }, {
                    key: "_init",
                    value: function(e, t, n) {
                        this.copy(t), this._matVector1 = R.allocateTyped(Float32Array, 4 * e), this._matVector2 = R.allocateTyped(Float32Array, 4 * e), this._matVector3 = R.allocateTyped(Float32Array, 4 * e), this._color1 = R.allocateTyped(Float32Array, e * vi), this._color2 = R.allocateTyped(Float32Array, e * vi);
                        var r = this._alpha = R.allocateTyped(Float32Array, e);
                        l.a.fill(r, 1), this.addAttribute("matVector1", new c.InstancedBufferAttribute(this._matVector1, 4, !1, 1)), this.addAttribute("matVector2", new c.InstancedBufferAttribute(this._matVector2, 4, !1, 1)), this.addAttribute("matVector3", new c.InstancedBufferAttribute(this._matVector3, 4, !1, 1)), this.addAttribute("color", new c.InstancedBufferAttribute(this._color1, vi, !1, 1)), this.addAttribute("color2", new c.InstancedBufferAttribute(this._color2, vi, !1, 1)), this.addAttribute("alphaColor", new c.InstancedBufferAttribute(this._alpha, 1, !1, 1)), n && (this._invmatVector1 = R.allocateTyped(Float32Array, 4 * e), this._invmatVector2 = R.allocateTyped(Float32Array, 4 * e), this._invmatVector3 = R.allocateTyped(Float32Array, 4 * e), this.addAttribute("invmatVector1", new c.InstancedBufferAttribute(this._invmatVector1, 4, !1, 1)), this.addAttribute("invmatVector2", new c.InstancedBufferAttribute(this._invmatVector2, 4, !1, 1)), this.addAttribute("invmatVector3", new c.InstancedBufferAttribute(this._invmatVector3, 4, !1, 1)))
                    }
                }]) && pi(n.prototype, r), o && pi(n, o), t
            }();

            function Si(e) {
                return (Si = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ci(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Pi(e, t) {
                return !t || "object" !== Si(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ei(e) {
                return (Ei = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Oi(e, t) {
                return (Oi = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ai = 3,
                Ti = 3,
                ki = new c.Vector3,
                Ri = new c.Vector3;
            var Ii = function(e) {
                function t(e, n, r) {
                    var o;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t);
                    var i = function(e, t) {
                        for (var n = new c.BufferGeometry, r = e.length, o = r * t, i = o <= 65536 ? Uint16Array : Uint32Array, a = (t - 1) * r * 2, s = new c.BufferAttribute(R.allocateTyped(i, a * Ti), 1), l = 0, u = 0, p = 0; p < t; p++) {
                            if (p !== t - 1)
                                for (var f = 0; f < r; f++) {
                                    var h = l + f,
                                        d = l + r + f,
                                        m = l + r + (f + 1) % r,
                                        y = l + (f + 1) % r;
                                    s.setXYZ(u * Ti, h, y, d), u++, s.setXYZ(u * Ti, d, y, m), u++
                                }
                            l += r
                        }
                        n.setIndex(s);
                        var v = R.allocateTyped(Float32Array, o * Ai);
                        return n.addAttribute("position", new c.BufferAttribute(v, Ai)), n._positions = e, n
                    }(e, n);
                    (o = Pi(this, Ei(t).call(this, i, r)))._ringsCount = n;
                    for (var a = o._tmpShape = [], s = 0; s < e.length; ++s) a[s] = new c.Vector3;
                    return o
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Oi(e, t)
                }(t, Do), n = t, (r = [{
                    key: "setItem",
                    value: function(e, t) {
                        for (var n = this._chunkGeo._positions, r = n.length, o = 0, i = r * this._ringsCount * e * Ai, a = this._positions, s = this._normals, l = this._tmpShape, c = 0, u = t.length; c < u; ++c) {
                            for (var p = t[c], f = 0; f < r; ++f) l[f].copy(n[f]).applyMatrix4(p);
                            for (var h = 0; h < r; ++h) {
                                var d = l[h],
                                    m = l[(h + 1) % r],
                                    y = l[(h + r - 1) % r],
                                    v = i + o;
                                a[v] = d.x, a[v + 1] = d.y, a[v + 2] = d.z, ki.subVectors(d, y).normalize(), Ri.subVectors(d, m).normalize(), ki.add(Ri).normalize(), s[v] = ki.x, s[v + 1] = ki.y, s[v + 2] = ki.z, o += Ai
                            }
                        }
                    }
                }]) && Ci(n.prototype, r), o && Ci(n, o), t
            }();

            function Mi(e) {
                return (Mi = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ni(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Li(e, t) {
                return !t || "object" !== Mi(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ji(e) {
                return (ji = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Di(e, t) {
                return (Di = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Vi = 4,
                Fi = new c.Color,
                Bi = new c.Vector3;

            function zi(e, t, n, r, o) {
                e[t] = n, e[t + 1] = r, e[t + 2] = o
            }

            function Ui(e, t, n, r, o, i) {
                e[t] = n, e[t + 1] = r, e[t + 2] = o, e[t + 3] = i
            }

            function Gi(e, t, n, r) {
                var o = t * Vi,
                    i = o + n * Vi;
                return e.subarray(o * r, i * r)
            }
            var Hi = function(e) {
                function t(e) {
                    var n;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = Li(this, ji(t).call(this)))._initVertices(e), n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Di(e, t)
                }(t, c["BufferGeometry"]), n = t, (r = [{
                    key: "startUpdate",
                    value: function() {
                        return !0
                    }
                }, {
                    key: "finishUpdate",
                    value: function() {
                        this.getAttribute("position").needsUpdate = !0, this.getAttribute("color").needsUpdate = !0, this.getAttribute("alphaColor").needsUpdate = !0, this.getAttribute("direction").needsUpdate = !0
                    }
                }, {
                    key: "setColor",
                    value: function(e, t) {
                        Fi.set(t);
                        var n = e * Vi * 3;
                        zi(this._colors, n, Fi.r, Fi.g, Fi.b), n += 3, zi(this._colors, n, Fi.r, Fi.g, Fi.b), n += 3, zi(this._colors, n, Fi.r, Fi.g, Fi.b), n += 3, zi(this._colors, n, Fi.r, Fi.g, Fi.b)
                    }
                }, {
                    key: "setSegment",
                    value: function(e, t, n) {
                        Bi.subVectors(t, n), Bi.normalize();
                        var r = this._positions,
                            o = this._directions,
                            i = e * Vi * 4,
                            a = e * Vi * 3;
                        Ui(r, i, t.x, t.y, t.z, .5), zi(o, a, Bi.x, Bi.y, Bi.z), a += 3, Ui(r, i += 4, t.x, t.y, t.z, -.5), zi(o, a, Bi.x, Bi.y, Bi.z), a += 3, Ui(r, i += 4, n.x, n.y, n.z, .5), zi(o, a, Bi.x, Bi.y, Bi.z), a += 3, Ui(r, i += 4, n.x, n.y, n.z, -.5), zi(o, a, Bi.x, Bi.y, Bi.z)
                    }
                }, {
                    key: "setOpacity",
                    value: function(e, t, n) {
                        var r = e * Vi,
                            o = t * Vi;
                        l.a.fill(this.alpha, n, o, r), this.getAttribute("alphaColor").needsUpdate = !0
                    }
                }, {
                    key: "getSubsetSegments",
                    value: function(e, t) {
                        return [Gi(this._positions, e, t, 4), Gi(this._directions, e, t, 3)]
                    }
                }, {
                    key: "getSubsetColors",
                    value: function(e, t) {
                        return Gi(this._colors, e, t, 3)
                    }
                }, {
                    key: "getSubsetOpacities",
                    value: function(e, t) {
                        return Gi(this._alpha, e, t, 1)
                    }
                }, {
                    key: "getNumVertexPerSegment",
                    value: function() {
                        return Vi
                    }
                }, {
                    key: "getPositionSize",
                    value: function() {
                        return 4
                    }
                }, {
                    key: "setSegments",
                    value: function(e, t) {
                        var n = e * Vi * 4;
                        if (t instanceof Array && 2 === t.length) {
                            this._positions.set(t[0], n);
                            var r = e * Vi * 3;
                            this._directions.set(t[1], r)
                        } else this._positions.set(t, n)
                    }
                }, {
                    key: "setColors",
                    value: function(e, t) {
                        var n = e * Vi * 3;
                        this._colors.set(t, n)
                    }
                }, {
                    key: "_initVertices",
                    value: function(e) {
                        this._buffersSize = e * Vi;
                        var t = this._buffersSize,
                            n = t > 65535;
                        this._index = R.allocateTyped(n ? Uint32Array : Uint16Array, 6 * e), this._positions = R.allocateTyped(Float32Array, 4 * t), this._colors = R.allocateTyped(Float32Array, 3 * t), this._directions = R.allocateTyped(Float32Array, 3 * t);
                        var r = this._alpha = R.allocateTyped(Float32Array, t);
                        l.a.fill(r, 1);
                        for (var o = this._index, i = 0, a = 0, s = 0; s < e; s++, i += 6, a += Vi) o[i] = a, o[i + 1] = a + 1, o[i + 2] = a + 3, o[i + 3] = a, o[i + 4] = a + 2, o[i + 5] = a + 3;
                        this.setIndex(new c.BufferAttribute(this._index, 1)), this.addAttribute("position", new c.BufferAttribute(this._positions, 4)), this.addAttribute("color", new c.BufferAttribute(this._colors, 3)), this.addAttribute("alphaColor", new c.BufferAttribute(r, 1)), this.addAttribute("direction", new c.BufferAttribute(this._directions, 3))
                    }
                }]) && Ni(n.prototype, r), o && Ni(n, o), t
            }();

            function Wi(e) {
                return (Wi = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function qi(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Yi(e, t) {
                return !t || "object" !== Wi(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Xi(e) {
                return (Xi = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function $i(e, t) {
                return ($i = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ki = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Yi(this, Xi(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && $i(e, t)
                }(t, Hi), n = t, (r = [{
                    key: "startUpdate",
                    value: function() {
                        return !0
                    }
                }, {
                    key: "computeBoundingSphere",
                    value: function() {
                        var e = this.boundingBox,
                            t = 0,
                            n = new c.Vector3;
                        e && e.getCenter(n);
                        for (var r = this._positions, o = this.boundingSphere || new c.Sphere, i = this._positions.length, a = new c.Vector3, s = this.getPositionSize(), l = 0; l < i; l += s) {
                            a.set(r[l], r[l + 1], r[l + 2]);
                            var u = n.distanceToSquared(a);
                            t < u && (t = u)
                        }
                        o.set(n, Math.sqrt(t)), this.boundingSphere = o
                    }
                }, {
                    key: "computeBoundingBox",
                    value: function() {
                        for (var e = this._positions, t = new c.Box3, n = this._positions.length, r = new c.Vector3, o = this.getPositionSize(), i = 0; i < n; i += o) r.set(e[i], e[i + 1], e[i + 2]), t.expandByPoint(r);
                        this.boundingBox = t
                    }
                }, {
                    key: "finalize",
                    value: function() {
                        this.finishUpdate(), this.computeBoundingSphere()
                    }
                }]) && qi(n.prototype, r), o && qi(n, o), t
            }();

            function Zi(e) {
                return (Zi = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Qi(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ji(e, t) {
                return !t || "object" !== Zi(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ea(e) {
                return (ea = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ta(e, t) {
                return (ta = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var na = 3,
                ra = new c.Vector3,
                oa = new c.Matrix3,
                ia = function(e) {
                    function t(e, n) {
                        var r;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t);
                        var o = new c.CylinderBufferGeometry(1, 1, 1, Math.max(3, n), 2, !0),
                            i = (r = Ji(this, ea(t).call(this, o, e)))._chunkSize;
                        return r._chunkPos = r._chunkGeo.attributes.position.array, r._chunkNorms = r._chunkGeo.attributes.normal.array, r._tmpVector = R.allocateTyped(Float32Array, i * na), r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && ta(e, t)
                    }(t, Do), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n, r) {
                            var o, i = this._chunkSize,
                                a = i * e * na,
                                s = this._tmpVector,
                                l = this._chunkPos,
                                c = this._chunkNorms,
                                u = $r.calcCylinderMatrix(t, n, r);
                            oa.getNormalMatrix(u);
                            for (var p = 0; p < i; ++p) o = p * na, ra.fromArray(l, o), ra.applyMatrix4(u), ra.toArray(s, o);
                            this._positions.set(s, a);
                            for (var f = 0; f < i; ++f) o = f * na, ra.fromArray(c, o), ra.applyMatrix3(oa), ra.toArray(s, o);
                            this._normals.set(s, a)
                        }
                    }]) && Qi(n.prototype, r), o && Qi(n, o), t
                }();

            function aa(e) {
                return (aa = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function sa(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function la(e, t) {
                return !t || "object" !== aa(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ca(e, t, n) {
                return (ca = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = ua(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function ua(e) {
                return (ua = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function pa(e, t) {
                return (pa = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var fa = function(e) {
                function t(e, n, r) {
                    var o;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (o = la(this, ua(t).call(this, e * n)))._init(n), o._collisionGeo = r ? new ia(e * n, 3) : null, o
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && pa(e, t)
                }(t, Ki), n = t, (r = [{
                    key: "startUpdate",
                    value: function() {
                        return !0
                    }
                }, {
                    key: "computeBoundingSphere",
                    value: function() {
                        var e = this._collisionGeo;
                        if (e) return e.computeBoundingSphere(), void(this.boundingSphere = e.boundingSphere);
                        ca(ua(t.prototype), "computeBoundingSphere", this).call(this)
                    }
                }, {
                    key: "computeBoundingBox",
                    value: function() {
                        var e = this._collisionGeo;
                        if (e) return e.computeBoundingBox(), void(this.boundingBox = e.boundingBox);
                        ca(ua(t.prototype), "computeBoundingBox", this).call(this)
                    }
                }, {
                    key: "raycast",
                    value: function(e, t) {
                        if (this._collisionGeo) {
                            var n = this._chunkSize;
                            this._collisionGeo.raycast(e, t);
                            for (var r = 0, o = t.length; r < o; ++r) {
                                var i = t[r].chunkIdx;
                                void 0 !== i && (i = i / n | 0, t[r].chunkIdx = i)
                            }
                        }
                    }
                }, {
                    key: "setColor",
                    value: function(e, n) {
                        for (var r = this._chunkSize, o = e * r, i = o + r; o < i; ++o) ca(ua(t.prototype), "setColor", this).call(this, o, n)
                    }
                }, {
                    key: "setSegment",
                    value: function(e, n, r, o) {
                        var i = this._chunkSize,
                            a = e * i + n;
                        ca(ua(t.prototype), "setSegment", this).call(this, a, r, o), this._collisionGeo && this._collisionGeo.setItem(e * i + n, r, o, .1)
                    }
                }, {
                    key: "finalize",
                    value: function() {
                        this.finishUpdate(), this.computeBoundingSphere()
                    }
                }, {
                    key: "setOpacity",
                    value: function(e, n) {
                        for (var r = this._chunkSize, o = 0, i = e.length; o < i; ++o) {
                            var a = e[o] * r;
                            ca(ua(t.prototype), "setOpacity", this).call(this, a, a + r - 1, n)
                        }
                    }
                }, {
                    key: "getSubset",
                    value: function(e) {
                        for (var n = e.length, r = this._chunkSize, o = new t(n, r, !1), i = 0, a = e.length; i < a; ++i) {
                            var s = i * r,
                                l = e[i] * r;
                            o.setSegments(s, this.getSubsetSegments(l, r)), o.setColors(s, this.getSubsetColors(l, r))
                        }
                        return o.boundingSphere = this.boundingSphere, o.boundingBox = this.boundingBox, [o]
                    }
                }, {
                    key: "_init",
                    value: function(e) {
                        this._chunkSize = e
                    }
                }]) && sa(n.prototype, r), o && sa(n, o), t
            }();

            function ha(e) {
                return (ha = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function da(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ma(e, t) {
                return !t || "object" !== ha(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ya(e, t, n) {
                return (ya = "undefined" != typeof Reflect && Reflect.get ? Reflect.get : function(e, t, n) {
                    var r = function(e, t) {
                        for (; !Object.prototype.hasOwnProperty.call(e, t) && null !== (e = va(e)););
                        return e
                    }(e, t);
                    if (r) {
                        var o = Object.getOwnPropertyDescriptor(r, t);
                        return o.get ? o.get.call(n) : o.value
                    }
                })(e, t, n || e)
            }

            function va(e) {
                return (va = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function _a(e, t) {
                return (_a = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var ga = new c.Vector3,
                ba = function(e) {
                    function t(e) {
                        var n;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (n = ma(this, va(t).call(this, 2 * e)))._init(e), n._collisionGeo = new ti(e, 3), n
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && _a(e, t)
                    }(t, Ki), n = t, (r = [{
                        key: "setItem",
                        value: function(e, n, r) {
                            this._collisionGeo.setItem(e, n, r, .3);
                            var o = 2 * e;
                            ga.lerpVectors(n, r, .5), ya(va(t.prototype), "setSegment", this).call(this, o, n, ga), ya(va(t.prototype), "setSegment", this).call(this, o + 1, ga, r)
                        }
                    }, {
                        key: "setColor",
                        value: function(e, n, r) {
                            var o = 2 * e;
                            ya(va(t.prototype), "setColor", this).call(this, o, n), ya(va(t.prototype), "setColor", this).call(this, o + 1, r)
                        }
                    }, {
                        key: "raycast",
                        value: function(e, t) {
                            this._collisionGeo && this._collisionGeo.raycast(e, t)
                        }
                    }, {
                        key: "getSubset",
                        value: function(e) {
                            for (var n = e.length, r = new t(n, !1), o = 0, i = n; o < i; ++o) {
                                var a = e[o];
                                r.setSegments(o, this.getSubsetSegments(a, 1)), r.setColors(o, this.getSubsetColors(a, 1))
                            }
                            return r.boundingSphere = this.boundingSphere, r.boundingBox = this.boundingBox, [r]
                        }
                    }, {
                        key: "_init",
                        value: function(e) {
                            this._segCounts = 2 * e
                        }
                    }]) && da(n.prototype, r), o && da(n, o), t
                }();

            function wa(e) {
                return (wa = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function xa(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Sa(e, t) {
                return !t || "object" !== wa(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ca(e) {
                return (Ca = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Pa(e, t) {
                return (Pa = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ea = [new c.Vector3(1, 0, 0), new c.Vector3(-1, 0, 0), new c.Vector3(0, 1, 0), new c.Vector3(0, -1, 0), new c.Vector3(0, 0, 1), new c.Vector3(0, 0, -1)],
                Oa = Ea.length,
                Aa = new c.Vector3,
                Ta = new c.Vector3,
                ka = function(e) {
                    function t(e) {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), Sa(this, Ca(t).call(this, e, e, Oa / 2 | 0, !1))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Pa(e, t)
                    }(t, fo(fa)), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n) {
                            this.setSphere(e, t, n);
                            for (var r = 0; r < Oa / 2; ++r) {
                                var o = 2 * r;
                                Aa.x = t.x + Ea[o].x * n, Aa.y = t.y + Ea[o].y * n, Aa.z = t.z + Ea[o].z * n;
                                var i = o + 1;
                                Ta.x = t.x + Ea[i].x * n, Ta.y = t.y + Ea[i].y * n, Ta.z = t.z + Ea[i].z * n, this.setSegment(e, r, Aa, Ta)
                            }
                        }
                    }]) && xa(n.prototype, r), o && xa(n, o), t
                }();

            function Ra(e) {
                return (Ra = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ia(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ma(e, t) {
                return !t || "object" !== Ra(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Na(e) {
                return (Na = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function La(e, t) {
                return (La = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var ja = 4,
                Da = 3,
                Va = new c.Color,
                Fa = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = Ma(this, Na(t).call(this)))._opts = n, r.zClip = r._opts.zClip, r._posRad = R.allocateTyped(Float32Array, e * ja), r._colors = R.allocateTyped(Float32Array, e * Da), r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && La(e, t)
                    }(t, To), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n) {
                            var r = this._posRad,
                                o = ja * e;
                            r[o++] = t.x, r[o++] = t.y, r[o++] = t.z, r[o] = n
                        }
                    }, {
                        key: "setColor",
                        value: function(e, t) {
                            Va.set(t);
                            var n = this._colors,
                                r = Da * e;
                            n[r++] = Va.r, n[r++] = Va.g, n[r] = Va.b
                        }
                    }, {
                        key: "finalize",
                        value: function() {
                            this.finishUpdate(), this.computeBoundingSphere()
                        }
                    }, {
                        key: "finishUpdate",
                        value: function() {
                            this._build()
                        }
                    }, {
                        key: "setOpacity",
                        value: function() {}
                    }, {
                        key: "raycast",
                        value: function() {}
                    }, {
                        key: "getSubset",
                        value: function() {
                            return []
                        }
                    }]) && Ia(n.prototype, r), o && Ia(n, o), t
                }();

            function Ba(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var za = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this.pointsValuesLinear = null, this.hasIntersection = null, this.bitsInside = null
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "create",
                    value: function(e) {
                        var t = e * e * e;
                        if (t > 117440512) throw new Error("Too large cube dimension: lead to memory huge uasge");
                        return this.pointsValuesLinear = R.allocateTyped(Float32Array, 32 * t), this.hasIntersection = R.allocateTyped(Int32Array, t), this.bitsInside = R.allocateTyped(Int32Array, t), 0
                    }
                }, {
                    key: "destroy",
                    value: function() {
                        this.bitsInside = null, this.hasIntersection = null, this.pointsValuesLinear = null
                    }
                }]) && Ba(t.prototype, n), r && Ba(t, r), e
            }();
            za.prototype.striIndicesMarchCube = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 8, 3, 9, 8, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 2, 10, 0, 2, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 8, 3, 2, 10, 8, 10, 9, 8, -1, -1, -1, -1, -1, -1, -1, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 11, 2, 8, 11, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 11, 2, 1, 9, 11, 9, 8, 11, -1, -1, -1, -1, -1, -1, -1, 3, 10, 1, 11, 10, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 10, 1, 0, 8, 10, 8, 11, 10, -1, -1, -1, -1, -1, -1, -1, 3, 9, 0, 3, 11, 9, 11, 10, 9, -1, -1, -1, -1, -1, -1, -1, 9, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 3, 0, 7, 3, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 1, 9, 4, 7, 1, 7, 3, 1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 7, 3, 0, 4, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, 9, 2, 10, 9, 0, 2, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, 2, 10, 9, 2, 9, 7, 2, 7, 3, 7, 9, 4, -1, -1, -1, -1, 8, 4, 7, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 4, 7, 11, 2, 4, 2, 0, 4, -1, -1, -1, -1, -1, -1, -1, 9, 0, 1, 8, 4, 7, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, 4, 7, 11, 9, 4, 11, 9, 11, 2, 9, 2, 1, -1, -1, -1, -1, 3, 10, 1, 3, 11, 10, 7, 8, 4, -1, -1, -1, -1, -1, -1, -1, 1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 4, -1, -1, -1, -1, 4, 7, 8, 9, 0, 11, 9, 11, 10, 11, 0, 3, -1, -1, -1, -1, 4, 7, 11, 4, 11, 9, 9, 11, 10, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 5, 4, 1, 5, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 5, 4, 8, 3, 5, 3, 1, 5, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 0, 8, 1, 2, 10, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1, 5, 2, 10, 5, 4, 2, 4, 0, 2, -1, -1, -1, -1, -1, -1, -1, 2, 10, 5, 3, 2, 5, 3, 5, 4, 3, 4, 8, -1, -1, -1, -1, 9, 5, 4, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 11, 2, 0, 8, 11, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1, 0, 5, 4, 0, 1, 5, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, 2, 1, 5, 2, 5, 8, 2, 8, 11, 4, 8, 5, -1, -1, -1, -1, 10, 3, 11, 10, 1, 3, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, 4, 9, 5, 0, 8, 1, 8, 10, 1, 8, 11, 10, -1, -1, -1, -1, 5, 4, 0, 5, 0, 11, 5, 11, 10, 11, 0, 3, -1, -1, -1, -1, 5, 4, 8, 5, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, 9, 7, 8, 5, 7, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 3, 0, 9, 5, 3, 5, 7, 3, -1, -1, -1, -1, -1, -1, -1, 0, 7, 8, 0, 1, 7, 1, 5, 7, -1, -1, -1, -1, -1, -1, -1, 1, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 7, 8, 9, 5, 7, 10, 1, 2, -1, -1, -1, -1, -1, -1, -1, 10, 1, 2, 9, 5, 0, 5, 3, 0, 5, 7, 3, -1, -1, -1, -1, 8, 0, 2, 8, 2, 5, 8, 5, 7, 10, 5, 2, -1, -1, -1, -1, 2, 10, 5, 2, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, 7, 9, 5, 7, 8, 9, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, 9, 5, 7, 9, 7, 2, 9, 2, 0, 2, 7, 11, -1, -1, -1, -1, 2, 3, 11, 0, 1, 8, 1, 7, 8, 1, 5, 7, -1, -1, -1, -1, 11, 2, 1, 11, 1, 7, 7, 1, 5, -1, -1, -1, -1, -1, -1, -1, 9, 5, 8, 8, 5, 7, 10, 1, 3, 10, 3, 11, -1, -1, -1, -1, 5, 7, 0, 5, 0, 9, 7, 11, 0, 1, 0, 10, 11, 10, 0, -1, 11, 10, 0, 11, 0, 3, 10, 5, 0, 8, 0, 7, 5, 7, 0, -1, 11, 10, 5, 7, 11, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 0, 1, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 8, 3, 1, 9, 8, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, 1, 6, 5, 2, 6, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 6, 5, 1, 2, 6, 3, 0, 8, -1, -1, -1, -1, -1, -1, -1, 9, 6, 5, 9, 0, 6, 0, 2, 6, -1, -1, -1, -1, -1, -1, -1, 5, 9, 8, 5, 8, 2, 5, 2, 6, 3, 2, 8, -1, -1, -1, -1, 2, 3, 11, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 0, 8, 11, 2, 0, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, 5, 10, 6, 1, 9, 2, 9, 11, 2, 9, 8, 11, -1, -1, -1, -1, 6, 3, 11, 6, 5, 3, 5, 1, 3, -1, -1, -1, -1, -1, -1, -1, 0, 8, 11, 0, 11, 5, 0, 5, 1, 5, 11, 6, -1, -1, -1, -1, 3, 11, 6, 0, 3, 6, 0, 6, 5, 0, 5, 9, -1, -1, -1, -1, 6, 5, 9, 6, 9, 11, 11, 9, 8, -1, -1, -1, -1, -1, -1, -1, 5, 10, 6, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 3, 0, 4, 7, 3, 6, 5, 10, -1, -1, -1, -1, -1, -1, -1, 1, 9, 0, 5, 10, 6, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, 10, 6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 4, -1, -1, -1, -1, 6, 1, 2, 6, 5, 1, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, 1, 2, 5, 5, 2, 6, 3, 0, 4, 3, 4, 7, -1, -1, -1, -1, 8, 4, 7, 9, 0, 5, 0, 6, 5, 0, 2, 6, -1, -1, -1, -1, 7, 3, 9, 7, 9, 4, 3, 2, 9, 5, 9, 6, 2, 6, 9, -1, 3, 11, 2, 7, 8, 4, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, 5, 10, 6, 4, 7, 2, 4, 2, 0, 2, 7, 11, -1, -1, -1, -1, 0, 1, 9, 4, 7, 8, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, 9, 2, 1, 9, 11, 2, 9, 4, 11, 7, 11, 4, 5, 10, 6, -1, 8, 4, 7, 3, 11, 5, 3, 5, 1, 5, 11, 6, -1, -1, -1, -1, 5, 1, 11, 5, 11, 6, 1, 0, 11, 7, 11, 4, 0, 4, 11, -1, 0, 5, 9, 0, 6, 5, 0, 3, 6, 11, 6, 3, 8, 4, 7, -1, 6, 5, 9, 6, 9, 11, 4, 7, 9, 7, 11, 9, -1, -1, -1, -1, 10, 4, 9, 6, 4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 10, 6, 4, 9, 10, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, 10, 0, 1, 10, 6, 0, 6, 4, 0, -1, -1, -1, -1, -1, -1, -1, 8, 3, 1, 8, 1, 6, 8, 6, 4, 6, 1, 10, -1, -1, -1, -1, 1, 4, 9, 1, 2, 4, 2, 6, 4, -1, -1, -1, -1, -1, -1, -1, 3, 0, 8, 1, 2, 9, 2, 4, 9, 2, 6, 4, -1, -1, -1, -1, 0, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 3, 2, 8, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, 10, 4, 9, 10, 6, 4, 11, 2, 3, -1, -1, -1, -1, -1, -1, -1, 0, 8, 2, 2, 8, 11, 4, 9, 10, 4, 10, 6, -1, -1, -1, -1, 3, 11, 2, 0, 1, 6, 0, 6, 4, 6, 1, 10, -1, -1, -1, -1, 6, 4, 1, 6, 1, 10, 4, 8, 1, 2, 1, 11, 8, 11, 1, -1, 9, 6, 4, 9, 3, 6, 9, 1, 3, 11, 6, 3, -1, -1, -1, -1, 8, 11, 1, 8, 1, 0, 11, 6, 1, 9, 1, 4, 6, 4, 1, -1, 3, 11, 6, 3, 6, 0, 0, 6, 4, -1, -1, -1, -1, -1, -1, -1, 6, 4, 8, 11, 6, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 10, 6, 7, 8, 10, 8, 9, 10, -1, -1, -1, -1, -1, -1, -1, 0, 7, 3, 0, 10, 7, 0, 9, 10, 6, 7, 10, -1, -1, -1, -1, 10, 6, 7, 1, 10, 7, 1, 7, 8, 1, 8, 0, -1, -1, -1, -1, 10, 6, 7, 10, 7, 1, 1, 7, 3, -1, -1, -1, -1, -1, -1, -1, 1, 2, 6, 1, 6, 8, 1, 8, 9, 8, 6, 7, -1, -1, -1, -1, 2, 6, 9, 2, 9, 1, 6, 7, 9, 0, 9, 3, 7, 3, 9, -1, 7, 8, 0, 7, 0, 6, 6, 0, 2, -1, -1, -1, -1, -1, -1, -1, 7, 3, 2, 6, 7, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 3, 11, 10, 6, 8, 10, 8, 9, 8, 6, 7, -1, -1, -1, -1, 2, 0, 7, 2, 7, 11, 0, 9, 7, 6, 7, 10, 9, 10, 7, -1, 1, 8, 0, 1, 7, 8, 1, 10, 7, 6, 7, 10, 2, 3, 11, -1, 11, 2, 1, 11, 1, 7, 10, 6, 1, 6, 7, 1, -1, -1, -1, -1, 8, 9, 6, 8, 6, 7, 9, 1, 6, 11, 6, 3, 1, 3, 6, -1, 0, 9, 1, 11, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 8, 0, 7, 0, 6, 3, 11, 0, 11, 6, 0, -1, -1, -1, -1, 7, 11, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 0, 8, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 1, 9, 8, 3, 1, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, 10, 1, 2, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 3, 0, 8, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, 2, 9, 0, 2, 10, 9, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, 6, 11, 7, 2, 10, 3, 10, 8, 3, 10, 9, 8, -1, -1, -1, -1, 7, 2, 3, 6, 2, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 0, 8, 7, 6, 0, 6, 2, 0, -1, -1, -1, -1, -1, -1, -1, 2, 7, 6, 2, 3, 7, 0, 1, 9, -1, -1, -1, -1, -1, -1, -1, 1, 6, 2, 1, 8, 6, 1, 9, 8, 8, 7, 6, -1, -1, -1, -1, 10, 7, 6, 10, 1, 7, 1, 3, 7, -1, -1, -1, -1, -1, -1, -1, 10, 7, 6, 1, 7, 10, 1, 8, 7, 1, 0, 8, -1, -1, -1, -1, 0, 3, 7, 0, 7, 10, 0, 10, 9, 6, 10, 7, -1, -1, -1, -1, 7, 6, 10, 7, 10, 8, 8, 10, 9, -1, -1, -1, -1, -1, -1, -1, 6, 8, 4, 11, 8, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 6, 11, 3, 0, 6, 0, 4, 6, -1, -1, -1, -1, -1, -1, -1, 8, 6, 11, 8, 4, 6, 9, 0, 1, -1, -1, -1, -1, -1, -1, -1, 9, 4, 6, 9, 6, 3, 9, 3, 1, 11, 3, 6, -1, -1, -1, -1, 6, 8, 4, 6, 11, 8, 2, 10, 1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 3, 0, 11, 0, 6, 11, 0, 4, 6, -1, -1, -1, -1, 4, 11, 8, 4, 6, 11, 0, 2, 9, 2, 10, 9, -1, -1, -1, -1, 10, 9, 3, 10, 3, 2, 9, 4, 3, 11, 3, 6, 4, 6, 3, -1, 8, 2, 3, 8, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, 0, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 9, 0, 2, 3, 4, 2, 4, 6, 4, 3, 8, -1, -1, -1, -1, 1, 9, 4, 1, 4, 2, 2, 4, 6, -1, -1, -1, -1, -1, -1, -1, 8, 1, 3, 8, 6, 1, 8, 4, 6, 6, 10, 1, -1, -1, -1, -1, 10, 1, 0, 10, 0, 6, 6, 0, 4, -1, -1, -1, -1, -1, -1, -1, 4, 6, 3, 4, 3, 8, 6, 10, 3, 0, 3, 9, 10, 9, 3, -1, 10, 9, 4, 6, 10, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 9, 5, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 4, 9, 5, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, 5, 0, 1, 5, 4, 0, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, 11, 7, 6, 8, 3, 4, 3, 5, 4, 3, 1, 5, -1, -1, -1, -1, 9, 5, 4, 10, 1, 2, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, 6, 11, 7, 1, 2, 10, 0, 8, 3, 4, 9, 5, -1, -1, -1, -1, 7, 6, 11, 5, 4, 10, 4, 2, 10, 4, 0, 2, -1, -1, -1, -1, 3, 4, 8, 3, 5, 4, 3, 2, 5, 10, 5, 2, 11, 7, 6, -1, 7, 2, 3, 7, 6, 2, 5, 4, 9, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, 0, 8, 6, 0, 6, 2, 6, 8, 7, -1, -1, -1, -1, 3, 6, 2, 3, 7, 6, 1, 5, 0, 5, 4, 0, -1, -1, -1, -1, 6, 2, 8, 6, 8, 7, 2, 1, 8, 4, 8, 5, 1, 5, 8, -1, 9, 5, 4, 10, 1, 6, 1, 7, 6, 1, 3, 7, -1, -1, -1, -1, 1, 6, 10, 1, 7, 6, 1, 0, 7, 8, 7, 0, 9, 5, 4, -1, 4, 0, 10, 4, 10, 5, 0, 3, 10, 6, 10, 7, 3, 7, 10, -1, 7, 6, 10, 7, 10, 8, 5, 4, 10, 4, 8, 10, -1, -1, -1, -1, 6, 9, 5, 6, 11, 9, 11, 8, 9, -1, -1, -1, -1, -1, -1, -1, 3, 6, 11, 0, 6, 3, 0, 5, 6, 0, 9, 5, -1, -1, -1, -1, 0, 11, 8, 0, 5, 11, 0, 1, 5, 5, 6, 11, -1, -1, -1, -1, 6, 11, 3, 6, 3, 5, 5, 3, 1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 9, 5, 11, 9, 11, 8, 11, 5, 6, -1, -1, -1, -1, 0, 11, 3, 0, 6, 11, 0, 9, 6, 5, 6, 9, 1, 2, 10, -1, 11, 8, 5, 11, 5, 6, 8, 0, 5, 10, 5, 2, 0, 2, 5, -1, 6, 11, 3, 6, 3, 5, 2, 10, 3, 10, 5, 3, -1, -1, -1, -1, 5, 8, 9, 5, 2, 8, 5, 6, 2, 3, 8, 2, -1, -1, -1, -1, 9, 5, 6, 9, 6, 0, 0, 6, 2, -1, -1, -1, -1, -1, -1, -1, 1, 5, 8, 1, 8, 0, 5, 6, 8, 3, 8, 2, 6, 2, 8, -1, 1, 5, 6, 2, 1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 1, 6, 10, 3, 8, 6, 5, 6, 9, 8, 9, 6, -1, 10, 1, 0, 10, 0, 6, 9, 5, 0, 5, 6, 0, -1, -1, -1, -1, 0, 3, 8, 5, 6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 10, 5, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 5, 10, 7, 5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 5, 10, 11, 7, 5, 8, 3, 0, -1, -1, -1, -1, -1, -1, -1, 5, 11, 7, 5, 10, 11, 1, 9, 0, -1, -1, -1, -1, -1, -1, -1, 10, 7, 5, 10, 11, 7, 9, 8, 1, 8, 3, 1, -1, -1, -1, -1, 11, 1, 2, 11, 7, 1, 7, 5, 1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 1, 2, 7, 1, 7, 5, 7, 2, 11, -1, -1, -1, -1, 9, 7, 5, 9, 2, 7, 9, 0, 2, 2, 11, 7, -1, -1, -1, -1, 7, 5, 2, 7, 2, 11, 5, 9, 2, 3, 2, 8, 9, 8, 2, -1, 2, 5, 10, 2, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1, 8, 2, 0, 8, 5, 2, 8, 7, 5, 10, 2, 5, -1, -1, -1, -1, 9, 0, 1, 5, 10, 3, 5, 3, 7, 3, 10, 2, -1, -1, -1, -1, 9, 8, 2, 9, 2, 1, 8, 7, 2, 10, 2, 5, 7, 5, 2, -1, 1, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 7, 0, 7, 1, 1, 7, 5, -1, -1, -1, -1, -1, -1, -1, 9, 0, 3, 9, 3, 5, 5, 3, 7, -1, -1, -1, -1, -1, -1, -1, 9, 8, 7, 5, 9, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 5, 8, 4, 5, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1, 5, 0, 4, 5, 11, 0, 5, 10, 11, 11, 3, 0, -1, -1, -1, -1, 0, 1, 9, 8, 4, 10, 8, 10, 11, 10, 4, 5, -1, -1, -1, -1, 10, 11, 4, 10, 4, 5, 11, 3, 4, 9, 4, 1, 3, 1, 4, -1, 2, 5, 1, 2, 8, 5, 2, 11, 8, 4, 5, 8, -1, -1, -1, -1, 0, 4, 11, 0, 11, 3, 4, 5, 11, 2, 11, 1, 5, 1, 11, -1, 0, 2, 5, 0, 5, 9, 2, 11, 5, 4, 5, 8, 11, 8, 5, -1, 9, 4, 5, 2, 11, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 5, 10, 3, 5, 2, 3, 4, 5, 3, 8, 4, -1, -1, -1, -1, 5, 10, 2, 5, 2, 4, 4, 2, 0, -1, -1, -1, -1, -1, -1, -1, 3, 10, 2, 3, 5, 10, 3, 8, 5, 4, 5, 8, 0, 1, 9, -1, 5, 10, 2, 5, 2, 4, 1, 9, 2, 9, 4, 2, -1, -1, -1, -1, 8, 4, 5, 8, 5, 3, 3, 5, 1, -1, -1, -1, -1, -1, -1, -1, 0, 4, 5, 1, 0, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 4, 5, 8, 5, 3, 9, 0, 5, 0, 3, 5, -1, -1, -1, -1, 9, 4, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 11, 7, 4, 9, 11, 9, 10, 11, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 4, 9, 7, 9, 11, 7, 9, 10, 11, -1, -1, -1, -1, 1, 10, 11, 1, 11, 4, 1, 4, 0, 7, 4, 11, -1, -1, -1, -1, 3, 1, 4, 3, 4, 8, 1, 10, 4, 7, 4, 11, 10, 11, 4, -1, 4, 11, 7, 9, 11, 4, 9, 2, 11, 9, 1, 2, -1, -1, -1, -1, 9, 7, 4, 9, 11, 7, 9, 1, 11, 2, 11, 1, 0, 8, 3, -1, 11, 7, 4, 11, 4, 2, 2, 4, 0, -1, -1, -1, -1, -1, -1, -1, 11, 7, 4, 11, 4, 2, 8, 3, 4, 3, 2, 4, -1, -1, -1, -1, 2, 9, 10, 2, 7, 9, 2, 3, 7, 7, 4, 9, -1, -1, -1, -1, 9, 10, 7, 9, 7, 4, 10, 2, 7, 8, 7, 0, 2, 0, 7, -1, 3, 7, 10, 3, 10, 2, 7, 4, 10, 1, 10, 0, 4, 0, 10, -1, 1, 10, 2, 8, 7, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 9, 1, 4, 1, 7, 7, 1, 3, -1, -1, -1, -1, -1, -1, -1, 4, 9, 1, 4, 1, 7, 0, 8, 1, 8, 7, 1, -1, -1, -1, -1, 4, 0, 3, 7, 4, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 8, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 0, 9, 3, 9, 11, 11, 9, 10, -1, -1, -1, -1, -1, -1, -1, 0, 1, 10, 0, 10, 8, 8, 10, 11, -1, -1, -1, -1, -1, -1, -1, 3, 1, 10, 11, 3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 11, 1, 11, 9, 9, 11, 8, -1, -1, -1, -1, -1, -1, -1, 3, 0, 9, 3, 9, 11, 1, 2, 9, 2, 11, 9, -1, -1, -1, -1, 0, 2, 11, 8, 0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 3, 8, 2, 8, 10, 10, 8, 9, -1, -1, -1, -1, -1, -1, -1, 9, 10, 2, 0, 9, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 3, 8, 2, 8, 10, 0, 1, 8, 1, 10, 8, -1, -1, -1, -1, 1, 10, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 8, 9, 1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 9, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 3, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
            var Ua = za;

            function Ga(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ha(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }

            function Wa(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }
            var qa = [0, 265, 515, 778, 1030, 1295, 1541, 1804, 2060, 2309, 2575, 2822, 3082, 3331, 3593, 3840, 400, 153, 915, 666, 1430, 1183, 1941, 1692, 2460, 2197, 2975, 2710, 3482, 3219, 3993, 3728, 560, 825, 51, 314, 1590, 1855, 1077, 1340, 2620, 2869, 2111, 2358, 3642, 3891, 3129, 3376, 928, 681, 419, 170, 1958, 1711, 1445, 1196, 2988, 2725, 2479, 2214, 4010, 3747, 3497, 3232, 1120, 1385, 1635, 1898, 102, 367, 613, 876, 3180, 3429, 3695, 3942, 2154, 2403, 2665, 2912, 1520, 1273, 2035, 1786, 502, 255, 1013, 764, 3580, 3317, 4095, 3830, 2554, 2291, 3065, 2800, 1616, 1881, 1107, 1370, 598, 863, 85, 348, 3676, 3925, 3167, 3414, 2650, 2899, 2137, 2384, 1984, 1737, 1475, 1226, 966, 719, 453, 204, 4044, 3781, 3535, 3270, 3018, 2755, 2505, 2240, 2240, 2505, 2755, 3018, 3270, 3535, 3781, 4044, 204, 453, 719, 966, 1226, 1475, 1737, 1984, 2384, 2137, 2899, 2650, 3414, 3167, 3925, 3676, 348, 85, 863, 598, 1370, 1107, 1881, 1616, 2800, 3065, 2291, 2554, 3830, 4095, 3317, 3580, 764, 1013, 255, 502, 1786, 2035, 1273, 1520, 2912, 2665, 2403, 2154, 3942, 3695, 3429, 3180, 876, 613, 367, 102, 1898, 1635, 1385, 1120, 3232, 3497, 3747, 4010, 2214, 2479, 2725, 2988, 1196, 1445, 1711, 1958, 170, 419, 681, 928, 3376, 3129, 3891, 3642, 2358, 2111, 2869, 2620, 1340, 1077, 1855, 1590, 314, 51, 825, 560, 3728, 3993, 3219, 3482, 2710, 2975, 2197, 2460, 1692, 1941, 1183, 1430, 666, 915, 153, 400, 3840, 3593, 3331, 3082, 2822, 2575, 2309, 2060, 1804, 1541, 1295, 1030, 778, 515, 265, 0];
            var Ya = function e() {
                    Wa(this, e), this._arrSize = 8, this.p = new Array(this._arrSize), this.g = new Array(this._arrSize), this.val = new Array(this._arrSize);
                    for (var t = 0; t < this._arrSize; ++t) this.p[t] = new c.Vector3, this.g[t] = new c.Vector3;
                    this.cubeIndex = 0
                },
                Xa = function e() {
                    Wa(this, e), this.a = {
                        p: new c.Vector3,
                        n: new c.Vector3
                    }, this.b = {
                        p: new c.Vector3,
                        n: new c.Vector3
                    }, this.c = {
                        p: new c.Vector3,
                        n: new c.Vector3
                    }
                };

            function $a(e) {
                for (var t = new Array(e), n = 0; n < e; ++n) t[n] = new c.Vector3;
                return t
            }
            var Ka = function() {
                function e() {
                    Wa(this, e), this._numTriangles = 0, this._numVertices = 0, this._position = [], this._normals = [], this._colors = null, this._indices = [], this._volumetricData = null, this._xAxis = new c.Vector3, this._yAxis = new c.Vector3, this._zAxis = new c.Vector3, this._xDir = new c.Vector3, this._yDir = new c.Vector3, this._zDir = new c.Vector3
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "_prepareAxesAndDirs",
                    value: function() {
                        var e = this._volumetricData.getCellSize(),
                            t = this._xAxis,
                            n = this._yAxis,
                            r = this._zAxis,
                            o = this._xDir,
                            i = this._yDir,
                            a = this._zDir;
                        t.set(e.x, 0, 0), n.set(0, e.y, 0), r.set(0, 0, e.z), o.set(1, 0, 0), i.set(0, 1, 0), a.set(0, 0, 1);
                        var s = new c.Vector3;
                        return s.crossVectors(o, i), s.dot(a) < 0 && (o.negate(), i.negate(), a.negate()), !(o.x < 0 || o.y < 0 || o.z < 0 || i.x < 0 || i.y < 0 || i.z < 0 || a.x < 0 || a.y < 0 || a.z < 0) && !(0 !== t.y || 0 !== t.z || 0 !== n.x || 0 !== n.z || 0 !== r.x || 0 !== r.y)
                    }
                }, {
                    key: "_vertexInterp",
                    value: function(e, t, n, r, o, i) {
                        var a = t.p[n],
                            s = t.p[r],
                            l = t.g[n],
                            c = t.g[r],
                            u = t.val[n],
                            p = e - u,
                            f = t.val[r] - u,
                            h = 0;
                        Math.abs(f) > 0 && (h = p / f), h = h > 1 ? 1 : h, o.lerpVectors(a, s, h), i.lerpVectors(l, c, h)
                    }
                }, {
                    key: "_polygonize",
                    value: function(t, n, r) {
                        for (var o = t.cubeIndex, i = 0, a = e._arrSize, s = e._firstIndices, l = e._secondIndices, c = e._vertexList, u = e._normalList; i < a; ++i) qa[o] & 1 << i && this._vertexInterp(n, t, s[i], l[i], c[i], u[i]);
                        var p = 0,
                            f = 16 * o,
                            h = e._triTable;
                        for (i = 0; - 1 !== h[f + i]; i += 3) r[p].a.p.copy(c[h[f + i]]), r[p].a.n.copy(u[h[f + i]]), r[p].b.p.copy(c[h[f + i + 1]]), r[p].b.n.copy(u[h[f + i + 1]]), r[p].c.p.copy(c[h[f + i + 2]]), r[p].c.n.copy(u[h[f + i + 2]]), ++p;
                        return p
                    }
                }, {
                    key: "_doGridPosNorms",
                    value: function(e, t, n) {
                        for (var r, o = this._volumetricData, i = this._volumetricData.getData(), a = o.getDimensions(), s = a[0], l = a[1], u = a[2], p = t * o.getStrideX(), f = t * o.getStrideY(), h = t * o.getStrideZ(), d = new Ya, m = d.val, y = d.val.length, v = [new c.Vector3(0, 0, 0), new c.Vector3(t, 0, 0), new c.Vector3(t, t, 0), new c.Vector3(0, t, 0), new c.Vector3(0, 0, t), new c.Vector3(t, 0, t), new c.Vector3(t, t, t), new c.Vector3(0, t, t)], _ = new Array(5), g = 0; g < 5; ++g) _[g] = new Xa;
                        var b, w = this,
                            x = this._position,
                            S = this._normals;
                        n ? (b = new c.Vector3(w._xAxis.x, w._yAxis.y, w._zAxis.z), r = function(e) {
                            var t = e.p.clone();
                            t.multiply(b), x.push(t.add(w._origin)), S.push(e.n.clone())
                        }) : r = function() {
                            var e = new c.Matrix3;
                            e.set(w._xAxis.x, w._yAxis.x, w._zAxis.x, w._xAxis.y, w._yAxis.y, w._zAxis.y, w._xAxis.z, w._yAxis.z, w._zAxis.z);
                            var t = new c.Matrix3;
                            return t.set(w._xDir.x, w._yDir.x, w._zDir.x, w._xDir.y, w._yDir.y, w._zDir.y, w._xDir.z, w._yDir.z, w._zDir.z),
                                function(n) {
                                    x.push(n.p.clone().applyMatrix3(e).add(w._origin)), S.push(n.n.clone().applyMatrix3(t))
                                }
                        }();
                        for (var C, P, E, O, A = this._indices, T = 0, k = 0; k < u - t; k += t)
                            for (var R = 0; R < l - t; R += t)
                                for (var I = o.getDirectIdx(0, R, k), M = 0; M < s - t; M += t, I += p) {
                                    m[0] = i[I], m[1] = i[I + p], m[3] = i[I + f], m[2] = i[I + p + f], m[4] = i[I + h], m[5] = i[I + p + h], m[7] = i[I + f + h], m[6] = i[I + p + f + h];
                                    for (var N = 0, L = 0; L < y; ++L) m[L] < e && (N |= 1 << L);
                                    if (0 !== qa[N]) {
                                        for (d.cubeIndex = N, L = 0; L < y; ++L) d.p[L].set(M + v[L].x, R + v[L].y, k + v[L].z), C = this._gradient, P = d.p[L], E = d.g[L], O = void 0, O = C.getValue(P.x, P.y, P.z), E.set(O[0], O[1], O[2]);
                                        var j = this._polygonize(d, e, _);
                                        for (T += j, L = 0; L < j; ++L) A.push(3 * this._numTriangles), A.push(3 * this._numTriangles + 1), A.push(3 * this._numTriangles + 2), ++this._numTriangles, r(_[L].a), r(_[L].b), r(_[L].c)
                                    }
                                }
                        return T
                    }
                }, {
                    key: "compute",
                    value: function(e, t, n, r) {
                        this._volumetricData = e, this._origin = t, this._gradient = e.computeGradient(), this._doGridPosNorms(n, r, this._prepareAxesAndDirs())
                    }
                }, {
                    key: "_remapIndices",
                    value: function(e, t) {
                        for (var n = this._indices, r = R.allocateTyped(Uint32Array, t), o = 0; o < t; ++o) n[o] = e[n[o]], r[o] = n[o];
                        this._indices = r
                    }
                }, {
                    key: "_remapVertices",
                    value: function(e, t, n) {
                        for (var r = R.allocateTyped(Float32Array, 3 * n), o = R.allocateTyped(Float32Array, 3 * n), i = 0; i < n; ++i) {
                            var a = e[i];
                            r[3 * i] = a.x, r[3 * i + 1] = a.y, r[3 * i + 2] = a.z;
                            var s = t[i].normalize();
                            o[3 * i] = s.x, o[3 * i + 1] = s.y, o[3 * i + 2] = s.z
                        }
                        this._position = r, this._normals = o
                    }
                }, {
                    key: "vertexFusion",
                    value: function(e, t) {
                        var n = this._indices.length,
                            r = this._position,
                            o = this._normals,
                            i = 0 | r.length;
                        if (0 !== n && 0 !== i) {
                            var a = R.allocateTyped(Uint32Array, i);
                            a[0] = 0;
                            for (var s = 1, l = 1; l < i; ++l) {
                                for (var c = s - e < 0 ? 0 : s - e, u = c + t > s ? s : c + t, p = -1, f = c; f < u; ++f)
                                    if (r[l].equals(r[f])) {
                                        p = f;
                                        break
                                    } - 1 !== p ? a[l] = p : (r[s].copy(r[l]), o[s].copy(o[l]), a[l] = s, ++s)
                            }
                            this._remapIndices(a, n), this._remapVertices(r, o, s)
                        }
                    }
                }, {
                    key: "setColorVolTex",
                    value: function(e, t, n, r) {
                        var o, i, a, s, l, c, u = this._position.length / 3,
                            p = this._position,
                            f = this._origin,
                            h = this._volumetricData.getDimensions(),
                            d = h[0] - 1,
                            m = h[1] - 1,
                            y = h[2] - 1,
                            v = e.getData(),
                            _ = e.getStrideX(),
                            g = e.getStrideY(),
                            b = e.getStrideZ();
                        null !== r && (a = n.getData(), s = n.getStrideX(), l = n.getStrideY(), c = n.getStrideZ());
                        var w = 1 / this._xAxis.x,
                            x = 1 / this._yAxis.y,
                            S = 1 / this._zAxis.z,
                            C = [],
                            P = [],
                            E = R.allocateTyped(Float32Array, 3 * u);

                        function O(e, t, n, r) {
                            r[0] = (1 - e) * v[t] + e * v[n], r[1] = (1 - e) * v[t + 1] + e * v[n + 1], r[2] = (1 - e) * v[t + 2] + e * v[n + 2]
                        }

                        function A(e, n, r, o) {
                            var i = t[e];
                            if (null != i) {
                                C[i._index] = i;
                                var s = n * r * o * a[e];
                                void 0 === P[i._index] ? P[i._index] = s : P[i._index] += s
                            }
                        }
                        var T = R.allocateTyped(Int32Array, u),
                            k = 0;
                        for (o = 0; o < u; o++) {
                            var I = 3 * o,
                                M = (p[I] - f.x) * w,
                                N = (p[I + 1] - f.y) * x,
                                L = (p[I + 2] - f.z) * S,
                                j = 0 | Math.min(Math.max(M, 0), d),
                                D = 0 | Math.min(Math.max(N, 0), m),
                                V = 0 | Math.min(Math.max(L, 0), y),
                                F = M - j,
                                B = N - D,
                                z = L - V;
                            if (null != r) {
                                C = [], P = [], A(i = n.getDirectIdx(j, D, V), 1 - F, 1 - B, 1 - z), A(i + s, F, 1 - B, 1 - z), A(i + l, 1 - F, B, 1 - z), A(i + s + l, F, B, 1 - z), A(i + c, 1 - F, 1 - B, z), A(i + s + c, F, 1 - B, z), A(i + l + c, 1 - F, B, z), A(i + s + l + c, F, B, z);
                                var U = 0,
                                    G = -1;
                                for (var H in P) P[H] > U && (G = H, U = P[H]);
                                if (G < 0 || !r.includesAtom(C[G])) {
                                    T[o] = -1;
                                    continue
                                }
                            }
                            T[o] = k++;
                            var W = j < d ? _ : 0,
                                q = D < m ? g : 0,
                                Y = V < y ? b : 0,
                                X = [0, 0, 0],
                                $ = [0, 0, 0],
                                K = [0, 0, 0],
                                Z = [0, 0, 0];
                            O(F, i = e.getDirectIdx(j, D, V), i + W, X), O(F, i + q, i + W + q, $), O(F, i + Y, i + W + Y, K), O(F, i + q + Y, i + W + q + Y, Z);
                            var Q = [0, 0, 0];
                            Q[0] = (1 - B) * X[0] + B * $[0], Q[1] = (1 - B) * X[1] + B * $[1], Q[2] = (1 - B) * X[2] + B * $[2];
                            var J = [0, 0, 0];
                            J[0] = (1 - B) * K[0] + B * Z[0], J[1] = (1 - B) * K[1] + B * Z[1], J[2] = (1 - B) * K[2] + B * Z[2], E[I] = (1 - z) * Q[0] + z * J[0], E[I + 1] = (1 - z) * Q[1] + z * J[1], E[I + 2] = (1 - z) * Q[2] + z * J[2]
                        }
                        if (this._colors = E, null != r) {
                            for (o = 0; o < u; ++o) {
                                var ee = T[o];
                                ee < 0 || (this._position[3 * ee] = this._position[3 * o], this._position[3 * ee + 1] = this._position[3 * o + 1], this._position[3 * ee + 2] = this._position[3 * o + 2], this._normals[3 * ee] = this._normals[3 * o], this._normals[3 * ee + 1] = this._normals[3 * o + 1], this._normals[3 * ee + 2] = this._normals[3 * o + 2], this._colors[3 * ee] = this._colors[3 * o], this._colors[3 * ee + 1] = this._colors[3 * o + 1], this._colors[3 * ee + 2] = this._colors[3 * o + 2])
                            }
                            var te = this._indices.length / 3,
                                ne = 0;
                            for (o = 0; o < te; ++o) {
                                var re = T[this._indices[3 * o]],
                                    oe = T[this._indices[3 * o + 1]],
                                    ie = T[this._indices[3 * o + 2]];
                                re >= 0 && oe >= 0 && ie >= 0 && (this._indices[3 * ne] = re, this._indices[3 * ne + 1] = oe, this._indices[3 * ne + 2] = ie, ++ne)
                            }
                            this._position = new Float32Array(this._position.buffer.slice(0, 3 * k * 4)), this._normals = new Float32Array(this._normals.buffer.slice(0, 3 * k * 4)), this._colors = new Float32Array(this._colors.buffer.slice(0, 3 * k * 4)), this._indices = new Uint32Array(this._indices.buffer.slice(0, 3 * ne * 4))
                        }
                    }
                }, {
                    key: "toMesh",
                    value: function() {
                        var e = new c.BufferGeometry;
                        return e.setIndex(new c.BufferAttribute(this._indices, 1)), e.addAttribute("position", new c.BufferAttribute(this._position, 3)), e.addAttribute("normal", new c.BufferAttribute(this._normals, 3)), e.addAttribute("color", new c.BufferAttribute(this._colors, 3)), e.computeBoundingSphere(), e
                    }
                }]) && Ga(t.prototype, n), r && Ga(t, r), e
            }();
            Ha(Ka, "_triTable", Ua.prototype.striIndicesMarchCube), Ha(Ka, "_arrSize", 12), Ha(Ka, "_firstIndices", [0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3]), Ha(Ka, "_secondIndices", [1, 2, 3, 0, 5, 6, 7, 4, 4, 5, 6, 7]), Ha(Ka, "_vertexList", $a(Ka._arrSize)), Ha(Ka, "_normalList", $a(Ka._arrSize));
            var Za = Ka;

            function Qa(e) {
                return (Qa = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ja(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function es(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ts(e, t) {
                return !t || "object" !== Qa(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ns(e) {
                return (ns = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function rs(e, t) {
                return (rs = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var os = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), ts(this, ns(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && rs(e, t)
                }(t, Fa), n = t, (r = [{
                    key: "_build",
                    value: function() {
                        var e = this._opts;
                        this.numVoxels = [128, 128, 128], this.xAxis = new c.Vector3(1, 0, 0), this.yAxis = new c.Vector3(0, 1, 0), this.zAxis = new c.Vector3(0, 0, 1), this.origin = new c.Vector3(0, 0, 0), this._visibilitySelector = e.visibilitySelector, this._calcSurface(e)
                    }
                }, {
                    key: "_findMinMax",
                    value: function(e) {
                        for (var t = e.length / 4, n = [e[0], e[1], e[2], e[3]], r = [e[0], e[1], e[2], e[3]], o = 1; o < t; ++o)
                            for (var i = 4 * o, a = 0; a < 4; ++a) {
                                var s = e[i + a];
                                n[a] = Math.max(s, n[a]), r[a] = Math.min(s, r[a])
                            }
                        return {
                            maxPosRad: n,
                            minPosRad: r
                        }
                    }
                }, {
                    key: "_findNumVoxels",
                    value: function(e, t) {
                        var n = this.numVoxels,
                            r = this._findMinMax(e),
                            o = r.minPosRad,
                            i = r.maxPosRad;
                        o[3] > 4 && (t.gridSpacing *= o[3]);
                        var a = t.radScale * i[3] * 1.7,
                            s = a;
                        s = .65 * Math.sqrt(4 / 3 * Math.PI * s * s * s), a = Math.max(a, s);
                        for (var l = 0; l < 3; ++l) o[l] -= a, i[l] += a;
                        for (l = 0; l < 3; ++l) n[l] = Math.ceil((i[l] - o[l]) / t.gridSpacing);
                        this.xAxis.x = (n[0] - 1) * t.gridSpacing, this.yAxis.y = (n[1] - 1) * t.gridSpacing, this.zAxis.z = (n[2] - 1) * t.gridSpacing;
                        var c = Ja(o, 3);
                        return this.origin.x = c[0], this.origin.y = c[1], this.origin.z = c[2], {
                            bbox: r,
                            dim: n
                        }
                    }
                }, {
                    key: "_makeSurface",
                    value: function(e, t) {
                        var n = new Za;
                        n.compute(e.volMap, this.origin, t.isoValue, 1), n.vertexFusion(9, 9), n._numTriangles > 0 ? (n.setColorVolTex(e.volTexMap, e.atomMap, e.atomWeightMap, this._visibilitySelector), this.setIndex(new c.BufferAttribute(n._indices, 1)), this.addAttribute("position", new c.BufferAttribute(n._position, 3)), this.addAttribute("normal", new c.BufferAttribute(n._normals, 3)), this.addAttribute("color", new c.BufferAttribute(n._colors, 3))) : this.addAttribute("position", new c.BufferAttribute(R.allocateTyped(Float32Array, 0), 3))
                    }
                }, {
                    key: "_calcSurface",
                    value: function(e) {
                        var t = {
                            posRad: this._posRad,
                            colors: this._colors,
                            atoms: this._opts.atoms
                        };
                        if (0 !== t.posRad.length) {
                            var n = this._findNumVoxels(t.posRad, e),
                                r = new c.Box3(this.origin, new c.Vector3(this.xAxis.x, this.yAxis.y, this.zAxis.z).add(this.origin)),
                                o = this._computeSurface(t, r, n, e);
                            this._makeSurface(o, e)
                        }
                    }
                }]) && es(n.prototype, r), o && es(n, o), t
            }();

            function is(e) {
                return (is = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function as(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ss(e, t) {
                return !t || "object" !== is(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ls(e) {
                return (ls = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function cs(e, t) {
                return (cs = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var us = hr.Volume,
                ps = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), ss(this, ls(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && cs(e, t)
                    }(t, os), n = t, (r = [{
                        key: "_computeSurface",
                        value: function(e, t, n, r) {
                            this._shiftByOrigin(e.posRad);
                            var o = {
                                volMap: new us(Float32Array, this.numVoxels, t),
                                volTexMap: new us(Float32Array, this.numVoxels, t, 3)
                            };
                            return null != this._visibilitySelector && (o.atomMap = [], o.atomWeightMap = new us(Float32Array, this.numVoxels, t)), this.gaussdensity(o, e, null, r), o
                        }
                    }, {
                        key: "gaussdensity",
                        value: function(e, t, n, r) {
                            var o, i = t.posRad.length / 4,
                                a = t.posRad,
                                s = t.colors,
                                l = this.numVoxels,
                                c = r.radScale,
                                u = r.gaussLim,
                                p = r.gridSpacing,
                                f = 1 / r.isoValue,
                                h = 1 / p,
                                d = l[0] - 1,
                                m = l[1] - 1,
                                y = l[2] - 1,
                                v = e.volMap,
                                _ = e.volTexMap,
                                g = v.getData(),
                                b = v.getStrideX(),
                                w = _.getData(),
                                x = _.getStrideX();
                            null != this._visibilitySelector && (o = e.atomWeightMap.getData());
                            for (var S = e.atomMap, C = 0; C < i; ++C) {
                                var P = 4 * C,
                                    E = a[P + 3] * c,
                                    O = null === n ? 1 : n[C],
                                    A = 1 / (2 * E * E),
                                    T = u * E,
                                    k = T * T;
                                T *= h;
                                var R = a[P] * h,
                                    I = Math.max(R - T | 0, 0),
                                    M = Math.min(R + T | 0, d);
                                R = a[P + 1] * h;
                                var N = Math.max(R - T | 0, 0),
                                    L = Math.min(R + T | 0, m);
                                R = a[P + 2] * h;
                                for (var j = Math.max(R - T | 0, 0), D = Math.min(R + T | 0, y), V = j * p - a[P + 2], F = j; F <= D; ++F, V += p)
                                    for (var B = N * p - a[P + 1], z = N; z <= L; ++z, B += p) {
                                        var U = B * B + V * V;
                                        if (!(U >= k))
                                            for (var G = v.getDirectIdx(I, z, F), H = _.getDirectIdx(I, z, F), W = I * p - a[P], q = I; q <= M; ++q, W += p, G += b, H += x) {
                                                var Y = -(W * W + U) * A,
                                                    X = Math.exp(Y) * O;
                                                null != this._visibilitySelector && X > o[G] && (o[G] = X, S[G] = t.atoms[C]), g[G] += X, X *= f;
                                                var $ = 3 * C;
                                                w[H] += X * s[$], w[H + 1] += X * s[$ + 1], w[H + 2] += X * s[$ + 2]
                                            }
                                    }
                            }
                        }
                    }, {
                        key: "_shiftByOrigin",
                        value: function(e) {
                            for (var t = this.origin.x, n = this.origin.y, r = this.origin.z, o = e.length / 4, i = 0; i < o; ++i) {
                                var a = 4 * i;
                                e[a] -= t, e[a + 1] -= n, e[a + 2] -= r
                            }
                        }
                    }]) && as(n.prototype, r), o && as(n, o), t
                }();

            function fs(e, t, n, r) {
                var o = e.length / 4,
                    i = t[0],
                    a = t[1],
                    s = t[2],
                    l = n[0],
                    c = n[1],
                    u = n[2];

                function p(e, t) {
                    return Math.floor((e - t) / r)
                }
                var f, h, d, m, y, v = p(l, i) + 1,
                    _ = p(c, a) + 1,
                    g = p(u, s) + 1,
                    b = v * _ * g,
                    w = _ * g,
                    x = [];
                for (f = 0; f < o; f++) {
                    var S = 4 * f;
                    d = e[S], m = e[S + 1], y = e[S + 2], void 0 === x[h = (p(d, i) * _ + p(m, a)) * g + p(y, s)] ? x[h] = [f] : x[h].push(f)
                }
                var C, P = R.allocateTyped(Uint32Array, b),
                    E = R.allocateTyped(Uint16Array, b),
                    O = R.allocateTyped(Uint32Array, o),
                    A = 0,
                    T = 0;
                for (f = 0; f < b; f++) {
                    var k = P[f] = A,
                        I = x[f];
                    if (void 0 !== I)
                        for (C = 0; C < I.length; C++) O[A] = I[C], A++;
                    var M = A - k;
                    E[f] = M, M > T && (T = M)
                }
                this.neighbourListLength = 27 * T + 1, this.withinRadii = function(t, n, r, o, l) {
                    var c = 0,
                        u = p(t, i),
                        d = p(n, a),
                        m = p(r, s),
                        y = Math.max(0, u - 1),
                        b = Math.max(0, d - 1),
                        x = Math.max(0, m - 1),
                        S = Math.min(v - 1, u + 1),
                        A = Math.min(_ - 1, d + 1),
                        T = Math.min(g - 1, m + 1);
                    for (f = y; f <= S; ++f) {
                        var k = f * w;
                        for (C = b; C <= A; ++C)
                            for (var R = C * g, I = x; I <= T; ++I)
                                for (var M = P[h = k + R + I], N = M + E[h], L = M; L < N; L++) {
                                    var j = 4 * O[L],
                                        D = e[j] - t,
                                        V = e[j + 1] - n,
                                        F = e[j + 2] - r,
                                        B = e[j + 3] + o;
                                    D * D + V * V + F * F <= B * B && (l[c++] = O[L])
                                }
                    }
                    l[c] = -1
                }
            }
            var hs = function(e, t, n, r) {
                var o, i, a, s, l, u, p, f, h, d, m, y, v, _, g, b, w, x = 4,
                    S = e.posRad,
                    C = e.colors,
                    P = e.atoms,
                    E = S.length / x,
                    O = t.bbox,
                    A = O.minPosRad,
                    T = O.maxPosRad,
                    k = -1,
                    I = null,
                    M = null,
                    N = null,
                    L = new c.Vector3(0, 0, 0),
                    j = new c.Vector3(0, 0, 0),
                    D = new c.Vector3(0, 0, 0);

                function V(e, t, n) {
                    for (var r = 0; r < e.length; r++) e[r] = t + n * r
                }

                function F() {
                    s = n.scaleFactor, u = t.dim, w = Math.min(5, 2 + Math.floor(a * s));
                    var e = u[0] * u[1] * u[2];
                    p = function(e, t, n) {
                        for (var r = R.allocateTyped(e, t), o = 0; o < t; ++o) r[o] = n;
                        return r
                    }(Float32Array, e, -1001), f = R.allocateTyped(Float32Array, 3 * e), h = R.allocateTyped(Float32Array, e), N && (I = R.allocateTyped(Float32Array, e), M = []), d = R.allocateTyped(Float32Array, u[0]), m = R.allocateTyped(Float32Array, u[1]), y = R.allocateTyped(Float32Array, u[2]), V(d, A[0], 1 / s), V(m, A[1], 1 / s), V(y, A[2], 1 / s)
                }

                function B() {
                    a = n.probeRadius, s = n.scaleFactor, l = n.probePositions, N = n.visibilitySelector, o = R.allocateTyped(Float32Array, E), i = 0;
                    for (var e = 0; e < E; ++e) {
                        var t = S[e * x + 3] += a;
                        t > i && (i = t), o[e] = t * t
                    }
                    F(),
                        function() {
                            var e = 0,
                                t = 2 * Math.PI / l;
                            _ = R.allocateTyped(Float32Array, l), v = R.allocateTyped(Float32Array, l);
                            for (var n = 0; n < l; n++) _[n] = Math.cos(e), v[n] = Math.sin(e), e += t
                        }(), g = new fs(S, A, T, 2.01 * i), b = new Int32Array(g.neighbourListLength), k = -1
                }

                function z(e, t, n, r) {
                    var i = x * e,
                        a = o[e],
                        s = S[i] - t,
                        l = S[i + 1] - n,
                        c = S[i + 2] - r;
                    return s * s + l * l + c * c < a
                }

                function U(e, t, n, r, o) {
                    var i;
                    if (-1 !== k) {
                        if ((i = k) !== r && i !== o && z(i, e, t, n)) return i;
                        k = -1
                    }
                    var a = 0;
                    for (i = b[a]; i >= 0;) {
                        if (i !== r && i !== o && z(i, e, t, n)) return k = i, i;
                        i = b[++a]
                    }
                    return k = -1, -1
                }

                function G(e, t) {
                    var n, r, o = x * e,
                        i = x * t,
                        a = S[o],
                        c = S[o + 1],
                        f = S[o + 2],
                        h = S[o + 3],
                        g = L.x = S[i] - a,
                        b = L.y = S[i + 1] - c,
                        C = L.z = S[i + 2] - f,
                        P = S[i + 3],
                        E = g * g + b * b + C * C,
                        O = Math.sqrt(E),
                        T = h * ((h * h + O * O - P * P) / (2 * h * O));
                    L.normalize(), r = L, (n = j).x = n.y = n.z = 1, 0 !== r.x ? n.x = (r.y + r.z) / -r.x : 0 !== r.y ? n.y = (r.x + r.z) / -r.y : 0 !== r.z && (n.z = (r.x + r.y) / -r.z), j.normalize(), D.crossVectors(L, j), D.normalize();
                    var R = Math.sqrt(h * h - T * T);
                    j.multiplyScalar(R), D.multiplyScalar(R), L.multiplyScalar(T), L.x += a, L.y += c, L.z += f, k = -1;
                    for (var I = w, M = 0; M < l; M++) {
                        var N = _[M],
                            V = v[M],
                            F = L.x + N * j.x + V * D.x,
                            B = L.y + N * j.y + V * D.y,
                            z = L.z + N * j.z + V * D.z;
                        if (-1 === U(F, B, z, e, t))
                            for (var G = Math.floor(s * (F - A[0])), H = Math.floor(s * (B - A[1])), W = Math.floor(s * (z - A[2])), q = Math.max(0, G - I), Y = Math.max(0, H - I), X = Math.max(0, W - I), $ = Math.min(u[0], G + I + 2), K = Math.min(u[1], H + I + 2), Z = Math.min(u[2], W + I + 2), Q = X; Q < Z; Q++) {
                                C = z - y[Q];
                                for (var J = u[1] * u[0] * Q, ee = Y; ee < K; ee++)
                                    for (var te = C * C + (b = B - m[ee]) * b, ne = J + u[0] * ee, re = q; re < $; re++) {
                                        E = te + (g = F - d[re]) * g;
                                        var oe = re + ne,
                                            ie = p[oe];
                                        ie > 0 && E < ie * ie && (p[oe] = Math.sqrt(E))
                                    }
                            }
                    }
                }

                function H() {
                    console.time("ContactSurface.getVolume"), console.time("ContactSurface.init"), B(), console.timeEnd("ContactSurface.init"), console.time("ContactSurface.projectPoints"),
                        function() {
                            for (var e = 0; e < E; e++) {
                                var t = x * e,
                                    n = S[t],
                                    r = S[t + 1],
                                    i = S[t + 2],
                                    a = S[t + 3],
                                    l = o[e];
                                g.withinRadii(n, r, i, a, b);
                                for (var c = Math.ceil(a * s), v = Math.floor(s * (n - A[0])), _ = Math.floor(s * (r - A[1])), w = Math.floor(s * (i - A[2])), O = Math.max(0, v - c), T = Math.max(0, _ - c), k = Math.max(0, w - c), R = Math.min(u[0], v + c + 2), L = Math.min(u[1], _ + c + 2), j = Math.min(u[2], w + c + 2), D = 3 * e, V = C[D], F = C[D + 1], B = C[D + 2], z = k; z < j; z++)
                                    for (var G = y[z] - i, H = u[1] * u[0] * z, W = T; W < L; W++)
                                        for (var q = m[W] - r, Y = G * G + q * q, X = H + u[0] * W, $ = O; $ < R; $++) {
                                            var K = $ + X,
                                                Z = d[$] - n,
                                                Q = Y + Z * Z;
                                            if (Q < l) {
                                                var J = Math.exp(.28125 * -Q),
                                                    ee = 3 * K;
                                                f[ee] += V * J, f[ee + 1] += F * J, f[ee + 2] += B * J, h[K] += J, null !== N && J > I[K] && (I[K] = J, M[K] = P[e]), p[K] < 0 && (p[K] = -p[K]);
                                                var te = Math.sqrt(Q),
                                                    ne = a / te,
                                                    re = Z * ne,
                                                    oe = q * ne,
                                                    ie = G * ne;
                                                if (-1 === U(re += n, oe += r, ie += i, e, -1)) {
                                                    var ae = a - te;
                                                    ae < p[K] && (p[K] = ae)
                                                }
                                            }
                                        }
                            }
                        }(), console.timeEnd("ContactSurface.projectPoints"), console.time("ContactSurface.projectTorii"),
                        function() {
                            for (var e = 0; e < E; e++) {
                                var t = x * e;
                                g.withinRadii(S[t], S[t + 1], S[t + 2], S[t + 3], b);
                                for (var n = 0, r = b[n]; r >= 0;) e < r && G(e, r), r = b[++n]
                            }
                        }(), console.timeEnd("ContactSurface.projectTorii"),
                        function() {
                            for (var e = 0, t = p.length; e < t; e++) {
                                p[e] < 0 && (p[e] = 0);
                                var n = h[e];
                                if (n > 0) {
                                    n = 1 / n;
                                    var r = 3 * e;
                                    f[r] *= n, f[r + 1] *= n, f[r + 2] *= n
                                }
                            }
                        }(), console.timeEnd("ContactSurface.getVolume")
                }
                this.build = function() {
                    H(), this.volTexMap = f, this.weightsMap = I, this.atomMap = M, this.volMap = p
                }
            };

            function ds(e) {
                return (ds = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ms(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ys(e, t) {
                return !t || "object" !== ds(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function vs(e) {
                return (vs = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function _s(e, t) {
                return (_s = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var gs = hr.Volume,
                bs = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), ys(this, vs(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && _s(e, t)
                    }(t, os), n = t, (r = [{
                        key: "_computeSurface",
                        value: function(e, t, n, r) {
                            var o = new hs(e, n, r);
                            return o.build(), {
                                volMap: new gs(Float32Array, this.numVoxels, t, 1, o.volMap),
                                volTexMap: new gs(Float32Array, this.numVoxels, t, 3, o.volTexMap),
                                atomMap: o.atomMap,
                                atomWeightMap: new gs(Float32Array, this.numVoxels, t, 1, o.weightsMap)
                            }
                        }
                    }]) && ms(n.prototype, r), o && ms(n, o), t
                }();
            var ws = function e(t, n) {
                ! function(e, t) {
                    if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                }(this, e), this.coord = new c.Vector3, this.coord.copy(t), this.radius = n, this.colorX = .99999, this.colorY = 0, this.colorZ = 0, this.atomType = 0, this.srcAtom = null
            };

            function xs(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Ss = function() {
                function e(t, n, r, o, i) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._numAtoms = t, this._atoms = n, this._vBoxMin = new c.Vector3, this._vBoxMax = new c.Vector3, this._vBoxMin.copy(r), this._vBoxMax.copy(o), this._probeRadius = i, this._atomsList = null, this._voxelList = null
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "createVoxels",
                    value: function() {
                        var e, t, n = 0 | this._numAtoms,
                            r = this._atoms,
                            o = this._vBoxMax.x - this._vBoxMin.x,
                            i = this._vBoxMax.y - this._vBoxMin.y,
                            a = this._vBoxMax.z - this._vBoxMin.z,
                            s = o < i ? o : i;
                        s = a < s ? a : s;
                        var l, c = 0,
                            u = 0;
                        for (l = 0; l < n; l++) c = (t = 2 * (r[l].radius + this._probeRadius)) > c ? t : c, u += t;
                        var p = Math.floor(s / c);
                        p < 2 && (p = 2), u /= n, this._numCells = p, this._aveRad = u, this._maxRad = c;
                        var f = p,
                            h = p * p,
                            d = p * p * p,
                            m = this._xScale = 1 / (this._vBoxMax.x - this._vBoxMin.x),
                            y = this._yScale = 1 / (this._vBoxMax.y - this._vBoxMin.y),
                            v = this._zScale = 1 / (this._vBoxMax.z - this._vBoxMin.z),
                            _ = 0,
                            g = m * p,
                            b = y * p,
                            w = v * p;
                        for (l = 0; l < n; l++) {
                            var x = 2 * (4.5 * (r[l].radius + this._probeRadius)),
                                S = Math.floor(g * x + .8),
                                C = Math.floor(b * x + .8),
                                P = Math.floor(w * x + .8);
                            _ += ++S * ++C * ++P
                        }
                        this._voxelList = R.allocateTyped(Int32Array, d);
                        var E = [];
                        if (E.length = _, null === this._voxelList || null === E) return -1;
                        for (l = 0; l < d; l++) this._voxelList[l] = -1;
                        for (e = 0, l = 0; l < n; l++) {
                            t = 4.5 * (r[l].radius + this._probeRadius);
                            var O = Math.floor((r[l].coord.x - this._vBoxMin.x - t) * p * m),
                                A = Math.floor((r[l].coord.y - this._vBoxMin.y - t) * p * y),
                                T = Math.floor((r[l].coord.z - this._vBoxMin.z - t) * p * v),
                                k = Math.floor((r[l].coord.x - this._vBoxMin.x + t) * p * m),
                                I = Math.floor((r[l].coord.y - this._vBoxMin.y + t) * p * y),
                                M = Math.floor((r[l].coord.z - this._vBoxMin.z + t) * p * v);
                            O = O >= 0 ? O : 0, A = A >= 0 ? A : 0, k = k < p ? k : p - 1, I = I < p ? I : p - 1, M = M < p ? M : p - 1;
                            for (var N = T = T >= 0 ? T : 0; N <= M; N++)
                                for (var L = A; L <= I; L++)
                                    for (var j = O; j <= k; j++) {
                                        var D = j + L * f + N * h;
                                        if (this._voxelList[D] < 0) E[2 * e + 0] = l, E[2 * e + 1] = -1, this._voxelList[D] = e, e++;
                                        else {
                                            var V = this._voxelList[D];
                                            this._voxelList[D] = e, E[2 * e + 0] = l, E[2 * e + 1] = V, e++
                                        }
                                    }
                        }
                        return this._atomsList = Int32Array.from(E), 0
                    }
                }, {
                    key: "destroyVoxels",
                    value: function() {
                        this._atomsList = null, this._voxelList = null, this._atoms = null, this._vertices = null, this._vBoxMin = null, this._vBoxMax = null
                    }
                }, {
                    key: "forEachRelatedAtom",
                    value: function(e, t) {
                        for (var n = Math.floor((e.x - this._vBoxMin.x) * this._numCells * this._xScale), r = Math.floor((e.y - this._vBoxMin.y) * this._numCells * this._yScale), o = Math.floor((e.z - this._vBoxMin.z) * this._numCells * this._zScale), i = n + r * this._numCells + o * this._numCells * this._numCells, a = this._atoms, s = this._voxelList[i]; s >= 0; s = this._atomsList[2 * s + 1]) {
                            t(a[this._atomsList[2 * s]])
                        }
                    }
                }, {
                    key: "getClosestAtom",
                    value: function(e) {
                        var t = null,
                            n = Number.MAX_VALUE;
                        return this.forEachRelatedAtom(e, function(r) {
                            var o = e.distanceToSquared(r.coord);
                            o < n && (n = o, t = r)
                        }), t
                    }
                }, {
                    key: "buildNormals",
                    value: function(e, t, n) {
                        for (var r, o = this, i = 0, a = 0, s = 0, l = 0, c = 0, u = 0, p = 0, f = 0, h = 0, d = 2.5 * this._aveRad, m = d * d, y = .1 * -this._aveRad, v = function(e) {
                                var t = a - e.coord.x,
                                    n = s - e.coord.y,
                                    d = l - e.coord.z;
                                if (!((r = t * t + n * n + d * d) > m)) {
                                    var v = e.radius + o._probeRadius;
                                    (f = r - v * v) < 0 && (f = -f), h = Math.exp(y * f), c += t * h, u += n * h, p += d * h, i++
                                }
                            }, _ = 0, g = 0; g < e; g++) a = t[g].x, s = t[g].y, l = t[g].z, i = 0, c = u = p = 0, this.forEachRelatedAtom(t[g], v), _ = i > _ ? i : _, r = c * c + u * u + p * p, i > 0 && (f = 1 / Math.sqrt(r), c *= f, u *= f, p *= f), n[g].x = c, n[g].y = u, n[g].z = p;
                        return 0
                    }
                }, {
                    key: "buildColors",
                    value: function(e, t, n, r) {
                        for (var o = this, i = 0, a = 0, s = 0, l = 0, c = 0, u = r * r, p = [], f = [], h = 0, d = function(e) {
                                var t = i - e.coord.x,
                                    n = a - e.coord.y,
                                    r = s - e.coord.z,
                                    d = t * t + n * n + r * r;
                                if (!(d > u)) {
                                    var m = e.radius + o._probeRadius;
                                    (l = d - m * m) < 0 && (l = -l), c = 1 / (.8 + l), p.push([e.colorX, e.colorY, e.colorZ]), f.push(c), h += c
                                }
                            }, m = 0; m < e; m++) {
                            i = t[m].x, a = t[m].y, s = t[m].z, p = [], f = [], h = 0, this.forEachRelatedAtom(t[m], d);
                            for (var y = 0; y < p.length; ++y) {
                                var v = f[y] / h;
                                n[m].x += p[y][0] * v, n[m].y += p[y][1] * v, n[m].z += p[y][2] * v
                            }
                        }
                        return 0
                    }
                }]) && xs(t.prototype, n), r && xs(t, r), e
            }();

            function Cs(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Ps = function() {
                function e(t, n, r, o, i, a, s) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this.complex = t, this.atoms = r, this.pdbAtoms = n, this.numVoxels = a, this.colorMode = s, this.vBoxMin = new c.Vector3, this.vBoxMax = new c.Vector3, this.vBoxMin.copy(o), this.vBoxMax.copy(i), this.voxelsRefs = null, this.voxels = null
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "destroy",
                    value: function() {
                        this.atoms = null, this.vBoxMin = null, this.vBoxMax = null, this.voxelsRefs = null, this.voxels = null
                    }
                }, {
                    key: "buildSimple",
                    value: function(e, t) {
                        var n, r, o, i = [],
                            a = 0,
                            s = 0,
                            l = 0,
                            u = 0,
                            p = [];
                        p.length = 8;
                        var f = this.numVoxels,
                            h = f * f * f,
                            d = this.atoms.length;
                        this.voxelsRefs = R.allocateTyped(Int32Array, 2 * d), this.voxels = R.allocateTyped(Int32Array, h);
                        for (var m = 0, y = 0; m < d; m++, y += 2) this.voxelsRefs[y + 0] = m, this.voxelsRefs[y + 1] = -1;
                        for (var v = 0; v < h; v++) this.voxels[v] = -1;
                        for (var _ = 1 / (this.vBoxMax.x - this.vBoxMin.x), g = 1 / (this.vBoxMax.y - this.vBoxMin.y), b = 1 / (this.vBoxMax.z - this.vBoxMin.z), w = 0; w < d; w++) {
                            var x = this.atoms[w].coord;
                            if (n = Math.floor((x.x - this.vBoxMin.x) * f * _) + Math.floor((x.y - this.vBoxMin.y) * f * g) * f + Math.floor((x.z - this.vBoxMin.z) * f * b) * f * f, (r = this.voxels[n]) < 0) this.voxels[n] = w;
                            else {
                                for (; r >= 0 && !(this.voxelsRefs[2 * r + 1] < 0);) r = this.voxelsRefs[2 * r + 1];
                                this.voxelsRefs[2 * r + 1] = w
                            }
                        }
                        for (var S = 0, C = 0, P = 0; P < f; P++)
                            for (var E = P * f * f, O = 0; O < f; O++)
                                for (var A = O * f, T = 0; T < f; T++)
                                    if (n = T + A + E, !((r = this.voxels[n]) < 0)) {
                                        for (var k = 0, I = 0, M = 0, N = 0; r >= 0;) k += (o = this.atoms[r]).coord.x, I += o.coord.y, M += o.coord.z, N++, r = this.voxelsRefs[2 * r + 1];
                                        k *= 1 / N, I *= 1 / N, M *= 1 / N;
                                        for (var L = 0; L < 8; L++) p[L] = 0;
                                        var j = 0;
                                        for (r = this.voxels[n]; r >= 0;) {
                                            var D = (o = this.atoms[r]).coord.x - k,
                                                V = o.coord.y - I,
                                                F = o.coord.z - M,
                                                B = Math.sqrt(D * D + V * V + F * F) + o.radius;
                                            B > j && (j = B), u = t.getIndex(e, this.atoms[r]), p[u &= 7]++, r = this.voxelsRefs[2 * r + 1]
                                        }
                                        for (var z = 0, U = 1; U < 8; U++) p[U] > p[z] && (z = U);
                                        var G = new c.Color(t.getAtomColor(e, this.atoms[z]));
                                        if (0 === this.colorMode && (a = this.atomColors[z].x, s = this.atomColors[z].y, l = this.atomColors[z].z), 1 === this.colorMode) {
                                            var H = this.complex.monomerTypeArray[u].color;
                                            a = H.r, s = H.g, l = H.b
                                        }
                                        1 !== this.colorMode && 0 !== this.colorMode && (a = this.atomColors[z].x, s = this.atomColors[z].y, l = this.atomColors[z].z), G.set(k, I, M), i[S] = new ws(G, j), i[S].colorX = a, i[S].colorY = s, i[S].colorZ = l, S++, C = N > C ? N : C
                                    } return this.voxelsRefs = null, this.voxels = null, i
                    }
                }]) && Cs(t.prototype, n), r && Cs(t, r), e
            }();
            Ps.prototype.atomColors = [new c.Vector3(.8, .8, .8), new c.Vector3(.99, .99, .99), new c.Vector3(.9, .2, .2), new c.Vector3(.2, .2, .9), new c.Vector3(.3, .9, .2), new c.Vector3(.9, .9, .2), new c.Vector3(0, 0, 0), new c.Vector3(.6, .6, .6)], Ps.prototype.resiudeColors = [new c.Vector3(.9, .9, .2), new c.Vector3(0, .9, .9), new c.Vector3(.9, .1, .9), new c.Vector3(.9, .4, .6), new c.Vector3(.9, .6, .4), new c.Vector3(.4, .6, .9), new c.Vector3(.9, .4, .7), new c.Vector3(.7, .3, .6)], Ps.prototype.chainColors = [new c.Vector3(.1, .1, .1), new c.Vector3(.3, .3, .3), new c.Vector3(.7, .7, .7), new c.Vector3(.9, .9, .9), new c.Vector3(.5, .2, .2), new c.Vector3(.3, .7, .7), new c.Vector3(.7, .3, .7), new c.Vector3(.8, .2, .5)];
            var Es = Ps;

            function Os(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var As = function() {
                function e(t, n, r) {
                    var o;
                    for (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._maxNumVertices = t, this._maxNumTriangles = n, this._vertices = new Array(t), this._normals = new Array(t), this._colors = null, r && (this._colors = new Array(t)), this._indices = new Array(3 * n), this._numVertices = 0, this._numTriangles = 0, o = 0; o < t; o++) this._vertices[o] = new c.Vector3, this._normals[o] = new c.Vector3;
                    for (o = 0; o < 3 * n; o++) this._indices[o] = -1;
                    if (r)
                        for (o = 0; o < t; o++) this._colors[o] = new c.Vector3
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "destroy",
                    value: function() {
                        this._vertices = null, this._normals = null, this._indices = null
                    }
                }]) && Os(t.prototype, n), r && Os(t, r), e
            }();

            function Ts(e) {
                return (Ts = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ks(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Rs(e, t) {
                return !t || "object" !== Ts(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Is(e) {
                return (Is = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ms(e, t) {
                return (Ms = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ns = hr.Element;

            function Ls(e) {
                return (Ls = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function js(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ds(e, t) {
                return !t || "object" !== Ls(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Vs(e) {
                return (Vs = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Fs(e, t) {
                return (Fs = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Bs = {
                InstancedSpheresGeometry: wo,
                SimpleSpheresGeometry: Ho,
                Simple2CCylindersGeometry: ti,
                Instanced2CCylindersGeometry: xi,
                ExtrudedObjectsGeometry: Ii,
                ChunkedLinesGeometry: fa,
                TwoColorLinesGeometry: ba,
                CrossGeometry: ka,
                QuickSurfGeometry: ps,
                ContactSurfaceGeometry: bs,
                SSIsosurfaceGeometry: function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), Rs(this, Is(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Ms(e, t)
                    }(t, Fa), n = t, (r = [{
                        key: "_build",
                        value: function() {
                            this._innerBuild();
                            var e = this.getGeo();
                            this.destroy(), this._fromGeo(e)
                        }
                    }, {
                        key: "_fromGeo",
                        value: function(e) {
                            var t = null,
                                n = R.allocateTyped(Float32Array, 3 * e._numVertices),
                                r = R.allocateTyped(Float32Array, 3 * e._numVertices);
                            null !== e._colors && (t = R.allocateTyped(Float32Array, 3 * e._numVertices));
                            for (var o = R.allocateTyped(Uint32Array, 3 * e._numTriangles), i = 0, a = 0; i < e._numVertices; i++) n[a + 0] = e._vertices[i].x, n[a + 1] = e._vertices[i].y, n[a + 2] = e._vertices[i].z, r[a + 0] = e._normals[i].x, r[a + 1] = e._normals[i].y, r[a + 2] = e._normals[i].z, a += 3;
                            if (null !== t)
                                for (var s = 0, l = 0; s < e._numVertices; s++, l += 3) t[l + 0] = e._colors[s].x, t[l + 1] = e._colors[s].y, t[l + 2] = e._colors[s].z;
                            for (var u = 3 * e._numTriangles, p = 0; p < u; p++) o[p] = e._indices[p];
                            this.setIndex(new c.BufferAttribute(o, 1)), this.addAttribute("position", new c.BufferAttribute(n, 3)), this.addAttribute("normal", new c.BufferAttribute(r, 3)), this.addAttribute("color", new c.BufferAttribute(t, 3)), this.computeBoundingBox(), this.computeBoundingSphere(), e.destroy()
                        }
                    }, {
                        key: "convertToAtomsColored",
                        value: function(e, t) {
                            for (var n = e.atoms, r = e.colors, o = 0, i = n.length; o < i; o++) {
                                var a = n[o].getPosition(),
                                    s = n[o].element.radius;
                                t[o] = new ws(a, s);
                                var l = n[o].element.number;
                                t[o].atomType = this.getType(l);
                                var c = 3 * o;
                                t[o].colorX = r[c++], t[o].colorY = r[c++], t[o].colorZ = r[c], t[o].srcAtom = n[o]
                            }
                        }
                    }, {
                        key: "getGeo",
                        value: function() {
                            return this.geoOut
                        }
                    }, {
                        key: "destroy",
                        value: function() {
                            this.atoms = null, this.hashLines = null, this.hashEntries = null
                        }
                    }, {
                        key: "getBoundingBox",
                        value: function(e, t, n) {
                            t.x = t.y = t.z = 1e7, n.x = n.y = n.z = -1e7;
                            for (var r = this.probeRadius * this.atomRadiusScale, o = 0, i = 0, a = e.length; i < a; i++) {
                                var s = e[i].coord,
                                    l = e[i].radius + r;
                                o = l > o ? l : o, s.x - l < t.x && (t.x = s.x - l), s.y - l < t.y && (t.y = s.y - l), s.z - l < t.z && (t.z = s.z - l), s.x + l > n.x && (n.x = s.x + l), s.y + l > n.y && (n.y = s.y + l), s.z + l > n.z && (n.z = s.z + l)
                            }
                            t.x -= o, t.y -= o, t.z -= o, n.x += o, n.y += o, n.z += o
                        }
                    }, {
                        key: "getCornerCoord",
                        value: function(e, t, n, r, o, i, a) {
                            var s = 1 / (i - 1),
                                l = n * s,
                                c = r * s,
                                u = o * s;
                            a.x = e.x * (1 - l) + t.x * l, a.y = e.y * (1 - c) + t.y * c, a.z = e.z * (1 - u) + t.z * u
                        }
                    }, {
                        key: "buildEdgePoint",
                        value: function(e, t, n, r, o, i) {
                            if (n[e] ^ n[t]) {
                                var a = (0 - r.pointsValuesLinear[o + 24 + e]) / (r.pointsValuesLinear[o + 24 + t] - r.pointsValuesLinear[o + 24 + e]),
                                    s = r.pointsValuesLinear[o + 3 * e + 0],
                                    l = r.pointsValuesLinear[o + 3 * e + 1],
                                    c = r.pointsValuesLinear[o + 3 * e + 2],
                                    u = r.pointsValuesLinear[o + 3 * t + 0],
                                    p = r.pointsValuesLinear[o + 3 * t + 1],
                                    f = r.pointsValuesLinear[o + 3 * t + 2];
                                i.x = s * (1 - a) + u * a, i.y = l * (1 - a) + p * a, i.z = c * (1 - a) + f * a
                            }
                        }
                    }, {
                        key: "isTriangleVisible",
                        value: function(e, t, n) {
                            var r = this.voxelWorld.getClosestAtom(e),
                                o = this.voxelWorld.getClosestAtom(t),
                                i = this.voxelWorld.getClosestAtom(n);
                            return null !== r && null !== o && null !== i && null !== r.srcAtom && null !== o.srcAtom && null !== i.srcAtom && (this.visibilitySelector.includesAtom(r.srcAtom) && this.visibilitySelector.includesAtom(o.srcAtom) && this.visibilitySelector.includesAtom(i.srcAtom))
                        }
                    }, {
                        key: "addTriangle",
                        value: function(e, t, n) {
                            if (this.visibilitySelector && !this.isTriangleVisible(e, t, n)) return !0;
                            var r = this.geoOut;
                            if (r._numTriangles >= this.maxNumTriangles) return !1;
                            var o = this.addVertexToGeo(r, e),
                                i = this.addVertexToGeo(r, t),
                                a = this.addVertexToGeo(r, n);
                            if ((o | i | a) < 0) return !1;
                            var s = 3 * r._numTriangles;
                            return r._indices[s + 0] = o, r._indices[s + 1] = i, r._indices[s + 2] = a, r._numTriangles++, !0
                        }
                    }, {
                        key: "buildGeoFromCorners",
                        value: function(e, t, n, r, o, i) {
                            for (var a = e - 1, s = e, l = e * e, u = new Array(12), p = 0; p < 12; p++) u[p] = new c.Vector3;
                            for (var f = [], h = 0; h < 8; h++) f[h] = 1;
                            for (var d = new c.Vector3, m = 0, y = 0, v = 0; v < a; v++, y += l)
                                for (var _ = 0, g = 0; g < a; g++, _ += s)
                                    for (var b = 0; b < a; b++)
                                        if (i.hasIntersection[m]) {
                                            var w = i.bitsInside[m];
                                            this.getCornerCoord(t, n, b, v, g, e, d);
                                            for (var x = 32 * m, S = 0, C = 0; S < 8; S++) i.pointsValuesLinear[x + C] = d.x, C++, i.pointsValuesLinear[x + C] = d.y, C++, i.pointsValuesLinear[x + C] = d.z, C++;
                                            i.pointsValuesLinear[x + 3] += o.x, i.pointsValuesLinear[x + 6] += o.x, i.pointsValuesLinear[x + 15] += o.x, i.pointsValuesLinear[x + 18] += o.x, i.pointsValuesLinear[x + 6 + 2] += o.z, i.pointsValuesLinear[x + 9 + 2] += o.z, i.pointsValuesLinear[x + 18 + 2] += o.z, i.pointsValuesLinear[x + 21 + 2] += o.z, i.pointsValuesLinear[x + 12 + 1] += o.y, i.pointsValuesLinear[x + 15 + 1] += o.y, i.pointsValuesLinear[x + 18 + 1] += o.y, i.pointsValuesLinear[x + 21 + 1] += o.y;
                                            for (var P = x + 24, E = 0; E < 8; ++E) f[E] = i.pointsValuesLinear[P + E] < 0 ? 1 : 0;
                                            this.buildEdgePoint(0, 1, f, i, x, u[0]), this.buildEdgePoint(1, 2, f, i, x, u[1]), this.buildEdgePoint(2, 3, f, i, x, u[2]), this.buildEdgePoint(3, 0, f, i, x, u[3]), this.buildEdgePoint(4, 5, f, i, x, u[4]), this.buildEdgePoint(5, 6, f, i, x, u[5]), this.buildEdgePoint(6, 7, f, i, x, u[6]), this.buildEdgePoint(7, 4, f, i, x, u[7]), this.buildEdgePoint(0, 4, f, i, x, u[8]), this.buildEdgePoint(1, 5, f, i, x, u[9]), this.buildEdgePoint(2, 6, f, i, x, u[10]), this.buildEdgePoint(3, 7, f, i, x, u[11]);
                                            for (var O = 16 * w, A = 0, T = 0; A < 6; A++, T += 3) {
                                                var k = i.striIndicesMarchCube[O + T];
                                                if (k < 0) break;
                                                var R = i.striIndicesMarchCube[O + T + 1],
                                                    I = i.striIndicesMarchCube[O + T + 2];
                                                if (!this.addTriangle(u[k], u[R], u[I])) return -2
                                            }
                                            m++
                                        } else m++;
                            return 0
                        }
                    }, {
                        key: "getNumIntersectedCells",
                        value: function(e, t, n, r) {
                            for (var o = e * e, i = 0, a = 0, s = 0, l = 0; l < t; l++, s += o)
                                for (var c = 0, u = 0; u < t; u++, c += e)
                                    for (var p = 0; p < t; p++) {
                                        var f = 32 * a + 24,
                                            h = p + c + s;
                                        r.pointsValuesLinear[f] = n[h], r.pointsValuesLinear[f + 1] = n[h + 1], r.pointsValuesLinear[f + 2] = n[h + e + 1], r.pointsValuesLinear[f + 3] = n[h + e], r.pointsValuesLinear[f + 4] = n[o + h], r.pointsValuesLinear[f + 5] = n[o + h + 1], r.pointsValuesLinear[f + 6] = n[o + h + e + 1], r.pointsValuesLinear[f + 7] = n[o + h + e];
                                        for (var d = 0, m = 0; m < 8; ++m) r.pointsValuesLinear[f + m] < 0 && (d |= 1 << m);
                                        0 === d || 255 === d ? r.hasIntersection[a] = !1 : (r.hasIntersection[a] = !0, i++), r.bitsInside[a] = d, a++
                                    }
                            return i
                        }
                    }, {
                        key: "getType",
                        value: function(e) {
                            var t = [0, 0, 1, 1, 2, 6, 3, 6, 4, 6, 5, 6, 6, 0, 7, 3, 8, 2, 9, 6, 10, 6, 11, 6, 12, 6, 13, 6, 14, 6, 15, 4, 16, 5, 17, 6, 18, 6, 19, 6, 20, 6, 21, 6, 22, 6, 23, 6, 24, 6, 25, 6, 26, 6, 27, 6, 28, 6, 29, 6, 30, 6, 31, 6, 32, 6, 33, 6, 34, 6, 35, 6, 36, 6, 37, 6, 38, 6, 39, 6, 40, 6, 41, 6, 42, 6, 43, 6, 44, 6, 45, 6, 46, 6, 47, 6, 48, 6, 49, 6, 50, 6, 51, 6, 52, 6, 53, 6, 54, 6, 55, 6, 56, 6, 57, 6, 58, 6, 59, 6, 60, 6, 61, 6, 62, 6, 63, 6, 64, 6, 65, 6, 66, 6, 67, 6, 68, 6, 69, 6, 70, 6, 71, 6, 72, 6, 73, 6, 74, 6, 75, 6, 76, 6, 77, 6, 78, 6, 79, 6, 80, 6, 81, 6, 82, 6, 83, 6, 84, 6, 85, 6, 86, 6, 87, 6, 88, 6, 89, 6, 90, 6, 91, 6, 92, 6, 93, 6, 94, 6, 95, 6, 96, 6, 97, 6, 98, 6, 99, 6, 100, 6, 101, 6, 102, 6, 103, 6, 104, 6, 105, 6, 106, 6, 107, 6, 108, 6, 109, 6];
                            if (e < 1 || e > t.length / 2 || 2 * Object.keys(Ns.ByAtomicNumber).length !== t.length) throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");
                            return t[2 * e]
                        }
                    }, {
                        key: "calculateGridCorners",
                        value: function(e, t, n, r, o, i) {
                            for (var a = t * t, s = a * t, l = new c.Vector3, u = new c.Vector3, p = 0; p < s; p++) e[p] = 1e12;
                            for (var f = (t - 1) / (r.x - n.x), h = (t - 1) / (r.y - n.y), d = (t - 1) / (r.z - n.z), m = 0, y = o.length; m < y; m++) {
                                var v = o[m],
                                    _ = v.radius + i,
                                    g = (v.coord.x - _ - n.x) * f,
                                    b = (v.coord.y - _ - n.y) * h,
                                    w = (v.coord.z - _ - n.z) * d,
                                    x = Math.floor(g),
                                    S = Math.floor(b),
                                    C = Math.floor(w),
                                    P = Math.floor((v.coord.x + _ - n.x) * f),
                                    E = Math.floor((v.coord.y + _ - n.y) * h),
                                    O = Math.floor((v.coord.z + _ - n.z) * d);
                                P = ++P <= t - 1 ? P : t - 1, E = ++E <= t - 1 ? E : t - 1, O = ++O <= t - 1 ? O : t - 1;
                                for (var A = S; A <= E; A++)
                                    for (var T = A * a, k = C; k <= O; k++)
                                        for (var R = k * t, I = x; I <= P; I++) {
                                            var M = T + R + I;
                                            this.getCornerCoord(n, r, I, A, k, t, l), u.x = l.x - v.coord.x, u.y = l.y - v.coord.y, u.z = l.z - v.coord.z;
                                            var N = Math.sqrt(u.x * u.x + u.y * u.y + u.z * u.z) - _;
                                            N < e[M] && (e[M] = N)
                                        }
                            }
                        }
                    }, {
                        key: "createVertexHash",
                        value: function(e, t) {
                            if (this.hashLines = R.allocateTyped(Int32Array, 65536), null === this.hashLines) return -1;
                            for (var n = 0, r = 0; n < 32768; n++) this.hashLines[r++] = 0, this.hashLines[r++] = -1;
                            if (this.maxNumVertices = e, this.maxNumTriangles = t, this.numHashEtriesAllocated = e, this.hashEntries = R.allocateTyped(Int32Array, 2 * this.numHashEtriesAllocated), null === this.hashEntries) return -1;
                            for (var o = 0, i = 0; o < this.numHashEtriesAllocated; o++) this.hashEntries[i++] = -1, this.hashEntries[i++] = -1;
                            return this.numHashEntryIndex = 0, 0
                        }
                    }, {
                        key: "getNewHashEntry",
                        value: function() {
                            if (this.numHashEntryIndex < this.numHashEtriesAllocated) {
                                var e = this.numHashEntryIndex;
                                return this.numHashEntryIndex++, e
                            }
                            return -1
                        }
                    }, {
                        key: "addVertexToGeo",
                        value: function(e, t) {
                            var n, r = this.marCubeResoultion << 2,
                                o = new c.Vector3,
                                i = Math.floor(r * (t.x - this.vBoxMin.x) / (this.vBoxMax.x + .01 - this.vBoxMin.x)),
                                a = Math.floor(r * (t.y - this.vBoxMin.y) / (this.vBoxMax.y + .01 - this.vBoxMin.y)),
                                s = 815851 * i + 37633 * Math.floor(r * (t.z - this.vBoxMin.z) / (this.vBoxMax.z + .01 - this.vBoxMin.z)) + 2453543 * a,
                                l = (s &= 32767) + s;
                            if (null !== this.vBoxMin && null !== this.vBoxMax)
                                for (n = this.hashLines[l + 1]; n >= 0; n = this.hashEntries[2 * n + 1]) {
                                    var u = this.hashEntries[2 * n + 0];
                                    if (o.copy(e._vertices[u]), o.x -= t.x, o.y -= t.y, o.z -= t.z, o.x * o.x + o.y * o.y + o.z * o.z < 1e-6) return u
                                }
                            if (e._numVertices >= this.maxNumVertices) return -1;
                            var p = e._numVertices;
                            if (e._vertices[p].copy(t), null !== this.vBoxMin && null !== this.vBoxMax) {
                                if ((n = this.getNewHashEntry()) < 0) return -1;
                                var f = this.hashLines[l + 1];
                                this.hashLines[l + 1] = n, this.hashEntries[2 * n + 0] = p, this.hashEntries[2 * n + 1] = f, this.hashLines[l + 0]++
                            }
                            return e._numVertices++, p
                        }
                    }, {
                        key: "modifyExcludedFromGeo",
                        value: function(e, t, n, r, o, i) {
                            var a, s, l;
                            for (var c = e * e, u = (e - 1) / (r.x - n.x), p = (e - 1) / (r.y - n.y), f = (e - 1) / (r.z - n.z), h = 2 * t * (2 * t), d = 1 / (e - 1), m = 0; m < o._numVertices; m++) {
                                var y = o._vertices[m],
                                    v = 1.1 * t,
                                    _ = Math.floor((y.x - v - n.x) * u),
                                    g = Math.floor((y.y - v - n.y) * p),
                                    b = Math.floor((y.z - v - n.z) * f),
                                    w = Math.floor((y.x + v - n.x) * u),
                                    x = Math.floor((y.y + v - n.y) * p),
                                    S = Math.floor((y.z + v - n.z) * f);
                                _ = _ >= 0 ? _ : 0, b = b >= 0 ? b : 0, w = w <= e - 1 ? w : e - 1, x = x <= e - 1 ? x : e - 1, S = S <= e - 1 ? S : e - 1;
                                for (var C = g = g >= 0 ? g : 0; C <= x; C++)
                                    for (var P = C * c, E = b; E <= S; E++)
                                        for (var O = E * e, A = _; A <= w; A++) {
                                            a = P + O + A;
                                            var T = A * d,
                                                k = n.x * (1 - T) + r.x * T;
                                            T = C * d;
                                            var R = n.y * (1 - T) + r.y * T;
                                            T = E * d;
                                            var I = n.z * (1 - T) + r.z * T,
                                                M = k - y.x,
                                                N = R - y.y,
                                                L = I - y.z,
                                                j = M * M + N * N + L * L;
                                            j < h && (s = Math.sqrt(j), (l = -(s - t)) > 0 ? (i[a] < 0 && (i[a] = l), l > i[a] && (i[a] = l)) : l > i[a] && (i[a] = l))
                                        }
                            }
                            return 0
                        }
                    }, {
                        key: "_innerBuild",
                        value: function() {
                            var e, t = {
                                posRad: this._posRad,
                                colors: this._colors,
                                atoms: this._opts.atoms
                            };
                            this.complex = this._opts.parent, this.atoms = t.atoms, this.meshResolution = this._opts.gridSpacing, this.atomRadiusScale = this._opts.radScale, this.colorMode = this._opts.colorMode, this.probeRadius = this._opts.probeRadius, this.useVertexColors = !0, this.excludeProbe = this._opts.excludeProbe, this.visibilitySelector = this._opts.visibilitySelector, this.clusterizationType = this._opts.clusterizationType, this.geoOut = null, this.hashLines = null, this.hashEntries = null, this.numHashEtriesAllocated = 0, this.numHashEntryIndex = 0, this.maxNumVertices = 0, this.maxNumTriangles = 0;
                            var n = new Array(this.atoms.length);
                            this.convertToAtomsColored(t, n);
                            var r = this.vBoxMin = new c.Vector3,
                                o = this.vBoxMax = new c.Vector3;
                            this.getBoundingBox(n, r, o);
                            var i = this.marCubeResoultion = 4 * this.meshResolution,
                                a = i,
                                s = a * a * a,
                                l = R.allocateTyped(Float32Array, s),
                                u = this.meshResolution,
                                p = 4,
                                f = this.atoms.length;
                            f >= 100 && (p = Math.floor(Math.pow(2 * f, 1 / 3))), u > p && (u = p);
                            var h = this.probeRadius * this.atomRadiusScale,
                                d = null,
                                m = null;
                            this.clusterizationType > 0 ? (d = new Es(this.complex, this.atoms, n, r, o, u, this.colorMode), m = 1 === this.clusterizationType ? d.buildKMeans() : d.buildSimple(), r.x -= 3.5, r.y -= 3.5, r.z -= 3.5, o.x += 3.5, o.y += 3.5, o.z += 3.5, this.calculateGridCorners(l, a, r, o, m, h)) : this.calculateGridCorners(l, a, r, o, n, h);
                            var y = i - 1,
                                v = new Ua;
                            if ((e = v.create(y)) < 0) return e;
                            var _ = new c.Vector3;
                            _.x = (o.x - r.x) / y, _.y = (o.y - r.y) / y, _.z = (o.z - r.z) / y;
                            var g = this.getNumIntersectedCells(a, y, l, v),
                                b = Math.floor(1.2 * g),
                                w = Math.floor(1.2 * g * 2);
                            if (this.geoOut = new As(b, w, this.useVertexColors), (e = this.createVertexHash(b, w)) < 0) return e;
                            var x = h;
                            if (this.excludeProbe && (x = .01), this.voxelWorld = null, this.clusterizationType > 0 ? this.voxelWorld = new Ss(m.length, m, r, o, x) : this.voxelWorld = new Ss(n.length, n, r, o, x), this.voxelWorld.createVoxels(), e = this.buildGeoFromCorners(i, r, o, l, _, v), this.excludeProbe) {
                                if (this.modifyExcludedFromGeo(a, h, r, o, this.geoOut, l), this.geoOut._vertices = null, this.geoOut._colors = null, this.geoOut._indices = null, this.geoOut._normals = null, this.geoOut._numVertices = 0, this.geoOut._numTriangles = 0, this.geoOut = null, g = this.getNumIntersectedCells(a, y, l, v), b = Math.floor(1.2 * g), w = Math.floor(1.2 * g * 2), this.geoOut = new As(b, w, this.useVertexColors), (e = this.createVertexHash(b, w)) < 0) return e;
                                e = this.buildGeoFromCorners(a, r, o, l, _, v)
                            }
                            if (null !== this.voxelWorld) {
                                this.voxelWorld.buildNormals(this.geoOut._vertices.length, this.geoOut._vertices, this.geoOut._normals);
                                var S = 6.5;
                                this.excludeProbe && (S -= 1.5), this.useVertexColors && this.voxelWorld.buildColors(this.geoOut._vertices.length, this.geoOut._vertices, this.geoOut._colors, S)
                            }
                            return this.voxelWorld.destroyVoxels(), this.voxelWorld = null, null !== d && d.destroy(), v.destroy(), e
                        }
                    }]) && ks(n.prototype, r), o && ks(n, o), t
                }(),
                LabelsGeometry: function(e) {
                    function t(e, n) {
                        var r;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = Ds(this, Vs(t).call(this)))._opts = n, r.items = [], r.needsUpdate = !1;
                        var o = -50,
                            i = -50;
                        switch (n.horizontalAlign) {
                            case "left":
                                o = 0;
                                break;
                            case "right":
                                o = -100
                        }
                        switch (n.verticalAlign) {
                            case "top":
                                i = -100;
                                break;
                            case "bottom":
                                i = 0
                        }
                        var a = new c.Vector3(n.dx || 0, n.dy || 0, n.dz || 0);
                        return r.userData = {
                            translation: "translate(".concat(o, "%, ").concat(i, "%)"),
                            offset: a
                        }, r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Fs(e, t)
                    }(t, h), n = t, (r = [{
                        key: "setItem",
                        value: function(e, t, n) {
                            var r = this._opts,
                                o = r.labels,
                                i = this.items[e] || function(e, t) {
                                    var n = document.createElement("div");
                                    if (n.className = t, "string" == typeof e) {
                                        var r = document.createElement("span");
                                        r.style.fontSize = "150%";
                                        for (var o = e.split("\n"), i = 0, a = o.length; i < a; ++i) {
                                            var s = document.createElement("span"),
                                                l = document.createTextNode(o[i]);
                                            s.appendChild(l), r.appendChild(s), i < a - 1 && r.appendChild(document.createElement("br"))
                                        }
                                        n.appendChild(r)
                                    } else n.appendChild(e);
                                    return n.worldPos = new c.Vector3, n
                                }(n, "label label-".concat(o));
                            i.worldPos.copy(t), i.style.textAlign = r.horizontalAlign, i.style.verticalAlign = r.verticalAlign, this.items[e] = i
                        }
                    }, {
                        key: "setColor",
                        value: function(e, t, n) {
                            this.items[e].opts = {
                                color: t,
                                background: n
                            }
                        }
                    }, {
                        key: "startUpdate",
                        value: function() {
                            return !0
                        }
                    }, {
                        key: "finishUpdate",
                        value: function() {
                            this.needsUpdate = !0, this.dispatchEvent({
                                type: "update"
                            })
                        }
                    }, {
                        key: "finalize",
                        value: function() {
                            this.finishUpdate()
                        }
                    }, {
                        key: "raycast",
                        value: function() {}
                    }, {
                        key: "setOpacity",
                        value: function() {}
                    }, {
                        key: "getSubset",
                        value: function() {
                            return []
                        }
                    }]) && js(n.prototype, r), o && js(n, o), t
                }()
            };

            function zs(e) {
                return (zs = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Us(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Gs(e, t) {
                return !t || "object" !== zs(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Hs(e) {
                return (Hs = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ws(e, t) {
                return (Ws = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var qs = function(e) {
                return function(t) {
                    function n() {
                        var e, t;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, n);
                        for (var r = arguments.length, o = new Array(r), i = 0; i < r; i++) o[i] = arguments[i];
                        return (t = Gs(this, (e = Hs(n)).call.apply(e, [this].concat(o)))).onBeforeRender = n.prototype.onBeforeRender, t
                    }
                    var r, o, i;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Ws(e, t)
                    }(n, e), r = n, (o = [{
                        key: "onBeforeRender",
                        value: function(e, t, n, r, o, i) {
                            this._onBeforeRender(e, t, n, r, o, i), this._update()
                        }
                    }, {
                        key: "_onBeforeRender",
                        value: function() {}
                    }, {
                        key: "_update",
                        value: function() {
                            var e = this.material;
                            e && e instanceof Gr && e.updateUniforms()
                        }
                    }]) && Us(r.prototype, o), i && Us(r, i), n
                }()
            };

            function Ys(e) {
                return (Ys = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Xs(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function $s(e, t) {
                return !t || "object" !== Ys(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ks(e) {
                return (Ks = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Zs(e, t) {
                return (Zs = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Qs = qs(c.Mesh),
                Js = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), $s(this, Ks(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Zs(e, t)
                    }(t, Qs), n = t, (r = [{
                        key: "_onBeforeRender",
                        value: function(e, t, n, r, o, i) {
                            Qs.prototype._onBeforeRender.call(this, e, t, n);
                            var a = this.material;
                            a && a.uniforms.invModelViewMatrix && (this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse, this.matrixWorld), a.uniforms.invModelViewMatrix.value.getInverse(this.modelViewMatrix), a.uniformsNeedUpdate = !0)
                        }
                    }]) && Xs(n.prototype, r), o && Xs(n, o), t
                }();

            function el(e) {
                return (el = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function tl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function nl(e, t) {
                return !t || "object" !== el(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function rl(e) {
                return (rl = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ol(e, t) {
                return (ol = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var il = qs(c.Mesh),
                al = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = nl(this, rl(t).call(this, e, n))).castShadow = !0, r.receiveShadow = !0, r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && ol(e, t)
                    }(t, il), n = t, (r = [{
                        key: "_onBeforeRender",
                        value: function(e, t, n) {
                            il.prototype._onBeforeRender.call(this, e, t, n);
                            var r = this.geometry,
                                o = this.material;
                            if (r.zClip && o.uberOptions) {
                                var i = (new c.Matrix4).multiplyMatrices(this.matrixWorld, n.matrixWorldInverse),
                                    a = (new c.Vector3).setFromMatrixColumn(i, 0).length(),
                                    s = (new c.Vector3).copy(r.boundingSphere.center);
                                this.localToWorld(s), o.uberOptions.zClipValue = n.position.z - s.z - a * (.5 * r.boundingSphere.radius)
                            }
                        }
                    }]) && tl(n.prototype, r), o && tl(n, o), t
                }();

            function sl(e) {
                return (sl = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ll(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function cl(e) {
                return (cl = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ul(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function pl(e, t) {
                return (pl = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var fl = function(e) {
                    function t(e, n) {
                        var r;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = function(e, t) {
                            return !t || "object" !== sl(t) && "function" != typeof t ? ul(e) : t
                        }(this, cl(t).call(this))).geometry = e;
                        var o = ul(r);
                        return o.initialized = !1, r.geometry.addEventListener("update", function() {
                            o.update()
                        }), r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && pl(e, t)
                    }(t, c["Group"]), n = t, (r = [{
                        key: "init",
                        value: function() {
                            for (var e = this.children, t = e.length - 1; t >= 0; --t) this.remove(e[t]);
                            for (var n = this.geometry, r = n.items, o = n.userData, i = 0, a = r.length; i < a; ++i) {
                                var s = r[i];
                                if (s) {
                                    var c = R.shallowCloneNode(s),
                                        u = new gr(c);
                                    u.userData = l.a.clone(o), u.getElement().style.visibility = "visible", u.source = s, this.add(u)
                                }
                            }
                            this.initialized = !0
                        }
                    }, {
                        key: "update",
                        value: function() {
                            if (this.geometry.needsUpdate) {
                                var e = this.children;
                                this.initialized || this.init();
                                for (var t = 0, n = e.length; t < n; ++t) {
                                    var r = e[t],
                                        o = r.source;
                                    r.position.copy(o.worldPos), r.userData.color = o.opts.color, r.userData.background = o.opts.background
                                }
                            }
                        }
                    }]) && ll(n.prototype, r), o && ll(n, o), t
                }(),
                hl = qs(c.Mesh);

            function dl(e, t) {
                hl.call(this, e, t), this.castShadow = !0, this.receiveShadow = !0
            }
            dl.prototype = Object.create(hl.prototype), dl.prototype.constructor = dl;
            var ml = dl;

            function yl(e) {
                return (yl = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function vl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function _l(e, t) {
                return !t || "object" !== yl(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function gl(e) {
                return (gl = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function bl(e, t) {
                return (bl = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var wl = qs(c.Mesh),
                xl = new c.Vector2,
                Sl = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), _l(this, gl(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && bl(e, t)
                    }(t, wl), n = t, (r = [{
                        key: "_onBeforeRender",
                        value: function(e, t, n, r, o, i) {
                            var a = this.material;
                            a.uberOptions && (a.uberOptions.projMatrixInv.getInverse(n.projectionMatrix, !0), e.getSize(xl), a.uberOptions.viewport.set(xl.width, xl.height))
                        }
                    }]) && vl(n.prototype, r), o && vl(n, o), t
                }(),
                Cl = {
                    ZClipped: al,
                    ZSprite: Js,
                    Text: fl,
                    Line: qs(c.Line),
                    LineSegments: qs(c.LineSegments),
                    Mesh: ml,
                    ThickLineMesh: Sl
                };

            function Pl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function El(e, t) {
                return function(n) {
                    n.setValues(e), n.setUberOptions(t)
                }
            }

            function Ol(e, t) {
                return {
                    Geometry: function(n, r) {
                        return new Bs.Instanced2CCylindersGeometry(n, r, e, t)
                    },
                    Object: Cl.ZSprite,
                    initMaterial: El({
                        instancedMatrix: !0,
                        attrColor: !0,
                        attrColor2: !0,
                        attrAlphaColor: !0,
                        cylinderSprite: e
                    })
                }
            }

            function Al(e, t) {
                var n = e.prototype instanceof Hi,
                    r = t.lineWidth || 0;
                return {
                    Geometry: e,
                    Object: n ? Cl.ThickLineMesh : Cl.LineSegments,
                    initMaterial: El({
                        lights: !1,
                        attrColor: !0,
                        attrAlphaColor: !0,
                        thickLine: n
                    }, {
                        lineWidth: r
                    })
                }
            }

            function Tl(e, t, n, r) {
                var o = {
                    wireframe: !!r.wireframe,
                    fakeOpacity: n.now.isoSurfaceFakeOpacity,
                    zClip: r.zClip
                };
                return {
                    Geometry: e,
                    Object: Cl.ZClipped,
                    initMaterial: El({
                        attrColor: !0,
                        attrAlphaColor: !1,
                        wireframe: o.wireframe,
                        fakeOpacity: o.fakeOpacity,
                        zClip: o.zClip
                    })
                }
            }
            var kl = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e)
                }
                var t, n, r;
                return t = e, r = [{
                    key: "createSpheres",
                    value: function(e, t) {
                        var n = t.now.zSprites;
                        return {
                            Geometry: function(e, t) {
                                return new Bs.InstancedSpheresGeometry(e, t, n)
                            },
                            Object: Cl.ZSprite,
                            initMaterial: El({
                                instancedPos: !0,
                                attrColor: !0,
                                attrAlphaColor: !0,
                                sphereSprite: n
                            })
                        }
                    }
                }, {
                    key: "create2CClosedCylinders",
                    value: function(e, t) {
                        return Ol(!1, !1)
                    }
                }, {
                    key: "create2CCylinders",
                    value: function(e, t) {
                        return Ol(t.now.zSprites, !0)
                    }
                }, {
                    key: "create2CLines",
                    value: function(e, t, n) {
                        return Al(Bs.TwoColorLinesGeometry, n)
                    }
                }, {
                    key: "createCrosses",
                    value: function(e, t, n) {
                        return Al(Bs.CrossGeometry, n)
                    }
                }, {
                    key: "createExtrudedChains",
                    value: function(e, t) {
                        return {
                            Geometry: Bs.ExtrudedObjectsGeometry,
                            Object: Cl.Mesh,
                            initMaterial: El({
                                attrColor: !0,
                                attrAlphaColor: !0
                            })
                        }
                    }
                }, {
                    key: "createChunkedLines",
                    value: function(e, t, n) {
                        return Al(Bs.ChunkedLinesGeometry, n)
                    }
                }, {
                    key: "createQuickSurface",
                    value: function(e, t, n) {
                        return Tl(Bs.QuickSurfGeometry, 0, t, n)
                    }
                }, {
                    key: "createContactSurface",
                    value: function(e, t, n) {
                        return Tl(Bs.ContactSurfaceGeometry, 0, t, n)
                    }
                }, {
                    key: "createSASSES",
                    value: function(e, t, n) {
                        return Tl(Bs.SSIsosurfaceGeometry, 0, t, n)
                    }
                }, {
                    key: "createLabels",
                    value: function(e, t) {
                        return {
                            Geometry: Bs.LabelsGeometry,
                            Object: Cl.Text,
                            initMaterial: function() {}
                        }
                    }
                }], (n = null) && Pl(t.prototype, n), r && Pl(t, r), e
            }();

            function Rl(e) {
                return (Rl = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Il(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ml(e, t) {
                return !t || "object" !== Rl(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Nl(e) {
                return (Nl = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ll(e, t) {
                return (Ll = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function jl(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var Dl = function(e) {
                function t(e, n, r, o) {
                    var i;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (i = Ml(this, Nl(t).call(this)))._geometry = e, i._geoParams = n;
                    var a = r.createInstance();
                    n.initMaterial(a), i._material = a, i._transforms = o.length > 0 ? o : [new c.Matrix4];
                    for (var s = i._createMeshes(e), l = 0, u = s.length; l < u; ++l) i.add(s[l]);
                    return i
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Ll(e, t)
                }(t, c["Object3D"]), n = t, (r = [{
                    key: "raycast",
                    value: function(e, n) {
                        var r = t._ray,
                            o = t._inverseMatrix,
                            i = this.children;
                        r.copy(e.ray);
                        for (var a = 0, s = i.length; a < s; ++a) {
                            var l = i[a];
                            l.updateMatrixWorld();
                            var c = l.matrixWorld;
                            o.getInverse(c), e.ray.copy(r).applyMatrix4(o);
                            var u = [];
                            this._geometry.raycast(e, u);
                            for (var p = 0, f = u.length; p < f; ++p) {
                                var h = u[p];
                                h.point && (h.point.applyMatrix4(c), h.distance = r.origin.distanceTo(h.point)), h.object = l, n[n.length] = h
                            }
                        }
                        e.ray.copy(r)
                    }
                }, {
                    key: "getSubset",
                    value: function(e) {
                        for (var t = this._geometry.getSubset(e), n = [], r = 0, o = 0, i = t.length; o < i; ++o)
                            for (var a = this._createMeshes(t[o]), s = 0, l = a.length; s < l; ++s) n[r++] = a[s];
                        return n
                    }
                }, {
                    key: "_createMeshes",
                    value: function(e) {
                        for (var t = this._transforms, n = this._geoParams.Object, r = this._material, o = [], i = 0, a = t.length; i < a; ++i) {
                            var s = new n(e, r);
                            s.applyMatrix(t[i]), o[i] = s
                        }
                        return o
                    }
                }]) && Il(n.prototype, r), o && Il(n, o), t
            }();
            jl(Dl, "_inverseMatrix", new c.Matrix4), jl(Dl, "_ray", new c.Ray);
            var Vl = Dl;

            function Fl(e) {
                return (Fl = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Bl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function zl(e, t) {
                return !t || "object" !== Fl(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ul(e) {
                return (Ul = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Gl(e, t) {
                return (Gl = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Hl(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }
            var Wl = function(e) {
                function t(e, n, r, o, i, a, s) {
                    var l, c, u, p;
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (l = zl(this, Ul(t).call(this))).constructor === t) throw new Error("Can not instantiate abstract class!");
                    return l._selection = n, l._mode = o, l._colorer = r, l._chunksIdc = n.chunks, l._polyComplexity = a, l._geo = new(c = e.Geometry, u = l._makeGeoArgs(), p = [c].concat(u), c.bind.apply(c, Hl(p))), l._mesh = new Vl(l._geo, e, s, i), l.add(l._mesh), l._build(), l
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Gl(e, t)
                }(t, Pr), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        throw new Error("ChemGroup subclass must override _makeGeoArgs() method")
                    }
                }, {
                    key: "getSubset",
                    value: function(e, t) {
                        t = void 0 !== t && t;
                        var n = this._calcChunksList(e, t);
                        return 0 === n.length ? [] : this._mesh.getSubset(n)
                    }
                }, {
                    key: "_changeSubsetOpacity",
                    value: function(e, t, n) {
                        var r = this._calcChunksList(e, n);
                        0 !== r.length && this._geo.setOpacity(r, t)
                    }
                }, {
                    key: "enableSubset",
                    value: function(e, t) {
                        t = void 0 === t || t, this._changeSubsetOpacity(e, 1, t)
                    }
                }, {
                    key: "disableSubset",
                    value: function(e, t) {
                        t = void 0 === t || t, this._changeSubsetOpacity(e, 0, t)
                    }
                }]) && Bl(n.prototype, r), o && Bl(n, o), t
            }();

            function ql(e) {
                return (ql = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Yl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Xl(e, t) {
                return !t || "object" !== ql(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function $l(e) {
                return ($l = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Kl(e, t) {
                return (Kl = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Zl = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Xl(this, $l(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Kl(e, t)
                }(t, Wl), n = t, (r = [{
                    key: "raycast",
                    value: function(e, t) {
                        var n = this._selection.atoms,
                            r = [];
                        this._mesh.raycast(e, r);
                        for (var o = this._chunksIdc, i = 0, a = r.length; i < a; ++i)
                            if (r[i].hasOwnProperty("chunkIdx")) {
                                var s = o[r[i].chunkIdx];
                                s < n.length && (r[i].atom = n[s], t.push(r[i]))
                            }
                    }
                }, {
                    key: "_calcChunksList",
                    value: function(e) {
                        for (var t = [], n = this._selection.atoms, r = this._chunksIdc, o = 0, i = r.length; o < i; ++o) {
                            0 != (n[r[o]]._mask & e) && t.push(o)
                        }
                        return t
                    }
                }]) && Yl(n.prototype, r), o && Yl(n, o), t
            }();

            function Ql(e) {
                return (Ql = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Jl(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ec(e, t) {
                return !t || "object" !== Ql(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function tc(e) {
                return (tc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function nc(e, t) {
                return (nc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var rc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), ec(this, tc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && nc(e, t)
                }(t, Zl), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        return [this._selection.chunks.length, this._polyComplexity]
                    }
                }, {
                    key: "_build",
                    value: function() {
                        for (var e = this._selection.chunks, t = this._selection, n = t.atoms, r = t.parent, o = this._mode, i = this._colorer, a = this._geo, s = 0, l = e.length; s < l; ++s) {
                            var c = n[e[s]];
                            a.setItem(s, c._position, o.calcAtomRadius(c)), a.setColor(s, i.getAtomColor(c, r))
                        }
                        a.finalize()
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        for (var t = this._selection.chunks, n = this._selection.atoms, r = this._mode, o = this._colorer, i = e.needsColorUpdate(o), a = this._geo, s = 0, l = t.length; s < l; ++s) {
                            var c = n[t[s]];
                            a.setItem(s, e.getAtomPos(t[s]), r.calcAtomRadius(c)), i && a.setColor(s, e.getAtomColor(o, c))
                        }
                        a.finalize()
                    }
                }]) && Jl(n.prototype, r), o && Jl(n, o), t
            }();

            function oc(e) {
                return (oc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ic(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ac(e, t) {
                return !t || "object" !== oc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function sc(e) {
                return (sc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function lc(e, t) {
                return (lc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var cc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), ac(this, sc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && lc(e, t)
                }(t, rc), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        for (var e = [], t = this._selection, n = t.atoms, r = t.chunks, o = r.length, i = 0; i < o; ++i) e[i] = n[r[i]];
                        var a = this._mode.getSurfaceOpts();
                        return a.atoms = e, [o, a]
                    }
                }]) && ic(n.prototype, r), o && ic(n, o), t
            }();

            function uc(e) {
                return (uc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function pc(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function fc(e, t) {
                return !t || "object" !== uc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function hc(e) {
                return (hc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function dc(e, t) {
                return (dc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var mc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), fc(this, hc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && dc(e, t)
                }(t, rc), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        for (var e = [], t = this._selection, n = t.atoms, r = t.chunks, o = r.length, i = 0; i < o; ++i) e[i] = n[r[i]];
                        var a = this._mode.getSurfaceOpts();
                        return a.atoms = e, a.selection = this._selection, a.colorMode = this._colorer, [o, a]
                    }
                }]) && pc(n.prototype, r), o && pc(n, o), t
            }();

            function yc(e) {
                return (yc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function vc(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function _c(e, t) {
                return !t || "object" !== yc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function gc(e) {
                return (gc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function bc(e, t) {
                return (bc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function wc(e) {
                return null !== e.getName().getNode() ? e.getName().getNode() : e.isLabelVisible() ? e.getVisualName() : null
            }
            var xc = {
                none: function(e) {
                    return e
                },
                adjust: function(e) {
                    var t = e >> 16 & 255,
                        n = e >> 8 & 255,
                        r = 255 & e;
                    return .2126 * t + .7152 * n + .0722 * r > 127 ? (t = 3 * t / 10, n = 3 * n / 10, r = 3 * r / 10) : (t = 255 - 3 * (255 - t) / 10, n = 255 - 3 * (255 - n) / 10, r = 255 - 3 * (255 - r) / 10), t << 16 | n << 8 | r
                },
                inverse: function(e) {
                    return 255 - (e >> 16 & 255) << 16 | 255 - (e >> 8 & 255) << 8 | 255 - (255 & e)
                }
            };

            function Sc(e, t) {
                var n;
                if (xc.hasOwnProperty(t)) n = R.hexColor(xc[t](e));
                else {
                    var r = parseInt(t, 16);
                    n = !Number.isNaN(r) && t.toLowerCase().startsWith("0x") ? R.hexColor(r) : "#000000"
                }
                return n
            }
            var Cc = {
                    serial: function(e) {
                        return e.getSerial()
                    },
                    name: function(e) {
                        return e.getVisualName()
                    },
                    elem: function(e) {
                        return e.element.name
                    },
                    residue: function(e) {
                        return e._residue.getType().getName()
                    },
                    sequence: function(e) {
                        return e._residue.getSequence()
                    },
                    chain: function(e) {
                        return e._residue.getChain().getName()
                    },
                    hetatm: function(e) {
                        return e.isHet()
                    },
                    water: function(e) {
                        return "HOH" === e._residue.getType().getName() || "WAT" === e._residue.getType().getName()
                    }
                },
                Pc = function(e, t) {
                    return t.replace(/\{\{(\s*\w+\s*)\}\}/g, function(t) {
                        var n = t.replace(/\s+/g, "");
                        return n = n.substring(2, n.length - 2).toLowerCase(), Cc.hasOwnProperty(n) ? Cc[n](e) : "null"
                    })
                },
                Ec = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), _c(this, gc(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && bc(e, t)
                    }(t, Zl), n = t, (r = [{
                        key: "_makeGeoArgs",
                        value: function() {
                            var e = this._mode.getLabelOpts();
                            return [this._selection.chunks.length, e]
                        }
                    }, {
                        key: "_build",
                        value: function() {
                            for (var e = this._mode.getLabelOpts(), t = this._selection.chunks, n = this._selection, r = n.atoms, o = n.parent, i = this._colorer, a = this._geo, s = 0, l = t.length; s < l; ++s) {
                                var c = r[t[s]],
                                    u = e.template ? Pc(c, e.template) : wc(c);
                                if (u) {
                                    var p = i.getAtomColor(c, o),
                                        f = parseInt(Sc(p, e.fg).substring(1), 16),
                                        h = e.showBg ? parseInt(Sc(p, e.bg).substring(1), 16) : "transparent";
                                    a.setItem(s, c.getPosition(), u), a.setColor(s, f, h)
                                }
                            }
                            a.finalize()
                        }
                    }, {
                        key: "updateToFrame",
                        value: function(e) {
                            for (var t = this._mode.getLabelOpts(), n = this._selection.chunks, r = this._selection.atoms, o = this._colorer, i = this._geo, a = e.needsColorUpdate(o), s = 0, l = n.length; s < l; ++s) {
                                var c = r[n[s]],
                                    u = t.template ? Pc(c, t.template) : wc(c);
                                if (u) {
                                    var p = e.getAtomColor(o, c),
                                        f = parseInt(Sc(p, t.fg).substring(1), 16),
                                        h = t.showBg ? parseInt(Sc(p, t.bg).substring(1), 16) : "transparent";
                                    i.setItem(s, e.getAtomPos(n[s]), u), a && i.setColor(s, f, h)
                                }
                            }
                            i.finalize()
                        }
                    }]) && vc(n.prototype, r), o && vc(n, o), t
                }();

            function Oc(e) {
                return (Oc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ac(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Tc(e, t) {
                return !t || "object" !== Oc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function kc(e) {
                return (kc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Rc(e, t) {
                return (Rc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Ic(e, t, n, r) {
                var o = Math.sin(e);
                return t.clone().multiplyScalar(Math.sin((1 - r) * e) / o).addScaledVector(n, Math.sin(r * e) / o)
            }
            var Mc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Tc(this, kc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Rc(e, t)
                }(t, Zl), n = t, (r = [{
                    key: "_buildInner",
                    value: function(e, t) {
                        for (var n = this._selection.chunks, r = new c.Vector3, o = new c.Vector3, i = this._segmentsHeight, a = 1 / i, s = this._colorer, l = this._selection, u = l.cycles, p = l.parent, f = 0, h = n[f], d = 0, m = u.length; d < m; ++d) {
                            var y = u[d],
                                v = y.atoms,
                                _ = [],
                                g = [],
                                b = y.center,
                                w = y.radius - e,
                                x = v.length,
                                S = 0,
                                C = v[x - 1]._position,
                                P = v[S]._position;
                            r.subVectors(C, b), o.subVectors(P, b);
                            for (var E = o.clone().cross(r).normalize(); S < x; ++S) {
                                var O = r.angleTo(o);
                                g[S] = Ic(O, r, o, .5).normalize(), P = v[(S + 1) % x]._position, r.copy(o), o.subVectors(P, b)
                            }
                            for (S = 0; S < x; ++S)
                                if (v[S]._index === h) {
                                    for (var A = g[S], T = g[(S + 1) % x], k = s.getAtomColor(v[S], p), R = A.angleTo(T), I = 0; I <= i; ++I) _[I] = Ic(R, A, T, I * a).multiplyScalar(w).add(b);
                                    t(f++, k, _, b, E), h = n[f]
                                }
                        }
                    }
                }]) && Ac(n.prototype, r), o && Ac(n, o), t
            }();

            function Nc(e) {
                return (Nc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Lc(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function jc(e, t) {
                return !t || "object" !== Nc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Dc(e) {
                return (Dc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Vc(e, t) {
                return (Vc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Fc(e, t) {
                for (var n = [], r = 0; r < t; ++r) {
                    var o = 2 * r / t * Math.PI;
                    n.push(new c.Vector3(Math.cos(o) * e, Math.sin(o) * e, 0))
                }
                return n
            }
            var Bc = $r.calcChunkMatrix,
                zc = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), jc(this, Dc(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Vc(e, t)
                    }(t, Mc), n = t, (r = [{
                        key: "_build",
                        value: function() {
                            var e = this._segmentsHeight,
                                t = this._mode.getAromRadius(),
                                n = new c.Vector2(t, t),
                                r = this._mode.calcStickRadius() + 2 * t,
                                o = new c.Vector3,
                                i = [],
                                a = this._geo;
                            this._buildInner(r, function(t, r, s, l, c) {
                                for (var u = 0; u <= e; ++u) {
                                    var p = s[u],
                                        f = p.clone().sub(l).cross(c);
                                    o.addVectors(p, f), i[u] = Bc(p, o, c, n)
                                }
                                a.setItem(t, i), a.setColor(t, r)
                            }), a.finalize()
                        }
                    }, {
                        key: "_makeGeoArgs",
                        value: function() {
                            return this._segmentsHeight = this._polyComplexity, [Fc(1, this._polyComplexity), this._segmentsHeight + 1, this._selection.chunks.length]
                        }
                    }]) && Lc(n.prototype, r), o && Lc(n, o), t
                }();

            function Uc(e) {
                return (Uc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Gc(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Hc(e, t) {
                return !t || "object" !== Uc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Wc(e) {
                return (Wc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function qc(e, t) {
                return (qc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Yc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Hc(this, Wc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && qc(e, t)
                }(t, Mc), n = t, (r = [{
                    key: "_build",
                    value: function() {
                        var e = this,
                            t = this._geo,
                            n = this._mode.getAromaticOffset();
                        this._buildInner(n, function(n, r, o) {
                            for (var i = o[0], a = 1; a <= e._segmentsHeight; ++a) {
                                var s = o[a];
                                t.setSegment(n, a - 1, i, s), i = s
                            }
                            t.setColor(n, r)
                        }), t.finalize()
                    }
                }, {
                    key: "_makeGeoArgs",
                    value: function() {
                        return this._segmentsHeight = this._mode.getAromaticArcChunks(), [this._selection.chunks.length, this._segmentsHeight, !0]
                    }
                }]) && Gc(n.prototype, r), o && Gc(n, o), t
            }();

            function Xc(e) {
                return (Xc = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function $c(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Kc(e, t) {
                return !t || "object" !== Xc(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Zc(e) {
                return (Zc = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Qc(e, t) {
                return (Qc = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Jc = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Kc(this, Zc(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Qc(e, t)
                }(t, Wl), n = t, (r = [{
                    key: "raycast",
                    value: function(e, t) {
                        var n = this._selection.residues,
                            r = [];
                        this._mesh.raycast(e, r);
                        for (var o = this._chunksIdc, i = 0, a = r.length; i < a; ++i)
                            if (r[i].hasOwnProperty("chunkIdx")) {
                                var s = o[r[i].chunkIdx];
                                s < n.length && (r[i].residue = n[s], t.push(r[i]))
                            }
                    }
                }, {
                    key: "_calcChunksList",
                    value: function(e) {
                        for (var t = [], n = this._selection.residues, r = this._chunksIdc, o = 0, i = r.length; o < i; ++o) {
                            0 != (n[r[o]]._mask & e) && t.push(o)
                        }
                        return t
                    }
                }]) && $c(n.prototype, r), o && $c(n, o), t
            }();

            function eu(e) {
                return (eu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function tu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function nu(e, t) {
                return !t || "object" !== eu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ru(e) {
                return (ru = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ou(e, t) {
                return (ou = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var iu = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), nu(this, ru(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && ou(e, t)
                }(t, Jc), n = t, (r = [{
                    key: "raycast",
                    value: function(e, t) {
                        var n = this._selection.residues,
                            r = [];
                        this._mesh.raycast(e, r);
                        for (var o = this._chunksIdc, i = 0, a = r.length; i < a; ++i)
                            if (r[i].hasOwnProperty("chunkIdx")) {
                                var s = o[Math.floor(r[i].chunkIdx / 2)];
                                s < n.length && (r[i].residue = n[s], t.push(r[i]))
                            }
                    }
                }, {
                    key: "_build",
                    value: function() {
                        for (var e = this._selection, t = e.residues, n = e.parent, r = this._colorer, o = this._geo, i = this._mode.calcStickRadius(), a = 0, s = this._selection.chunks, l = 0, c = s.length; l < c; ++l) {
                            var u = t[s[l]],
                                p = r.getResidueColor(u, n);
                            this._processItem(a++, u._cylinders[0], u._cylinders[1], i, p)
                        }
                        o.finalize()
                    }
                }, {
                    key: "_calcChunksList",
                    value: function(e) {
                        for (var t = [], n = 0, r = this._selection.residues, o = this._chunksIdc, i = 0, a = o.length; i < a; ++i) {
                            0 != (r[o[i]]._mask & e) && (t[n++] = 2 * i, t[n++] = 2 * i + 1)
                        }
                        return t
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        for (var t = e.getResidues(), n = this._selection.parent, r = this._colorer, o = this._geo, i = this._mode.calcStickRadius(), a = 0, s = this._selection.chunks, l = 0, c = s.length; l < c; ++l) {
                            var u = t[s[l]],
                                p = r.getResidueColor(u, n);
                            this._processItem(a++, u._cylinders[0], u._cylinders[1], i, p)
                        }
                        o.finishUpdate()
                    }
                }]) && tu(n.prototype, r), o && tu(n, o), t
            }();

            function au(e) {
                return (au = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function su(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function lu(e, t) {
                return !t || "object" !== au(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function cu(e) {
                return (cu = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function uu(e, t) {
                return (uu = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var pu = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), lu(this, cu(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && uu(e, t)
                }(t, iu), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        return [this._selection.chunks.length, this._polyComplexity]
                    }
                }, {
                    key: "_processItem",
                    value: function(e, t, n, r, o) {
                        var i = this._geo;
                        i.setItem(e, t, n, r), i.setColor(e, o, o)
                    }
                }]) && su(n.prototype, r), o && su(n, o), t
            }();

            function fu(e) {
                return (fu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function hu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function du(e, t) {
                return !t || "object" !== fu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function mu(e) {
                return (mu = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function yu(e, t) {
                return (yu = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var vu = function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), du(this, mu(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && yu(e, t)
                    }(t, iu), n = t, (r = [{
                        key: "_makeGeoArgs",
                        value: function() {
                            return [2 * this._selection.chunks.length, this._polyComplexity]
                        }
                    }, {
                        key: "_processItem",
                        value: function(e, t, n, r, o) {
                            var i = this._geo,
                                a = 2 * e;
                            i.setItem(a, t, r), i.setColor(a, o), a++, i.setItem(a, n, r), i.setColor(a, o)
                        }
                    }]) && hu(n.prototype, r), o && hu(n, o), t
                }(),
                _u = n("Nq/s");

            function gu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var bu = hr.ResidueType,
                wu = $r.calcChunkMatrix;

            function xu(e, t) {
                var n = Object(_u.Smooth)(e, {
                    method: _u.Smooth.METHOD_CUBIC,
                    clip: _u.Smooth.CLIP_CLAMP,
                    cubicTension: t,
                    scaleTo: 1
                });
                return function(t, r) {
                    var o = r;
                    null === o && (o = function(t) {
                        return (t * (e.length - 1 - 2) + 1) / (e.length - 1)
                    });
                    var i = o(t),
                        a = n(i);
                    return new c.Vector3(a[0], a[1], a[2])
                }
            }

            function Su(e, t, n, r) {
                if (!r._isValid) return e[n] = e[n - 1], void(t[n] = t[n - 1]);
                var o = r._controlPoint;
                e[n] = [o.x, o.y, o.z];
                var i = o.clone().add(r._wingVector);
                t[n] = [i.x, i.y, i.z]
            }

            function Cu(e, t, n, r) {
                var o = r.start,
                    i = r.end;

                function a(t) {
                    return t > o && e[t - 1]._isValid ? t - 1 : t
                }

                function s(t) {
                    return t < i && e[t + 1]._isValid ? t + 1 : t
                }
                var l = [],
                    c = [],
                    u = 0;

                function p(t, n) {
                    var r = e[t]._controlPoint.clone().lerp(e[n]._controlPoint, -.25),
                        o = r.clone().add(e[t]._wingVector);
                    c[u] = [r.x, r.y, r.z], l[u++] = [o.x, o.y, o.z], c[u] = [r.x, r.y, r.z], l[u++] = [o.x, o.y, o.z]
                }
                var f = a(t),
                    h = s(n);
                if (f === h) return function(e, t, n, r) {
                    var o, i, a = 0 != (r._type.flags & bu.Flags.NUCLEIC),
                        s = a ? "C5'" : "N",
                        l = a ? "C3'" : "C";
                    if (r.forEachAtom(function(e) {
                            var t = e.getVisualName();
                            o || t !== s ? i || t !== l || (i = e._position) : o = e._position
                        }), o && i || (o = r._firstAtom._position, i = r._lastAtom._position), o && i) {
                        var c = i.clone().sub(o),
                            u = r._wingVector,
                            p = r._controlPoint,
                            f = p.clone().add(u),
                            h = p.clone().sub(c),
                            d = h.clone().add(u);
                        e[n] = [h.x, h.y, h.z], t[n] = [d.x, d.y, d.z], e[++n] = [h.x, h.y, h.z], t[n] = [d.x, d.y, d.z], e[++n] = [p.x, p.y, p.z], t[n] = [f.x, f.y, f.z], ++n;
                        var m = p.clone().add(c),
                            y = m.clone().add(u);
                        e[n] = [m.x, m.y, m.z], t[n] = [y.x, y.y, y.z], e[++n] = [m.x, m.y, m.z], t[n] = [y.x, y.y, y.z]
                    }
                }(c, l, u, e[t]), {
                    centerPoints: c,
                    topPoints: l
                };
                t === f ? p(t, s(t)) : (Su(c, l, u++, e[a(f)]), Su(c, l, u++, e[f]));
                for (var d = t; d <= n; ++d) Su(c, l, u++, e[d]);
                return h === s(h) ? p(n, a(n)) : (Su(c, l, u++, e[h]), Su(c, l, u, e[s(h)])), {
                    centerPoints: c,
                    topPoints: l
                }
            }
            var Pu = function() {
                function e(t, n, r, o, i, a) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e);
                    var s = Cu(t, n, r, a);
                    this._topInterp = xu(s.topPoints, i), this._centerInterp = xu(s.centerPoints, i), this._shift = .5 / (r - n + 2), this._valueStep = (1 - 2 * this._shift) / (2 * (r - n + 1) * (o - 1)), this._segmentsCount = o
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "prepareMatrices",
                    value: function(e, t, n) {
                        for (var r = this._segmentsCount, o = new Array(r), i = new c.Vector2(0, 0), a = this._topInterp, s = this._centerInterp, l = this._shift + this._valueStep * (r - 1) * e, u = 0; u < r; ++u) {
                            var p = Math.min(1, u / (r - 1));
                            i.lerpVectors(t, n, p);
                            var f = a(l, null),
                                h = s(l, null),
                                d = s(l += this._valueStep, null);
                            o[u] = wu(h.clone(), d.clone(), f.clone().sub(h), i)
                        }
                        return o
                    }
                }]) && gu(t.prototype, n), r && gu(t, r), e
            }();

            function Eu(e) {
                return (Eu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ou(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Au(e, t) {
                return !t || "object" !== Eu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Tu(e) {
                return (Tu = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ku(e, t) {
                return (ku = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Ru(e, t) {
                for (var n = [], r = 0; r < t; ++r) {
                    var o = 2 * r / t * Math.PI;
                    n.push(new c.Vector3(Math.cos(o) * e, Math.sin(o) * e, 0))
                }
                return n
            }

            function Iu(e, t, n, r, o, i) {
                for (var a = 0, s = e.length; a < s; ++a)
                    for (var l = e[a].arr, c = e[a].boundaries, u = 0, p = l.length; u < p; ++u)
                        for (var f = [l[u].start, l[u].end], h = new Pu(t, f[0], f[1], n, r, c), d = null, m = 2 * l[u].start, y = 2 * l[u].end + 1, v = m; v <= y; ++v) {
                            var _ = v / 2 | 0,
                                g = t[_],
                                b = o.getResidueRadius(g, v % 2),
                                w = o.getResidueRadius(g, 1 + v % 2),
                                x = h.prepareMatrices(v - 2 * f[0], b, w);
                            x.unshift(null === d ? x[0] : d), i(g, x, _), d = x[n]
                        }
            }
            var Mu = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Au(this, Tu(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && ku(e, t)
                }(t, Jc), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        var e = this._mode.getHeightSegmentsRatio();
                        return this._segmentsHeight = this._polyComplexity * e | 0, [Ru(1, this._polyComplexity), this._segmentsHeight + 1, 2 * this._selection.chunks.length]
                    }
                }, {
                    key: "_build",
                    value: function() {
                        var e = this._selection,
                            t = e.residues,
                            n = e.parent,
                            r = this._mode,
                            o = this._colorer,
                            i = r.getTension(),
                            a = this._geo,
                            s = 0,
                            l = [];
                        Iu(this._selection.subdivs, t, this._segmentsHeight, i, r, function(e, t) {
                            var r = o.getResidueColor(e, n);
                            l[s] = e._index, a.setItem(s, t), a.setColor(s++, r)
                        }), this._chunksIdc = l, a.finalize()
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        var t = this._selection.parent,
                            n = this._mode,
                            r = this._colorer,
                            o = n.getTension(),
                            i = this._geo,
                            a = e.getResidues(),
                            s = 0,
                            l = e.needsColorUpdate(r);
                        Iu(this._selection.subdivs, a, this._segmentsHeight, o, n, function(e, n) {
                            i.setItem(s, n), l && i.setColor(s, r.getResidueColor(e, t)), s++
                        }), i.finalize()
                    }
                }]) && Ou(n.prototype, r), o && Ou(n, o), t
            }();

            function Nu(e) {
                return (Nu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Lu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ju(e, t) {
                return !t || "object" !== Nu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Du(e) {
                return (Du = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Vu(e, t) {
                return (Vu = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Fu = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), ju(this, Du(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Vu(e, t)
                }(t, Wl), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        for (var e = this._selection.subdivs, t = 0, n = 0, r = e.length; n < r; ++n)
                            for (var o = e[n].arr, i = 0, a = o.length; i < a; ++i) t += o[i].end - o[i].start;
                        return [t, this._polyComplexity]
                    }
                }, {
                    key: "_build",
                    value: function() {
                        for (var e = this._selection, t = e.residues, n = e.parent, r = this._mode, o = this._colorer, i = this._geo, a = 0, s = [], l = this._selection.subdivs, c = r.calcStickRadius(), u = 0, p = l.length; u < p; ++u)
                            for (var f = l[u].arr, h = 0, d = f.length; h < d; ++h)
                                for (var m = f[h].start, y = f[h].end, v = t[m], _ = m + 1; _ <= y; ++_) {
                                    var g = t[_];
                                    s[a] = {
                                        first: v._index,
                                        second: g._index
                                    }, i.setItem(a, v._controlPoint, g._controlPoint, c), i.setColor(a, o.getResidueColor(v, n), o.getResidueColor(g, n)), a++, v = g
                                }
                        this._chunksIdc = s, i.finalize()
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        for (var t = e.getResidues(), n = this._selection.parent, r = this._mode, o = this._colorer, i = this._geo, a = 0, s = this._selection.subdivs, l = r.calcStickRadius(), c = e.needsColorUpdate(o), u = 0, p = s.length; u < p; ++u)
                            for (var f = s[u].arr, h = 0, d = f.length; h < d; ++h)
                                for (var m = f[h].start, y = f[h].end, v = t[m], _ = m + 1; _ <= y; ++_) {
                                    var g = t[_];
                                    i.setItem(a, v._controlPoint, g._controlPoint, l), c && i.setColor(a, o.getResidueColor(v, n), o.getResidueColor(g, n)), a++, v = g
                                }
                        i.finalize()
                    }
                }, {
                    key: "raycast",
                    value: function(e, t) {
                        var n = [],
                            r = this._selection.residues;
                        this._mesh.raycast(e, n);
                        for (var o = this._chunksIdc, i = 0, a = n.length; i < a; ++i)
                            if (n[i].hasOwnProperty("chunkIdx")) {
                                var s = n[i].chunkIdx,
                                    l = o[Math.floor(s / 2)],
                                    c = s % 2 == 0 ? l.first : l.second;
                                c < r.length && (n[i].residue = r[c], t.push(n[i]))
                            }
                    }
                }, {
                    key: "_calcChunksList",
                    value: function(e) {
                        for (var t = [], n = this._chunksIdc, r = this._selection.residues, o = 0, i = n.length; o < i; ++o) {
                            var a = n[o];
                            r[a.first]._mask & e && t.push(2 * o), r[a.second]._mask & e && t.push(2 * o + 1)
                        }
                        return t
                    }
                }]) && Lu(n.prototype, r), o && Lu(n, o), t
            }();

            function Bu(e) {
                return (Bu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function zu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Uu(e, t) {
                return !t || "object" !== Bu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Gu(e) {
                return (Gu = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Hu(e, t) {
                return (Hu = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Wu = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Uu(this, Gu(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Hu(e, t)
                }(t, Wl), n = t, (r = [{
                    key: "_makeGeoArgs",
                    value: function() {
                        for (var e = this._mode.drawMultiorderBonds(), t = this._mode.showAromaticLoops(), n = this._selection.chunks, r = this._selection.bonds, o = 1, i = 0, a = n.length; i < a; ++i) o += this.getBondOrder(r[n[i]], e, t);
                        return [o, this._polyComplexity]
                    }
                }, {
                    key: "getBondOrder",
                    value: function(e, t, n) {
                        var r = 1;
                        return !t || n && e._type === Me.BondType.AROMATIC || (r = function(e) {
                            return e < 2 ? 1 : e
                        }(e._order)), r
                    }
                }, {
                    key: "raycast",
                    value: function(e, t) {
                        var n = this._selection.bonds,
                            r = [];
                        this._mesh.raycast(e, r);
                        for (var o = this._chunksIdc, i = 0, a = r.length; i < a; ++i)
                            if (r[i].hasOwnProperty("chunkIdx")) {
                                var s = r[i].chunkIdx,
                                    l = o[Math.floor(s / 2)];
                                if (l < n.length) {
                                    var c = n[l];
                                    r[i].atom = s % 2 == 0 ? c._left : c._right, t.push(r[i])
                                }
                            }
                    }
                }, {
                    key: "_calcChunksList",
                    value: function(e, t) {
                        for (var n = [], r = this._selection.bonds, o = this._chunksIdc, i = 0, a = o.length; i < a; ++i) {
                            var s = r[o[i]];
                            s._left._mask & e && (!t || s._right._mask & e) && n.push(2 * i), s._right._mask & e && (!t || s._left._mask & e) && n.push(2 * i + 1)
                        }
                        return n
                    }
                }]) && zu(n.prototype, r), o && zu(n, o), t
            }();

            function qu(e) {
                return (qu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Yu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Xu(e, t) {
                return !t || "object" !== qu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function $u(e) {
                return ($u = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ku(e, t) {
                return (Ku = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Zu(e) {
                return (Zu = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Qu(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ju(e, t) {
                return !t || "object" !== Zu(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ep(e) {
                return (ep = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function tp(e, t) {
                return (tp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var np = {
                AtomsSphereGroup: rc,
                AtomsSurfaceGroup: cc,
                AtomsSASSESGroupStub: mc,
                AtomsTextGroup: Ec,
                AromaticTorusGroup: zc,
                AromaticLinesGroup: Yc,
                NucleicCylindersGroup: pu,
                NucleicSpheresGroup: vu,
                ResiduesSubseqGroup: Mu,
                ResiduesTraceGroup: Fu,
                BondsCylinderGroup: function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), Xu(this, $u(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Ku(e, t)
                    }(t, Wu), n = t, (r = [{
                        key: "_build",
                        value: function() {
                            for (var e, t = this._selection.chunks, n = this._selection, r = n.bonds, o = n.parent, i = this._mode, a = this._colorer, s = this._geo, l = i.drawMultiorderBonds(), u = i.showAromaticLoops(), p = i.calcStickRadius(), f = i.calcSpaceFraction(), h = new c.Vector3, d = new c.Vector3, m = 0, y = [], v = 0, _ = t.length; v < _; ++v) {
                                var g = r[t[v]],
                                    b = g._left,
                                    w = g._right,
                                    x = b._position,
                                    S = w._position;
                                e = g.calcNormalDir();
                                for (var C = this.getBondOrder(g, l, u), P = 2 * Math.min(i.calcAtomRadius(b), i.calcAtomRadius(w)) / C, E = l ? Math.min(p, .5 * P * (1 - f)) : p, O = 0; O < C; ++O) {
                                    var A = P * (C % 2 == 0 ? (.5 + (O / 2 | 0)) * (1 - O % 2 * 2) : ((O + 1) / 2 | 0) * (O % 2 * 2 - 1));
                                    y[m] = g._index, h.copy(x), h.addScaledVector(e, A), d.copy(S), d.addScaledVector(e, A), s.setItem(m, h, d, E), s.setColor(m++, a.getAtomColor(b, o), a.getAtomColor(w, o))
                                }
                            }
                            s.finalize(), this._chunksIdc = y
                        }
                    }, {
                        key: "updateToFrame",
                        value: function(e) {
                            for (var t, n = this._selection.chunks, r = this._selection.bonds, o = this._mode, i = this._colorer, a = this._geo, s = o.drawMultiorderBonds(), l = o.showAromaticLoops(), u = o.calcStickRadius(), p = o.calcSpaceFraction(), f = new c.Vector3, h = new c.Vector3, d = 0, m = e.needsColorUpdate(i), y = 0, v = n.length; y < v; ++y) {
                                var _ = r[n[y]],
                                    g = _._left,
                                    b = _._right,
                                    w = e.getAtomPos(g._index).clone(),
                                    x = e.getAtomPos(b._index);
                                t = _.calcNormalDir();
                                for (var S = this.getBondOrder(_, s, l), C = 2 * Math.min(o.calcAtomRadius(g), o.calcAtomRadius(b)) / S, P = s ? Math.min(u, .5 * C * (1 - p)) : u, E = 0; E < S; ++E) {
                                    var O = C * (S % 2 == 0 ? (.5 + (E / 2 | 0)) * (1 - E % 2 * 2) : ((E + 1) / 2 | 0) * (E % 2 * 2 - 1));
                                    f.copy(w), f.addScaledVector(t, O), h.copy(x), h.addScaledVector(t, O), a.setItem(d, f, h, P), m && a.setColor(d, e.getAtomColor(i, g), e.getAtomColor(i, b)), d++
                                }
                            }
                            a.finalize()
                        }
                    }]) && Yu(n.prototype, r), o && Yu(n, o), t
                }(),
                BondsLinesGroup: function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), Ju(this, ep(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && tp(e, t)
                    }(t, Wu), n = t, (r = [{
                        key: "_build",
                        value: function() {
                            for (var e = this._selection.chunks, t = this._selection, n = t.bonds, r = t.parent, o = this._mode, i = this._colorer, a = this._geo, s = o.drawMultiorderBonds(), l = o.showAromaticLoops(), u = new c.Vector3, p = new c.Vector3, f = new c.Vector3, h = 0, d = [], m = 0, y = e.length; m < y; ++m) {
                                var v = n[e[m]],
                                    _ = v._left,
                                    g = v._right,
                                    b = _._position,
                                    w = g._position,
                                    x = 1 === _._bonds.length,
                                    S = 1 === g._bonds.length;
                                u.subVectors(w, b);
                                for (var C = u.length(), P = v.calcNormalDir(), E = this.getBondOrder(v, s, l), O = 0; O < E; ++O) {
                                    p.copy(b), f.copy(w);
                                    var A = E % 2 == 0 ? (.5 + (O / 2 | 0)) * (1 - O % 2 * 2) : ((O + 1) / 2 | 0) * (O % 2 * 2 - 1);
                                    d[h] = v._index, 2 !== E || x || S || (A -= .5, A *= -1), !x && !S && E > 1 && 0 !== A && (p.lerpVectors(b, w, .15 / C), f.lerpVectors(b, w, 1 - .15 / C)), A *= .15, p.addScaledVector(P, A), f.addScaledVector(P, A), a.setItem(h, p, f), a.setColor(h++, i.getAtomColor(_, r), i.getAtomColor(g, r))
                                }
                            }
                            a.finalize(), this._chunksIdc = d
                        }
                    }, {
                        key: "updateToFrame",
                        value: function(e) {
                            for (var t = this._selection.chunks, n = this._selection.bonds, r = this._mode, o = this._colorer, i = this._geo, a = r.drawMultiorderBonds(), s = r.showAromaticLoops(), l = new c.Vector3, u = new c.Vector3, p = new c.Vector3, f = 0, h = e.needsColorUpdate(o), d = 0, m = t.length; d < m; ++d) {
                                var y = n[t[d]],
                                    v = y._left,
                                    _ = y._right,
                                    g = e.getAtomPos(v._index).clone(),
                                    b = e.getAtomPos(_._index),
                                    w = 1 === v._bonds.length,
                                    x = 1 === _._bonds.length;
                                l.subVectors(b, g);
                                for (var S = l.length(), C = y.calcNormalDir(), P = this.getBondOrder(y, a, s), E = 0; E < P; ++E) {
                                    u.copy(g), p.copy(b);
                                    var O = P % 2 == 0 ? (.5 + (E / 2 | 0)) * (1 - E % 2 * 2) : ((E + 1) / 2 | 0) * (E % 2 * 2 - 1);
                                    2 !== P || w || x || (O -= .5, O *= -1), !w && !x && P > 1 && 0 !== O && (u.lerpVectors(g, b, .15 / S), p.lerpVectors(g, b, 1 - .15 / S)), O *= .15, u.addScaledVector(C, O), p.addScaledVector(C, O), i.setItem(f, u, p), h && i.setColor(f, e.getAtomColor(o, v), e.getAtomColor(o, _)), f++
                                }
                            }
                            i.finalize()
                        }
                    }]) && Qu(n.prototype, r), o && Qu(n, o), t
                }()
            };

            function rp(e) {
                return (rp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function op(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ip(e) {
                return (ip = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ap(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function sp(e, t) {
                return (sp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var lp = function(e) {
                function t(e, n, r, o, i, a, s, l) {
                    var c;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), c = function(e, t) {
                        return !t || "object" !== rp(t) && "function" != typeof t ? ap(e) : t
                    }(this, ip(t).call(this));
                    var u = ap(c);
                    c._complex = r, c._mode = i;
                    var p = r.getAtoms(),
                        f = r.getTransforms();
                    return r.forEachComponent(function(t) {
                        var c = [],
                            h = 0;
                        if (t.forEachAtom(function(e) {
                                u._checkAtom(e, s) && (c[h++] = e._index)
                            }), 0 !== h) {
                            var d = new e(n, {
                                atoms: p,
                                chunks: c,
                                parent: r
                            }, o, i, f, a, l);
                            d._component = t, u.add(d)
                        }
                    }), c
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && sp(e, t)
                }(t, Pr), n = t, (r = [{
                    key: "_checkAtom",
                    value: function(e, t) {
                        return e._mask & t
                    }
                }, {
                    key: "getSubset",
                    value: function(e, t) {
                        for (var n = [], r = this.children, o = 0, i = 0, a = r.length; i < a; ++i)
                            if (r[i].getSubset)
                                for (var s = r[i].getSubset(e, t), l = 0, c = s.length; l < c; ++l) {
                                    var u = s[l];
                                    u._component = r[i]._component, n[o++] = u
                                }
                        return n
                    }
                }]) && op(n.prototype, r), o && op(n, o), t
            }();

            function cp(e) {
                return (cp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function up(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function pp(e, t) {
                return !t || "object" !== cp(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function fp(e) {
                return (fp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function hp(e, t) {
                return (hp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var dp = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), pp(this, fp(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && hp(e, t)
                }(t, lp), n = t, (r = [{
                    key: "_checkAtom",
                    value: function(e, t) {
                        if (!(e._mask & t)) return !1;
                        if ("no" !== this._mode.settings.now.labels && e.isLabelVisible()) return !1;
                        for (var n = e._bonds, r = 0, o = n.length; r < o; ++r)
                            if (n[r]._left._mask & t && n[r]._right._mask & t) return !1;
                        return !0
                    }
                }]) && up(n.prototype, r), o && up(n, o), t
            }();

            function mp(e) {
                return (mp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function yp(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function vp(e) {
                return (vp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function _p(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function gp(e, t) {
                return (gp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var bp = function(e) {
                function t(e, n, r, o, i, a, s, l) {
                    var c;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), c = function(e, t) {
                        return !t || "object" !== mp(t) && "function" != typeof t ? _p(e) : t
                    }(this, vp(t).call(this));
                    var u = _p(c);
                    c._complex = r;
                    var p = r.getResidues(),
                        f = r.getTransforms();
                    return r.forEachComponent(function(t) {
                        var c = 0,
                            h = [];
                        if (t.forEachResidue(function(e) {
                                u._checkResidue(e, s) && (h[c++] = e._index)
                            }), 0 !== c) {
                            var d = new e(n, {
                                residues: p,
                                chunks: h,
                                parent: r
                            }, o, i, f, a, l);
                            d._component = t, u.add(d)
                        }
                    }), c
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && gp(e, t)
                }(t, Pr), n = t, (r = [{
                    key: "checkResidue",
                    value: function(e, t) {
                        return e._mask & t
                    }
                }, {
                    key: "getSubset",
                    value: function(e, t) {
                        for (var n = [], r = this.children, o = 0, i = 0, a = r.length; i < a; ++i)
                            if (r[i].getSubset)
                                for (var s = r[i].getSubset(e, t), l = 0, c = s.length; l < c; ++l) {
                                    var u = s[l];
                                    u._component = r[i]._component, n[o++] = u
                                }
                        return n
                    }
                }]) && yp(n.prototype, r), o && yp(n, o), t
            }();

            function wp(e) {
                return (wp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function xp(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Sp(e, t) {
                return !t || "object" !== wp(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Cp(e) {
                return (Cp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Pp(e, t) {
                return (Pp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Ep(e) {
                return (Ep = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Op(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ap(e) {
                return (Ap = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Tp(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function kp(e, t) {
                return (kp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Rp(e) {
                return (Rp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ip(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Mp(e) {
                return (Mp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Np(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function Lp(e, t) {
                return (Lp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function jp(e) {
                return (jp = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Dp(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Vp(e, t) {
                return !t || "object" !== jp(t) && "function" != typeof t ? Bp(e) : t
            }

            function Fp(e) {
                return (Fp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Bp(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function zp(e, t) {
                return (zp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Up(e) {
                return (Up = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Gp(e, t) {
                return !t || "object" !== Up(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Hp(e) {
                return (Hp = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Wp(e, t) {
                return (Wp = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function qp(e, t, n) {
                var r = document.createElement("div");
                if (r.className = "label label-sgroup", r.style.color = t, "string" == typeof n) {
                    var o = document.createElement("span");
                    o.style.fontSize = "150%";
                    var i = document.createElement("span"),
                        a = document.createTextNode(n);
                    i.appendChild(a), o.appendChild(i), r.appendChild(o)
                } else r.appendChild(n);
                var s = new gr(r);
                s.position.copy(e), s.userData = {
                    translation: "translate(-50%, -50%)",
                    color: t
                };
                var l = s.getElement();
                return l.style.visibility = "visible", l.style.textAlign = "center", l.style.verticalAlign = "middle", s
            }
            var Yp = {
                Atoms: lp,
                OrphanAtoms: dp,
                Residues: bp,
                Nucleic: function(e) {
                    function t() {
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), Sp(this, Cp(t).apply(this, arguments))
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Pp(e, t)
                    }(t, bp), n = t, (r = [{
                        key: "_checkResidue",
                        value: function(e, t) {
                            return t & e._mask && null !== e._cylinders
                        }
                    }]) && xp(n.prototype, r), o && xp(n, o), t
                }(),
                Subseqs: function(e) {
                    function t(e, n, r, o, i, a, s, l) {
                        var c;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), c = function(e, t) {
                            return !t || "object" !== Ep(t) && "function" != typeof t ? Tp(e) : t
                        }(this, Ap(t).call(this));
                        var u = Tp(c);
                        c._complex = r;
                        var p = r.getResidues(),
                            f = r.getTransforms();
                        return r.forEachComponent(function(t) {
                            for (var c = t.getMaskedSubdivSequences(s), h = 0, d = [], m = 0, y = c.length; m < y; ++m)
                                for (var v = c[m].arr, _ = 0, g = v.length; _ < g; ++_)
                                    for (var b = v[_].start, w = v[_].end; b <= w; ++b) d[h++] = p[b]._index;
                            if (0 !== h) {
                                var x = new e(n, {
                                    residues: p,
                                    chunks: d,
                                    subdivs: c,
                                    parent: r
                                }, o, i, f, a, l);
                                x._component = t, u.add(x)
                            }
                        }), c
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && kp(e, t)
                    }(t, Pr), n = t, (r = [{
                        key: "getSubset",
                        value: function(e, t) {
                            for (var n = [], r = this.children, o = 0, i = 0, a = r.length; i < a; ++i)
                                if (r[i].getSubset)
                                    for (var s = r[i].getSubset(e, t), l = 0, c = s.length; l < c; ++l) {
                                        var u = s[l];
                                        u._component = r[i]._component, n[o++] = u
                                    }
                            return n
                        }
                    }]) && Op(n.prototype, r), o && Op(n, o), t
                }(),
                Bonds: function(e) {
                    function t(e, n, r, o, i, a, s, l) {
                        var c;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), c = function(e, t) {
                            return !t || "object" !== Rp(t) && "function" != typeof t ? Np(e) : t
                        }(this, Mp(t).call(this));
                        var u = Np(c);
                        c._complex = r;
                        var p = r.getBonds(),
                            f = r.getTransforms();
                        return r.forEachComponent(function(t) {
                            var c = [],
                                h = 0;
                            if (t.forEachBond(function(e) {
                                    var t = e._left,
                                        n = e._right;
                                    t._mask & s && n._mask & s && (c[h++] = e._index)
                                }), 0 !== h) {
                                var d = new e(n, {
                                    bonds: p,
                                    chunks: c,
                                    parent: r
                                }, o, i, f, a, l);
                                d._component = t, u.add(d)
                            }
                        }), c
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Lp(e, t)
                    }(t, Pr), n = t, (r = [{
                        key: "getSubset",
                        value: function(e, t) {
                            for (var n = [], r = this.children, o = 0, i = 0, a = r.length; i < a; ++i)
                                if (r[i].getSubset)
                                    for (var s = r[i].getSubset(e, t), l = 0, c = s.length; l < c; ++l) {
                                        var u = s[l];
                                        u._component = r[i]._component, n[o++] = u
                                    }
                            return n
                        }
                    }]) && Ip(n.prototype, r), o && Ip(n, o), t
                }(),
                Aromatic: function(e) {
                    function t(e, n, r, o, i, a, s, l) {
                        var c;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t);
                        var u = Bp(c = Vp(this, Fp(t).call(this)));
                        c._complex = r;
                        var p = r.getAtoms(),
                            f = r.getTransforms();
                        return i.showAromaticLoops() ? (r.forEachComponent(function(t) {
                            var c = [],
                                h = 0,
                                d = [],
                                m = 0;
                            t.forEachCycle(function(e) {
                                for (var t = e.atoms, n = 0, r = 0, o = t.length; r < o; ++r) 0 != (t[r]._mask & s) && (++n, c[h++] = t[r]._index);
                                n > 0 && (d[m++] = e)
                            });
                            var y = new e(n, {
                                cycles: d,
                                atoms: p,
                                chunks: c,
                                parent: r
                            }, o, i, f, a, l);
                            y._component = t, u.add(y)
                        }), c) : Vp(c)
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && zp(e, t)
                    }(t, Pr), n = t, (r = [{
                        key: "getSubset",
                        value: function(e, t) {
                            for (var n = [], r = this.children, o = 0, i = 0, a = r.length; i < a; ++i)
                                if (r[i].getSubset)
                                    for (var s = r[i].getSubset(e, t), l = 0, c = s.length; l < c; ++l) {
                                        var u = s[l];
                                        u._component = r[i]._component, n[o++] = u
                                    }
                            return n
                        }
                    }]) && Dp(n.prototype, r), o && Dp(n, o), t
                }(),
                SGroups: function(e) {
                    function t(e, n, r, o, i, a, s, l) {
                        var u;
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), u = Gp(this, Hp(t).call(this));
                        for (var p = new Pr, f = 0; f < r.getSGroupCount(); f++) {
                            var h = r.getSGroups()[f];
                            if (null !== h._center) {
                                var d = (new c.Vector3).copy(h._position);
                                d.add(h._center), p.add(qp(d, 16776960, h._name))
                            } else p.add(qp((new c.Vector3).copy(h._position), 16776960, h._name))
                        }
                        return u.add(p), u
                    }
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Wp(e, t)
                    }(t, Pr), t
                }()
            };

            function Xp(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function $p(e, t, n) {
                return function(r, o, i, a, s, l) {
                    return new t(n, e, r, o, i, a, s, l)
                }
            }
            var Kp = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e)
                }
                var t, n, r;
                return t = e, r = [{
                    key: "AtomsSpheres",
                    value: function(e, t) {
                        return $p(kl.createSpheres(e, t), Yp.Atoms, np.AtomsSphereGroup)
                    }
                }, {
                    key: "OrphanedAtomsCrosses",
                    value: function(e, t, n) {
                        return $p(kl.createCrosses(e, t, n), Yp.OrphanAtoms, np.AtomsSphereGroup)
                    }
                }, {
                    key: "BondsCylinders",
                    value: function(e, t) {
                        return $p(kl.create2CCylinders(e, t), Yp.Bonds, np.BondsCylinderGroup)
                    }
                }, {
                    key: "BondsLines",
                    value: function(e, t, n) {
                        return $p(kl.create2CLines(e, t, n), Yp.Bonds, np.BondsLinesGroup)
                    }
                }, {
                    key: "CartoonChains",
                    value: function(e, t) {
                        return $p(kl.createExtrudedChains(e, t), Yp.Subseqs, np.ResiduesSubseqGroup)
                    }
                }, {
                    key: "TraceChains",
                    value: function(e, t) {
                        return $p(kl.create2CClosedCylinders(e, t), Yp.Subseqs, np.ResiduesTraceGroup)
                    }
                }, {
                    key: "NucleicSpheres",
                    value: function(e, t) {
                        return $p(kl.createSpheres(e, t), Yp.Nucleic, np.NucleicSpheresGroup)
                    }
                }, {
                    key: "NucleicCylinders",
                    value: function(e, t) {
                        return $p(kl.create2CCylinders(e, t), Yp.Nucleic, np.NucleicCylindersGroup)
                    }
                }, {
                    key: "ALoopsTorus",
                    value: function(e, t) {
                        return $p(kl.createExtrudedChains(e, t), Yp.Aromatic, np.AromaticTorusGroup)
                    }
                }, {
                    key: "ALoopsLines",
                    value: function(e, t, n) {
                        return $p(kl.createChunkedLines(e, t, n), Yp.Aromatic, np.AromaticLinesGroup)
                    }
                }, {
                    key: "QuickSurfGeo",
                    value: function(e, t, n) {
                        return $p(kl.createQuickSurface(e, t, n), Yp.Atoms, np.AtomsSurfaceGroup)
                    }
                }, {
                    key: "ContactSurfaceGeo",
                    value: function(e, t, n) {
                        return $p(kl.createContactSurface(e, t, n), Yp.Atoms, np.AtomsSurfaceGroup)
                    }
                }, {
                    key: "SASSESSurfaceGeo",
                    value: function(e, t, n) {
                        return $p(kl.createSASSES(e, t, n), Yp.Atoms, np.AtomsSASSESGroupStub)
                    }
                }, {
                    key: "TextLabelsGeo",
                    value: function(e, t) {
                        return $p(kl.createLabels(e, t), Yp.Atoms, np.AtomsTextGroup)
                    }
                }, {
                    key: "SGroupsLabels",
                    value: function(e, t) {
                        return $p(null, Yp.SGroups, null)
                    }
                }], (n = null) && Xp(t.prototype, n), r && Xp(t, r), e
            }();

            function Zp(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Qp(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Jp = function() {
                function e(t) {
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this.constructor === e) throw new Error("Can not instantiate abstract class!");
                    this.opts = l.a.merge(R.deriveDeep(this.settings.now.modes[this.id], !0), t)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "identify",
                    value: function() {
                        var e = R.objectsDiff(this.opts, this.settings.now.modes[this.id]);
                        return l.a.isEmpty(e) ? this.id : [this.id, e]
                    }
                }, {
                    key: "buildGeometry",
                    value: function(e, t, n, r) {
                        for (var o = this.opts.polyComplexity ? this.opts.polyComplexity[this.settings.now.resolution] : 0, i = this.depGroups, a = i.length, s = new $r.RCGroup, c = 0; c < a; ++c) {
                            var u = i[c],
                                p = {};
                            if (l.a.isArray(u)) p = u[1].call(this), u = Zp(u, 1)[0];
                            var f = new(Kp[u](null, this.settings, p))(e, t, this, o, n, r);
                            f.children.length > 0 && s.add(f)
                        }
                        return s
                    }
                }]) && Qp(t.prototype, n), r && Qp(t, r), e
            }();
            ro(Jp.prototype), Jp.prototype.id = "__", Jp.prototype.depGroups = [];
            var ef = Jp;

            function tf(e) {
                return (tf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function nf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function rf(e, t) {
                return !t || "object" !== tf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function of (e) {
                return ( of = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function af(e, t) {
                return (af = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var sf = function(e) {
                function t(e) {
                    var n;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = rf(this, of (t).call(this, e))).depGroups = n.depGroups.slice(0), n._staticGroups = n.depGroups.length, n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && af(e, t)
                }(t, ef), n = t, (r = [{
                    key: "update",
                    value: function() {
                        var e = this._staticGroups;
                        "no" === this.settings.now.labels ? this.depGroups = this.depGroups.slice(0, e) : (this.depGroups[e] = "TextLabelsGeo", this.depGroups[e + 1] = "SGroupsLabels")
                    }
                }, {
                    key: "buildGeometry",
                    value: function(e, t, n, r) {
                        return this.update(), ef.prototype.buildGeometry.call(this, e, t, n, r)
                    }
                }]) && nf(n.prototype, r), o && nf(n, o), t
            }();

            function lf(e) {
                return (lf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function cf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function uf(e, t) {
                return !t || "object" !== lf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function pf(e) {
                return (pf = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ff(e, t) {
                return (ff = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function hf() {
                return {
                    lineWidth: this.opts.lineWidth
                }
            }
            var df = function(e) {
                function t(e) {
                    var n;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t);
                    for (var r = (n = uf(this, pf(t).call(this, e))).depGroups, o = 0, i = r.length; o < i; ++o) r[o] = [r[o], hf];
                    return n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && ff(e, t)
                }(t, sf), n = t, (r = [{
                    key: "drawMultiorderBonds",
                    value: function() {
                        return this.opts.multibond
                    }
                }, {
                    key: "calcAtomRadius",
                    value: function() {
                        return this.opts.atom
                    }
                }, {
                    key: "getAromaticOffset",
                    value: function() {
                        return this.opts.offsarom
                    }
                }, {
                    key: "getAromaticArcChunks",
                    value: function() {
                        return this.opts.chunkarom
                    }
                }, {
                    key: "showAromaticLoops",
                    value: function() {
                        return this.opts.showarom
                    }
                }, {
                    key: "getLabelOpts",
                    value: function() {
                        return {
                            fg: "none",
                            bg: "0x202020",
                            showBg: !0,
                            labels: this.settings.now.labels,
                            colors: !0,
                            adjustColor: !0,
                            transparent: !0
                        }
                    }
                }]) && cf(n.prototype, r), o && cf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(df, "id", "LN"), df.prototype.id = "LN", df.prototype.name = "Lines", df.prototype.shortName = "Lines", df.prototype.depGroups = ["ALoopsLines", "BondsLines", "OrphanedAtomsCrosses"];
            var mf = df;

            function yf(e) {
                return (yf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function vf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function _f(e, t) {
                return !t || "object" !== yf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function gf(e) {
                return (gf = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function bf(e, t) {
                return (bf = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var wf = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), _f(this, gf(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && bf(e, t)
                }(t, sf), n = t, (r = [{
                    key: "calcAtomRadius",
                    value: function(e) {
                        return this.opts.bond
                    }
                }, {
                    key: "calcStickRadius",
                    value: function() {
                        return this.opts.bond
                    }
                }, {
                    key: "calcSpaceFraction",
                    value: function() {
                        return this.opts.space
                    }
                }, {
                    key: "getAromRadius",
                    value: function() {
                        return this.opts.aromrad
                    }
                }, {
                    key: "showAromaticLoops",
                    value: function() {
                        return this.opts.showarom
                    }
                }, {
                    key: "drawMultiorderBonds",
                    value: function() {
                        return this.opts.multibond
                    }
                }, {
                    key: "getLabelOpts",
                    value: function() {
                        return {
                            fg: "none",
                            bg: "0x202020",
                            showBg: !1,
                            labels: this.settings.now.labels,
                            colors: !0,
                            adjustColor: !0,
                            transparent: !0
                        }
                    }
                }]) && vf(n.prototype, r), o && vf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(wf, "id", "LC"), wf.prototype.id = "LC", wf.prototype.name = "Licorice", wf.prototype.shortName = "Licorice", wf.prototype.depGroups = ["AtomsSpheres", "BondsCylinders", "ALoopsTorus"];
            var xf = wf;

            function Sf(e) {
                return (Sf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Cf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Pf(e, t) {
                return !t || "object" !== Sf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ef(e) {
                return (Ef = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Of(e, t) {
                return (Of = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Af = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Pf(this, Ef(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Of(e, t)
                }(t, sf), n = t, (r = [{
                    key: "calcAtomRadius",
                    value: function(e) {
                        return e.element.radius * this.opts.atom
                    }
                }, {
                    key: "calcStickRadius",
                    value: function() {
                        return this.opts.bond
                    }
                }, {
                    key: "getAromRadius",
                    value: function() {
                        return this.opts.aromrad
                    }
                }, {
                    key: "showAromaticLoops",
                    value: function() {
                        return this.opts.showarom
                    }
                }, {
                    key: "calcSpaceFraction",
                    value: function() {
                        return this.opts.space
                    }
                }, {
                    key: "drawMultiorderBonds",
                    value: function() {
                        return this.opts.multibond
                    }
                }, {
                    key: "getLabelOpts",
                    value: function() {
                        return {
                            fg: "none",
                            bg: "0x202020",
                            showBg: !1,
                            labels: this.settings.now.labels,
                            colors: !0,
                            adjustColor: !0,
                            transparent: !0
                        }
                    }
                }]) && Cf(n.prototype, r), o && Cf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Af, "id", "BS"), Af.prototype.id = "BS", Af.prototype.name = "Balls and Sticks", Af.prototype.shortName = "Balls", Af.prototype.depGroups = ["AtomsSpheres", "BondsCylinders", "ALoopsTorus"];
            var Tf = Af;

            function kf(e) {
                return (kf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Rf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function If(e, t) {
                return !t || "object" !== kf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Mf(e) {
                return (Mf = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Nf(e, t) {
                return (Nf = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Lf = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), If(this, Mf(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Nf(e, t)
                }(t, ef), n = t, (r = [{
                    key: "calcAtomRadius",
                    value: function(e) {
                        return e.element.radius
                    }
                }]) && Rf(n.prototype, r), o && Rf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Lf, "id", "VW"), Lf.prototype.id = "VW", Lf.prototype.name = "Van der Waals", Lf.prototype.shortName = "VDW", Lf.prototype.depGroups = ["AtomsSpheres"];
            var jf = Lf;

            function Df(e) {
                return (Df = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Vf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ff(e, t) {
                return !t || "object" !== Df(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Bf(e) {
                return (Bf = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function zf(e, t) {
                return (zf = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Uf = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Ff(this, Bf(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && zf(e, t)
                }(t, ef), n = t, (r = [{
                    key: "calcStickRadius",
                    value: function() {
                        return this.opts.radius
                    }
                }]) && Vf(n.prototype, r), o && Vf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Uf, "id", "TR"), Uf.prototype.id = "TR", Uf.prototype.name = "Trace", Uf.prototype.shortName = "Trace", Uf.prototype.depGroups = ["TraceChains"];
            var Gf = Uf;

            function Hf(e) {
                return (Hf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Wf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function qf(e, t) {
                return !t || "object" !== Hf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Yf(e) {
                return (Yf = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Xf(e, t) {
                return (Xf = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var $f = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), qf(this, Yf(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Xf(e, t)
                }(t, ef), n = t, (r = [{
                    key: "getResidueRadius",
                    value: function(e) {
                        return this.TUBE_RADIUS
                    }
                }, {
                    key: "getHeightSegmentsRatio",
                    value: function() {
                        return this.opts.heightSegmentsRatio
                    }
                }, {
                    key: "getTension",
                    value: function() {
                        return this.opts.tension
                    }
                }, {
                    key: "buildGeometry",
                    value: function(e, t, n, r) {
                        var o = this.opts.radius;
                        return this.TUBE_RADIUS = new c.Vector2(o, o), ef.prototype.buildGeometry.call(this, e, t, n, r)
                    }
                }]) && Wf(n.prototype, r), o && Wf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }($f, "id", "TU"), $f.prototype.id = "TU", $f.prototype.name = "Tube", $f.prototype.shortName = "Tube", $f.prototype.depGroups = ["CartoonChains"];
            var Kf = $f;

            function Zf(e) {
                return (Zf = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Qf(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Jf(e, t) {
                return !t || "object" !== Zf(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function eh(e) {
                return (eh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function th(e, t) {
                return (th = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var nh = function(e) {
                function t(e) {
                    var n;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = Jf(this, eh(t).call(this, e))).secCache = {}, n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && th(e, t)
                }(t, ef), n = t, (r = [{
                    key: "getResidueStartRadius",
                    value: function(e) {
                        var t = e.getSecondary();
                        if (!t || !t.generic) return this.TUBE_RADIUS;
                        var n = this.secCache[t.generic];
                        return n ? t.term === e ? n.start : n.center : this.TUBE_RADIUS
                    }
                }, {
                    key: "getResidueEndRadius",
                    value: function(e) {
                        var t = e.getSecondary();
                        if (null === t || !t.generic) return this.TUBE_RADIUS;
                        var n = this.secCache[t.generic];
                        return n ? t.term === e ? this.ARROW_END : n.center : this.TUBE_RADIUS
                    }
                }, {
                    key: "getResidueRadius",
                    value: function(e, t) {
                        var n = this.getResidueStartRadius(e);
                        if (0 === t) return n;
                        var r = this.getResidueEndRadius(e);
                        return 2 === t ? r : n.clone().lerp(r, t / 2)
                    }
                }, {
                    key: "calcStickRadius",
                    value: function(e) {
                        return this.opts.radius
                    }
                }, {
                    key: "getHeightSegmentsRatio",
                    value: function() {
                        return this.opts.heightSegmentsRatio
                    }
                }, {
                    key: "getTension",
                    value: function() {
                        return this.opts.tension
                    }
                }, {
                    key: "buildGeometry",
                    value: function(e, t, n, r) {
                        var o = this.opts.radius,
                            i = this.opts.depth;
                        this.TUBE_RADIUS = new c.Vector2(o, o), this.ARROW_END = new c.Vector2(i, o);
                        var a = {},
                            s = this.opts.ss;
                        for (var l in s) a[l] = {
                            center: new c.Vector2(i, s[l].width),
                            start: new c.Vector2(i, s[l].arrow)
                        };
                        return this.secCache = a, ef.prototype.buildGeometry.call(this, e, t, n, r)
                    }
                }]) && Qf(n.prototype, r), o && Qf(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(nh, "id", "CA"), nh.prototype.id = "CA", nh.prototype.name = "Cartoon", nh.prototype.shortName = "Cartoon", nh.prototype.depGroups = ["CartoonChains", "NucleicSpheres", "NucleicCylinders"];
            var rh = nh;

            function oh(e) {
                return (oh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ih(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ah(e, t) {
                return !t || "object" !== oh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function sh(e) {
                return (sh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function lh(e, t) {
                return (lh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var ch = hr.selectors;

            function uh() {
                return {
                    wireframe: this.opts.wireframe,
                    zClip: this.opts.zClip
                }
            }
            var ph = function(e) {
                function t(e) {
                    var n;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = ah(this, sh(t).call(this, e))).depGroups = n.depGroups.slice(0);
                    for (var r = n.surfaceNames, o = n.depGroups, i = 0, a = r.length; i < a; ++i) o[o.length] = [r[i], uh];
                    return n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && lh(e, t)
                }(t, ef), n = t, (r = [{
                    key: "calcAtomRadius",
                    value: function(e) {
                        return e.element.radius
                    }
                }, {
                    key: "getVisibilitySelector",
                    value: function() {
                        var e = null;
                        if ("" !== this.opts.subset) {
                            var t = ch.parse(this.opts.subset);
                            t.error || (e = t.selector)
                        }
                        return e
                    }
                }]) && ih(n.prototype, r), o && ih(n, o), t
            }();
            ph.prototype.isSurface = !0, ph.prototype.surfaceNames = [];
            var fh = ph;

            function hh(e) {
                return (hh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function dh(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function mh(e, t) {
                return !t || "object" !== hh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function yh(e) {
                return (yh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function vh(e, t) {
                return (vh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var _h = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), mh(this, yh(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && vh(e, t)
                }(t, fh), n = t, (r = [{
                    key: "getSurfaceOpts",
                    value: function() {
                        return {
                            useBeads: !1,
                            isoValue: this.opts.isoValue,
                            gaussLim: this.opts.gaussLim[this.settings.now.resolution],
                            radScale: this.opts.scale,
                            gridSpacing: this.opts.gridSpacing[this.settings.now.resolution],
                            zClip: this.opts.zClip,
                            visibilitySelector: this.getVisibilitySelector()
                        }
                    }
                }]) && dh(n.prototype, r), o && dh(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(_h, "id", "QS"), _h.prototype.id = "QS", _h.prototype.name = "Quick Surface", _h.prototype.shortName = "Quick Surf", _h.prototype.surfaceNames = ["QuickSurfGeo"];
            var gh = _h;

            function bh(e) {
                return (bh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function wh(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function xh(e, t) {
                return !t || "object" !== bh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Sh(e) {
                return (Sh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ch(e, t) {
                return (Ch = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ph = function(e) {
                function t(e, n) {
                    var r;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (r = xh(this, Sh(t).call(this, n)))._excludeProbe = e, r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Ch(e, t)
                }(t, fh), n = t, (r = [{
                    key: "calcAtomRadius",
                    value: function(e) {
                        return e.element.radius
                    }
                }, {
                    key: "getSurfaceOpts",
                    value: function() {
                        return {
                            gridSpacing: this.opts.polyComplexity[this.settings.now.resolution],
                            radScale: this._radScale,
                            zClip: this.opts.zClip,
                            visibilitySelector: this.getVisibilitySelector(),
                            probeRadius: this.opts.probeRadius,
                            excludeProbe: this._excludeProbe,
                            clusterizationType: this._clusterViaKMeans
                        }
                    }
                }]) && wh(n.prototype, r), o && wh(n, o), t
            }();
            Ph.prototype.id = "SU", Ph.prototype.name = "Surface", Ph.prototype.shortName = "Surface", Ph.prototype.surfaceNames = ["SASSESSurfaceGeo"], Ph.prototype._radScale = 1, Ph.prototype._clusterViaKMeans = 0, Ph.prototype._excludeProbe = !1;
            var Eh = Ph;

            function Oh(e) {
                return (Oh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ah(e, t) {
                return !t || "object" !== Oh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Th(e) {
                return (Th = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function kh(e, t) {
                return (kh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Rh = function(e) {
                function t(e) {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Ah(this, Th(t).call(this, !1, e))
                }
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && kh(e, t)
                }(t, Eh), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Rh, "id", "SA"), Rh.prototype.id = "SA", Rh.prototype.name = "Solvent Accessible Surface", Rh.prototype.shortName = "SAS";
            var Ih = Rh;

            function Mh(e) {
                return (Mh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Nh(e, t) {
                return !t || "object" !== Mh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Lh(e) {
                return (Lh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function jh(e, t) {
                return (jh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Dh = function(e) {
                function t(e) {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Nh(this, Lh(t).call(this, !0, e))
                }
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && jh(e, t)
                }(t, Eh), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Dh, "id", "SE"), Dh.prototype.id = "SE", Dh.prototype.name = "Solvent Excluded Surface", Dh.prototype.shortName = "SES";
            var Vh = Dh;

            function Fh(e) {
                return (Fh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Bh(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function zh(e, t) {
                return !t || "object" !== Fh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Uh(e) {
                return (Uh = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Gh(e, t) {
                return (Gh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Hh = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), zh(this, Uh(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Gh(e, t)
                }(t, fh), n = t, (r = [{
                    key: "getSurfaceOpts",
                    value: function() {
                        return {
                            probeRadius: this.opts.probeRadius,
                            radScale: this.opts.polyComplexity[this.settings.now.resolution],
                            scaleFactor: this.opts.polyComplexity[this.settings.now.resolution],
                            gridSpacing: 1 / this.opts.polyComplexity[this.settings.now.resolution],
                            isoValue: this.opts.isoValue,
                            probePositions: this.opts.probePositions,
                            zClip: this.opts.zClip,
                            visibilitySelector: this.getVisibilitySelector()
                        }
                    }
                }]) && Bh(n.prototype, r), o && Bh(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Hh, "id", "CS"), Hh.prototype.id = "CS", Hh.prototype.name = "Contact Surface", Hh.prototype.shortName = "Contact Surf", Hh.prototype.isSurface = !0, Hh.prototype.surfaceNames = ["ContactSurfaceGeo"];
            var Wh = Hh;

            function qh(e) {
                return (qh = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Yh(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Xh(e, t) {
                return !t || "object" !== qh(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function $h(e) {
                return ($h = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Kh(e, t) {
                return (Kh = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Zh = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Xh(this, $h(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Kh(e, t)
                }(t, ef), n = t, (r = [{
                    key: "getTemplateOptions",
                    value: function() {
                        return this.opts.template
                    }
                }, {
                    key: "getLabelOpts",
                    value: function() {
                        return l.a.merge(this.opts, {
                            labels: this.settings.now.labels,
                            colors: !0,
                            adjustColor: !0,
                            transparent: !0
                        })
                    }
                }]) && Yh(n.prototype, r), o && Yh(n, o), t
            }();

            function Qh(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Zh, "id", "TX"), Zh.prototype.id = "TX", Zh.prototype.name = "Text mode", Zh.prototype.shortName = "Text", Zh.prototype.depGroups = ["TextLabelsGeo"];
            var Jh = new no([mf, xf, Tf, jf, Gf, Kf, rh, gh, Ih, Vh, Wh, Zh]);
            Object.defineProperty(Jh, "list", {
                get: function() {
                    return this.all
                }
            }), Object.defineProperty(Jh, "any", {
                get: function() {
                    return this.first
                }
            }), Object.defineProperty(Jh, "descriptions", {
                get: function() {
                    return l.a.map(this._list, function(e) {
                        return l.a.pick(e.prototype, ["id", "name"])
                    })
                }
            }), Jh.create = function(e, t) {
                if (!t && e instanceof Array) {
                    var n = Qh(e, 2);
                    e = n[0], t = n[1]
                }
                return new(this.get(e) || this.first)(t)
            };
            var ed = Jh;

            function td(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function nd(e, t, n) {
                return e <= n ? e < 0 ? 0 : e : n
            }

            function rd(e, t) {
                this.name = e || "Custom", this.id = t || "CP"
            }
            rd.prototype = {
                constructor: rd,
                colors: [16777215, 16711680, 65280, 255, 8421504],
                minRangeColor: 0,
                midRangeColor: 8355711,
                maxRangeColor: 16777215,
                defaultElementColor: 16777215,
                elementColors: {},
                defaultResidueColor: 16777215,
                residueColors: {},
                chainColors: [16777215],
                defaultSecondaryColor: 16777215,
                secondaryColors: {},
                defaultGradientColor: 0,
                defaultNamedColor: 16777215,
                namedColorsArray: [
                    ["indianred", 13458524],
                    ["lightcoral", 15761536],
                    ["salmon", 16416882],
                    ["darksalmon", 15308410],
                    ["lightsalmon", 16752762],
                    ["crimson", 14423100],
                    ["red", 16711680],
                    ["firebrick", 11674146],
                    ["darkred", 9109504],
                    ["pink", 16761035],
                    ["lightpink", 16758465],
                    ["hotpink", 16738740],
                    ["deeppink", 16716947],
                    ["mediumvioletred", 13047173],
                    ["palevioletred", 14381203],
                    ["coral", 16744272],
                    ["tomato", 16737095],
                    ["orangered", 16729344],
                    ["darkorange", 16747520],
                    ["orange", 16753920],
                    ["gold", 16766720],
                    ["yellow", 16776960],
                    ["lightyellow", 16777184],
                    ["lemonchiffon", 16775885],
                    ["lightgoldenrodyellow", 16448210],
                    ["papayawhip", 16773077],
                    ["moccasin", 16770229],
                    ["peachpuff", 16767673],
                    ["palegoldenrod", 15657130],
                    ["khaki", 15787660],
                    ["darkkhaki", 12433259],
                    ["lavender", 15132410],
                    ["thistle", 14204888],
                    ["plum", 14524637],
                    ["violet", 15631086],
                    ["orchid", 14315734],
                    ["fuchsia", 16711935],
                    ["magenta", 16711935],
                    ["mediumorchid", 12211667],
                    ["mediumpurple", 9662683],
                    ["rebeccapurple", 6697881],
                    ["blueviolet", 9055202],
                    ["darkviolet", 9699539],
                    ["darkorchid", 10040012],
                    ["darkmagenta", 9109643],
                    ["purple", 8388736],
                    ["indigo", 4915330],
                    ["slateblue", 6970061],
                    ["mediumslateblue", 8087790],
                    ["darkslateblue", 4734347],
                    ["greenyellow", 11403055],
                    ["chartreuse", 8388352],
                    ["lawngreen", 8190976],
                    ["lime", 65280],
                    ["limegreen", 3329330],
                    ["palegreen", 10025880],
                    ["lightgreen", 9498256],
                    ["mediumspringgreen", 64154],
                    ["springgreen", 65407],
                    ["mediumseagreen", 3978097],
                    ["seagreen", 3050327],
                    ["forestgreen", 2263842],
                    ["green", 32768],
                    ["darkgreen", 25600],
                    ["yellowgreen", 10145074],
                    ["olivedrab", 7048739],
                    ["olive", 8421376],
                    ["darkolivegreen", 5597999],
                    ["mediumaquamarine", 6737322],
                    ["darkseagreen", 9419919],
                    ["lightseagreen", 2142890],
                    ["darkcyan", 35723],
                    ["teal", 32896],
                    ["aqua", 65535],
                    ["cyan", 65535],
                    ["lightcyan", 14745599],
                    ["paleturquoise", 11529966],
                    ["aquamarine", 8388564],
                    ["turquoise", 4251856],
                    ["mediumturquoise", 4772300],
                    ["darkturquoise", 52945],
                    ["cadetblue", 6266528],
                    ["steelblue", 4620980],
                    ["lightsteelblue", 11584734],
                    ["powderblue", 11591910],
                    ["lightblue", 11393254],
                    ["skyblue", 8900331],
                    ["lightskyblue", 8900346],
                    ["deepskyblue", 49151],
                    ["dodgerblue", 2003199],
                    ["cornflowerblue", 6591981],
                    ["royalblue", 4286945],
                    ["blue", 255],
                    ["mediumblue", 205],
                    ["darkblue", 139],
                    ["navy", 128],
                    ["midnightblue", 1644912],
                    ["cornsilk", 16775388],
                    ["blanchedalmond", 16772045],
                    ["bisque", 16770244],
                    ["navajowhite", 16768685],
                    ["wheat", 16113331],
                    ["burlywood", 14596231],
                    ["tan", 13808780],
                    ["rosybrown", 12357519],
                    ["sandybrown", 16032864],
                    ["goldenrod", 14329120],
                    ["darkgoldenrod", 12092939],
                    ["peru", 13468991],
                    ["chocolate", 13789470],
                    ["saddlebrown", 9127187],
                    ["sienna", 10506797],
                    ["brown", 10824234],
                    ["maroon", 8388608],
                    ["white", 16777215],
                    ["snow", 16775930],
                    ["honeydew", 15794160],
                    ["mintcream", 16121850],
                    ["azure", 15794175],
                    ["aliceblue", 15792383],
                    ["ghostwhite", 16316671],
                    ["whitesmoke", 16119285],
                    ["seashell", 16774638],
                    ["beige", 16119260],
                    ["oldlace", 16643558],
                    ["floralwhite", 16775920],
                    ["ivory", 16777200],
                    ["antiquewhite", 16444375],
                    ["linen", 16445670],
                    ["lavenderblush", 16773365],
                    ["mistyrose", 16770273],
                    ["gainsboro", 14474460],
                    ["lightgray", 13882323],
                    ["silver", 12632256],
                    ["darkgray", 11119017],
                    ["gray", 8421504],
                    ["dimgray", 6908265],
                    ["lightslategray", 7833753],
                    ["slategray", 7372944],
                    ["darkslategray", 3100495],
                    ["black", 0]
                ],
                namedColors: {},
                gradients: {
                    rainbow: [255, 65535, 65280, 16776960, 16711680],
                    temp: [255, 32767, 16777215, 16744192, 16711680],
                    hot: [16777215, 16744192, 16711680],
                    cold: [16777215, 32767, 255],
                    "blue-red": [255, 16777215, 16711680],
                    reds: [16777215, 16711680],
                    blues: [16777215, 255]
                },
                getElementColor: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                        n = this.elementColors[e];
                    return void 0 !== n || t ? n : this.defaultElementColor
                },
                getResidueColor: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                        n = this.residueColors[e];
                    return void 0 !== n || t ? n : this.defaultResidueColor
                },
                getChainColor: function(e) {
                    var t = e.charCodeAt(0);
                    return t = (31 & (t < 0 ? 0 : t >= 256 ? t - 256 : t)) % this.chainColors.length, this.chainColors[t]
                },
                getSecondaryColor: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                        n = this.secondaryColors[e];
                    return void 0 !== n || t ? n : this.defaultSecondaryColor
                },
                getSequentialColor: function(e) {
                    var t = this.colors,
                        n = t.length;
                    return e < 0 ? t[e % n + n] : t[e % n]
                },
                getGradientColor: function(e, t) {
                    var n = this.gradients[t];
                    if (!n) return this.defaultNamedColor;
                    var r, o, i, a, s = n.length,
                        l = e * (s - 1),
                        c = Math.floor(l),
                        u = nd(c + 1, 0, s - 1);
                    return c = nd(c, 0, s - 1), r = n[c], o = n[u], (a = 1 - (i = l - c)) * (r >> 16 & 255) + i * (o >> 16 & 255) << 16 | a * (r >> 8 & 255) + i * (o >> 8 & 255) << 8 | a * (255 & r) + i * (255 & o)
                },
                getNamedColor: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                        n = this.namedColors[e];
                    return void 0 !== n || t ? n : this.defaultNamedColor
                }
            };
            for (var od = rd.prototype, id = od.namedColorsArray, ad = od.namedColors, sd = 0, ld = id.length; sd < ld; ++sd) {
                var cd = td(id[sd], 2),
                    ud = cd[0],
                    pd = cd[1];
                ad[ud] = pd
            }
            var fd = rd,
                hd = new fd("CPK", "CP");
            hd.elementColors = {
                H: 16777215,
                C: 2105376,
                N: 2121983,
                O: 15605776,
                F: 65280,
                P: 8397055,
                S: 16776960,
                CL: 47872,
                FE: 13684944,
                CO: 13684944,
                NI: 13684944,
                CU: 13684944,
                BR: 34816,
                I: 21760
            };
            var dd, md = hd;

            function yd(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var vd = new fd("Jmol", "JM");
            vd.colors = [255, 22015, 44031, 65535, 65451, 65365, 65280, 5635840, 11271936, 16776960, 16755456, 16733440, 16711680, 16711765, 16711851, 16711935, 11206911, 5570815], vd.elementColors = {
                H: 16777215,
                D: 16777152,
                T: 16777120,
                HE: 14286847,
                LI: 13402367,
                BE: 12779264,
                B: 16758197,
                C: 9474192,
                N: 3166456,
                O: 16715021,
                F: 9494608,
                NE: 11789301,
                NA: 11230450,
                MG: 9109248,
                AL: 12560038,
                SI: 1578e4,
                P: 16744448,
                S: 16777008,
                CL: 2093087,
                AR: 8442339,
                K: 9388244,
                CA: 4062976,
                SC: 15132390,
                TI: 12567239,
                V: 10921643,
                CR: 9083335,
                MN: 10255047,
                FE: 14706227,
                CO: 15765664,
                NI: 5296208,
                CU: 13140019,
                ZN: 8224944,
                GA: 12750735,
                GE: 6721423,
                AS: 12419299,
                SE: 16752896,
                BR: 10889513,
                KR: 6076625,
                RB: 7351984,
                SR: 65280,
                Y: 9764863,
                ZR: 9756896,
                NB: 7586505,
                MO: 5551541,
                TC: 3907230,
                RU: 2396047,
                RH: 687500,
                PD: 27013,
                AG: 12632256,
                CD: 16767375,
                IN: 10909043,
                SN: 6717568,
                SB: 10380213,
                TE: 13924864,
                I: 9699476,
                XE: 4366e3,
                CS: 5707663,
                BA: 51456,
                LA: 7394559,
                CE: 16777159,
                PR: 14286791,
                ND: 13107143,
                PM: 10747847,
                SM: 9437127,
                EU: 6422471,
                GD: 4587463,
                TB: 3211207,
                DY: 2097095,
                HO: 65436,
                ER: 58997,
                TM: 54354,
                YB: 48952,
                LU: 43812,
                HF: 5096191,
                TA: 5089023,
                W: 2200790,
                RE: 2522539,
                OS: 2516630,
                IR: 1528967,
                PT: 13684960,
                AU: 16765219,
                HG: 12105936,
                TL: 10900557,
                PB: 5724513,
                BI: 10375093,
                PO: 11230208,
                AT: 7688005,
                RN: 4358806,
                FR: 4325478,
                RA: 32e3,
                AC: 7384058,
                TH: 47871,
                PA: 41471,
                U: 36863,
                NP: 33023,
                PU: 27647,
                AM: 5528818,
                CM: 7888099,
                BK: 9064419,
                CF: 10565332,
                ES: 11739092,
                FM: 11739066,
                MD: 11734438,
                NO: 12389767,
                LR: 13041766,
                RF: 13369433,
                DB: 13697103,
                SG: 14221381,
                BH: 14680120,
                HS: 15073326,
                MT: 15400998
            }, vd.defaultResidueColor = 12492910, vd.residueColors = {
                ALA: 13158600,
                ARG: 1334015,
                ASN: 56540,
                ASP: 15075850,
                CYS: 15132160,
                GLN: 56540,
                GLU: 15075850,
                GLY: 15461355,
                HIS: 8553170,
                ILE: 1016335,
                LEU: 1016335,
                LYS: 1334015,
                MET: 15132160,
                PHE: 3289770,
                PRO: 14456450,
                SER: 16422400,
                THR: 16422400,
                TRP: 11819700,
                TYR: 3289770,
                VAL: 1016335,
                A: 10526975,
                C: 16747595,
                G: 16740464,
                I: 8454143,
                T: 10551200,
                U: 16744576,
                DA: 10526975,
                DC: 16747595,
                DG: 16740464,
                DI: 8454143,
                DT: 10551200,
                DU: 16744576,
                "+A": 10526975,
                "+C": 16747595,
                "+G": 16740464,
                "+I": 8454143,
                "+T": 10551200,
                "+U": 16744576
            }, vd.chainColors = [4294967295, 4290826495, 4289789872, 4294951112, 4294967168, 4294951167, 4289786096, 4294955120, 4293951616, 4294303411, 4278239231, 4291648604, 4284927402, 4288335154, 4293821166, 4278243025, 4278255487, 4282168177, 4278190219, 4290623339, 4278215680, 4286578688, 4286611456, 4286578816, 4278222976, 4290283019, 4289864226];
            var _d = nt.Type;
            vd.secondaryColors = (yd(dd = {}, _d.HELIX_ALPHA, 16711808), yd(dd, _d.HELIX_PI, 6291584), yd(dd, _d.HELIX_310, 10485888), yd(dd, _d.STRAND, 16762880), yd(dd, _d.TURN, 6324479), yd(dd, "dna", 11403518), yd(dd, "rna", 16580962), dd);
            var gd, bd = vd;

            function wd(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var xd = new fd("VMD", "VM");
            xd.colors = [255, 16711680, 6316128, 16744448, 16776960, 8421427, 10066329, 65280, 16777215, 16751001, 4243648, 10879142, 8447590, 15099571, 8408320, 8421568], xd.defaultElementColor = 8408320, xd.elementColors = {
                H: 16777215,
                C: 4243391,
                N: 255,
                O: 16711680,
                P: 8421427,
                S: 16776960
            }, xd.defaultResidueColor = 4243648, xd.residueColors = {
                ALA: 255,
                ARG: 16777215,
                ASN: 8421427,
                ASP: 16711680,
                CYS: 16776960,
                GLN: 16744448,
                GLU: 16751001,
                GLY: 16777215,
                HIS: 4243648,
                ILE: 65280,
                LEU: 16751001,
                LYS: 4243648,
                MET: 16776960,
                PHE: 10879142,
                PRO: 8408064,
                SER: 16776960,
                THR: 15099571,
                TRP: 10066329,
                TYR: 65280,
                VAL: 8421427,
                A: 255,
                C: 16744448,
                G: 16776960,
                T: 10879142,
                U: 65280,
                DA: 255,
                DC: 16744448,
                DG: 16776960,
                DT: 10879142,
                DU: 65280,
                "+A": 255,
                "+C": 16744448,
                "+G": 16776960,
                "+T": 10879142,
                "+U": 65280,
                WAT: 4243648,
                H2O: 4243648,
                HOH: 4243648
            }, xd.chainColors = [16777215].concat(xd.colors);
            var Sd = nt.Type;
            xd.secondaryColors = (wd(gd = {}, Sd.HELIX_ALPHA, 10879142), wd(gd, Sd.HELIX_310, 255), wd(gd, Sd.HELIX_PI, 16711680), wd(gd, Sd.STRAND, 16776960), wd(gd, Sd.BRIDGE, 8421427), wd(gd, Sd.TURN, 4243648), gd);
            var Cd = new no([md, bd, xd]);
            Object.defineProperty(Cd, "list", {
                get: function() {
                    return this.all
                }
            }), Object.defineProperty(Cd, "any", {
                get: function() {
                    return this.first
                }
            });
            var Pd = Cd;

            function Ed(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Od = function() {
                function e(t) {
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this.constructor === e) throw new Error("Can not instantiate abstract class!");
                    this.opts = l.a.merge(R.deriveDeep(H.now.colorers[this.id], !0), t), this.palette = Pd.first
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "identify",
                    value: function() {
                        var e = R.objectsDiff(this.opts, H.now.colorers[this.id]);
                        return l.a.isEmpty(e) ? this.id : [this.id, e]
                    }
                }]) && Ed(t.prototype, n), r && Ed(t, r), e
            }();
            Od.prototype.id = "__";
            var Ad = Od;

            function Td(e) {
                return (Td = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function kd(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Rd(e, t) {
                return !t || "object" !== Td(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Id(e) {
                return (Id = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Md(e, t) {
                return (Md = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Nd = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Rd(this, Id(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Md(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        var n = e.element.name;
                        return "C" === n && this.opts.carbon >= 0 ? this.opts.carbon : this.palette.getElementColor(n)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.palette.defaultResidueColor
                    }
                }]) && kd(n.prototype, r), o && kd(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Nd, "id", ["EL", "AT"]), Nd.prototype.id = "EL", Nd.prototype.aliases = ["AT"], Nd.prototype.name = "Element", Nd.prototype.shortName = "Element";
            var Ld = Nd;

            function jd(e) {
                return (jd = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Dd(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Vd(e, t) {
                return !t || "object" !== jd(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Fd(e) {
                return (Fd = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Bd(e, t) {
                return (Bd = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var zd = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Vd(this, Fd(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Bd(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.palette.getResidueColor(e._type._name)
                    }
                }]) && Dd(n.prototype, r), o && Dd(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(zd, "id", "RT"), zd.prototype.id = "RT", zd.prototype.name = "Residue Type", zd.prototype.shortName = "Residue";
            var Ud = zd;

            function Gd(e) {
                return (Gd = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Hd(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Wd(e, t) {
                return !t || "object" !== Gd(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function qd(e) {
                return (qd = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Yd(e, t) {
                return (Yd = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Xd = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Wd(this, qd(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Yd(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        var n = e._chain;
                        if (n.minSequence === Number.POSITIVE_INFINITY && n.maxSequence === Number.NEGATIVE_INFINITY) return this.palette.defaultNamedColor;
                        var r = n.minSequence,
                            o = n.maxSequence > r ? n.maxSequence : r + 1;
                        return this.palette.getGradientColor((e._sequence - r) / (o - r), this.opts.gradient)
                    }
                }]) && Hd(n.prototype, r), o && Hd(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Xd, "id", ["SQ", "RI"]), Xd.prototype.id = "SQ", Xd.prototype.aliases = ["RI"], Xd.prototype.name = "Sequence", Xd.prototype.shortName = "Sequence";
            var $d = Xd;

            function Kd(e) {
                return (Kd = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Zd(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Qd(e, t) {
                return !t || "object" !== Kd(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Jd(e) {
                return (Jd = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function em(e, t) {
                return (em = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var tm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Qd(this, Jd(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && em(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.palette.getChainColor(e.getChain()._name)
                    }
                }]) && Zd(n.prototype, r), o && Zd(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(tm, "id", "CH"), tm.prototype.id = "CH", tm.prototype.name = "Chain", tm.prototype.shortName = "Chain";
            var nm = tm;

            function rm(e) {
                return (rm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function om(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function im(e, t) {
                return !t || "object" !== rm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function am(e) {
                return (am = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function sm(e, t) {
                return (sm = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var lm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), im(this, am(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && sm(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        if (e._type.flags & Fe.Flags.DNA) return this.palette.getSecondaryColor("dna");
                        if (e._type.flags & Fe.Flags.RNA) return this.palette.getSecondaryColor("rna");
                        var n = e.getSecondary();
                        if (n) {
                            var r = this.palette.getSecondaryColor(n.type, !0);
                            return void 0 === r && (r = this.palette.getSecondaryColor(n.generic)), r
                        }
                        return this.palette.defaultSecondaryColor
                    }
                }]) && om(n.prototype, r), o && om(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(lm, "id", "SS"), lm.prototype.id = "SS", lm.prototype.name = "Secondary Structure", lm.prototype.shortName = "Structure";
            var cm = lm;

            function um(e) {
                return (um = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function pm(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function fm(e, t) {
                return !t || "object" !== um(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function hm(e) {
                return (hm = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function dm(e, t) {
                return (dm = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var mm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), fm(this, hm(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && dm(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.opts.color
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.opts.color
                    }
                }]) && pm(n.prototype, r), o && pm(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(mm, "id", "UN"), mm.prototype.id = "UN", mm.prototype.name = "Uniform", mm.prototype.shortName = "Uniform";
            var ym = mm;

            function vm(e) {
                return (vm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function _m(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function gm(e, t) {
                return !t || "object" !== vm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function bm(e) {
                return (bm = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function wm(e, t) {
                return (wm = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var xm = function(e) {
                function t(e) {
                    var n;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), n = gm(this, bm(t).call(this, e));
                    var r = Xt.parse(n.opts.subset);
                    return n._subsetCached = r.error ? Xt.none() : r.selector, n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && wm(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this._subsetCached.includesAtom(e) ? this.opts.color : this.opts.baseColor
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        for (var n = this._subsetCached, r = !0, o = e._atoms, i = 0, a = o.length; i < a; ++i) r = r && n.includesAtom(o[i]);
                        return r ? this.opts.color : this.opts.baseColor
                    }
                }]) && _m(n.prototype, r), o && _m(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(xm, "id", "CO"), xm.prototype.id = "CO", xm.prototype.name = "Conditional", xm.prototype.shortName = "Conditional";
            var Sm = xm;

            function Cm(e) {
                return (Cm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Pm(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Em(e, t) {
                return !t || "object" !== Cm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Om(e) {
                return (Om = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Am(e, t) {
                return (Am = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Tm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Em(this, Om(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Am(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.palette.getChainColor(String.fromCharCode(e._location))
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.palette.defaultResidueColor
                    }
                }]) && Pm(n.prototype, r), o && Pm(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Tm, "id", "CF"), Tm.prototype.id = "CF", Tm.prototype.name = "Conformation", Tm.prototype.shortName = "Conformation";
            var km = Tm;

            function Rm(e) {
                return (Rm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Im(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Mm(e, t) {
                return !t || "object" !== Rm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Nm(e) {
                return (Nm = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Lm(e, t) {
                return (Lm = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var jm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Mm(this, Nm(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Lm(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        var n = this.opts,
                            r = 1;
                        return e._temperature && n ? (r = n.min === n.max ? e._temperature > n.max ? 1 : 0 : (e._temperature - n.min) / (n.max - n.min), this.palette.getGradientColor(r, n.gradient)) : this.palette.defaultGradientColor
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        var n = this.opts;
                        if (!n) return this.palette.defaultGradientColor;
                        if (e.temperature) {
                            var r = 0;
                            return r = n.min === n.max ? e.temperature > n.max ? 1 : 0 : (e.temperature - n.min) / (n.max - n.min), this.palette.getGradientColor(r, n.gradient)
                        }
                        return this.palette.defaultGradientColor
                    }
                }]) && Im(n.prototype, r), o && Im(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(jm, "id", "TM"), jm.prototype.id = "TM", jm.prototype.name = "Temperature", jm.prototype.shortName = "Temperature";
            var Dm = jm;

            function Vm(e) {
                return (Vm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Fm(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Bm(e, t) {
                return !t || "object" !== Vm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function zm(e) {
                return (zm = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Um(e, t) {
                return (Um = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Gm = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Bm(this, zm(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Um(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        var n = this.opts;
                        if (e._occupancy && n) {
                            var r = 1 - e._occupancy;
                            return this.palette.getGradientColor(r, n.gradient)
                        }
                        return this.palette.defaultGradientColor
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        var n = this.opts;
                        if (!n) return this.palette.defaultGradientColor;
                        if (e.occupancy > 0) {
                            var r = 1 - e.occupancy;
                            return this.palette.getGradientColor(r, n.gradient)
                        }
                        return this.palette.defaultGradientColor
                    }
                }]) && Fm(n.prototype, r), o && Fm(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Gm, "id", "OC"), Gm.prototype.id = "OC", Gm.prototype.name = "Occupancy", Gm.prototype.shortName = "Occupancy";
            var Hm = Gm;

            function Wm(e) {
                return (Wm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function qm(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ym(e, t) {
                return !t || "object" !== Wm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Xm(e) {
                return (Xm = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function $m(e, t) {
                return ($m = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Km = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Ym(this, Xm(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && $m(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        var n = this.palette.defaultResidueColor;
                        if (e._type.hydrophobicity) {
                            n = this.palette.getGradientColor((e._type.hydrophobicity - -4.5) / 9, this.opts.gradient)
                        }
                        return n
                    }
                }]) && qm(n.prototype, r), o && qm(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(Km, "id", "HY"), Km.prototype.id = "HY", Km.prototype.name = "Hydrophobicity", Km.prototype.shortName = "Hydrophobicity";
            var Zm = Km;

            function Qm(e) {
                return (Qm = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Jm(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function ey(e, t) {
                return !t || "object" !== Qm(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ty(e) {
                return (ty = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ny(e, t) {
                return (ny = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var ry = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), ey(this, ty(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && ny(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        return this.getResidueColor(e._residue, t)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        var n = e._molecule,
                            r = t.getMoleculeCount();
                        return r > 1 ? this.palette.getGradientColor((n._index - 1) / (r - 1), this.opts.gradient) : this.palette.getGradientColor(0, this.opts.gradient)
                    }
                }]) && Jm(n.prototype, r), o && Jm(n, o), t
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(ry, "id", "MO"), ry.prototype.id = "MO", ry.prototype.name = "Molecule", ry.prototype.shortName = "Molecule";
            var oy = ry;

            function iy(e) {
                return (iy = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ay(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function sy(e, t) {
                return !t || "object" !== iy(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function ly(e) {
                return (ly = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function cy(e, t) {
                return (cy = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var uy = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), sy(this, ly(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && cy(e, t)
                }(t, Ad), n = t, (r = [{
                    key: "getAtomColor",
                    value: function(e, t) {
                        var n, r, o = this.opts.color,
                            i = (n = o, (r = this.opts.factor) * (n >> 16 & 255) << 16 | r * (n >> 8 & 255) << 8 | r * (255 & n));
                        return e.flags & Ae.Flags.CARBON ? o : i
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return this.opts.color
                    }
                }]) && ay(n.prototype, r), o && ay(n, o), t
            }();

            function py(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(uy, "id", "CB"), uy.prototype.id = "CB", uy.prototype.name = "Carbon", uy.prototype.shortName = "Carbon";
            var fy = new no([Ld, Ud, $d, nm, cm, ym, Sm, km, Dm, Hm, Zm, oy, uy]);
            Object.defineProperty(fy, "list", {
                get: function() {
                    return this.all
                }
            }), Object.defineProperty(fy, "any", {
                get: function() {
                    return this.first
                }
            }), Object.defineProperty(fy, "descriptions", {
                get: function() {
                    return l.a.map(this._list, function(e) {
                        return l.a.pick(e.prototype, ["id", "name"])
                    })
                }
            }), fy.create = function(e, t) {
                if (!t && e instanceof Array) {
                    var n = py(e, 2);
                    e = n[0], t = n[1]
                }
                return new(this.get(e) || this.first)(t)
            };
            var hy = fy;

            function dy(e) {
                return new c.Color(e, e, e)
            }
            var my = new no([{
                id: "DF",
                name: "Diffuse",
                shortName: "Diffuse",
                uberOptions: {
                    diffuse: dy(1),
                    specular: dy(0),
                    shininess: 1,
                    opacity: 1
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "SF",
                name: "Soft Plastic",
                shortName: "Soft",
                uberOptions: {
                    diffuse: dy(1),
                    specular: dy(.1),
                    shininess: 30,
                    opacity: 1
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "PL",
                name: "Glossy Plastic",
                shortName: "Glossy",
                uberOptions: {
                    diffuse: dy(.56),
                    specular: dy(.28),
                    shininess: 100,
                    opacity: 1
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "ME",
                name: "Metal",
                shortName: "Metal",
                uberOptions: {
                    diffuse: dy(.56),
                    specular: dy(.55),
                    shininess: 30,
                    opacity: 1
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "TR",
                name: "Transparent",
                shortName: "Transparent",
                uberOptions: {
                    diffuse: dy(1),
                    specular: dy(0),
                    shininess: 1,
                    opacity: .5
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !0,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "GL",
                name: "Glass",
                shortName: "Glass",
                depthWrite: !0,
                uberOptions: {
                    diffuse: dy(.5),
                    specular: dy(.65),
                    shininess: 100,
                    opacity: .5
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !0,
                    toonShading: !1,
                    side: c.DoubleSide
                }
            }, {
                id: "BA",
                name: "Backdrop",
                shortName: "Backdrop",
                uberOptions: {
                    opacity: 1
                },
                values: {
                    lights: !1,
                    fog: !1,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !1,
                    side: c.BackSide
                }
            }, {
                id: "TN",
                name: "Toon",
                shortName: "Toon",
                uberOptions: {
                    diffuse: dy(1),
                    specular: dy(0),
                    shininess: 1,
                    opacity: 1
                },
                values: {
                    lights: !0,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    toonShading: !0,
                    side: c.DoubleSide
                }
            }, {
                id: "FL",
                name: "Flat",
                shortName: "Flat",
                uberOptions: {
                    diffuse: dy(1),
                    specular: dy(0),
                    shininess: 0,
                    opacity: 1
                },
                values: {
                    lights: !1,
                    fog: !0,
                    depthWrite: !0,
                    transparent: !1,
                    side: c.DoubleSide
                }
            }]);
            Object.defineProperty(my, "list", {
                get: function() {
                    return this.all
                }
            }), Object.defineProperty(my, "any", {
                get: function() {
                    return this.first
                }
            }), Object.defineProperty(my, "descriptions", {
                get: function() {
                    return l.a.map(this._list, function(e) {
                        return l.a.pick(e, ["id", "name"])
                    })
                }
            });
            var yy = my;

            function vy(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var _y = function() {
                function e(t, n, r, o) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e);
                    var i = {
                        clipPlane: H.now.draft.clipPlane,
                        fogTransparent: H.now.bg.transparent,
                        shadowmap: H.now.shadow.on,
                        shadowmapType: H.now.shadow.type
                    };
                    this.index = t, this.mode = n, this.colorer = r, this.selector = o, this.selectorString = "", this.count = 0, this.material = new Gr, this.material.setValues(i), this.material.setUberOptions({
                        fogAlpha: H.now.fogAlpha
                    }), this.materialPreset = yy.first, this.needsRebuild = !0, this.visible = !0, this.setMode(n)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "markAtoms",
                    value: function(e) {
                        return this.count = e.markAtoms(this.selector, 1 << this.index), this.needsRebuild = !0, this.count
                    }
                }, {
                    key: "unmarkAtoms",
                    value: function(e) {
                        e.clearAtomBits(1 << this.index), this.count = 0
                    }
                }, {
                    key: "setMode",
                    value: function(e) {
                        this.mode = e
                    }
                }, {
                    key: "setMaterialPreset",
                    value: function(e) {
                        this.materialPreset = e, this.material.setUberOptions(e.uberOptions), this.material.setValues(e.values)
                    }
                }, {
                    key: "reset",
                    value: function() {
                        this.geo = null, this.selectionGeo = null
                    }
                }, {
                    key: "buildGeometry",
                    value: function(e) {
                        return this.reset(), this.needsRebuild = !1, H.now.ao && this.material.setValues({
                            normalsToGBuffer: H.now.ao
                        }), this.geo = this.mode.buildGeometry(e, this.colorer, 1 << this.index, this.material), this.material.uberOptions.opacity < .99 && "prepass" === H.now.transparency && $r.processTransparentMaterial(this.geo, this.material), this.geo.visible = this.visible, H.now.shadow.on && $r.processMaterialForShadow(this.geo, this.material), $r.processColFromPosMaterial(this.geo, this.material), this.geo
                    }
                }, {
                    key: "buildSelectionGeometry",
                    value: function(e) {
                        var t = null;
                        if (this.geo && "getSubset" in this.geo) {
                            var n = this.geo.getSubset(e);
                            if (n && n.length > 0) {
                                (t = new c.Group).matrixAutoUpdate = !1, t.matrix = this.geo.matrix;
                                for (var r = 0; r < n.length; r++) {
                                    var o = n[r];
                                    t.add(o)
                                }
                            }
                        }
                        return t && (t.visible = this.visible), this.selectionGeo = t, this.selectionGeo
                    }
                }, {
                    key: "compare",
                    value: function(e) {
                        var t = {},
                            n = String(this.selector);
                        e && n.valueOf() === String(e.selector).valueOf() || (t.selector = n);
                        var r = this.mode.identify();
                        e && !Array.isArray(r) && r === e.mode || (t.mode = r);
                        var o = this.colorer.identify();
                        return e && !Array.isArray(o) && o === e.colorer || (t.colorer = o), e && this.materialPreset.id === e.material || (t.material = this.materialPreset.id), t
                    }
                }, {
                    key: "show",
                    value: function(e) {
                        this.visible = e, this.geo && (this.geo.visible = e), this.selectionGeo && (this.selectionGeo.visible = e)
                    }
                }]) && vy(t.prototype, n), r && vy(t, r), e
            }();

            function gy() {}

            function by(e) {
                this._complexVisual = e, this._inProgress = !1
            }

            function wy(e) {
                this._complexVisual = e, this._inProgress = !1
            }
            R.deriveClass(by, gy), by.prototype.begin = function() {
                var e = this._complexVisual.getComplex();
                this._componentTransforms = [];
                for (var t = 0; t < e._components.length; ++t) {
                    var n = e._components[t];
                    this._componentTransforms[n._index] = new c.Object3D
                }
                return this._inProgress = !0, !0
            }, by.prototype.apply = function() {
                if (this._inProgress) {
                    for (var e = this._complexVisual.getComplex(), t = 0; t < e._components.length; ++t) this._bakeComponentTransform(e._components[t]);
                    e.onAtomPositionChanged(), this._resetComponentTransform(), this._complexVisual.finalizeEdit()
                }
            }, by.prototype.discard = function() {
                this._inProgress && (this._resetComponentTransform(), this._complexVisual.finalizeEdit())
            }, by.prototype.getAltObj = function() {
                var e = {
                        objects: [],
                        pivot: new c.Vector3(0, 0, 0)
                    },
                    t = this._complexVisual,
                    n = t.getSelectedComponent();
                if (null === n) return e;
                var r, o, i, a, s = this._complexVisual.getSelectionGeo(),
                    l = 1 << t.getSelectionBit();
                for (function e(t, n, r) {
                        var o = t.children;
                        if (o)
                            for (var i = 0, a = o.length; i < a; ++i) {
                                var s = o[i];
                                s._component === n && r(s), s instanceof $r.RCGroup && e(s, n, r)
                            }
                    }(t, n, function(t) {
                        e.objects.push(t)
                    }), r = 0; r < s.children.length; ++r)
                    for (i = s.children[r], o = 0; o < i.children.length; ++o)(a = i.children[o]).hasOwnProperty("_component") && a._component === n && e.objects.push(a);
                e.objects.push(this._componentTransforms[n._index]);
                var u = new c.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE),
                    p = new c.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);
                return n.forEachResidue(function(e) {
                    var t = e._atoms;
                    for (o = 0; o < t.length; ++o) t[o]._mask & l && (u.min(t[o]._position), p.max(t[o]._position))
                }), e.pivot.lerpVectors(u, p, .5), e
            }, by.prototype._bakeComponentTransform = function(e) {
                var t = this._componentTransforms[e._index];
                !t || 0 === t.position.x && 0 === t.position.y && 0 === t.position.z && 0 === t.quaternion.x && 0 === t.quaternion.y && 0 === t.quaternion.z && 1 === t.quaternion.w || (t.updateMatrix(), e.forEachResidue(function(e) {
                    for (var n = e._atoms, r = 0; r < n.length; ++r) n[r]._position.applyMatrix4(t.matrix)
                }))
            }, by.prototype._resetComponentTransform = function() {
                var e, t, n, r, o = this._complexVisual,
                    i = this._complexVisual.getSelectionGeo();
                for (e = 0; e < this._componentTransforms.length; ++e)(r = this._componentTransforms[e]).position.set(0, 0, 0), r.quaternion.set(0, 0, 0, 1);
                for (e = 0; e < o.children.length; ++e)
                    for (n = o.children[e], t = 0; t < n.children.length; ++t)(r = n.children[t]).hasOwnProperty("_component") && (r.position.set(0, 0, 0), r.quaternion.set(0, 0, 0, 1));
                for (e = 0; e < i.children.length; ++e)
                    for (n = i.children[e], t = 0; t < n.children.length; ++t)(r = n.children[t]).hasOwnProperty("_component") && (r.position.set(0, 0, 0), r.quaternion.set(0, 0, 0, 1))
            }, R.deriveClass(wy, gy), wy.prototype.begin = function() {
                var e = this._complexVisual,
                    t = this._complexVisual.getSelectionGeo(),
                    n = this._getSelectionBorderAtoms();
                if (n.length < 1 || n.length > 2) return v.error("Can only edit fragments with one or two bound atoms."), !1;
                this._fragmentBoundAtoms = n;
                var r = 1 << e.getSelectionBit();
                e.disableSubset(r, !0);
                for (var o = 0; o < t.children.length; ++o) t.children[o].visible = !1;
                var i = n[0]._position.clone();
                2 === n.length && i.lerp(n[1]._position, .5), this._fragmentGeo = new c.Group, e.add(this._fragmentGeo), this._fragmentGeo.position.copy(i), this._fragmentSelectionGeo = new c.Group, t.add(this._fragmentSelectionGeo), this._fragmentSelectionGeo.position.copy(i);
                var a = i.clone();
                a.negate();
                for (var s = 0; s < e.children.length; ++s) {
                    var l = e.children[s];
                    if ("getSubset" in l) {
                        var u = new c.Group;
                        this._fragmentGeo.add(u);
                        var p = new c.Group;
                        this._fragmentSelectionGeo.add(p);
                        for (var f = l.getSubset(r, !0), h = 0; h < f.length; h++) {
                            var d = f[h];
                            u.add(d), d.position.copy(a)
                        }
                        for (var m = l.getSubset(r, !0), y = 0; y < m.length; y++) {
                            var _ = m[y];
                            p.add(_), _.position.copy(a)
                        }
                    }
                }
                return $r.applySelectionMaterial(this._fragmentSelectionGeo), this._inProgress = !0, !0
            }, wy.prototype.apply = function() {
                if (this._inProgress) {
                    var e = this._complexVisual,
                        t = e.getSelectionBit(),
                        n = this._fragmentGeo.position,
                        r = this._fragmentGeo.matrix.clone();
                    r.multiply((new c.Matrix4).makeTranslation(-n.x, -n.y, -n.z)), this._bakeAtomTransform(r, 1 << t), e.enableSubset(1 << t, !0), e.getComplex().onAtomPositionChanged(), e.finalizeEdit()
                }
            }, wy.prototype.discard = function() {
                if (this._inProgress) {
                    var e = this._complexVisual,
                        t = this._complexVisual.getSelectionGeo();
                    this._fragmentGeo.parent.remove(this._fragmentGeo), e.enableSubset(1 << e.getSelectionBit(), !0);
                    for (var n = 0; n < t.children.length; ++n) {
                        var r = t.children[n];
                        r.visible ? t.remove(r) : r.visible = !0
                    }
                    e.finalizeEdit()
                }
            }, wy.prototype.isFreeRotationAllowed = function() {
                return this._fragmentBoundAtoms.length < 2
            }, wy.prototype.getAltObj = function() {
                var e = {
                    objects: [],
                    pivot: new c.Vector3(0, 0, 0)
                };
                e.objects.push(this._fragmentGeo, this._fragmentSelectionGeo);
                var t = this._fragmentBoundAtoms;
                if (1 === t.length) {
                    if (1 === t[0]._bonds.length) {
                        var n = t[0]._bonds[0];
                        e.axis = (new c.Vector3).subVectors(n._right._position, n._left._position), e.axis.normalize(), e.axis.transformDirection(this._complexVisual.matrixWorld)
                    }
                } else 2 === t.length && (e.axis = (new c.Vector3).subVectors(t[1]._position, t[0]._position), e.axis.normalize(), e.axis.transformDirection(this._complexVisual.matrixWorld));
                return e
            }, wy.prototype._getSelectionBorderAtoms = function() {
                var e = this._complexVisual.getComplex(),
                    t = 1 << this._complexVisual.getSelectionBit(),
                    n = {};
                e.forEachBond(function(e) {
                    e._left._mask & t ? 0 == (e._right._mask & t) && (n[e._left._index] = 1) : e._right._mask & t && (n[e._right._index] = 1)
                });
                for (var r = [], o = Object.keys(n), i = 0, a = o.length; i < a; ++i) {
                    var s = o[i];
                    r.push(e._atoms[s])
                }
                return r
            }, wy.prototype._bakeAtomTransform = function(e, t) {
                this._complexVisual.getComplex().forEachAtom(function(n) {
                    n._mask & t && n._position.applyMatrix4(e)
                })
            };
            var xy = {
                ComponentEditor: by,
                FragmentEditor: wy
            };

            function Sy(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }
            var Cy = hr.selectors;

            function Py(e, t) {
                Qr.call(this, e, t), this._complex = t, this._reprList = [], this._repr = null, this._reprListChanged = !0, this._selectionBit = 0, this._reprUsedBits = 0, this._selectionCount = 0, this._selectionGeometry = new c.Group
            }

            function Ey(e, t) {
                Array.isArray(t) || (t = [t]);
                var n = Sy(t, 2),
                    r = n[0],
                    o = n[1];
                return new(e.get(r) || e.first)(o)
            }
            Py.NUM_REPRESENTATION_BITS = 30, R.deriveClass(Py, Qr), Py.prototype.getBoundaries = function() {
                return this._complex.getBoundaries()
            }, Py.prototype.release = function() {
                this._selectionGeometry.parent && this._selectionGeometry.remove(this._selectionGeometry), Qr.prototype.release.call(this)
            }, Py.prototype.getComplex = function() {
                return this._complex
            }, Py.prototype.getSelectionCount = function() {
                return this._selectionCount
            }, Py.prototype.getSelectionGeo = function() {
                return this._selectionGeometry
            }, Py.prototype.getSelectionBit = function() {
                return this._selectionBit
            }, Py.prototype.getEditor = function() {
                return this._editor
            }, Py.prototype.resetReps = function(e) {
                this._complex && this._complex.clearAtomBits(-1), this._reprListChanged = !0, this._reprUsedBits = 0, this._reprList.length = e.length;
                for (var t = 0, n = e.length; t < n; ++t) {
                    var r = e[t],
                        o = void 0,
                        i = void 0;
                    if ("string" == typeof r.selector) i = r.selector, o = Cy.parse(i).selector;
                    else if (void 0 === r.selector) {
                        i = H.now.presets.default[0].selector, o = Cy.parse(i).selector
                    } else i = (o = r.selector).toString();
                    var a = Ey(ed, r.mode),
                        s = Ey(hy, r.colorer),
                        l = yy.get(r.material) || yy.first;
                    this._reprList[t] = new _y(t, a, s, o), this._reprList[t].setMaterialPreset(l), this._reprList[t].selectorString = i, this._complex && this._complex.markAtoms(o, 1 << t), this._reprUsedBits |= 1 << t
                }
                this._repr = e.length > 0 ? this._reprList[0] : null, this._selectionBit = e.length, this._reprUsedBits |= 1 << this._selectionBit, this._selectionCount = 0, this._complex && this._complex.update()
            }, Py.prototype.repCount = function() {
                return this._reprList.length
            }, Py.prototype.repCurrent = function(e) {
                return e >= 0 && e < this._reprList.length ? this._repr = this._reprList[e] : e = this._reprList.indexOf(this._repr), e
            }, Py.prototype.rep = function(e, t) {
                if (!t && (void 0 === e || e instanceof Object) && (t = e, e = this.repCurrent()), e < 0 || e > this._reprList.length) return v.error("Rep ".concat(e, " does not exist!")), null;
                e === this._reprList.length && (this.repAdd(t), t = void 0, v.warn("Rep ".concat(e, " does not exist! New representation was created.")));
                var n = this._reprList[e],
                    r = {
                        selector: n.selectorString,
                        mode: n.mode.identify(),
                        colorer: n.colorer.identify(),
                        material: n.materialPreset.id
                    };
                if (t) {
                    var o = !1;
                    if (t.selector) {
                        var i = Cy.parse(t.selector).selector,
                            a = String(i);
                        r.selector !== a && (n.selectorString = r.selector = a, n.selector = i, n.markAtoms(this._complex), o = !0, v.debug("rep[".concat(e, "].selector changed to").concat(a)))
                    }
                    if (t.mode) {
                        var s = t.mode;
                        l.a.isEqual(r.mode, s) || (r.mode = s, n.setMode(Ey(ed, t.mode)), o = !0, v.debug("rep[".concat(e, "].mode changed to ").concat(s)), !n.mode.isSurface || "ultra" !== H.now.resolution && "high" !== H.now.resolution || (v.report('Surface resolution was changed to "medium" to avoid hang-ups.'), H.set("resolution", "medium")))
                    }
                    if (t.colorer) {
                        var c = t.colorer;
                        l.a.isEqual(r.colorer, c) || (r.colorer = c, n.colorer = Ey(hy, t.colorer), o = !0, v.debug("rep[".concat(e, "].colorer changed to ").concat(c)))
                    }
                    if (t.material) {
                        var u = t.material;
                        l.a.isEqual(r.material, u) || (r.material = u, n.setMaterialPreset(yy.get(t.material)), o = !0, v.debug("rep[".concat(e, "].material changed to").concat(u)))
                    }
                    o && (n.needsRebuild = !0)
                }
                return r
            }, Py.prototype.repGet = function(e) {
                return (void 0 === e || e instanceof Object) && (e = this.repCurrent()), e < 0 || e >= this._reprList.length ? null : this._reprList[e]
            }, Py.prototype._getFreeReprIdx = function() {
                for (var e = this._reprUsedBits, t = 0; t <= Py.NUM_REPRESENTATION_BITS; ++t, e >>= 1)
                    if (0 == (1 & e)) return t;
                return -1
            }, Py.prototype.repAdd = function(e) {
                if (this._reprList.length >= Py.NUM_REPRESENTATION_BITS) return -1;
                var t = this._getFreeReprIdx();
                if (t < 0) return -1;
                var n = this.buildSelectorFromMask(1 << this._selectionBit),
                    r = H.now.presets.default[0],
                    o = l.a.merge({
                        selector: r.selector,
                        mode: r.mode,
                        colorer: r.colorer,
                        material: r.material
                    }, e),
                    i = "string" == typeof o.selector ? Cy.parse(o.selector).selector : o.selector,
                    a = new _y(this._selectionBit, Ey(ed, o.mode), Ey(hy, o.colorer), i);
                return a.selectorString = i.toString(), a.setMaterialPreset(yy.get(o.material)), a.markAtoms(this._complex), this._reprList.push(a), this._selectionBit = t, this._reprUsedBits |= 1 << this._selectionBit, this._complex.markAtoms(n, 1 << this._selectionBit), this._reprList.length - 1
            }, Py.prototype.repRemove = function(e) {
                void 0 === e && (e = this.repCurrent());
                var t = this._reprList.length;
                if (!(e < 0 || e >= t || t <= 1)) {
                    var n = this._reprList[e];
                    n.unmarkAtoms(this._complex), this._reprUsedBits &= ~(1 << n.index), this._reprList.splice(e, 1), n === this._repr && (e = e < --t ? e : t - 1, this._repr = this._reprList[e]), this._reprListChanged = !0
                }
            }, Py.prototype.repHide = function(e, t) {
                (void 0 === t && (t = !0), e < 0 || e >= this._reprList.length) || this._reprList[e].show(!t)
            }, Py.prototype.select = function(e, t) {
                t ? this._selectionCount += this._complex.markAtomsAdditionally(e, 1 << this._selectionBit) : this._selectionCount = this._complex.markAtoms(e, 1 << this._selectionBit), this._complex.updateStructuresMask(), this.rebuildSelectionGeometry()
            }, Py.prototype.resetSelectionMask = function() {
                0 !== this._selectionCount && (this._selectionCount = 0, this._complex && this._complex.clearAtomBits(1 << this._selectionBit))
            }, Py.prototype.updateSelectionMask = function(e) {
                var t = this,
                    n = e.atom,
                    r = e.residue,
                    o = e.chain,
                    i = e.molecule,
                    a = 1 << this._selectionBit,
                    s = ~a;
                if (n) r = n._residue, o = r._chain, i = r._molecule, n._mask & a ? (n._mask &= s, r._mask &= s, o._mask &= s, i && (i._mask &= s), this._selectionCount--) : (n._mask |= a, this._selectionCount++, r.collectMask(), o.collectMask(), i && i.collectMask());
                else if (r) o = r._chain, i = r._molecule, r._mask & a ? (r._mask &= s, o._mask &= s, r.forEachAtom(function(e) {
                    e._mask & a && (e._mask &= s, t._selectionCount--)
                })) : (r._mask |= a, r.forEachAtom(function(e) {
                    e._mask & a || (e._mask |= a, t._selectionCount++)
                }), o.collectMask(), i && i.collectMask());
                else if (o || i) {
                    var l = o || i;
                    l._mask & a ? (l._mask &= s, l.forEachResidue(function(e) {
                        e._mask & a && (e._mask &= s, e.forEachAtom(function(e) {
                            e._mask & a && (e._mask &= s, t._selectionCount--)
                        }), e._mask &= s)
                    })) : (l._mask |= a, l.forEachResidue(function(e) {
                        if (!(e._mask & a)) {
                            e._mask |= a, e.forEachAtom(function(e) {
                                e._mask & a || (e._mask |= a, t._selectionCount++)
                            });
                            var n = o ? e.getMolecule() : e.getChain();
                            n && n.collectMask()
                        }
                    }))
                } else this.resetSelectionMask()
            }, Py.prototype.expandSelection = function() {
                var e = this,
                    t = 1 << this._selectionBit;
                this._complex.forEachBond(function(e) {
                    e._left._mask & t ? 0 == (e._right._mask & t) && (e._right._mask |= 1 << 31) : e._right._mask & t && (e._left._mask |= 1 << 31)
                });
                this._complex.forEachAtom(function(n) {
                    n._mask & 1 << 31 && (n._mask = n._mask & ~(1 << 31) | t, ++e._selectionCount)
                }), this._complex.updateStructuresMask()
            }, Py.prototype.shrinkSelection = function() {
                var e = this,
                    t = 1 << this._selectionBit;
                this._complex.forEachBond(function(e) {
                    e._left._mask & t ? 0 == (e._right._mask & t) && (e._left._mask |= 1 << 31) : e._right._mask & t && (e._right._mask |= 1 << 31)
                }), this._complex.forEachAtom(function(e) {
                    e._mask & t && 1 === e._bonds.length && (e._mask |= 1 << 31)
                });
                var n = ~(t | 1 << 31);
                this._complex.forEachAtom(function(t) {
                    t._mask & 1 << 31 && (t._mask &= n, --e._selectionCount)
                }), this._complex.updateStructuresMask()
            }, Py.prototype.getSelectedComponent = function() {
                var e = 1 << this._selectionBit,
                    t = null,
                    n = !1;
                return this._complex.forEachAtom(function(r) {
                    r._mask & e && (null === t ? t = r._residue._component : t !== r._residue._component && (n = !0))
                }), n ? null : t
            }, Py.prototype.needsRebuild = function() {
                if (this._reprListChanged) return !0;
                for (var e = this._reprList, t = 0, n = e.length; t < n; ++t) {
                    if (e[t].needsRebuild) return !0
                }
                return !1
            }, Py.prototype.rebuild = function() {
                var e = this;
                return $r.clearTree(this), new Promise(function(t, n) {
                    var r = e._complex;
                    if (r) {
                        var o = !1;
                        setTimeout(function() {
                            console.time("build");
                            for (var n = e._reprList, i = Pd.get(H.now.palette) || Pd.first, a = !1, s = 0, l = n.length; s < l; ++s) {
                                var c = n[s];
                                if (c.colorer.palette = i, c.needsRebuild) {
                                    c.reset();
                                    try {
                                        c.buildGeometry(r)
                                    } catch (e) {
                                        if (!(e instanceof R.OutOfMemoryError)) throw e;
                                        c.needsRebuild = !1, c.reset(), v.error("Not enough memory to build geometry for representation ".concat(c.index + 1)), o = !0
                                    }
                                    0
                                }
                                a = o || a || $r.groupHasGeometryToRender(c.geo), c.geo && e.add(c.geo)
                            }
                            e._reprListChanged = !1, console.timeEnd("build"), t()
                        }, 10)
                    } else t()
                })
            }, Py.prototype.setNeedsRebuild = function() {
                for (var e = this._reprList, t = 0, n = e.length; t < n; ++t) e[t].needsRebuild = !0
            }, Py.prototype.rebuildSelectionGeometry = function() {
                var e = 1 << this._selectionBit;
                $r.clearTree(this._selectionGeometry);
                for (var t = 0, n = this._reprList.length; t < n; ++t) {
                    var r = this._reprList[t].buildSelectionGeometry(e);
                    if (r) {
                        this._selectionGeometry.add(r);
                        for (var o = 0; o < r.children.length; o++) {
                            var i = r.children[o];
                            if (this._editor && this._editor._componentTransforms) {
                                var a = this._editor._componentTransforms[i._component._index];
                                a && (i.position.copy(a.position), i.quaternion.copy(a.quaternion))
                            }
                        }
                        $r.applySelectionMaterial(r)
                    }
                }
            }, Py.prototype._buildSelectorFromSortedLists = function(e, t, n) {
                var r = this._complex;

                function o(e) {
                    for (var t = [], n = 0, r = NaN, o = NaN, i = 0, a = e.length; i < a; ++i) {
                        var s = e[i];
                        s === o + 1 ? o = s : (Number.isNaN(r) || (t[n++] = new Cy.Range(r, o)), r = o = s)
                    }
                    return Number.isNaN(r) || (t[n] = new Cy.Range(r, o)), t
                }
                var i = null;
                if (n.length === r._chains.length) i = Cy.all();
                else {
                    var a;
                    if (n.length > 0 && (a = Cy.chain(n), i = i ? Cy.or(i, a) : a), Object.keys(t).length > 0)
                        for (var s in t) t.hasOwnProperty(s) && (a = Cy.and(Cy.chain(s), Cy.residx(o(t[s]))), i = i ? Cy.or(i, a) : a);
                    e.length > 0 && (a = Cy.serial(o(e)), i = i ? Cy.or(i, a) : a), i || (i = Cy.none())
                }
                return i
            }, Py.prototype.buildSelectorFromMask = function(e) {
                var t = this._complex,
                    n = [],
                    r = {},
                    o = [];
                return t.forEachChain(function(t) {
                    t._mask & e && n.push(t._name)
                }), t.forEachResidue(function(t) {
                    if (t._mask & e && !(t._chain._mask & e)) {
                        var n = t._chain._name;
                        n in r ? r[n].push(t._index) : r[n] = [t._index]
                    }
                }), t.forEachAtom(function(t) {
                    t._mask & e && !(t._residue._mask & e) && o.push(t._serial)
                }), this._buildSelectorFromSortedLists(o, r, n)
            }, Py.prototype.getSelectedComponent = function() {
                var e = 1 << this._selectionBit,
                    t = null,
                    n = !1;
                return this._complex.forEachAtom(function(r) {
                    r._mask & e && (null === t ? t = r._residue._component : t !== r._residue._component && (n = !0))
                }), n ? null : t
            }, Py.prototype.forSelectedResidues = function(e) {
                var t = 1 << this._selectionBit;
                this._complex.forEachResidue(function(n) {
                    n._mask & t && e(n)
                })
            }, Py.prototype.beginComponentEdit = function() {
                if (this._editor) return null;
                var e = new xy.ComponentEditor(this);
                return e.begin() ? (this._editor = e, e) : null
            }, Py.prototype.beginFragmentEdit = function() {
                if (this._editor) return null;
                var e = new xy.FragmentEditor(this);
                return e.begin() ? (this._editor = e, e) : null
            }, Py.prototype.finalizeEdit = function() {
                this._editor = null
            }, Py.prototype.setMaterialValues = function(e) {
                for (var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1], n = arguments.length > 2 ? arguments[2] : void 0, r = 0, o = this._reprList.length; r < o; ++r) {
                    var i = this._reprList[r];
                    i.material.setValues(e), t && i.geo.traverse(function(t) {
                        t instanceof c.Mesh && (t.material.setValues(e), void 0 !== n && n(t), t.material.needsUpdate = !0)
                    })
                }
            }, Py.prototype.setUberOptions = function(e) {
                for (var t = 0, n = this._reprList.length; t < n; ++t) {
                    this._reprList[t].material.setUberOptions(e)
                }
            }, Py.prototype.within = function(e, t) {
                var n = this._complex.getVoxelWorld();
                if (null === n) return !1;
                var r = 1 << this._selectionBit;
                return this._complex.markAtoms(e, r), n && n.forEachAtomWithinDistFromMasked(this._complex, r, Number(t), function(e) {
                    e._mask |= r
                }), this._selectionCount = this._complex.countAtomsByMask(r), this._complex.updateStructuresMask(), this.buildSelectorFromMask(r)
            };
            var Oy = Py,
                Ay = "uniform mat4 projectionMatrix;\n\n// 3D volume texture\nuniform vec3 volumeDim;    // volume dimensions, pixels\nuniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\nuniform vec2 tileTexSize;  // size of tiled texture, pixels\nuniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\n\nuniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\nuniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\n\nuniform vec3 _isoLevel0;\nuniform float _flipV;\nuniform sampler2D _BFLeft;\nuniform sampler2D _BFRight;\nuniform sampler2D _FFLeft;\nuniform sampler2D _FFRight;\nuniform sampler2D _WFFLeft;\nuniform sampler2D _WFFRight;\n\nvarying vec4 screenSpacePos;\n\nvec4 sample3DTexture(vec3 texCoord)\n{\n  // a pair of Z slices is determined by nearest slice border\n  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\n  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\n  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\n\n  float rowTiles = floor(tileTexSize.x / tileStride.x);\n\n  // calculate coords in tile texture for both slices\n  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\n  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\n  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\n  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\n\n  // bilinear filtering\n  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\n  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\n  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\n  return mix(colorSlice1, colorSlice2, weightSlice2);\n}\n\nvec4 sample3DTextureInclined(vec3 boxCoord) { //delta:{ x: XY, y : XZ, z: YZ }\n  vec3 textCoord = boxCoord;\n  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\n\n  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\n  if (textCoord.y < 0.0 || textCoord.y > 1.0)\n    return vec4(0., 0., 0., 0);\n\n  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\n\n  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\n  if (textCoord.x < 0.0 || textCoord.x > 1.0)\n    return vec4(0., 0., 0., 0);\n\n  return sample3DTexture(textCoord);\n}\n\nfloat CalcColor(vec3 iter, vec3 dir)\n{\n  float d = 1.0 / 128.0;\n  vec3 dx = vec3(d, 0.0, 0.0);\n  vec3 dy = vec3(0.0, d, 0.0);\n  vec3 dz = vec3(0.0, 0.0, d);\n  vec3 N;\n  N.x = sample3DTextureInclined(iter + dx).r - sample3DTextureInclined(iter - dx).r;\n  N.y = sample3DTextureInclined(iter + dy).r - sample3DTextureInclined(iter - dy).r;\n  N.z = sample3DTextureInclined(iter + dz).r - sample3DTextureInclined(iter - dz).r;\n  N = normalize(N);\n  float dif = max(0.0, dot(N,dir));\n  return dif;\n}\n\nvec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold)\n{\n  for (int i = 0; i < 5; i++)\n  {\n    vec3 iterator = 0.5*(left + right);\n    float vol = sample3DTextureInclined(iterator).r;\n    if ((volLeft - threshold)*(vol - threshold) < 0.)\n      right = iterator;\n    else\n      left = iterator;\n  }\n  return 0.5 * (left + right);\n}\n\nvec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count)\n{\n  float vol, stepSize = (0.5*float(count) + 1.) / 85.;\n  //    \t\tfloat vol, stepSize = (0.5*count + 1.) / 64.;// 128.;\n  vec3 step = stepSize*dir, iterator = start, left, right;\n  vec4 acc = vec4(0., 0., 0., 0.);\n    for (int i=0; i < 200; i++)\n    {\n      iterator = iterator + step;\n      vol = sample3DTextureInclined(iterator).r;\n      if (length(iterator - back) < stepSize || vol > tr)\n        break;\n    }\n    if (vol > tr)\n    {\n      left = iterator - step;\n      right = iterator;\n      for (int j = 0; j < 5; j++)\n      {\n        iterator = 0.5 * (left + right);\n        float vol = sample3DTextureInclined(iterator).r;\n        if (vol > tr)\n          right = iterator;\n        else\n          left = iterator;\n      }\n      acc = vec4(0.5*(left + right), 1.);\n    }\n\n  return acc;\n}\n\n\nfloat easeOut(float x0, float x1, float x) {\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\n  return 1.0 - (1.0 - t) * (1.0 - t);\n}\n\nfloat easeIn(float x0, float x1, float x) {\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\n  return t * t;\n}\n\nvec3 GetColSimple(float vol)\n{\n  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\n  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\n  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\n}\n\nvec3 CorrectIso(vec3 left, vec3 right, float tr)\n{\n  for (int j = 0; j < 5; j++)\n  {\n    vec3 iterator = 0.5*(left + right);\n    float vol = sample3DTextureInclined(iterator).r;\n    if (vol < tr)\n      right = iterator;\n    else\n      left = iterator;\n  }\n  return 0.5*(left + right);\n}\n\nvec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir)\n{\n  vec4 acc = vec4(0., 0., 0., 0.), iso;\n  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\n  //\t\t\t\tfloat stepSize = 1. / 110., alpha, sumAlpha = 0, vol, curStepSize = stepSize, molD;\n  float stepSize = 1. / 170., alpha, sumAlpha = 0.0, vol, curStepSize = stepSize, molD;\n  vec3 step = stepSize*dir, col, colOld, right;\n  float tr0 = _isoLevel0.x;\n  float dif, r, kd, finish;\n  int count = 0, stopMol = 0;\n  kd = 140. * tr0 * stepSize;\n  r = 1. - kd;\n\n  for (int k = 0; k < 3; k++)\n  {\n    stepSize = (0.5 * float(k) + 1.) / 85.;\n    kd = 140. * tr0 * stepSize;\n    r = 1. - kd;\n    step = stepSize * dir;\n    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\n    if (iso.a < 0.1 || length(iso.rgb - start) > molDist)\n      break;\n    iterator = iso.rgb;\n    dif = 1.;// CalcColor(iterator, dir);\n    colOld = GetColSimple(tr0);\n    curStepSize = stepSize;\n    for (int i = 0; i < 200; i++)\n    {\n      iterator = iterator + step;\n      molD = length(iterator - start);\n      vol = sample3DTextureInclined(iterator).r;\n      finish = distance(iterator, back) - stepSize;\n      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\n        break;\n      alpha = (1. - r);\n      col = GetColSimple(vol);\n      vol = sample3DTextureInclined(iterator - 0.5*step).r;\n      vec3 colMid = GetColSimple(vol);\n      sumColor += (1. - sumAlpha)*(colOld + 4.*colMid + col)*alpha / 6.;\n      sumAlpha += (1. - sumAlpha)*alpha;// *(1. - 1.0*dif*dif);\n      colOld = col;\n    } // for i\n    if (finish < 0.0 || sumAlpha > 0.97)\n      break;\n    if (molD > molDist)\n    {\n      curStepSize = stepSize - (molD - molDist);\n      right = iterator - (molD - molDist)*dir;\n      vol = sample3DTextureInclined(right).r;\n    }\n    else\n    {\n      vec3 left = iterator - step;\n      right = CorrectIso(left, iterator, tr0);\n      curStepSize = distance(left, right);\n      vol = tr0;\n    }\n    alpha = (1. - r)*curStepSize / stepSize;\n    dif = 1.;// CalcColor(right, dir);\n    col = GetColSimple(vol);\n    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\n    vec3 colMid = GetColSimple(vol);\n    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\n    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\n    if (molD > molDist)\n      break;\n  } // for k\n  acc.rgb = 1.*sumColor / sumAlpha;\n  acc.a = sumAlpha;\n  return acc;\n}\n\nvec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir)\n{\n  float stepSize = 1.0 / 200.0;\n  float len = length(back - start);\n  vec3 step = stepSize * dir;\n  vec3 iterator = start;\n  float acc = 0.0;\n\n  for (int i=0; i < 200; i++)\n  {\n    if (float(i) * stepSize > len) break;\n    iterator = iterator + step;\n    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\n      acc += sample3DTextureInclined(iterator).r / 200.0;\n  }\n\n  return vec4(1,1,1, acc);\n}\n\nvec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir)\n{\n  vec4 tst = GetIso1(start, back, 2., dir, 0.28, 0);\n  vec4 col = vec4(0, 0., 0., 0.);\n  if (tst.a > 0.1)\n  {\n   float dif = CalcColor(tst.rgb, dir);\n   col = vec4(dif, 0., 0., 1.);\n  }\n  return col;\n}\n\nvec4 VolRender3(vec3 start, vec3 back, float molDist, vec3 dir)\n{\n  return sample3DTextureInclined(start);\n}\n\nvoid main()\n{\n  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\n\n  if (_flipV > 0.0) {\n    tc.y = 1.0 - tc.y;\n  }\n\n  vec3 start;\n  vec3 back;\n  vec3 molBack;\n  if (projectionMatrix[0][2] < 0.0)\n  {\n    start = texture2D(_FFLeft, tc.xy).xyz;\n    back = texture2D(_BFLeft, tc.xy).xyz;\n    molBack = texture2D(_WFFLeft, tc.xy).xyz;\n  }\n  else\n  {\n    start = texture2D(_FFRight, tc.xy).xyz;\n    back = texture2D(_BFRight, tc.xy).xyz;\n    molBack = texture2D(_WFFRight, tc.xy).xyz;\n  }\n\n  vec3 dir = normalize(back - start);\n\n  float molDist = 2.0;\n  if (length(molBack) > 0.001)\n  {\n    molDist = distance(start, molBack);\n  }\n\n  //gl_FragColor = texture2D(_WFFLeft, tc.xy);\n  //gl_FragColor = texture2D(tileTex, tc.xy);\n  gl_FragColor = VolRender(start, back, molDist, dir);\n}\n",
                Ty = c.UniformsUtils.merge([{
                    volumeDim: {
                        type: "v3",
                        value: new c.Vector3(512, 512, 512)
                    },
                    tileTex: {
                        type: "t",
                        value: null
                    },
                    tileTexSize: {
                        type: "v2",
                        value: new c.Vector2(512, 512)
                    },
                    tileStride: {
                        type: "v2",
                        value: new c.Vector2(512, 512)
                    },
                    boxAngles: {
                        type: "v3",
                        value: new c.Vector3(1, 1, 1)
                    },
                    delta: {
                        type: "v3",
                        value: new c.Vector3(0, 0, 0)
                    },
                    _isoLevel0: {
                        type: "v2",
                        value: new c.Vector3(.5, .75, 1)
                    },
                    _flipV: {
                        type: "f",
                        value: 0
                    },
                    _BFLeft: {
                        type: "t",
                        value: null
                    },
                    _BFRight: {
                        type: "t",
                        value: null
                    },
                    _FFLeft: {
                        type: "t",
                        value: null
                    },
                    _FFRight: {
                        type: "t",
                        value: null
                    },
                    _WFFLeft: {
                        type: "t",
                        value: null
                    },
                    _WFFRight: {
                        type: "t",
                        value: null
                    }
                }]);

            function ky(e, t) {
                var n = c.UniformsUtils.clone(t);
                for (var r in e) n.hasOwnProperty(r) && (n[r].value = e[r]);
                return n
            }
            var Ry = {
                BackFacePosMaterial: function(e) {
                    var t = {
                        uniforms: ky(e, {}),
                        vertexShader: "varying vec3 pos; void main() {pos = position.xyz + 0.5;gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",
                        fragmentShader: "varying vec3 pos; void main() { gl_FragColor = vec4(pos, 0.5); }",
                        transparent: !1,
                        depthTest: !1,
                        depthWrite: !1,
                        side: c.BackSide
                    };
                    return new c.ShaderMaterial(t)
                },
                BackFacePosMaterialFarPlane: function(e) {
                    var t = {
                        uniforms: ky(e, c.UniformsUtils.merge([{
                            aspectRatio: {
                                type: "f",
                                value: 0
                            },
                            farZ: {
                                type: "f",
                                value: 0
                            },
                            tanHalfFOV: {
                                type: "f",
                                value: 0
                            },
                            matWorld2Volume: {
                                type: "4fv",
                                value: new c.Matrix4
                            }
                        }])),
                        vertexShader: "varying vec4 volPos;\nuniform float aspectRatio;\nuniform float farZ;\nuniform float tanHalfFOV;\nuniform mat4  matWorld2Volume\n;void main() {\nvec3 pos = position.xyz;\npos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\npos.y = pos.y * tanHalfFOV * farZ;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\nvolPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\nvolPos = volPos + 0.5;\nvolPos.w = 0.5;}",
                        fragmentShader: "varying vec4 volPos; \nvoid main() { gl_FragColor = volPos; }",
                        transparent: !1,
                        depthTest: !1,
                        depthWrite: !1,
                        side: c.FrontSide
                    };
                    return new c.ShaderMaterial(t)
                },
                FrontFacePosMaterial: function(e) {
                    var t = {
                        uniforms: ky(e, {}),
                        vertexShader: "varying vec3 pos; void main() {pos = position.xyz + 0.5;gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",
                        fragmentShader: "varying vec3 pos; void main() { gl_FragColor = vec4(pos, 0.5); }",
                        transparent: !1,
                        depthTest: !1,
                        depthWrite: !1,
                        side: c.FrontSide
                    };
                    return new c.ShaderMaterial(t)
                },
                VolumeMaterial: function(e) {
                    var t = {
                        uniforms: ky(e, Ty),
                        vertexShader: "varying vec4 screenSpacePos; void main() {screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);gl_Position = screenSpacePos;}",
                        fragmentShader: Ay,
                        transparent: !0,
                        depthTest: !0,
                        depthWrite: !1,
                        side: c.FrontSide
                    };
                    return new c.ShaderMaterial(t)
                }
            };

            function Iy(e) {
                return (Iy = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function My(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Ny(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ly(e) {
                return (Ly = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function jy(e) {
                if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                return e
            }

            function Dy(e, t) {
                return (Dy = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function Vy(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var Fy = function(e) {
                function t() {
                    var e;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t);
                    var n, r, o = new c.BufferGeometry;
                    n = this, e = !(r = Ly(t).call(this, o)) || "object" !== Iy(r) && "function" != typeof r ? jy(n) : r, Vy(jy(e), "volumeInfo", {}), e.clipPlane = new c.Plane;
                    var i = new c.Vector3(.5, .5, .5);
                    return e.size = i, e.cullFlag = [!0, !0, !0, !0, !0, !0, !0, !0, !1, !1, !1, !1, !1, !1], e.faces = [{
                        indices: [],
                        norm: new c.Vector3(0, 0, -1)
                    }, {
                        indices: [],
                        norm: new c.Vector3(0, 0, 1)
                    }, {
                        indices: [],
                        norm: new c.Vector3(0, -1, 0)
                    }, {
                        indices: [],
                        norm: new c.Vector3(0, 1, 0)
                    }, {
                        indices: [],
                        norm: new c.Vector3(-1, 0, 0)
                    }, {
                        indices: [],
                        norm: new c.Vector3(1, 0, 0)
                    }, {
                        indices: [],
                        norm: new c.Vector3(0, 0, 0)
                    }], e.vertices = [new c.Vector3(-i.x, -i.y, -i.z), new c.Vector3(-i.x, i.y, -i.z), new c.Vector3(i.x, -i.y, -i.z), new c.Vector3(i.x, i.y, -i.z), new c.Vector3(-i.x, -i.y, i.z), new c.Vector3(-i.x, i.y, i.z), new c.Vector3(i.x, -i.y, i.z), new c.Vector3(i.x, i.y, i.z), new c.Vector3(0, 0, 0), new c.Vector3(0, 0, 0), new c.Vector3(0, 0, 0), new c.Vector3(0, 0, 0), new c.Vector3(0, 0, 0), new c.Vector3(0, 0, 0)], o.addAttribute("position", new c.BufferAttribute(new Float32Array(3 * e.vertices.length), 3)), e.name = "VolumeMesh", e
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Dy(e, t)
                }(t, c["Mesh"]), n = t, (r = [{
                    key: "_updateVertices",
                    value: function() {
                        var e, n = t._corners,
                            r = t._edges,
                            o = t._edgeIntersections,
                            i = this.clipPlane.normal,
                            a = this.clipPlane.constant,
                            s = this.vertices,
                            l = this.size,
                            u = [0, 0, 0, 0, 0, 0, 0, 0],
                            p = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                            f = new c.Vector3,
                            h = null;

                        function d() {
                            if (0 === i.x) return 0;
                            var e = -(i.dot(f) + a) / i.x;
                            return -l.x <= e && e <= l.x ? (h.set(e, f.y, f.z), e === l.x ? 2 : e === -l.x ? -2 : 1) : 0
                        }

                        function m() {
                            if (0 === i.y) return 0;
                            var e = -(i.dot(f) + a) / i.y;
                            return -l.y <= e && e <= l.y ? (h.set(f.x, e, f.z), e === l.y ? 2 : e === -l.y ? -2 : 1) : 0
                        }

                        function y() {
                            if (0 === i.z) return 0;
                            var e = -(i.dot(f) + a) / i.z;
                            return -l.z <= e && e <= l.z ? (h.set(f.x, f.y, e), e === l.z ? 2 : e === -l.z ? -2 : 1) : 0
                        }
                        for (var v = 0; v < 12; ++v) {
                            var _ = r[v];
                            h = o[v], f.set(_[2], _[3], _[4]), f.multiply(l);
                            var g = 0;
                            0 === _[2] && (g = d()), 0 === _[3] && (g = m()), 0 === _[4] && (g = y()), -2 === g ? u[_[0]] = 1 : 2 === g ? u[_[1]] = 1 : 0 === g && (p[v] = 0)
                        }
                        var b = {
                                indices: [],
                                norm: i.clone().negate()
                            },
                            w = 8;
                        for (e = 0; e < 8; ++e) 1 === u[e] && (s[w].set(n[e][0], n[e][1], n[e][2]).multiply(l), b.indices.push(w++), p[n[e][3]] = 0, p[n[e][4]] = 0, p[n[e][5]] = 0);
                        for (e = 0; e < 12; ++e) 1 === p[e] && (s[w].copy(o[e]), b.indices.push(w++));
                        this.faces[6] = b;
                        var x = new c.Vector3,
                            S = new c.Vector3;
                        for (this.clipPlane.coplanarPoint(S), e = 0; e < s.length; ++e) this.cullFlag[e] = !1, e < 8 ? (x.subVectors(s[e], S), this.cullFlag[e] = i.dot(x) >= 0) : e < 8 + b.indices.length && (this.cullFlag[e] = !0);
                        var C = this.geometry.getAttribute("position"),
                            P = 0;
                        for (e = 0; e < s.length; ++e) C.array[P++] = s[e].x, C.array[P++] = s[e].y, C.array[P++] = s[e].z;
                        C.needsUpdate = !0
                    }
                }, {
                    key: "_collectVertices",
                    value: function(e, t) {
                        var n, r = this.vertices;
                        for (e.indices = [], n = 0; n < r.length; ++n) this.cullFlag[n] && t(r[n]) && e.indices.push(n)
                    }
                }, {
                    key: "_sortIndices",
                    value: function(e, t) {
                        var n, r, o = this.vertices,
                            i = [],
                            a = new c.Vector3;
                        for (n = 1; n < e.indices.length; ++n) a.subVectors(o[e.indices[n]], o[e.indices[0]]), a.normalize(), a.cross(t), a.negate(), i[n] = e.norm.dot(a);
                        for (n = 1; n < e.indices.length - 1; ++n)
                            for (r = n + 1; r < e.indices.length; ++r)
                                if (i[r] < i[n]) {
                                    var s = i[n];
                                    i[n] = i[r], i[r] = s, s = e.indices[n], e.indices[n] = e.indices[r], e.indices[r] = s
                                }
                    }
                }, {
                    key: "_updateIndices",
                    value: function() {
                        var e, t, n, r = this.vertices,
                            o = this.size;
                        this._collectVertices(this.faces[0], function(e) {
                            return e.z === -o.z
                        }), this._collectVertices(this.faces[1], function(e) {
                            return e.z === o.z
                        }), this._collectVertices(this.faces[2], function(e) {
                            return e.y === -o.y
                        }), this._collectVertices(this.faces[3], function(e) {
                            return e.y === o.y
                        }), this._collectVertices(this.faces[4], function(e) {
                            return e.x === -o.x
                        }), this._collectVertices(this.faces[5], function(e) {
                            return e.x === o.x
                        });
                        var i = new c.Vector3,
                            a = new c.Vector3,
                            s = new c.Vector3;
                        for (t = 0; t < this.faces.length; ++t)
                            if (0 !== (n = this.faces[t]).indices.length) {
                                for (i.set(0, 0, 0), e = 0; e < n.indices.length; ++e) i.add(r[n.indices[e]]);
                                i.multiplyScalar(1 / n.indices.length), a.subVectors(r[n.indices[0]], i), a.normalize();
                                var l = [];
                                for (e = 0; e < n.indices.length; ++e) s.subVectors(r[n.indices[e]], i), l[e] = s.dot(a);
                                for (e = 1; e < n.indices.length; ++e)
                                    if (l[e] < l[0]) {
                                        var u = l[0];
                                        l[0] = l[e], l[e] = u, u = My(n.indices, 1)[0], n.indices[0] = n.indices[e], n.indices[e] = u
                                    } this._sortIndices(n, a)
                            } var p = 0;
                        for (t = 0; t < this.faces.length; ++t)(n = this.faces[t]).indices.length >= 3 && (p += 3 * (n.indices.length - 2));
                        var f = 0,
                            h = new Uint16Array(p);
                        for (t = 0; t < this.faces.length; ++t)
                            for (n = this.faces[t], e = 0; e < n.indices.length - 2; ++e) h[f] = n.indices[0], h[f + 1] = n.indices[e + 1], h[f + 2] = n.indices[e + 2], f += 3;
                        this.geometry.setIndex(new c.BufferAttribute(h, 1))
                    }
                }, {
                    key: "setDataSource",
                    value: function(e) {
                        var t = new Ry.VolumeMaterial,
                            n = e.getDimensions(),
                            r = e.getTiledTextureStride(),
                            o = e.buildTiledTexture(),
                            i = e.getBox();
                        t.uniforms.volumeDim.value.set(n[0], n[1], n[2]), t.uniforms.tileTex.value = o, t.uniforms.tileTexSize.value.set(o.image.width, o.image.height), t.uniforms.tileStride.value.set(r[0], r[1]), Object.assign(this.volumeInfo, e.getVolumeInfo());
                        var a = this.volumeInfo;
                        t.uniforms.delta.value.copy(a.delta), t.uniforms.boxAngles.value.set(a.obtuseAngle[0], a.obtuseAngle[1], a.obtuseAngle[2]), this.material = t, i.getSize(this.scale), i.getCenter(this.position)
                    }
                }, {
                    key: "_updateIsoLevel",
                    value: function() {
                        var e = H.now.modes.VD,
                            t = e.kSigma,
                            n = e.kSigmaMed,
                            r = e.kSigmaMax,
                            o = this.volumeInfo,
                            i = o.dmean - o.dmin,
                            a = o.dmax - o.dmin,
                            s = function(e) {
                                return (i + e * o.sd) / a
                            };
                        this.material.uniforms._isoLevel0.value.set(s(t), s(n), s(r))
                    }
                }, {
                    key: "rebuild",
                    value: function(e) {
                        var n = t._nearClipPlaneOffset,
                            r = t._pos,
                            o = t._norm,
                            i = t._norm4D,
                            a = t._matrixWorldToLocal,
                            s = t._clipPlane;
                        this._updateIsoLevel(), e.getWorldDirection(o), e.getWorldPosition(r), r.addScaledVector(o, e.near + n), a.getInverse(this.matrixWorld), r.applyMatrix4(a), i.set(o.x, o.y, o.z, 0), i.applyMatrix4(a), o.copy(i), o.normalize(), s.setFromNormalAndCoplanarPoint(o, r), this.clipPlane.equals(s) || (this.clipPlane = s.clone(), this._updateVertices(), this._updateIndices())
                    }
                }]) && Ny(n.prototype, r), o && Ny(n, o), t
            }();
            Vy(Fy, "_corners", [
                [-1, -1, -1, 0, 4, 8],
                [1, -1, -1, 0, 5, 9],
                [1, 1, -1, 1, 5, 10],
                [-1, 1, -1, 1, 4, 11],
                [-1, -1, 1, 2, 6, 8],
                [1, -1, 1, 2, 7, 9],
                [1, 1, 1, 3, 7, 10],
                [-1, 1, 1, 3, 6, 11]
            ]), Vy(Fy, "_edges", [
                [0, 1, 0, -1, -1],
                [2, 3, 0, 1, -1],
                [4, 5, 0, -1, 1],
                [6, 7, 0, 1, 1],
                [0, 3, -1, 0, -1],
                [1, 2, 1, 0, -1],
                [4, 7, -1, 0, 1],
                [5, 6, 1, 0, 1],
                [0, 4, -1, -1, 0],
                [1, 5, 1, -1, 0],
                [2, 6, -1, 1, 0],
                [3, 7, 1, 1, 0]
            ]), Vy(Fy, "_edgeIntersections", function() {
                for (var e = [], t = 0; t < 12; ++t) e.push(new c.Vector3);
                return e
            }()), Vy(Fy, "_nearClipPlaneOffset", .2), Vy(Fy, "_pos", new c.Vector3), Vy(Fy, "_norm", new c.Vector3), Vy(Fy, "_norm4D", new c.Vector4), Vy(Fy, "_matrixWorldToLocal", new c.Matrix4), Vy(Fy, "_clipPlane", new c.Plane);
            var By = Fy;

            function zy(e, t) {
                Qr.call(this, e, t), this._mesh = new By, this._mesh.setDataSource(t), this.add(this._mesh), this.buildFarPlane()
            }
            R.deriveClass(zy, Qr), zy.prototype.buildFarPlane = function() {
                var e = new c.PlaneGeometry(2, 2, 1, 1),
                    t = Ry.BackFacePosMaterialFarPlane();
                this._plane = new Cl.Mesh(e, t), this._plane.frustumCulled = !1, this._plane.doubleSided = !0;
                var n = new c.Matrix4;
                this._plane._onBeforeRender = function(e, t, r, o, i, a) {
                    var s = this.parent.getObjectByName("VolumeMesh"),
                        l = this.material;
                    if (s && l) {
                        var u = new c.Vector4(0, 0, -(r.far - .1), 1);
                        u.applyMatrix4(r.matrixWorld), this.matrix.identity(), this.matrix.makeTranslation(u.x, u.y, u.z), this.matrixWorld.copy(this.matrix), this.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse, this.matrixWorld), this.normalMatrix.getNormalMatrix(this.modelViewMatrix);
                        var p = this.parent.getObjectByName("VolumeMesh").matrixWorld;
                        n.getInverse(p), l.uniforms.aspectRatio.value = r.aspect, l.uniforms.farZ.value = r.far, l.uniforms.tanHalfFOV.value = Math.tan(.5 * c.Math.DEG2RAD * r.fov), l.uniforms.matWorld2Volume.value = n
                    }
                }, this.add(this._plane), this._plane.layers.set($r.LAYERS.VOLUME_BFPLANE)
            }, zy.prototype.getBoundaries = function() {
                var e = this._dataSource.getBox(),
                    t = new c.Sphere;
                return e.getBoundingSphere(t), {
                    boundingBox: e,
                    boundingSphere: t
                }
            }, zy.prototype.getMesh = function() {
                return this._mesh
            };
            var Uy = zy;

            function Gy() {
                this.now = R.Timer.now, this._startTime = 0, this._times = []
            }
            Gy.prototype.start = function() {
                this._startTime = this.now()
            }, Gy.prototype.end = function() {
                0 !== this._startTime && this._times.push(this.now() - this._startTime)
            }, Gy.prototype.rawMean = function() {
                for (var e = this._times.length, t = 0, n = 0; n < e; ++n) t += this._times[n];
                return t / e
            }, Gy.prototype.mean = function() {
                return this._robustMean(this._times)
            }, Gy.prototype.deviation = function(e) {
                return this._robustDeviation(this._times, e)
            }, Gy.prototype.min = function() {
                return this._robustMin(this._times)
            }, Gy.prototype._robustMean = function(e) {
                var t = Math.round(.1 * e.length),
                    n = e.length - Math.round(.2 * e.length);
                e.sort(function(e, t) {
                    return e - t
                });
                for (var r = 0, o = t; o < n; ++o) r += e[o];
                return r / n
            }, Gy.prototype._robustDeviation = function(e, t) {
                for (var n = e.length, r = new Array(n), o = 0; o < n; ++o) r[o] = (e[o] - t) * (e[o] - t);
                return r.sort(function(e, t) {
                    return e - t
                }), Math.sqrt(this._robustMean(r))
            }, Gy.prototype._robustMin = function(e) {
                var t = Math.round(.05 * e.length),
                    n = Math.round(.1 * e.length);
                e.sort(function(e, t) {
                    return e - t
                });
                for (var r = 0, o = 0; o < n; ++o) r += e[t + o];
                return r / n
            };
            var Hy = Gy;

            function Wy(e) {
                this._renderer = e, this._prepareTest()
            }
            Wy.prototype._prepareTest = function() {
                this._scene = new c.Scene;
                for (var e = new c.PlaneGeometry(10, 10, 128, 128), t = new c.MeshBasicMaterial({
                        color: this._renderer.getClearColor()
                    }), n = 0; n < 300; ++n) {
                    var r = new c.Mesh(e, t);
                    this._scene.add(r)
                }
                this._camera = new c.PerspectiveCamera(45, 1, 1, 2e3), this._camera.position.z = 30, this._prof = new Hy
            }, Wy.prototype.run = function() {
                for (var e = 0; e < 100; ++e) this._prof.start(), this._renderer.setRenderTarget(this._target), this._renderer.render(this._scene, this._camera), this._prof.end()
            }, Wy.prototype.runOnTicks = function(e, t, n) {
                var r = this;
                void 0 === e && (e = 50), void 0 === t && (t = 1e3), void 0 === n && (n = 1e4);
                var o = -1,
                    i = this._prof.now();
                return new Promise(function(a) {
                    requestAnimationFrame(function s() {
                        r._renderer.render(r._scene, r._camera);
                        var l = r._prof.now() - i;
                        l > t && (r._prof.end(), r._prof.start(), ++o), l > n || o === e ? a(Math.max(o, 0)) : requestAnimationFrame(s)
                    })
                })
            }, Wy.prototype.mean = function() {
                return this._prof ? this._prof.rawMean() : 0
            }, Wy.prototype.min = function() {
                return this._prof ? this._prof.min() : 0
            };
            var qy = Wy;

            function Yy(e) {
                return (Yy = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Xy(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }

            function $y(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ky(e, t) {
                return !t || "object" !== Yy(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Zy(e) {
                return (Zy = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Qy(e, t) {
                return (Qy = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Jy = function(e) {
                function t() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Ky(this, Zy(t).call(this, e, ["types"]))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Qy(e, t)
                }(t, no), n = t, (r = [{
                    key: "find",
                    value: function(e) {
                        var t = [];
                        if (e.type) t = this._dict.types[e.type.toLowerCase()] || [];
                        else if (e.source) return this._list.filter(function(t) {
                            return t.canProbablyLoad && t.canProbablyLoad(e.source)
                        });
                        return Xy(t)
                    }
                }]) && $y(n.prototype, r), o && $y(n, o), t
            }();

            function ev(e) {
                return (ev = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function tv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function nv(e, t) {
                return !t || "object" !== ev(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function rv(e) {
                return (rv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function ov(e, t) {
                return (ov = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var iv = function(e) {
                function t(e, n) {
                    var r;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (r = nv(this, rv(t).call(this)))._source = e, r._options = n || {}, r._abort = !1, r._agent = null, r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && ov(e, t)
                }(t, h), n = t, o = [{
                    key: "extractName",
                    value: function(e) {}
                }], (r = [{
                    key: "load",
                    value: function(e) {
                        return e ? this._loadOLD(e) : this._abort ? Promise.reject(new Error("Loading aborted")) : this.loadAsync()
                    }
                }, {
                    key: "loadAsync",
                    value: function() {
                        return Promise.reject(new Error("Loading from this source is not implemented"))
                    }
                }, {
                    key: "_loadOLD",
                    value: function(e) {
                        return e.progress && this.addEventListener("progress", function(t) {
                            t.lengthComputable && t.total > 0 ? e.progress(t.loaded / t.total) : e.progress()
                        }), this.load().then(function(t) {
                            e.ready(t)
                        }).catch(function(t) {
                            e.error(t)
                        })
                    }
                }, {
                    key: "abort",
                    value: function() {
                        this._abort = !0, this._agent && this._agent.abort()
                    }
                }]) && tv(n.prototype, r), o && tv(n, o), t
            }();

            function av(e) {
                return (av = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function sv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function lv(e, t) {
                return !t || "object" !== av(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function cv(e) {
                return (cv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function uv(e, t) {
                return (uv = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            ro(iv.prototype);
            var pv = function(e) {
                function t(e, n) {
                    var r;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), n = (r = lv(this, cv(t).call(this, e, n)))._options, r._binary = !0 === n.binary, r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && uv(e, t)
                }(t, iv), n = t, o = [{
                    key: "canLoad",
                    value: function(e, t) {
                        var n = t.sourceType;
                        return e instanceof File && (!n || "file" === n)
                    }
                }, {
                    key: "canProbablyLoad",
                    value: function(e) {
                        return File && e instanceof File || Blob && e instanceof Blob
                    }
                }, {
                    key: "extractName",
                    value: function(e) {
                        return e && e.name
                    }
                }], (r = [{
                    key: "loadAsync",
                    value: function() {
                        var e = this;
                        return new Promise(function(t, n) {
                            var r = e._source,
                                o = e._agent = new FileReader;
                            o.addEventListener("load", function() {
                                t(o.result)
                            }), o.addEventListener("error", function() {
                                n(o.error)
                            }), o.addEventListener("abort", function() {
                                n(new Error("Loading aborted"))
                            }), o.addEventListener("progress", function(t) {
                                e.dispatchEvent(t)
                            }), e._binary ? o.readAsArrayBuffer(r) : o.readAsText(r)
                        })
                    }
                }]) && sv(n.prototype, r), o && sv(n, o), t
            }();

            function fv(e) {
                return (fv = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function hv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function dv(e, t) {
                return !t || "object" !== fv(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function mv(e) {
                return (mv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function yv(e, t) {
                return (yv = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            pv.types = ["file", "blob"];
            var vv = /^(https?|ftp):\/\//i,
                _v = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), n = (r = dv(this, mv(t).call(this, e, n)))._options, r._binary = !0 === n.binary, r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && yv(e, t)
                    }(t, iv), n = t, o = [{
                        key: "canLoad",
                        value: function(e, t) {
                            var n = t.sourceType;
                            return "string" == typeof e && (!n || "url" === n)
                        }
                    }, {
                        key: "canProbablyLoad",
                        value: function(e) {
                            return l.a.isString(e) && vv.test(e)
                        }
                    }, {
                        key: "extractName",
                        value: function(e) {
                            if (e) {
                                var t = (e.indexOf("?") + 1 || e.lastIndexOf("#") + 1 || e.length + 1) - 1;
                                return e.slice(e.lastIndexOf("/", t) + 1, t)
                            }
                        }
                    }], (r = [{
                        key: "loadAsync",
                        value: function() {
                            var e = this;
                            return new Promise(function(t, n) {
                                var r = e._source,
                                    o = e._agent = new XMLHttpRequest;
                                o.addEventListener("load", function() {
                                    200 === o.status ? t(o.response) : n(new Error("HTTP ".concat(o.status, " while fetching ").concat(r)))
                                }), o.addEventListener("error", function() {
                                    n(new Error("HTTP request failed"))
                                }), o.addEventListener("abort", function() {
                                    n(new Error("Loading aborted"))
                                }), o.addEventListener("progress", function(t) {
                                    e.dispatchEvent(t)
                                }), o.open("GET",r), e._binary ? o.responseType = "arraybuffer" : o.responseType = "text", o.send()
                            })
                        }
                    }]) && hv(n.prototype, r), o && hv(n, o), t
                }();

            function gv(e) {
                return (gv = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function bv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function wv(e, t) {
                return !t || "object" !== gv(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function xv(e) {
                return (xv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Sv(e, t) {
                return (Sv = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            _v.types = ["url"];
            var Cv = function(e) {
                function t() {
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), wv(this, xv(t).apply(this, arguments))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Sv(e, t)
                }(t, iv), n = t, o = [{
                    key: "canLoad",
                    value: function(e, t) {
                        return void 0 !== e && void 0 !== t && "immediate" === t.sourceType
                    }
                }, {
                    key: "canProbablyLoad",
                    value: function(e) {
                        return !1
                    }
                }], (r = [{
                    key: "loadAsync",
                    value: function() {
                        return Promise.resolve(this._source)
                    }
                }]) && bv(n.prototype, r), o && bv(n, o), t
            }();
            Cv.types = ["immediate"];
            var Pv = new Jy([pv, _v, Cv]);
            Pv.all;

            function Ev(e) {
                return (Ev = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ov(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }

            function Av(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Tv(e, t) {
                return !t || "object" !== Ev(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function kv(e) {
                return (kv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Rv(e, t) {
                return (Rv = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Iv = function(e) {
                function t() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Tv(this, kv(t).call(this, e, ["formats", "extensions"]))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Rv(e, t)
                }(t, no), n = t, (r = [{
                    key: "find",
                    value: function(e) {
                        var t = [];
                        return e.format ? t = this._dict.formats[e.format.toLowerCase()] || [] : e.ext && (t = this._dict.extensions[e.ext.toLowerCase()] || []), 0 === t.length && !e.format && e.data ? this._list.filter(function(t) {
                            return t.canProbablyParse && t.canProbablyParse(e.data)
                        }) : Ov(t)
                    }
                }]) && Av(n.prototype, r), o && Av(n, o), t
            }();

            function Mv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Nv = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._data = t, this._options = n || {}, this._abort = !1
                }
                var t, n, r;
                return t = e, r = [{
                    key: "checkDataTypeOptions",
                    value: function(e, t, n) {
                        var r = e.fileType,
                            o = e.fileName;
                        return n = (n || ".".concat(t)).toLowerCase(), Boolean(r && r.toLowerCase() === t.toLowerCase() || !r && o && o.toLowerCase().endsWith(n))
                    }
                }], (n = [{
                    key: "parseSync",
                    value: function() {
                        throw new Error("Parsing this type of data is not implemented")
                    }
                }, {
                    key: "parse",
                    value: function(e) {
                        var t = this;
                        return e ? this._parseOLD(e) : new Promise(function(e, n) {
                            setTimeout(function() {
                                try {
                                    return t._abort ? n(new Error("Parsing aborted")) : e(t.parseSync())
                                } catch (e) {
                                    return n(e)
                                }
                            })
                        })
                    }
                }, {
                    key: "getModel",
                    value: function() {
                        return this.model._parseHeader(this._data), this.model
                    }
                }, {
                    key: "_parseOLD",
                    value: function(e) {
                        return this.parse().then(function(t) {
                            e.ready(t)
                        }).catch(function(t) {
                            e.error(t)
                        })
                    }
                }, {
                    key: "abort",
                    value: function() {
                        this._abort = !0
                    }
                }]) && Mv(t.prototype, n), r && Mv(t, r), e
            }();

            function Lv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            ro(Nv.prototype);
            var jv = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this.matrices = [], this._matrix = null, this._matrixIndex = -1
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "parse",
                    value: function(e) {
                        var t = this._matrix;
                        if ("  SMTRY" === e.readString(12, 18)) {
                            var n = e.readCharCode(19) - 49,
                                r = e.readString(20, 80).trim().split(/\s+/),
                                o = parseInt(r[0], 10);
                            null !== this._matrix && o === this._matrixIndex || (this._matrixIndex = o, this._matrix = t = new c.Matrix4, this.matrices[this.matrices.length] = t);
                            var i = t.elements;
                            i[n] = parseFloat(r[1]), i[n + 4] = parseFloat(r[2]), i[n + 8] = parseFloat(r[3]), i[n + 12] = parseFloat(r[4])
                        }
                    }
                }]) && Lv(t.prototype, n), r && Lv(t, r), e
            }();
            jv.prototype.id = 290;
            var Dv = jv;

            function Vv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Fv = hr.Assembly,
                Bv = function() {
                    function e(t) {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._complex = t, this.assemblies = [], this._assembly = null, this._matrix = null, this._matrixIndex = -1
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "parse",
                        value: function(e) {
                            var t = this._assembly,
                                n = this._matrix;
                            if (t && "  BIOMT" === e.readString(12, 18)) {
                                var r = e.readCharCode(19) - 49,
                                    o = e.readString(20, 80).trim().split(/\s+/),
                                    i = parseInt(o[0], 10);
                                null !== this._matrix && i === this._matrixIndex || (this._matrixIndex = i, this._matrix = n = new c.Matrix4, t.addMatrix(n));
                                var a = n.elements;
                                a[r] = parseFloat(o[1]), a[r + 4] = parseFloat(o[2]), a[r + 8] = parseFloat(o[3]), a[r + 12] = parseFloat(o[4])
                            } else if (t && "CHAINS:" === e.readString(35, 41))
                                for (var s = e.readString(42, 80).split(","), l = 0, u = s.length; l < u; ++l) {
                                    var p = s[l].trim();
                                    p.length > 0 && t.addChain(p)
                                } else "BIOMOLECULE:" === e.readString(12, 23) && (this._matrix = null, this._matrixIndex = -1, this._assembly = t = new Fv(this._complex), this.assemblies.push(t))
                        }
                    }]) && Vv(t.prototype, n), r && Vv(t, r), e
                }();
            Bv.prototype.id = 350;
            var zv = Bv;

            function Uv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Gv = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._data = t, this._start = 0, this._nextCR = -1, this._nextLF = -1, this._next = -1, this._end = t.length, this.next()
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "readLine",
                    value: function() {
                        return this._data.slice(this._start, this._next)
                    }
                }, {
                    key: "readChar",
                    value: function(e) {
                        return (e = this._start + e - 1) < this._next ? this._data[e] : " "
                    }
                }, {
                    key: "readCharCode",
                    value: function(e) {
                        return (e = this._start + e - 1) < this._next ? this._data.charCodeAt(e) : 32
                    }
                }, {
                    key: "readString",
                    value: function(e, t) {
                        var n = this._start + e - 1,
                            r = this._start + t;
                        return this._data.slice(n, r < this._next ? r : this._next)
                    }
                }, {
                    key: "readInt",
                    value: function(e, t) {
                        return parseInt(this.readString(e, t), 10)
                    }
                }, {
                    key: "readFloat",
                    value: function(e, t) {
                        return parseFloat(this.readString(e, t))
                    }
                }, {
                    key: "end",
                    value: function() {
                        return this._start >= this._end
                    }
                }, {
                    key: "next",
                    value: function() {
                        var e = this._next + 1;
                        this._start = e < this._end ? e : this._end, this._start > this._nextCR && (this._nextCR = (this._data.indexOf("\r", this._start) + 1 || this._end + 1) - 1), this._start > this._nextLF && (this._nextLF = (this._data.indexOf("\n", this._start) + 1 || this._end + 1) - 1), this._next = this._nextCR + 1 < this._nextLF ? this._nextCR : this._nextLF
                    }
                }]) && Uv(t.prototype, n), r && Uv(t, r), e
            }();

            function Hv(e) {
                return (Hv = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Wv(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function qv(e, t) {
                return !t || "object" !== Hv(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Yv(e) {
                return (Yv = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Xv(e, t) {
                return (Xv = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var $v = hr.Complex,
                Kv = hr.Element,
                Zv = hr.Helix,
                Qv = hr.Sheet,
                Jv = hr.Strand,
                e_ = hr.Bond,
                t_ = hr.Molecule;
            var n_ = /^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,
                r_ = {
                    290: Dv,
                    350: zv
                },
                o_ = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = qv(this, Yv(t).call(this, e, n)))._complex = null, r._chain = null, r._residue = null, r._sheet = null, r._serialAtomMap = null, r._modelId = 1, r._compaundFound = !1, r._biomoleculeFound = !1, r._allowedChainsIDs = null, r._lastMolId = -1, r._remarks = {}, r._remark = null, r._molecules = [], r._molecule = null, r._compndCurrToken = "", r._options.fileType = "pdb", r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Xv(e, t)
                    }(t, Nv), n = t, o = [{
                        key: "canParse",
                        value: function(e, t) {
                            return !!e && ("string" == typeof e && (Nv.checkDataTypeOptions(t, "pdb") || Nv.checkDataTypeOptions(t, "pdb", ".ent")))
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return l.a.isString(e) && n_.test(e)
                        }
                    }], (r = [{
                        key: "_finalize",
                        value: function() {
                            this._fixBondsArray(), this._fixChains();
                            var e = this._remarks[290];
                            this._complex.symmetry = l.a.isUndefined(e) ? [] : e.matrices;
                            var t = this._remarks[350];
                            this._complex.units = this._complex.units.concat(l.a.isUndefined(t) ? [] : t.assemblies), this._finalizeMolecules(), this._complex.finalize({
                                needAutoBonding: !0,
                                detectAromaticLoops: this.settings.now.aromatic,
                                enableEditing: this.settings.now.editing,
                                serialAtomMap: this._serialAtomMap
                            })
                        }
                    }, {
                        key: "_finalizeMolecules",
                        value: function() {
                            var e, t = {},
                                n = this._complex._chains;
                            for (e = 0; e < n.length; ++e) {
                                var r = n[e];
                                t[r._name] = r
                            }
                            for (e = 0; e < this._molecules.length; e++) {
                                for (var o = this._molecules[e], i = [], a = 0; a < o._chains.length; a++) {
                                    var s = t[o._chains[a]];
                                    i = i.concat(s._residues.slice())
                                }
                                var l = new t_(this._complex, o._name, e + 1);
                                l._residues = i, this._complex._molecules[e] = l
                            }
                        }
                    }, {
                        key: "_fixChains",
                        value: function() {
                            for (var e = {}, t = this._complex, n = 0; n < t._chains.length; n++) {
                                var r = t._chains[n];
                                e[r._name.charCodeAt(0)] = r
                            }
                        }
                    }, {
                        key: "_fixBondsArray",
                        value: function() {
                            for (var e = this._serialAtomMap = {}, t = this._complex, n = t._atoms, r = 0, o = n.length; r < o; ++r) {
                                var i = n[r];
                                e[i._serial] = i
                            }
                            for (var a = t._bonds, s = this.logger, l = 0, c = a.length; l < c; ++l) {
                                var u = a[l];
                                u._right < u._left && s.debug("_fixBondsArray: Logic error."), u._left = e[u._left] || null, u._right = e[u._right] || null
                            }
                        }
                    }, {
                        key: "_parseATOM",
                        value: function(e) {
                            if (1 === this._modelId) {
                                var t = 72 === e.readCharCode(1),
                                    n = t ? e.readInt(7, 11) : e.readInt(6, 11),
                                    r = e.readString(13, 16),
                                    o = e.readChar(17),
                                    i = e.readString(18, 20).trim(),
                                    a = e.readChar(22),
                                    s = e.readInt(23, 26),
                                    l = e.readChar(27),
                                    u = e.readFloat(31, 38),
                                    p = e.readFloat(39, 46),
                                    f = e.readFloat(47, 54),
                                    h = e.readFloat(55, 60),
                                    d = e.readFloat(61, 66),
                                    m = e.readString(77, 78).trim() || function(e) {
                                        var t = 4 === e.trim().length;
                                        return e.slice(0, t ? 1 : 2).trim()
                                    }(r),
                                    y = e.readInt(79, 80) || 0;
                                if (!this.settings.now.nowater || "HOH" !== i && "WAT" !== i) {
                                    r = r.trim();
                                    var v = Kv.getByName(m),
                                        _ = Kv.Role[r],
                                        g = this._chain;
                                    g && g.getName() === a || (this._chain = g = this._complex.getChain(a) || this._complex.addChain(a), this._residue = null);
                                    var b = this._residue;
                                    b && b.getSequence() === s && b.getICode() === l || (this._residue = b = g.addResidue(i, s, l));
                                    var w = new c.Vector3(u, p, f);
                                    b.addAtom(r, v, w, _, t, n, o, h, d, y)
                                }
                            }
                        }
                    }, {
                        key: "_parseENDMDL",
                        value: function() {
                            this._modelId += 1
                        }
                    }, {
                        key: "_parseCONECT",
                        value: function(e) {
                            var t = e.readInt(7, 11),
                                n = e.readInt(12, 16),
                                r = e.readInt(17, 21),
                                o = e.readInt(22, 26),
                                i = e.readInt(27, 31),
                                a = this._complex;
                            n && n > t && a.addBond(t, n, 0, e_.BondType.UNKNOWN, !0), r && r > t && a.addBond(t, r, 0, e_.BondType.UNKNOWN, !0), o && o > t && a.addBond(t, o, 0, e_.BondType.UNKNOWN, !0), i && i > t && a.addBond(t, i, 0, e_.BondType.UNKNOWN, !0)
                        }
                    }, {
                        key: "_parseCOMPND",
                        value: function(e) {
                            var t = e.readString(11, 80),
                                n = t.indexOf(":");
                            if (this._compndCurrToken = n > 0 ? t.substring(0, n).trim() : this._compndCurrToken, "MOL_ID" === this._compndCurrToken) this._molecule = {
                                _index: "",
                                _chains: []
                            }, this._molecule._index = parseInt(t.substring(n + 1, t.indexOf(";")), 10), this._molecules.push(this._molecule);
                            else if ("MOLECULE" === this._compndCurrToken && null != this._molecule) this._molecule._name = t.substring(n + 1, t.indexOf(";")).trim();
                            else if ("CHAIN" === this._compndCurrToken && null != this._molecule) {
                                var r = t.substring(n + 1, 80).trim(),
                                    o = r[r.length - 1];
                                ";" !== o && "," !== o || (r = r.slice(0, -1));
                                var i = (r = r.replace(/\s+/g, "")).split(",");
                                this._molecule._chains = this._molecule._chains.concat(i)
                            }
                        }
                    }, {
                        key: "_parseREMARK",
                        value: function(e) {
                            var t = e.readInt(8, 10),
                                n = this._remarks[t];
                            if (l.a.isUndefined(n)) {
                                var r = r_[t];
                                l.a.isFunction(r) && (this._remarks[t] = n = new r(this._complex))
                            }
                            l.a.isUndefined(n) || n.parse(e)
                        }
                    }, {
                        key: "_parseHELIX",
                        value: function(e) {
                            var t = this;
                            this._parseSTRUCTURE(e, [20, 22, 32, 34], function(e) {
                                t._complex.addHelix(e), t._complex.structures.push(e)
                            })
                        }
                    }, {
                        key: "_parseSHEET",
                        value: function(e) {
                            var t = this;
                            this._parseSTRUCTURE(e, [22, 23, 33, 34], function(e) {
                                t._complex.addSheet(e)
                            })
                        }
                    }, {
                        key: "_parseSTRUCTURE",
                        value: function(e, t, n) {
                            var r = e.readInt(8, 10),
                                o = e.readString(12, 14).trim(),
                                i = e.readString(41, 70).trim(),
                                a = e.readInt(72, 76),
                                s = e.readInt(39, 40),
                                l = e.readInt(15, 16),
                                c = e.readInt(42, 45),
                                u = e.readInt(57, 60),
                                p = e.readString(t[0], t[2] + 1).charCodeAt(0),
                                f = e.readString(t[2], t[2] + 1).charCodeAt(0),
                                h = e.readInt(t[1], t[1] + 3),
                                d = e.readString(t[1] + 4, t[1] + 4),
                                m = 0;
                            d.length > 0 && (m = d.charCodeAt(0));
                            var y, v = e.readInt(t[3], t[3] + 3),
                                _ = 0;
                            (d = e.readString(t[3] + 4, t[3] + 4)).length > 0 && (_ = d.charCodeAt(0));
                            var g = this._sheet;
                            if (83 === e.readCharCode(1)) {
                                null !== g && g.getName() !== o && (g = null, this._sheet = null), null === g ? (this._sheet = y = new Qv(o, l), n(y)) : y = g;
                                var b = new Jv(y, this._complex.getUnifiedSerial(p, h, m), this._complex.getUnifiedSerial(f, v, _), s, c, u);
                                y.addStrand(b), this._complex.structures.push(b)
                            } else n(y = new Zv(s, this._complex.getUnifiedSerial(p, h, m), this._complex.getUnifiedSerial(f, v, _), r, o, i, a))
                        }
                    }, {
                        key: "_parseHEADER",
                        value: function(e) {
                            var t = this._complex.metadata;
                            t.classification = e.readString(11, 50).trim(), t.date = e.readString(51, 59).trim();
                            var n = e.readString(63, 66).trim();
                            t.id = n, n && (this._complex.name = n), t.format = "pdb"
                        }
                    }, {
                        key: "_parseTITLE",
                        value: function(e) {
                            var t = this._complex.metadata;
                            t.title = t.title || [];
                            var n = e.readInt(9, 10) || 1;
                            t.title[n - 1] = e.readString(11, 80).trim()
                        }
                    }, {
                        key: "parseSync",
                        value: function() {
                            for (var e = new Gv(this._data), n = this._complex = new $v; !e.end();) {
                                var r = e.readString(1, 6),
                                    o = t.tagParsers[r];
                                l.a.isFunction(o) && o.call(this, e), e.next()
                            }
                            if (this._finalize(), this._serialAtomMap = null, this._sheet = null, this._residue = null, this._chain = null, this._complex = null, 0 === n.getAtomCount()) throw new Error("The data does not contain valid atoms");
                            return n
                        }
                    }]) && Wv(n.prototype, r), o && Wv(n, o), t
                }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(o_, "tagParsers", {
                HEADER: o_.prototype._parseHEADER,
                "TITLE ": o_.prototype._parseTITLE,
                "ATOM  ": o_.prototype._parseATOM,
                HETATM: o_.prototype._parseATOM,
                ENDMDL: o_.prototype._parseENDMDL,
                CONECT: o_.prototype._parseCONECT,
                COMPND: o_.prototype._parseCOMPND,
                REMARK: o_.prototype._parseREMARK,
                "HELIX ": o_.prototype._parseHELIX,
                "SHEET ": o_.prototype._parseSHEET,
                "ATOM 1": o_.prototype._parseATOM,
                "ATOM 2": o_.prototype._parseATOM,
                "ATOM 3": o_.prototype._parseATOM,
                "ATOM 4": o_.prototype._parseATOM,
                "ATOM 5": o_.prototype._parseATOM,
                "ATOM 6": o_.prototype._parseATOM,
                "ATOM 7": o_.prototype._parseATOM,
                "ATOM 8": o_.prototype._parseATOM,
                "ATOM 9": o_.prototype._parseATOM
            }), o_.formats = ["pdb"], o_.extensions = [".pdb", ".ent"];
            var i_ = o_;

            function a_(e) {
                return (a_ = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function s_(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function l_(e, t) {
                return !t || "object" !== a_(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function c_(e) {
                return (c_ = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function u_(e, t) {
                return (u_ = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var p_ = hr.Complex,
                f_ = hr.Element,
                h_ = hr.AtomName,
                d_ = hr.SGroup,
                m_ = hr.Bond,
                y_ = {
                    A: 0,
                    S: 1,
                    D: 2,
                    T: 3
                },
                v_ = /\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,
                __ = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = l_(this, c_(t).call(this, e, n)))._complex = null, r._residue = null, r._serialAtomMap = null, r._modelId = 1, r._lastMolId = -1, r._readOnlyOneMolecule = !1, r._options.fileType = "cml", r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && u_(e, t)
                    }(t, Nv), n = t, o = [{
                        key: "canParse",
                        value: function(e, t) {
                            if (!e) return !1;
                            var n = new RegExp("^\\s*?\\<\\?xml"),
                                r = new RegExp("^\\s*?\\<cml");
                            return ("string" == typeof e || e instanceof String) && (e.match(n) || e.match(r)) && Nv.checkDataTypeOptions(t, "cml")
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return l.a.isString(e) && v_.test(e)
                        }
                    }], (r = [{
                        key: "_rebuidBondIndexes",
                        value: function(e, t) {
                            for (var n = e.length, r = 0; r < n; r++)
                                for (var o = e[r].id, i = t.length, a = 0; a < i; a++) {
                                    var s = t[a].atomRefs2.split(" ");
                                    s[0] === o && (t[a].start = r), s[1] === o && (t[a].end = r)
                                }
                        }
                    }, {
                        key: "_createSGroup",
                        value: function(e, t) {
                            var n = new d_(e.id, e.fieldData, new c.Vector3(parseFloat(e.x), parseFloat(e.y), 0), e.atomRefs, e);
                            "Relative" === e.placement && (n._center = new c.Vector3(0, 0, 0)), "MDLBG_FRAGMENT_CHARGE" === e.fieldName && (n._charge = parseInt(e.fieldData, 10) || 0), "MDLBG_FRAGMENT_COEFFICIENT" === e.fieldName && (n._repeat = parseInt(e.fieldData, 10) || 1), t.push(n)
                        }
                    }, {
                        key: "_extractSGroup",
                        value: function(e, t) {
                            if (Array.isArray(t) || (t = []), e)
                                if (Array.isArray(e))
                                    for (var n = e.length, r = 0; r < n; r++) e[r].molecule && (t = t.concat(this._extractSGroup(e[r].molecule))), this._createSGroup(e[r], t);
                                else e.molecule && e.molecule && (t = t.concat(this._extractSGroup(e.molecule))), this._createSGroup(e, t);
                            return t
                        }
                    }, {
                        key: "_extractSGroups",
                        value: function(e, t) {
                            var n, r, o = this._extractSGroup(e),
                                i = t.length;
                            for (n = 0; n < i; n++) {
                                var a = t[n].id;
                                for (r = 0; r < o.length; r++) {
                                    o[r]._atoms.split(" ")[0] === a && (t[n].sgroupRef || (t[n].sgroupRef = []), t[n].sgroupRef.push(o[r]))
                                }
                            }
                            var s, l = {},
                                u = null,
                                p = new c.Vector3(1e8, 1e8, 1e8),
                                f = new c.Vector3(-1e8, -1e8, -1e8);

                            function h(e) {
                                (u = l[e]) && o[r]._atoms.push(u.a)
                            }

                            function d(e) {
                                (u = l[e]) && (p.set(Math.min(p.x, u.x), Math.min(p.y, u.y), Math.min(p.z, u.z)), f.set(Math.max(f.x, u.x), Math.max(f.y, u.y), Math.max(f.z, u.z)), h(e))
                            }
                            for (n = 0; n < t.length; n++) l[t[n].id] = {}, l[t[n].id].x = t[n].x2, t[n].x3 && (l[t[n].id].x = t[n].x3), l[t[n].id].x = parseFloat(l[t[n].id].x), l[t[n].id].y = t[n].y2, t[n].y3 && (l[t[n].id].y = t[n].y3), l[t[n].id].y = parseFloat(l[t[n].id].y), l[t[n].id].z = "0.0", t[n].z3 && (l[t[n].id].z = t[n].z3), l[t[n].id].z = parseFloat(l[t[n].id].z), l[t[n].id].a = t[n];
                            for (r = 0; r < o.length; r++) null !== o[r]._center ? (p.set(1e8, 1e8, 1e8), f.set(-1e8, -1e8, -1e8), s = o[r]._atoms.split(" "), o[r]._atoms = [], s.forEach(d), o[r]._center.addVectors(p, f), o[r]._center.multiplyScalar(.5)) : (s = o[r]._atoms.split(" "), o[r]._atoms = [], s.forEach(h));
                            l = null
                        }
                    }, {
                        key: "_traverseData",
                        value: function(e) {
                            var t = {};
                            return e.childNodes.length && function e(t, n) {
                                if ("#text" !== t.nodeName || "" !== t.nodeValue.trim()) {
                                    var r = {};
                                    r.xmlNode = t;
                                    var o, i, a, s = n[t.nodeName];
                                    if (s ? (o = s, "[object Array]" !== Object.prototype.toString.apply(o) ? n[t.nodeName] = [s, r] : n[t.nodeName].push(r)) : n[t.nodeName] = r, t.attributes)
                                        for (i = t.attributes.length, a = 0; a < i; a++) {
                                            var l = t.attributes[a];
                                            r[l.nodeName] = l.nodeValue
                                        }
                                    for (i = t.childNodes.length, a = 0; a < i; a++) e(t.childNodes[a], r)
                                }
                            }(e.childNodes[0], t), t
                        }
                    }, {
                        key: "_findSuitableMolecule",
                        value: function(e, t) {
                            for (var n in e)
                                if ("xmlNode" !== n)
                                    if ("molecule" === n) {
                                        if (e.molecule && (e.molecule.atomArray && e.molecule.atomArray.atom && t.push(e), Array.isArray(e.molecule)))
                                            for (var r = 0; r < e.molecule.length; r++) e.molecule[r].atomArray && e.molecule[r].atomArray.atom && t.push({
                                                molecule: e.molecule[r]
                                            })
                                    } else e[n] && null !== e[n] && "object" === a_(e[n]) && this._findSuitableMolecule(e[n], t)
                        }
                    }, {
                        key: "_selectComponents",
                        value: function(e) {
                            var t, n = (new DOMParser).parseFromString(e, "application/xml"),
                                r = this._traverseData(n),
                                o = this;
                            t = r.cml ? r.cml : r;
                            var i = [],
                                a = [];
                            return this._findSuitableMolecule(t, a), this._readOnlyOneMolecule && a.length > 1 && a.splice(1, a.length - 1), a.forEach(function(e) {
                                var t = function(e) {
                                    var t, r = [];
                                    if (e.molecule && e.molecule.atomArray && e.molecule.atomArray.atom) Array.isArray(e.molecule.atomArray.atom) ? r = e.molecule.atomArray.atom : r.push(e.molecule.atomArray.atom);
                                    else if (!e.molecule) {
                                        var i = {
                                            atomLabels: null,
                                            labelsCount: 1
                                        };
                                        return i
                                    }
                                    e.molecule.molecule && o._extractSGroups(e.molecule.molecule, r);
                                    for (var a = r.length, s = 0; s < a; s++)(t = r[s]).edges = [];
                                    var l, c = [];
                                    e.molecule.bondArray && e.molecule.bondArray.bond && (Array.isArray(e.molecule.bondArray.bond) ? c = e.molecule.bondArray.bond : c.push(e.molecule.bondArray.bond)), a = c.length, o._rebuidBondIndexes(r, c);
                                    for (var u = 0; u < a; u++)
                                        if (l = c[u], (t = r[l.start]) && (t.edges.push(l.end), (t = r[l.end]) && (t.edges.push(l.start), 1))) {
                                            var p = l.xmlNode.getAttribute("order"),
                                                f = parseInt(p, 10);
                                            if (c[u].order = 0, c[u].type = m_.BondType.UNKNOWN, f > 1) c[u].order = f;
                                            else {
                                                var h = y_[p];
                                                void 0 !== h && (c[u].order = h, "A" === p && (c[u].type = m_.BondType.AROMATIC))
                                            }
                                        } a = r.length;
                                    for (var d = 0; d < a; d++)(t = r[d]).edges.sort();
                                    var m = o._breadWidthSearch(r, 0),
                                        y = {};
                                    return y.atoms = r, y.bonds = c, y.labels = m.atomLabels, y.count = Math.min(1, m.labelsCount), y.curr = -1, y.originalCML = n, y
                                }(e);
                                t.atoms.length > 0 && i.push(t)
                            }), i
                        }
                    }, {
                        key: "_packLabel",
                        value: function(e, t) {
                            return (t << 16) + e
                        }
                    }, {
                        key: "_unpackLabel",
                        value: function(e) {
                            return {
                                molId: e >>> 16,
                                compId: 65535 & e
                            }
                        }
                    }, {
                        key: "_breadWidthSearch",
                        value: function(e, t) {
                            var n, r = new Array(e.length);
                            for (n = 0; n < r.length; n++) r[n] = this._packLabel(0, t);
                            for (var o = [], i = 0, a = e.length; a > 0;) {
                                i++;
                                var s = -1;
                                for (n = 0; n < r.length; n++)
                                    if (0 === this._unpackLabel(r[n]).compId) {
                                        s = n;
                                        break
                                    } if (s < 0) break;
                                for (o.push(e[s]), r[s] = this._packLabel(i, t), a--; o.length > 0;) {
                                    var l = o.shift();
                                    if (l)
                                        for (var c = 0; c < l.edges.length; c++) r[l.edges[c]] !== i && (o.push(e[l.edges[c]]), r[l.edges[c]] = i, a--)
                                }
                            }
                            var u = {};
                            return u.atomLabels = r, u.labelsCount = i, u
                        }
                    }, {
                        key: "_parseBond",
                        value: function(e, t, n, r) {
                            if (e >= 0) {
                                var o = [Math.min(e, t), Math.max(e, t)];
                                this._complex.addBond(o[0], o[1], n, r, !0)
                            }
                        }
                    }, {
                        key: "_fixBondsArray",
                        value: function() {
                            for (var e = this._serialAtomMap = {}, t = this._complex, n = t._atoms, r = 0, o = n.length; r < o; ++r) {
                                var i = n[r];
                                e[i._serial] = i
                            }
                            for (var a = t._bonds, s = this.logger, l = 0, c = a.length; l < c; ++l) {
                                var u = a[l];
                                u._right < u._left && s.debug("_fixBondsArray: Logic error."), u._left = e[u._left] || null, u._right = e[u._right] || null
                            }
                        }
                    }, {
                        key: "_parseSet",
                        value: function(e) {
                            var t, n, r = this._complex = new p_,
                                o = e,
                                i = o.curr,
                                a = o.atoms,
                                s = o.labels,
                                l = null,
                                u = a.length;
                            var p, f = {},
                                h = [];
                            for (t = 0; t < u; t++) h.push(t);
                            for (h.sort(function(e, t) {
                                    return s[e] - s[t]
                                }), t = 0; t < u; t++) {
                                var d = s[h[t]];
                                if (this._unpackLabel(d).molId === this._unpackLabel(i).molId) {
                                    l = a[h[t]];
                                    var m = new h_(l.elementType, null);
                                    if (l.sgroupRef)
                                        for (var y = l.sgroupRef.length, v = 0; v < y; ++v) r._sgroups.push(l.sgroupRef[v]);
                                    if (l.x3 || l.x2) {
                                        var _ = this._unpackLabel(d).compId,
                                            g = _,
                                            b = _.toString();
                                        1 === b.length && (b = "0".concat(b));
                                        var w = "N".concat(b),
                                            x = f[" "];
                                        x && " " === x.getName() || (f[" "] = x = this._complex.getChain(" ") || this._complex.addChain(" "), this._residue = null);
                                        var S = this._residue;
                                        S && S.getSequence() === g && " " === S.getICode() || (this._residue = S = x.addResidue(w, g, " "));
                                        var C = null;
                                        l.x3 ? C = new c.Vector3(parseFloat(l.x3), parseFloat(l.y3), parseFloat(l.z3)) : l.x2 && (C = new c.Vector3(parseFloat(l.x2), parseFloat(l.y2), 0));
                                        var P = f_.ByName[l.elementType.toUpperCase()];
                                        P || ((P = JSON.parse(JSON.stringify(f_.ByName[Object.keys(f_.ByName)[Object.keys(f_.ByName).length - 1]]))).number += 1, P.name = l.elementType.toUpperCase(), P.fullName = "Unknown", f_.ByName[l.elementType.toUpperCase()] = P);
                                        var E = parseInt(l.id.replace(/[^0-9]/, ""), 10),
                                            O = S.addAtom(m, P, C, f_.Role.SG, !0, E, " ", 1, 0, 0);
                                        l.hydrogenCount && (O._hydrogenCount = parseInt(l.hydrogenCount, 10)), l.mrvValence && (O._valence = parseInt(l.mrvValence, 10)), (p = O).xmlNodeRef = l, l.x2 && (l.x3 = l.x2, delete l.x2), l.y2 && (l.y3 = l.y2, delete l.y2), l.z3 || (l.z3 = "0.0"), l.complexAtom = p
                                    }
                                }
                            }
                            for (f = null, t = 0; t < o.bonds.length; t++) {
                                var A = o.bonds[t];
                                if (this._unpackLabel(s[A.start]).molId === this._unpackLabel(i).molId && this._unpackLabel(s[A.end]).molId === this._unpackLabel(i).molId) {
                                    if (!(l = a[A.start]) || !a[A.end]) continue;
                                    this._parseBond(parseInt(l.id.replace(/[^0-9]/, ""), 10), parseInt(a[A.end].id.replace(/[^0-9]/, ""), 10), A.order, A.type)
                                }
                            }
                            for (t = 0; t < this._complex.getSGroupCount(); t++) {
                                var T = this._complex.getSGroups()[t];
                                for (n = 0; n < T._atoms.length; n++) T._atoms[n] = T._atoms[n].complexAtom
                            }
                            for (t = 0; t < u; t++) this._unpackLabel(s[t]).molId === this._unpackLabel(i).molId && ((l = a[t]).complexAtom = null, delete l.complexAtom);
                            return this._complex.originalCML = o.originalCML, this._fixBondsArray(), r.finalize({
                                needAutoBonding: !1,
                                detectAromaticLoops: this.settings.now.aromatic,
                                enableEditing: this.settings.now.editing,
                                serialAtomMap: this._serialAtomMap
                            }), this._serialAtomMap = null, this._complex = null, r
                        }
                    }, {
                        key: "parseSync",
                        value: function() {
                            var e = [],
                                t = this;
                            this._selectComponents(this._data).forEach(function(n) {
                                n.curr = 2, 0 === n.count && (n.count = 1);
                                for (var r = 0; r < n.count; r++) n.curr = r + 1, e.push(t._parseSet(n, !1))
                            });
                            var n = 0;
                            if (e.forEach(function(e) {
                                    n += e.getAtomCount()
                                }), n <= 0) throw new Error("The data does not contain valid atoms");
                            if (e.length > 1) {
                                var r = new p_;
                                return r.joinComplexes(e), r.originalCML = e[0].originalCML, r
                            }
                            return 1 === e.length ? e[0] : new p_
                        }
                    }]) && s_(n.prototype, r), o && s_(n, o), t
                }();
            __.formats = ["cml"], __.extensions = [".cml"];
            var g_ = __,
                b_ = n("rVTi"),
                w_ = n.n(b_);

            function x_(e) {
                return (x_ = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function S_(e, t) {
                return !t || "object" !== x_(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function C_(e) {
                return (C_ = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function P_(e, t) {
                return (P_ = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function E_(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function O_(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function A_(e, t, n) {
                return t && O_(e.prototype, t), n && O_(e, n), e
            }
            var T_ = hr.Complex,
                k_ = hr.Chain,
                R_ = hr.Atom,
                I_ = hr.AtomName,
                M_ = hr.Element,
                N_ = hr.Helix,
                L_ = hr.Sheet,
                j_ = hr.Strand,
                D_ = hr.Bond,
                V_ = hr.Assembly,
                F_ = hr.Molecule,
                B_ = function() {
                    function e(t) {
                        E_(this, e), this._original = Array.from(t), this._original.sort(), this._sum = 0;
                        for (var n = 0; n < this._original.length; ++n) this._sum += this._original[n]
                    }
                    return A_(e, [{
                        key: "compare",
                        value: function(e) {
                            var t = e.length;
                            if (t !== this._original.length) return !1;
                            var n, r = 0;
                            for (n = 0; n < t; ++n) r += e[n];
                            if (r !== this._sum) return !1;
                            var o = Array.from(e);
                            for (o.sort(), n = 0; n < t; ++n)
                                if (o[n] !== this._original[n]) return !1;
                            return !0
                        }
                    }]), e
                }();
            B_.prototype.constructor = B_;
            var z_ = nt.Type,
                U_ = [z_.HELIX_PI, z_.BEND, z_.HELIX_ALPHA, z_.STRAND, z_.HELIX_310, z_.BRIDGE, z_.TURN, z_.COIL];
            var G_ = function(e) {
                function t(e, n) {
                    var r;
                    return E_(this, t), (r = S_(this, C_(t).call(this, e, n)))._options.fileType = "mmtf", r
                }
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && P_(e, t)
                }(t, Nv), A_(t, [{
                    key: "_onModel",
                    value: function(e) {}
                }, {
                    key: "_onChain",
                    value: function(e) {
                        if (0 === e.modelIndex) {
                            var t = new k_(this._complex, e.chainName);
                            this._complex._chains[e.chainIndex] = t, t._index = e.chainIndex
                        }
                    }
                }, {
                    key: "_onGroup",
                    value: function(e) {
                        if (0 === e.modelIndex && (!this.settings.now.nowater || "HOH" !== e.groupName && "WAT" !== e.groupName)) {
                            var t = this._complex._chains[e.chainIndex],
                                n = e.insCode.charCodeAt(0) ? e.insCode : "",
                                r = t.addResidue(e.groupName, e.groupId, n);
                            r._index = e.groupIndex, this._updateSecStructure(this._complex, r, e)
                        }
                    }
                }, {
                    key: "_onAtom",
                    value: function(e) {
                        if (0 === e.modelIndex) {
                            var t = e.altLoc.charCodeAt(0) ? e.altLoc : "",
                                n = new R_(e.groupIndex, new I_(e.atomName), M_.getByName(e.element.toUpperCase()), new c.Vector3(e.xCoord, e.yCoord, e.zCoord), M_.Role[e.atomName], !1, e.atomId, t, e.occupancy, e.bFactor, e.formalCharge);
                            this._complex._atoms[e.atomIndex] = n, n._index = e.atomIndex, this._serialAtomMap[e.atomId] = n
                        }
                    }
                }, {
                    key: "_onBond",
                    value: function(e) {
                        var t = Math.max(e.atomIndex1, e.atomIndex2);
                        if (!(t >= this._complex._atoms.length)) {
                            var n = Math.min(e.atomIndex1, e.atomIndex2);
                            this._complex.addBond(this._complex._atoms[n], this._complex._atoms[t], e.bondOrder, D_.BondType.UNKNOWN, !0)
                        }
                    }
                }, {
                    key: "_updateSecStructure",
                    value: function(e, t, n) {
                        if (!l.a.isUndefined(n) && n.secStruct === this._ssType) return t._secondary = this._ssStruct, void(this._ssStruct && (this._ssStruct.term = t));
                        if (!l.a.isUndefined(n)) {
                            var r = U_[n.secStruct];
                            this._ssType = n.secStruct, this._ssStart = t;
                            var o = null;
                            switch (this._ssType) {
                                case -1:
                                case 7:
                                    break;
                                case 0:
                                case 2:
                                case 4:
                                    o = new N_([3, -1, 1, -1, 5][this._ssType], t, t, 0, "", "", 0), e._helices.push(o);
                                    break;
                                case 3:
                                    var i = new L_("", 0);
                                    e._sheets.push(i), o = new j_(i, t, t, 0, null, null);
                                    break;
                                default:
                                    void 0 !== r && (o = new nt(r, t, t))
                            }
                            this._ssStruct = o, t._secondary = o, o && e.structures.push(o)
                        }
                    }
                }, {
                    key: "_updateMolecules",
                    value: function(e) {
                        var t = e.entityList;
                        if (t)
                            for (var n = e.chainsPerModel[0], r = 0; r < t.length; r++) {
                                for (var o = t[r], i = o.chainIndexList, a = [], s = 0; s < i.length; s++) {
                                    var l = i[s];
                                    if (!(l >= n)) {
                                        var c = this._complex._chains[l];
                                        a = a.concat(c._residues.slice())
                                    }
                                }
                                var u = new F_(this._complex, o.description, r + 1);
                                u._residues = a, this._complex._molecules[r] = u
                            }
                    }
                }, {
                    key: "_traverse",
                    value: function(e) {
                        var t = this,
                            n = this._complex.metadata;
                        n.id = e.structureId, n.title = [], n.title[0] = e.title, n.date = e.releaseDate, n.format = "mmtf";
                        var r = {
                            onModel: function(e) {
                                t._onModel(e)
                            },
                            onChain: function(e) {
                                t._onChain(e)
                            },
                            onGroup: function(e) {
                                t._onGroup(e)
                            },
                            onAtom: function(e) {
                                t._onAtom(e)
                            },
                            onBond: function(e) {
                                t._onBond(e)
                            }
                        };
                        this._ssType = -1, this._ssStruct = null, this._ssStart = null, w_.a.traverse(e, r), this._updateSecStructure(this._complex), this._updateMolecules(e)
                    }
                }, {
                    key: "_linkAtomsToResidues",
                    value: function() {
                        for (var e = 0; e < this._complex._atoms.length; ++e) {
                            var t = this._complex._atoms[e],
                                n = this._complex._residues[t._residue];
                            t._residue = n, n._atoms.push(t)
                        }
                    }
                }, {
                    key: "_findSynonymousChains",
                    value: function() {
                        for (var e = {}, t = 0; t < this._complex._chains.length; ++t) {
                            var n = this._complex._chains[t],
                                r = n.getName();
                            e.hasOwnProperty(r) || (e[r] = []), e[r].push(n._index)
                        }
                        return e
                    }
                }, {
                    key: "_parseAssemblyInfo",
                    value: function(e) {
                        var t, n, r, o = [],
                            i = this.logger;
                        for (t = 0; t < e.bioAssemblyList.length; ++t) {
                            var a = e.bioAssemblyList[t];
                            if (0 !== a.transformList.length) {
                                var s = a.transformList[0].chainIndexList,
                                    l = new B_(s),
                                    u = {};
                                for (n = 0; n < s.length; ++n) u[this._complex._chains[s[n]].getName()] = 1;
                                var p = [],
                                    f = void 0;
                                for (f in u) u.hasOwnProperty(f) && Array.prototype.push.apply(p, this._chainsByName[f]);
                                l.compare(p) || i.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");
                                var h = new V_(this._complex);
                                for (f in u) u.hasOwnProperty(f) && h.addChain(f);
                                for (h.addMatrix((new c.Matrix4).fromArray(a.transformList[0].matrix).transpose()), n = 1; n < a.transformList.length; ++n) {
                                    var d = a.transformList[n];
                                    if (l.compare(d.chainIndexList)) {
                                        var m = (new c.Matrix4).fromArray(d.matrix).transpose();
                                        for (r = 0; r < h.matrices.length && !h.matrices[r].equals(m); ++r);
                                        r === h.matrices.length && h.addMatrix(m)
                                    } else i.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...")
                                }
                                h.finalize(), o.push(h)
                            }
                        }
                        return o
                    }
                }, {
                    key: "_markHeteroAtoms",
                    value: function(e) {
                        for (var t = e.chainsPerModel[0], n = 0; n < e.entityList.length; ++n) {
                            var r = e.entityList[n];
                            if ("polymer" !== r.type)
                                for (var o = 0; o < r.chainIndexList.length; ++o) {
                                    var i = r.chainIndexList[o];
                                    if (!(i >= t))
                                        for (var a = this._complex._chains[i], s = 0; s < a._residues.length; ++s)
                                            for (var l = a._residues[s], c = 0; c < l._atoms.length; ++c) l._atoms[c]._het = !0
                                }
                        }
                    }
                }, {
                    key: "_joinSynonymousChains",
                    value: function() {
                        var e, t, n = [],
                            r = {};
                        for (e = 0; e < this._complex._chains.length; ++e) {
                            var o = this._complex._chains[e],
                                i = o.getName();
                            if (r.hasOwnProperty(i)) {
                                var a = r[i];
                                for (t = 0; t < o._residues.length; ++t) {
                                    var s = o._residues[t];
                                    a._residues.push(s), s._chain = a
                                }
                            } else r[i] = o, o._index = n.length, n.push(o)
                        }
                        this._complex._chains = n
                    }
                }, {
                    key: "parseSync",
                    value: function() {
                        var e = w_.a.decode(this._data);
                        return this._complex = new T_, this._serialAtomMap = {}, this._traverse(e), this._linkAtomsToResidues(), this._markHeteroAtoms(e), this._chainsByName = this._findSynonymousChains(), Array.prototype.push.apply(this._complex.units, this._parseAssemblyInfo(e)), this._joinSynonymousChains(), this._complex.finalize({
                            needAutoBonding: !1,
                            detectAromaticLoops: this.settings.now.aromatic,
                            enableEditing: this.settings.now.editing,
                            serialAtomMap: this._serialAtomMap
                        }), this._complex
                    }
                }], [{
                    key: "canParse",
                    value: function(e, t) {
                        return !!e && (e instanceof ArrayBuffer && Nv.checkDataTypeOptions(t, "mmtf"))
                    }
                }, {
                    key: "canProbablyParse",
                    value: function(e) {
                        return l.a.isArrayBuffer(e) && 223 == (1 | new Uint8Array(e, 0, 1)[0])
                    }
                }]), t
            }();
            G_.formats = ["mmtf"], G_.extensions = [".mmtf"], G_.binary = !0;
            var H_ = G_;

            function W_(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function q_(e) {
                return (q_ = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Y_(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function X_(e, t) {
                return !t || "object" !== q_(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function $_(e, t) {
                if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                e.prototype = Object.create(t && t.prototype, {
                    constructor: {
                        value: e,
                        writable: !0,
                        configurable: !0
                    }
                }), t && Q_(e, t)
            }

            function K_(e) {
                var t = "function" == typeof Map ? new Map : void 0;
                return (K_ = function(e) {
                    if (null === e || (n = e, -1 === Function.toString.call(n).indexOf("[native code]"))) return e;
                    var n;
                    if ("function" != typeof e) throw new TypeError("Super expression must either be null or a function");
                    if (void 0 !== t) {
                        if (t.has(e)) return t.get(e);
                        t.set(e, r)
                    }

                    function r() {
                        return Z_(e, arguments, J_(this).constructor)
                    }
                    return r.prototype = Object.create(e.prototype, {
                        constructor: {
                            value: r,
                            enumerable: !1,
                            writable: !0,
                            configurable: !0
                        }
                    }), Q_(r, e)
                })(e)
            }

            function Z_(e, t, n) {
                return (Z_ = function() {
                    if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
                    if (Reflect.construct.sham) return !1;
                    if ("function" == typeof Proxy) return !0;
                    try {
                        return Date.prototype.toString.call(Reflect.construct(Date, [], function() {})), !0
                    } catch (e) {
                        return !1
                    }
                }() ? Reflect.construct : function(e, t, n) {
                    var r = [null];
                    r.push.apply(r, t);
                    var o = new(Function.bind.apply(e, r));
                    return n && Q_(o, n.prototype), o
                }).apply(null, arguments)
            }

            function Q_(e, t) {
                return (Q_ = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function J_(e) {
                return (J_ = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }
            var eg = hr.Complex,
                tg = hr.Element,
                ng = hr.Helix,
                rg = hr.Sheet,
                og = hr.Strand,
                ig = hr.Assembly,
                ag = hr.Molecule,
                sg = ["auth_seq_id", "Cartn_x", "Cartn_y", "Cartn_z", "label_atom_id"],
                lg = {
                    helx: "helix",
                    turn: "turn",
                    strn: "strand"
                };

            function cg(e) {
                return null == e || l.a.isArray(e) ? e : [e]
            }

            function ug(e) {
                var t = 4 === e.trim().length;
                return e.slice(0, t ? 1 : 2).trim()
            }
            var pg = function(e) {
                function t(e) {
                    var n;
                    return Y_(this, t), (n = X_(this, J_(t).call(this))).name = "AtomDataError", n.message = e, n
                }
                return $_(t, K_(Error)), t
            }();

            function fg(e, t) {
                for (var n = (e = l.a.isString(e) ? e : "".concat(e)).replace(/\)\s*\(/g, "!").replace(/[()']/g, "").split("!"), r = [], o = 0, i = n.length; o < i; ++o) {
                    for (var a = n[o].split(","), s = [], u = 0, p = 0, f = a.length; p < f; ++p) {
                        var h = a[p];
                        if (h.includes("-"))
                            for (var d = h.split("-"), m = parseInt(d[0], 10), y = parseInt(d[1], 10); m <= y; ++m) s[u++] = t[m];
                        else s[u++] = t[h]
                    }
                    r.push(s)
                }
                var v = [],
                    _ = 0;
                return function e(t, n) {
                    for (var o = 0, i = r[t].length; o < i; ++o) {
                        var a = n ? n.clone() : new c.Matrix4;
                        a.multiplyMatrices(r[t][o], a), 0 === t ? v[_++] = a : e(t - 1, a)
                    }
                }(r.length - 1), v
            }
            var hg = function(e) {
                function t(e, n) {
                    var r;
                    return Y_(this, t), (r = X_(this, J_(t).call(this, e, n))).asymDict = {}, r.molecules = [], r._options.fileType = "cif", r
                }
                var n, r, o;
                return $_(t, Nv), n = t, o = [{
                    key: "canParse",
                    value: function(e, t) {
                        return !!e && ("string" == typeof e && Nv.checkDataTypeOptions(t, "cif"))
                    }
                }, {
                    key: "canProbablyParse",
                    value: function(e) {
                        return l.a.isString(e) && /^\s*data_/i.test(e)
                    }
                }, {
                    key: "_parseToObject",
                    value: function(e) {
                        var t, n, r, o, i = 0,
                            a = 0,
                            s = e.length,
                            c = NaN,
                            u = !0,
                            p = 1,
                            f = 1,
                            h = 0,
                            d = "unexpected character",
                            m = {},
                            y = {},
                            v = [],
                            _ = 0,
                            g = "",
                            b = [],
                            w = 0;

                        function x(e) {
                            return 32 === e || 10 === e || 13 === e || 9 === e
                        }

                        function S(e, t, n) {
                            for (var r = t.length, o = -1; n < r && (o = t.charCodeAt(n)) !== e && 10 !== o;) ++n;
                            return o === e ? n : -1
                        }

                        function C() {
                            var t;
                            if ((46 === c || 63 === c) && (i + 1 >= s || x(e.charCodeAt(i + 1)))) return ++f, void++i;
                            if (u && 59 === c) {
                                a = i;
                                var n = 0;
                                do {
                                    if (-1 === (a = S(10, e, a + 1))) return d = "unterminated text block found", null;
                                    ++n
                                } while (a + 1 < s && e.charCodeAt(a + 1) !== c || a + 1 >= s);
                                return t = e.substring(i + 1, a).replace(/\r/g, ""), i = a + 2, p += n, f = 1, u = !1, t
                            }
                            if (39 === c || 34 === c) {
                                a = i;
                                do {
                                    if (-1 === (a = S(c, e, a + 1))) return d = "unterminated quoted string found", null
                                } while (a + 1 < s && !x(e.charCodeAt(a + 1)));
                                return t = e.substring(i + 1, a), f += a - i + 1, i = a + 1, t
                            }
                            for (a = i; a < s && !x(e.charCodeAt(a));) ++a;
                            t = e.substring(i, a), f += a - i, i = a;
                            var r = Number(t);
                            return Number.isNaN(r) ? t : r
                        }
                        for (; i <= s;) {
                            if (13 === (c = e.charCodeAt(i)));
                            else if (10 === c) u = !0, ++p, f = 1;
                            else {
                                if (32 !== c && 9 !== c) {
                                    if (35 === c) {
                                        if (-1 === (i = S(10, e, i + 1))) break;
                                        continue
                                    }
                                    if (0 === h) {
                                        if (68 !== c && 100 !== c || "ata_" !== e.substr(i + 1, 4).toLowerCase()) {
                                            if (Number.isNaN(c)) break;
                                            d += " in state ".concat(h), h = 666;
                                            break
                                        }
                                        for (t = a = i + 5; a < s && !x(e.charCodeAt(a));) ++a;
                                        if (f += a - i, t < (i = a)) {
                                            m[e.substring(t, i)] = y = {}, h = 1;
                                            continue
                                        }
                                        d = "data block name missing", h = 666;
                                        break
                                    }
                                    if (1 === h) {
                                        if (68 !== c && 100 !== c || "ata_" !== e.substr(i + 1, 4).toLowerCase()) {
                                            if (95 === c) {
                                                for (t = a = i + 1; a < s && !x(e.charCodeAt(a));) ++a;
                                                if (f += a - i, t < (i = a)) {
                                                    g = e.substring(t, i), h = 2;
                                                    continue
                                                }
                                                d = "tag name missing", h = 666;
                                                break
                                            }
                                            if (76 !== c && 108 !== c || "oop_" !== e.substr(i + 1, 4).toLowerCase()) {
                                                if (Number.isNaN(c)) break;
                                                d += " in state ".concat(h), h = 666;
                                                break
                                            }
                                            if (f += 5, (i += 5) < s && !x(e.charCodeAt(i))) {
                                                d += " in state ".concat(h), h = 666;
                                                break
                                            }
                                            v = [], _ = 0, b = [], w = 0, h = 3;
                                            continue
                                        }
                                        h = 0;
                                        continue
                                    }
                                    if (2 === h) {
                                        if (Number.isNaN(c)) break;
                                        if (null !== (n = C())) {
                                            l.a.set(y, g, n), h = 1;
                                            continue
                                        }
                                        h = 666;
                                        break
                                    }
                                    if (3 === h) {
                                        if (95 === c) {
                                            for (t = a = i + 1; a < s && !x(e.charCodeAt(a));) ++a;
                                            if (f += a - i, t < (i = a)) {
                                                o = e.substring(t, i), v[_++] = o;
                                                continue
                                            }
                                            d = "tag name missing", h = 666;
                                            break
                                        }
                                        if (_ > 0) {
                                            for (var P = 0; P < _; ++P) n = [], b[P] = n, l.a.set(y, v[P], n);
                                            h = 4;
                                            continue
                                        }
                                        d = "data tags are missing inside a loop", h = 666;
                                        break
                                    }
                                    if (4 === h) {
                                        if (68 !== c && 100 !== c || "ata_" !== e.substr(i + 1, 4).toLowerCase())
                                            if (95 === c) h = 1;
                                            else if (76 !== c && 108 !== c || "oop_" !== e.substr(i + 1, 4).toLowerCase()) {
                                            if (!Number.isNaN(c)) {
                                                if (null !== (r = C(), b[w % _].push(r), ++w, r)) continue;
                                                h = 666;
                                                break
                                            }
                                            h = 0
                                        } else h = 1;
                                        else h = 0;
                                        continue
                                    }
                                    d = "unexpected internal state ".concat(h), h = 666;
                                    break
                                }
                                u = !1, ++f
                            }++i
                        }
                        2 === h && (d = "unexpected end of file in state ".concat(h), h = 666);
                        var E = {
                            data: m
                        };
                        return 666 === h && (E.error = {
                            line: p,
                            column: f,
                            message: d
                        }), E
                    }
                }], (r = [{
                    key: "parseSync",
                    value: function() {
                        this.logger.info("Parsing CIF file..");
                        var e = t._parseToObject(this._data);
                        if (e.error) throw new Error(e.error.message);
                        return this._toComplex(e.data)
                    }
                }, {
                    key: "_toComplex",
                    value: function(e) {
                        var t = new eg,
                            n = e[Object.keys(e)[0]];
                        return this._extractAtoms(t, n), this._extractSecondary(t, n), this._extractAssemblies(t, n), this._extractMolecules(t, n), this._extractMetadata(t, n), t.finalize({
                            needAutoBonding: !0,
                            detectAromaticLoops: this.settings.now.aromatic,
                            enableEditing: this.settings.now.editing
                        }), t
                    }
                }, {
                    key: "_extractMetadata",
                    value: function(e, t) {
                        var n = e.metadata;
                        n.id = t.entry.id, n.classification = t.struct_keywords.pdbx_keywords;
                        var r = t.database_PDB_rev;
                        n.date = r && r.date_original ? r.date_original : "", n.format = "cif", n.title = [], n.title[0] = t.struct.title
                    }
                }, {
                    key: "_extractMolecules",
                    value: function(e, t) {
                        var n, r = cg(t.entity.pdbx_description),
                            o = r.length;
                        for (n = 0; n < o; n++) this.molecules[n].name = r[n];
                        var i = e.getMolecules();
                        for (n = 0; n < o; n++) {
                            var a = this.molecules[n];
                            i[n] = new ag(e, a.name, n + 1), i[n]._residues = a.residues
                        }
                    }
                }, {
                    key: "_extractAtoms",
                    value: function(e, t) {
                        var n = t.atom_site;
                        if (!n) throw new pg("CIF parsing error: atom_site is not specified!");
                        for (var r = 0, o = sg.length; r < o; ++r)
                            if (!n[sg[r]]) throw new pg("CIF parsing error: requires field ".concat(sg[r], " not found!"));
                        for (var i = this.asymDict, a = cg(n.auth_seq_id), s = cg(n.Cartn_x), l = cg(n.Cartn_y), u = cg(n.Cartn_z), p = cg(n.label_atom_id), f = p.length, h = cg(n.group_PDB) || [], d = cg(n.auth_asym_id) || [], m = cg(n.label_asym_id) || [], y = cg(n.id) || [], v = cg(n.pdbx_PDB_ins_code) || [], _ = cg(n.label_comp_id) || [], g = cg(n.type_symbol) || [], b = cg(n.B_iso_or_equiv) || [], w = cg(n.occupancy) || [], x = cg(n.pdbx_formal_charge) || [], S = cg(n.label_alt_id) || [], C = cg(n.pdbx_PDB_model_num) || [], P = cg(n.label_entity_id) || [], E = null, O = null, A = 0; A < f; ++A) {
                            if (1 === (C[A] || 1)) {
                                var T = String(d[A] || " ");
                                E && E.getName() === T || (E = e.getChain(T) || e.addChain(T)), i[String(m[A] || " ")] = T;
                                var k = a[A],
                                    R = String(v[A] || " "),
                                    I = String(_[A] || "");
                                if (!O || O.getSequence() !== k || O.getICode() !== R) {
                                    O = E.addResidue(I, k, R);
                                    var M = P[A] - 1,
                                        N = this.molecules[M];
                                    N || (this.molecules[M] = {
                                        name: "",
                                        residues: []
                                    }, N = this.molecules[M]), N.residues.push(O)
                                }
                                var L = p[A],
                                    j = g[A] || ug(L),
                                    D = tg.getByName(j),
                                    V = tg.Role[L.trim()],
                                    F = new c.Vector3(s[A], l[A], u[A]),
                                    B = "HETATM" === h[A] || !1,
                                    z = y[A] || A,
                                    U = b[A] || 0,
                                    G = w[A] || 0,
                                    H = String(S[A] || ""),
                                    W = x[A] || 0;
                                O.addAtom(L, D, F, V, B, z, H, G, U, W)
                            }
                        }
                    }
                }, {
                    key: "_extractSecondary",
                    value: function(e, t) {
                        t.struct_conf && this._extractConfs(e, t.struct_conf), t.struct_sheet_range && this._extractSheets(e, t.struct_sheet_range)
                    }
                }, {
                    key: "_extractSheets",
                    value: function(e, t) {
                        var n = this.asymDict;
                        if (t.sheet_id && t.id && t.beg_label_seq_id && t.end_label_seq_id && t.beg_label_asym_id)
                            for (var r = e._sheets, o = cg(t.sheet_id), i = cg(t.id), a = cg(t.beg_auth_seq_id), s = cg(t.end_auth_seq_id), l = cg(t.beg_label_asym_id), c = cg(t.pdbx_beg_PDB_ins_code) || [], u = cg(t.pdbx_end_PDB_ins_code) || [], p = 0, f = i.length; p < f; ++p) {
                                var h = e.getChain(n[l[p]]),
                                    d = C(o[p]),
                                    m = a[p],
                                    y = s[p],
                                    v = c[p] || " ",
                                    _ = u[p] || " ",
                                    g = h.findResidue(m, v),
                                    b = h.findResidue(y, _);
                                if (g && b) {
                                    for (var w = new og(d, g[0], b[0], 0, null, null), x = h.getResidues(), S = g[1]; S <= b[1]; ++S) x[S]._secondary = w;
                                    d.addStrand(w), e.structures.push(w)
                                }
                            }

                        function C(e) {
                            for (var t = r.length, n = 0; n < t; ++n)
                                if (r[n]._name === e) return r[n];
                            return r[t] = new rg(e, 0), r[t]
                        }
                    }
                }, {
                    key: "_extractConfs",
                    value: function(e, t) {
                        var n = this.asymDict;
                        if (t.conf_type_id && t.beg_label_seq_id && t.end_label_seq_id && t.beg_label_asym_id)
                            for (var r, o, i = cg(t.conf_type_id), a = cg(t.beg_auth_seq_id), s = cg(t.pdbx_beg_PDB_ins_code) || [], l = cg(t.end_auth_seq_id), c = cg(t.pdbx_end_PDB_ins_code) || [], u = cg(t.details) || [], p = cg(t.pdbx_PDB_helix_length) || [], f = cg(t.pdbx_PDB_helix_class) || [], h = cg(t.id) || [], d = cg(t.beg_label_asym_id), m = 0, y = i.length; m < y; ++m) {
                                var v = (r = i[m], o = void 0, (o = /[A-Za-z]+/.exec(r)) ? lg[o[0].toLowerCase()] : null);
                                if (v) {
                                    var _ = h[m] || i[m],
                                        g = e.getChain(n[d[m]]),
                                        b = a[m],
                                        w = l[m],
                                        x = s[m] || " ",
                                        S = c[m] || " ",
                                        C = g.findResidue(b, x),
                                        P = g.findResidue(w, S);
                                    if (C && P) {
                                        var E = u[m] || "",
                                            O = p[m] || 0,
                                            A = f[m] || " ",
                                            T = void 0;
                                        if ("helix" === v) {
                                            var k = e._helices.length;
                                            T = new ng(A, C[0], P[0], k, _, E, O), e.addHelix(T), e.structures.push(T)
                                        } else "turn" === v ? (T = new nt(nt.Type.TURN, C[0], P[0]), e.structures.push(T)) : T = null;
                                        if (T)
                                            for (var R = g.getResidues(), I = C[1]; I <= P[1]; ++I) R[I]._secondary = T
                                    }
                                }
                            }
                    }
                }, {
                    key: "_extractAssemblies",
                    value: function(e, t) {
                        var n = this.asymDict,
                            r = t.pdbx_struct_assembly_gen;
                        if (r) {
                            var o = cg(r.assembly_id),
                                i = cg(r.oper_expression),
                                a = cg(r.asym_id_list);
                            if (o && i && a) {
                                var s = function(e) {
                                    if (!e) return null;
                                    var t = cg(e.id),
                                        n = e.matrix,
                                        r = e.vector;
                                    if (!t || !n || !r) return null;
                                    for (var o = [], i = 0, a = t.length; i < a; ++i) {
                                        for (var s = new c.Matrix4, l = s.elements, u = 0; u < 3; ++u) {
                                            var p = n[u + 1];
                                            l[u] = cg(p[1])[i], l[u + 4] = cg(p[2])[i], l[u + 8] = cg(p[3])[i], l[u + 12] = cg(r[u + 1])[i]
                                        }
                                        o[t[i]] = s
                                    }
                                    return o
                                }(t.pdbx_struct_oper_list);
                                if (s)
                                    for (var l = 0, u = o.length; l < u; ++l) {
                                        for (var p = new ig(e), f = fg(i[l], s), h = a[l].split(","), d = 0, m = h.length; d < m; ++d) {
                                            var y = h[d].trim();
                                            y.length > 0 && p.addChain(n[y])
                                        }
                                        p.matrices = f, e.units.push(p)
                                    }
                            }
                        }
                    }
                }]) && W_(n.prototype, r), o && W_(n, o), t
            }();
            hg.formats = ["cif", "mmcif"], hg.extensions = [".cif", ".mmcif"];
            var dg = hg;

            function mg(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function yg(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function vg(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var _g = 0,
                gg = 1,
                bg = 2,
                wg = 3,
                xg = function() {
                    function e() {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), vg(this, "_xyz2crs", []), vg(this, "_origin", new c.Vector3(0, 0, 0)), this._header = {}, this._boxSize = new c.Vector3, this._boxStart = new c.Vector3, this._header.delta = {}, this._header.extent = [], this._header.nstart = [], this._header.grid = [], this._header.crs2xyz = [], this._header.cellDims = new c.Vector3, this._header.angles = [], this._header.origin = new c.Vector3(0, 0, 0), this._header.dmin = 0, this._header.dmean = 0, this._header.dmax = 0
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "_typedCheck",
                        value: function() {
                            if (l.a.isTypedArray(this._buff)) this._buff = this._buff.buffer;
                            else if (!l.a.isArrayBuffer(this._buff)) throw new TypeError("Expected ArrayBuffer or TypedArray")
                        }
                    }, {
                        key: "_fillHeader",
                        value: function(e, t) {
                            for (var n in e)
                                if (e.hasOwnProperty(n)) switch (e[n][0]) {
                                    case _g:
                                        this._header[n] = t[e[n][1]][e[n][2]];
                                        break;
                                    case bg:
                                        this._parseArray(this._header[n], t[e[n][1]], e[n][2]);
                                        break;
                                    case gg:
                                        this._parseVector(this._header[n], t[e[n][1]], e[n][2]);
                                        break;
                                    case wg:
                                        this._header[n] = new Uint8Array(t[e[n][1]], 4 * [e[n][2]], 4 * [e[n][3]])
                                }
                        }
                    }, {
                        key: "_parseVector",
                        value: function(e, t, n) {
                            var r = [t[n], t[n + 1], t[n + 2]];
                            e.x = r[0], e.y = r[1], e.z = r[2]
                        }
                    }, {
                        key: "_parseArray",
                        value: function(e, t, n) {
                            e[0] = t[n], e[1] = t[n + 1], e[2] = t[n + 2]
                        }
                    }, {
                        key: "_parseHeader",
                        value: function(e) {}
                    }, {
                        key: "_setAxisIndices",
                        value: function() {}
                    }, {
                        key: "_setOrigins",
                        value: function() {}
                    }, {
                        key: "_getAxis",
                        value: function() {
                            var e = this._header,
                                t = e.cellDims.x / e.grid[0],
                                n = e.cellDims.y / e.grid[1],
                                r = e.cellDims.z / e.grid[2],
                                o = mg(e.angles, 3),
                                i = o[0],
                                a = o[1],
                                s = o[2],
                                l = Math.cos(a),
                                u = (Math.cos(i) - Math.cos(a) * Math.cos(s)) / Math.sin(s),
                                p = Math.sqrt(1 - l * l - u * u);
                            return [new c.Vector3(t, 0, 0), new c.Vector3(Math.cos(s) * n, Math.sin(s) * n, 0), new c.Vector3(l * r, u * r, p * r)]
                        }
                    }, {
                        key: "_getXYZdim",
                        value: function() {
                            return [this._header.extent[this._xyz2crs[0]], this._header.extent[this._xyz2crs[1]], this._header.extent[this._xyz2crs[2]]]
                        }
                    }, {
                        key: "_getVolumeInfo",
                        value: function() {
                            var e = l.a.pick(this._header, ["dmean", "dmin", "dmax", "sd", "delta"]);
                            return e.obtuseAngle = this._header.angles.map(function(e) {
                                return Number(e >= Math.PI / 2)
                            }), e
                        }
                    }, {
                        key: "_setBoxParams",
                        value: function(e, t, n) {
                            var r = this,
                                o = 0,
                                i = 0,
                                a = mg(this._header.angles, 3),
                                s = a[0],
                                l = a[1];
                            a[2] >= Math.PI / 2 && (o += Math.abs(t.x)), l >= Math.PI / 2 && (o += Math.abs(n.x)), s >= Math.PI / 2 && (i += Math.abs(n.y)), this._boxStart = new c.Vector3(this._origin.x - o, this._origin.y - i, this._origin.z), this._boxSize = new c.Vector3(Math.abs(e.x) + Math.abs(t.x) + Math.abs(n.x), Math.abs(t.y) + Math.abs(n.y), Math.abs(n.z));
                            var u = function(e, t) {
                                return Math.abs(e[t]) / r._boxSize[t]
                            };
                            this._header.delta.x = u(t, "x"), this._header.delta.y = u(n, "x"), this._header.delta.z = u(n, "y")
                        }
                    }, {
                        key: "_getXYZbox",
                        value: function() {
                            return new c.Box3(this._boxStart.clone(), this._boxStart.clone().add(this._boxSize))
                        }
                    }, {
                        key: "_toXYZData",
                        value: function() {}
                    }, {
                        key: "parse",
                        value: function(e) {
                            return this._parseHeader(e), this._setOrigins(), new pr(Float32Array, this._getXYZdim(), this._getXYZbox(), 1, this._toXYZData(), this._getVolumeInfo())
                        }
                    }]) && yg(t.prototype, n), r && yg(t, r), e
                }();

            function Sg(e) {
                return (Sg = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Cg(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Pg(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function Eg(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Og(e, t, n) {
                return t && Eg(e.prototype, t), n && Eg(e, n), e
            }

            function Ag(e, t) {
                return !t || "object" !== Sg(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Tg(e) {
                return (Tg = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function kg(e, t) {
                if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                e.prototype = Object.create(t && t.prototype, {
                    constructor: {
                        value: e,
                        writable: !0,
                        configurable: !0
                    }
                }), t && Rg(e, t)
            }

            function Rg(e, t) {
                return (Rg = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Ig = {
                    extent: [bg, "u32", 0],
                    type: [_g, "u32", 3],
                    nstart: [bg, "i32", 4],
                    grid: [bg, "u32", 7],
                    cellDims: [gg, "f32", 10],
                    angles: [bg, "f32", 13],
                    crs2xyz: [bg, "i32", 16],
                    dmin: [_g, "f32", 19],
                    dmax: [_g, "f32", 20],
                    dmean: [_g, "f32", 21],
                    ispg: [_g, "u32", 22],
                    nsymbt: [_g, "u32", 23],
                    lksflg: [_g, "u32", 24],
                    customData: [wg, "buffer", 25, 9],
                    origin: [gg, "f32", 34],
                    map: [wg, "buffer", 52, 1],
                    machine: [_g, "u32", 53],
                    sd: [_g, "f32", 54],
                    nlabel: [_g, "f32", 55],
                    label: [wg, "buffer", 56, 200]
                },
                Mg = function(e) {
                    function t() {
                        return Pg(this, t), Ag(this, Tg(t).apply(this, arguments))
                    }
                    return kg(t, xg), Og(t, [{
                        key: "_parseHeader",
                        value: function(e) {
                            this._buff = e, this._typedCheck();
                            var t = {};
                            t.u32 = new Uint32Array(this._buff, 0, 56), t.i32 = new Int32Array(this._buff, 0, 56), t.f32 = new Float32Array(this._buff, 0, 56), t.buffer = this._buff;
                            var n = this._header;
                            this._fillHeader(Ig, t), n.angles.forEach(function(e, t, n) {
                                n[t] *= Math.PI / 180
                            })
                        }
                    }, {
                        key: "_setAxisIndices",
                        value: function() {
                            var e = this._header;
                            0 === e.cellDims.x && 0 === e.cellDims.y && 0 === e.cellDims.z && e.cellDims.set(1, 1, 1);
                            var t = this._header.crs2xyz;
                            0 === t[0] && 0 === t[1] && 0 === t[2] && (t[0] = 1, t[1] = 2, t[2] = 3);
                            var n = this._xyz2crs;
                            n[t[0] - 1] = 0, n[t[1] - 1] = 1, n[t[2] - 1] = 2
                        }
                    }, {
                        key: "_setOrigins",
                        value: function() {
                            var e = Cg(this._getAxis(), 3),
                                t = e[0],
                                n = e[1],
                                r = e[2];
                            this._setAxisIndices();
                            var o = this._header,
                                i = this._xyz2crs;
                            if (0 === o.origin.x && 0 === o.origin.y && 0 === o.origin.z ? (this._origin.addScaledVector(t, o.nstart[i[0]]), this._origin.addScaledVector(n, o.nstart[i[1]]), this._origin.addScaledVector(r, o.nstart[i[2]])) : this._origin = o.origin, t.multiplyScalar(o.extent[i[0]] - 1), n.multiplyScalar(o.extent[i[1]] - 1), r.multiplyScalar(o.extent[i[2]] - 1), 2 !== o.type) throw new Error("CCP4: Unsupported format ".concat(o.type));
                            this._data = new Float32Array(this._buff, 1024 + o.nsymbt, o.extent[0] * o.extent[1] * o.extent[2]), this._setBoxParams(t, n, r)
                        }
                    }, {
                        key: "_toXYZData",
                        value: function() {
                            var e = this._header,
                                t = this._data,
                                n = this._xyz2crs,
                                r = new Float32Array(t.length),
                                o = this._getXYZdim(),
                                i = o[0],
                                a = o[1],
                                s = 0,
                                l = [];
                            for (l[2] = 0; l[2] < e.extent[2]; l[2]++)
                                for (l[1] = 0; l[1] < e.extent[1]; l[1]++)
                                    for (l[0] = 0; l[0] < e.extent[0]; l[0]++, s++) r[l[n[0]] + i * (l[n[1]] + a * l[n[2]])] = t[s];
                            return r
                        }
                    }]), t
                }(),
                Ng = function(e) {
                    function t(e, n) {
                        var r;
                        return Pg(this, t), (r = Ag(this, Tg(t).call(this, e, n)))._options.fileType = "ccp4", r.model = new Mg, r
                    }
                    return kg(t, Nv), Og(t, [{
                        key: "parseSync",
                        value: function() {
                            return this.model.parse(this._data)
                        }
                    }], [{
                        key: "canParse",
                        value: function(e, t) {
                            return !!e && (e instanceof ArrayBuffer && Nv.checkDataTypeOptions(t, "ccp4"))
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return !1
                        }
                    }]), t
                }();
            Ng.formats = ["ccp4"], Ng.extensions = [".ccp4", ".map", ".mrc"], Ng.binary = !0;
            var Lg = Ng;

            function jg(e) {
                return (jg = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Dg(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Vg(e, t) {
                return !t || "object" !== jg(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Fg(e) {
                return (Fg = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Bg(e, t) {
                return (Bg = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }

            function zg(e, t, n) {
                return t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n, e
            }
            var Ug = hr.Complex,
                Gg = hr.Element,
                Hg = hr.Molecule,
                Wg = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = Vg(this, Fg(t).call(this, e, n)))._complex = null, r._atomsInf = null, r._options.fileType = "xyz", r._fileName = n.name, r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Bg(e, t)
                    }(t, Nv), n = t, o = [{
                        key: "canParse",
                        value: function(e, t) {
                            return !!e && ("string" == typeof e && Nv.checkDataTypeOptions(t, "xyz"))
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return l.a.isString(e) && /^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(e)
                        }
                    }], (r = [{
                        key: "_parseToAtomsInf",
                        value: function(e) {
                            var t = e.indexOf("\n"),
                                n = parseInt(e.substring(0, t), 10),
                                r = e.indexOf("\n", t + 1),
                                o = e.slice(t + 1, r).trim();
                            0 === o.length && (o = this._fileName);
                            var i = r + e.substring(r).search(/\S/);
                            this._atomsInf = e.substring(i).split(/[\s,]*\n[\s,]*/), Number.isNaN(n) || this._atomsInf.length - 1 === n ? (this._complex.metadata.format = "xyz", this._complex.name = o) : this._complex.error = {
                                message: "wrong number of atoms"
                            }
                        }
                    }, {
                        key: "_parseAtomsInf",
                        value: function() {
                            for (var e = this._complex.addChain("A").addResidue("UNK", 1, " "), t = 0; t < this._atomsInf.length - 1; t++) {
                                var n = this._atomsInf[t].split(/[\s,]+/);
                                if (4 !== n.length) {
                                    this._complex.error = {
                                        message: "missed parameters"
                                    };
                                    break
                                }
                                var r = t + 1,
                                    o = n[0],
                                    i = new c.Vector3(parseFloat(n[1]), parseFloat(n[2]), parseFloat(n[3])),
                                    a = Gg.getByName(o),
                                    s = Gg.Role[o];
                                e.addAtom(o, a, i, s, !0, r, " ", 1, 1, 0)
                            }
                            var l = new Hg(this._complex, this._complex.name, 1);
                            l._residues = e, this._complex._molecules[0] = l
                        }
                    }, {
                        key: "parseSync",
                        value: function() {
                            var e = this._complex = new Ug;
                            if (this._parseToAtomsInf(this._data), this._parseAtomsInf(), this._complex.finalize({
                                    needAutoBonding: !0,
                                    detectAromaticLoops: this.settings.now.aromatic,
                                    enableEditing: this.settings.now.editing,
                                    serialAtomMap: this._serialAtomMap
                                }), this._complex = null, this._atomsInf = null, e.error) throw new Error(e.error.message);
                            return e
                        }
                    }]) && Dg(n.prototype, r), o && Dg(n, o), t
                }();
            zg(Wg, "formats", ["xyz"]), zg(Wg, "extensions", [".xyz"]);
            var qg = Wg;

            function Yg(e) {
                return (Yg = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Xg(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function $g(e, t) {
                return !t || "object" !== Yg(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Kg(e) {
                return (Kg = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Zg(e, t) {
                return (Zg = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Qg = hr.Complex,
                Jg = hr.Element,
                eb = function(e) {
                    function t(e, n) {
                        var r;
                        return function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), (r = $g(this, Kg(t).call(this, e, n)))._options.fileType = "pubchem+json", r
                    }
                    var n, r, o;
                    return function(e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && Zg(e, t)
                    }(t, Nv), n = t, o = [{
                        key: "canParse",
                        value: function(e, t) {
                            if (!e) return !1;
                            var n = t.fileType;
                            return l.a.isString(e) && ("pubchem+json" === n || !n && "{" === e[0])
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return l.a.isString(e) && "{" === e[0]
                        }
                    }], (r = [{
                        key: "parseSync",
                        value: function() {
                            return this.logger.info("Parsing PubChem JSON file..."), this._toComplex(JSON.parse(this._data))
                        }
                    }, {
                        key: "_toComplex",
                        value: function(e) {
                            var t = new Qg,
                                n = e.PC_Compounds && e.PC_Compounds[0];
                            return n && (this._extractAtoms(t, n), t.finalize({
                                needAutoBonding: !1,
                                detectAromaticLoops: this.settings.now.aromatic,
                                enableEditing: this.settings.now.editing
                            })), t
                        }
                    }, {
                        key: "_extractAtoms",
                        value: function(e, t) {
                            var n = t.atoms && t.atoms.aid,
                                r = n && t.atoms.element;
                            if (!r || n.length !== r.length) throw new Error("Unable to parse atom elements");
                            r = l.a.fromPairs(l.a.zip(n, r));
                            var o = {},
                                i = t.coords && t.coords[0],
                                a = i && i.conformers && i.conformers[0],
                                s = a && a.x,
                                u = a && a.y,
                                p = a && a.z || [];
                            if (!(n = i && i.aid) || !s || !u) throw new Error("Coordinates are not found in the file");
                            for (var f = e.addChain(" ").addResidue("UNK", 1, " "), h = 0, d = n.length; h < d; ++h) {
                                var m = n[h],
                                    y = Jg.ByAtomicNumber[r[m]],
                                    v = new c.Vector3(s[h], u[h], p[h] || 0);
                                o[m] = f.addAtom(y.name, y, v, void 0, !0, m, " ", 1, 0, 0)
                            }
                            var _ = t.bonds && t.bonds.aid1,
                                g = t.bonds && t.bonds.aid2,
                                b = t.bonds && t.bonds.order || [];
                            if (_ && g && _.length === g.length)
                                for (var w = 0, x = _.length; w < x; ++w) e.addBond(o[_[w]], o[g[w]], b[w] || 1, 0, !0)
                        }
                    }]) && Xg(n.prototype, r), o && Xg(n, o), t
                }();
            eb.formats = ["pubchem", "pubchem+json", "pc"], eb.extensions = [".json"];
            var tb = eb;

            function nb(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var rb = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._strings = t.split(/\r?\n|\r/), this._currentStart = 0, this._currentStringIndx = 0
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "setStart",
                    value: function(e) {
                        e >= this._strings.length ? (this._currentStart = this._strings.length - 1, this._currentStringIndx = this._strings.length - 1) : (this._currentStart = e, this._currentStringIndx = e)
                    }
                }, {
                    key: "getNextString",
                    value: function() {
                        return this._strings[++this._currentStringIndx]
                    }
                }, {
                    key: "getCurrentString",
                    value: function() {
                        return this._strings[this._currentStringIndx]
                    }
                }, {
                    key: "getStringFromStart",
                    value: function(e) {
                        return this._currentStringIndx = this._currentStart + e, this._strings[this._currentStart + e]
                    }
                }, {
                    key: "findNextDataItem",
                    value: function() {
                        for (var e = this.getNextString(), t = !1; !l.a.isUndefined(e) && "$$$$" !== e.trim();) {
                            if (e.match(/>\s+<(.*)>/)) {
                                t = !0;
                                break
                            }
                            e = this.getNextString()
                        }
                        return t
                    }
                }, {
                    key: "findNextCompoundStart",
                    value: function() {
                        for (var e = this.getCurrentString(); !l.a.isUndefined(e) && "$$$$" !== e.trim();) e = this.getNextString();
                        return this.setStart(++this._currentStringIndx), this.probablyHaveDataToParse()
                    }
                }, {
                    key: "probablyHaveDataToParse",
                    value: function() {
                        return this._currentStringIndx < this._strings.length - 2
                    }
                }]) && nb(t.prototype, n), r && nb(t, r), e
            }();

            function ob(e) {
                return (ob = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function ib(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function ab(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function sb(e, t) {
                return !t || "object" !== ob(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function lb(e) {
                return (lb = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function cb(e, t) {
                return (cb = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var ub = hr.Complex,
                pb = hr.Element,
                fb = hr.Bond,
                hb = hr.Molecule,
                db = [0, 3, 2, 1, 0, -1, -2, -3],
                mb = [0, 1, 2, 3, 1, 1, 1, 2],
                yb = [fb.BondType.UNKNOWN, fb.BondType.COVALENT, fb.BondType.COVALENT, fb.BondType.COVALENT, fb.BondType.AROMATIC, fb.BondType.UNKNOWN, fb.BondType.AROMATIC, fb.BondType.AROMATIC],
                vb = /.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,
                _b = /.*($$$$).*|.*>\s+<(.+)>.*/,
                gb = "sdf",
                bb = "mol",
                wb = ["name", "id", "title"],
                xb = {
                    name: ["PUBCHEM_IUPAC_TRADITIONAL_NAME", /PUBCHEM_(.+)_NAME/, /(.+)name/, /(.+)NAME/],
                    id: ["PUBCHEM_COMPOUND_CID", "id", "ID", /.*CID/, /.*ID/, /.*id/],
                    title: ["msg", "MSG", "message", "title", "description", "desc"]
                };
            var Sb = function(e) {
                function t(e, n) {
                    var r;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (r = sb(this, lb(t).call(this, e, n)))._format = "sdf", r._complex = null, r._chain = null, r._residue = null, r._molecules = null, r._metadata = {}, r._metadata.molecules = [], r._currentMolProps = {}, r._compoundIndx = -1, r._assemblies = [], r._atomsParsed = 0, r._atomsIndexes = [], r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && cb(e, t)
                }(t, Nv), n = t, (r = [{
                    key: "canProbablyParse",
                    value: function(e) {
                        return l.a.isString(e) && vb.test(e)
                    }
                }, {
                    key: "_parseHeader",
                    value: function(e) {
                        var t = {};
                        t.name = e.getStringFromStart(0);
                        var n = parseInt(e.getStringFromStart(1).substr(10, 6).trim(), 10);
                        t.date = n.toString() || "", t.title = e.getStringFromStart(2), this._metadata.molecules.push(t)
                    }
                }, {
                    key: "_parseAtoms",
                    value: function(e, t) {
                        var n, r = this._atomsParsed,
                            o = function(e) {
                                if (!e) return "A";
                                for (var t = []; e;) t.push(65 + e % 26), e = Math.trunc(e / 26);
                                return t.length > 1 && (t.reverse(), t[0] -= 1), String.fromCharCode.apply(String, t)
                            }(this._compoundIndx);
                        this._chain = this._complex.getChain(o) || this._complex.addChain(o), this._residue = this._chain.addResidue("UNK", 1, " ");
                        for (var i = 0; i < t; i++) {
                            n = e.getNextString(), r++;
                            var a = parseFloat(n.substr(0, 10)),
                                s = parseFloat(n.substr(10, 10)),
                                l = parseFloat(n.substr(20, 10)),
                                u = db[parseInt(n.substr(36, 3), 10)],
                                p = new c.Vector3(a, s, l),
                                f = n.substr(31, 3).trim().toUpperCase(),
                                h = pb.getByName(f);
                            this._atomsIndexes[f] || (this._atomsIndexes[f] = 0), this._atomsIndexes[f] += 1, f += this._atomsIndexes[f], this._residue.addAtom(f, h, p, void 0, !0, r, " ", 1, 0, u)
                        }
                    }
                }, {
                    key: "_parseBonds",
                    value: function(e, t) {
                        for (var n, r = 0; r < t; r++) {
                            n = e.getNextString();
                            var o = parseInt(n.substr(0, 3), 10) + this._atomsParsed,
                                i = parseInt(n.substr(3, 3), 10) + this._atomsParsed,
                                a = parseInt(n.substr(6, 3), 10);
                            if (o > i) {
                                var s = [i, o];
                                o = s[0], i = s[1]
                            }
                            this._complex.addBond(o, i, mb[a] || 1, yb[a] || fb.BondType.UNKNOWN, !0)
                        }
                    }
                }, {
                    key: "_parseMOL",
                    value: function(e) {
                        this._compoundIndx++, this._parseHeader(e);
                        var t = e.getStringFromStart(3),
                            n = parseInt(t.substr(0, 3), 10),
                            r = parseInt(t.substr(3, 3), 10);
                        this._parseAtoms(e, n), this._parseBonds(e, r), this._atomsParsed += n, this._metadata.molecules[this._compoundIndx]._residues = [], this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)
                    }
                }, {
                    key: "_parseDataItem",
                    value: function(e) {
                        for (var t = e.getCurrentString(), n = [], r = e.getNextString();
                            "" !== r.trim();) n.push(r), r = e.getNextString();
                        1 === n.length && (n = ib(n, 1)[0]);
                        this._currentMolProps[t.replace(/[<>]/g, "").trim()] = n
                    }
                }, {
                    key: "_parseCompound",
                    value: function(e) {
                        if (this._parseMOL(e), this._format === gb) {
                            for (this._currentMolProps = {}; e.findNextDataItem();) this._parseDataItem(e);
                            if (0 !== Object.keys(this._currentMolProps).length) {
                                var t = this._metadata.molecules[this._compoundIndx];
                                t.props = this._currentMolProps, this._tryToUpdateMoleculeData(t)
                            }
                        }
                    }
                }, {
                    key: "_fixBondsArray",
                    value: function() {
                        for (var e = this._serialAtomMap, t = this._complex._bonds, n = 0; n < t.length; n++) {
                            var r = t[n];
                            r._right < r._left && console.log("_fixBondsArray: Logic error."), r._left = e[r._left] || null, r._right = e[r._right] || null
                        }
                    }
                }, {
                    key: "_buildAssemblies",
                    value: function() {
                        var e = this._complex._chains;
                        if (1 === e.length) return this._assemblies;
                        for (var t = 0; t < e.length; t++) {
                            var n = new rn(this._complex),
                                r = new c.Matrix4;
                            n.addMatrix(r), n.addChain(e[t]._name), this._assemblies.push(n)
                        }
                        return this._assemblies
                    }
                }, {
                    key: "_buildMolecules",
                    value: function() {
                        this._complex._molecules = [];
                        for (var e = this._metadata.molecules, t = 0; t < e.length; t++) {
                            var n = new hb(this._complex, e[t].name, t + 1);
                            n._residues = e[t]._residues, this._complex._molecules[t] = n
                        }
                        return this._complex._molecules
                    }
                }, {
                    key: "_searchTag",
                    value: function(e, t) {
                        for (var n = 0; n < t.length; n++)
                            if (e instanceof RegExp && e.test(t[n].tag) || e === t[n].tag) return t[n].data
                    }
                }, {
                    key: "_tryToFind",
                    value: function(e, t) {
                        for (var n = 0; n < e.length; n++) {
                            var r = this._searchTag(e[n], t);
                            if (r) return r
                        }
                    }
                }, {
                    key: "_tryToUpdateMoleculeData",
                    value: function(e) {
                        for (var t = !1, n = 0; n < wb.length; n++) {
                            var r = xb[wb[n]],
                                o = this._tryToFind(r, e.props);
                            o && (e[wb[n]] = o, t = !0)
                        }
                        return e.name = e.name || e.id, e.name.match(/^\d+$/) && (e.name = "CID: ".concat(e.name)), t
                    }
                }, {
                    key: "_finalizeMetadata",
                    value: function() {
                        var e = this._metadata.molecules,
                            t = this._complex.metadata,
                            n = this._complex;
                        if (1 === e.length) n.name = e[0].name, t.title = e[0].title, t.date = e[0].date, t.properties = e[0].props;
                        else if (e.length > 1) {
                            t.molecules = [];
                            for (var r = 0; r < e.length; r++) t.molecules.push({
                                name: e[r].name,
                                date: e[r].date,
                                title: e[r].title,
                                properties: e[r].props
                            })
                        }
                    }
                }, {
                    key: "_finalize",
                    value: function() {
                        for (var e = this._serialAtomMap = {}, t = this._complex._atoms, n = 0; n < t.length; n++) {
                            var r = t[n];
                            e[r._serial] = r
                        }
                        this._complex._finalizeBonds(), this._fixBondsArray(), this._finalizeMetadata(), this._buildAssemblies(), this._complex.units = this._complex.units.concat(this._assemblies), this._buildMolecules(), this._complex.finalize({
                            needAutoBonding: !1,
                            detectAromaticLoops: !1,
                            enableEditing: !1,
                            serialAtomMap: this._serialAtomMap
                        })
                    }
                }, {
                    key: "defineFormat",
                    value: function(e) {
                        return _b.test(e) ? gb : bb
                    }
                }, {
                    key: "parseSync",
                    value: function() {
                        var e = this._complex = new ub,
                            t = new rb(this._data);
                        this._format = this.defineFormat(this._data), e.metadata.format = this._format;
                        do {
                            this._parseCompound(t)
                        } while (t.findNextCompoundStart());
                        return this._finalize(), e
                    }
                }]) && ab(n.prototype, r), o && ab(n, o), t
            }();

            function Cb(e) {
                return (Cb = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Pb(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Eb(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function Ob(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Ab(e, t, n) {
                return t && Ob(e.prototype, t), n && Ob(e, n), e
            }

            function Tb(e, t) {
                return !t || "object" !== Cb(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function kb(e) {
                return (kb = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Rb(e, t) {
                if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                e.prototype = Object.create(t && t.prototype, {
                    constructor: {
                        value: e,
                        writable: !0,
                        configurable: !0
                    }
                }), t && Ib(e, t)
            }

            function Ib(e, t) {
                return (Ib = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            Sb.formats = ["mol", "sdf"], Sb.extensions = [".mol", ".sdf"];
            var Mb = {
                    nstart: [bg, "i16", 0],
                    extent: [bg, "i16", 3],
                    grid: [bg, "i16", 6],
                    cellDims: [gg, "i16", 9],
                    angles: [bg, "i16", 12],
                    div: [_g, "i16", 15],
                    adder: [_g, "i16", 16],
                    scaleFactor: [_g, "i16", 17]
                },
                Nb = function(e) {
                    function t() {
                        return Eb(this, t), Tb(this, kb(t).apply(this, arguments))
                    }
                    return Rb(t, xg), Ab(t, [{
                        key: "_parseHeader",
                        value: function(e) {
                            this._buff = e, this._typedCheck();
                            var t = {};
                            if (t.i16 = new Int16Array(this._buff), 100 !== t.i16[18])
                                for (var n = 0, r = t.i16.length; n < r; ++n) {
                                    var o = t.i16[n];
                                    t.i16[n] = (255 & o) << 8 | o >> 8 & 255
                                }
                            if (100 !== t.i16[18]) throw new Error("DSN6: Incorrect format ");
                            var i = this._header;
                            this._fillHeader(Mb, t), i.cellDims.multiplyScalar(1 / i.scaleFactor), i.angles.forEach(function(e, t, n) {
                                n[t] *= Math.PI / 180 / i.scaleFactor
                            }), i.div /= 100
                        }
                    }, {
                        key: "_setAxisIndices",
                        value: function() {
                            this._xyz2crs[0] = 0, this._xyz2crs[1] = 1, this._xyz2crs[2] = 2
                        }
                    }, {
                        key: "_setOrigins",
                        value: function() {
                            var e = this._header,
                                t = Pb(this._getAxis(), 3),
                                n = t[0],
                                r = t[1],
                                o = t[2];
                            this._setAxisIndices(), this._origin.addScaledVector(n, e.nstart[0]), this._origin.addScaledVector(r, e.nstart[1]), this._origin.addScaledVector(o, e.nstart[2]), n.multiplyScalar(e.extent[0]), r.multiplyScalar(e.extent[1]), o.multiplyScalar(e.extent[2]), this._setBoxParams(n, r, o)
                        }
                    }, {
                        key: "_pointCalculate",
                        value: function(e, t, n, r, o, i, a) {
                            var s = this._header;
                            return o < s.extent[0] && r < s.extent[1] && n < s.extent[2] ? (e[o + s.extent[0] * (r + s.extent[1] * n)] = (t[i.counter] - s.adder) / s.div, ++i.counter, !0) : (i.counter += 8 - a, !1)
                        }
                    }, {
                        key: "_blockCalculate",
                        value: function(e, t, n, r, o, i) {
                            for (var a = 0; a < 8; ++a)
                                for (var s = 8 * n + a, l = 0; l < 8; ++l)
                                    for (var c = 8 * r + l, u = !0, p = 0; u && p < 8;) {
                                        var f = 8 * o + p;
                                        u = this._pointCalculate(e, t, s, c, f, i, p), p++
                                    }
                        }
                    }, {
                        key: "_toXYZData",
                        value: function() {
                            for (var e = this._header, t = new Uint8Array(this._buff), n = new Float32Array(e.extent[0] * e.extent[1] * e.extent[2]), r = new c.Vector3(e.extent[0] / 8, e.extent[1] / 8, e.extent[2] / 8), o = {
                                    counter: 512
                                }, i = 0; i < r.z; ++i)
                                for (var a = 0; a < r.y; ++a)
                                    for (var s = 0; s < r.x; ++s) this._blockCalculate(n, t, i, a, s, o);
                            return this._calculateInfoParams(n), n
                        }
                    }, {
                        key: "_calculateInfoParams",
                        value: function(e) {
                            this._header.dmean /= e.length;
                            for (var t = 0, n = e[0], r = e[0], o = 0; o < e.length; o++) t += Math.pow(this._header.dmean - e[o], 2), e[o] < n && (n = e[o]), e[o] > r && (r = e[o]);
                            this._header.sd = Math.sqrt(t / e.length), this._header.dmax = r, this._header.dmin = n
                        }
                    }]), t
                }(),
                Lb = function(e) {
                    function t(e, n) {
                        var r;
                        return Eb(this, t), (r = Tb(this, kb(t).call(this, e, n)))._options.fileType = "dsn6", r.model = new Nb, r
                    }
                    return Rb(t, Nv), Ab(t, [{
                        key: "parseSync",
                        value: function() {
                            return this.model.parse(this._data)
                        }
                    }], [{
                        key: "canParse",
                        value: function(e, t) {
                            return !!e && (e instanceof ArrayBuffer && Nv.checkDataTypeOptions(t, "dsn6"))
                        }
                    }, {
                        key: "canProbablyParse",
                        value: function(e) {
                            return !1
                        }
                    }]), t
                }();
            Lb.formats = ["dsn6"], Lb.extensions = [".dsn6", ".omap"], Lb.binary = !0;
            var jb = new Iv([i_, dg, H_, qg, g_, tb, Sb, Lg, Lb]);
            jb.all;

            function Db(e) {
                return (Db = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Vb(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }

            function Fb(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Bb(e, t) {
                return !t || "object" !== Db(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function zb(e) {
                return (zb = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Ub(e, t) {
                return (Ub = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Gb = function(e) {
                function t() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), Bb(this, zb(t).call(this, e, ["formats"]))
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Ub(e, t)
                }(t, no), n = t, (r = [{
                    key: "find",
                    value: function(e) {
                        var t = [];
                        return e.format && (t = this._dict.formats[e.format.toLowerCase()] || []), Vb(t)
                    }
                }]) && Fb(n.prototype, r), o && Fb(n, o), t
            }();

            function Hb(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Wb = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._source = t, this._options = n || {}, this._abort = !1
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "exportSync",
                    value: function() {
                        throw new Error("Exporting to this source is not implemented")
                    }
                }, {
                    key: "export",
                    value: function() {
                        var e = this;
                        return new Promise(function(t, n) {
                            setTimeout(function() {
                                try {
                                    return e._abort ? n(new Error("Export aborted")) : t(e.exportSync())
                                } catch (e) {
                                    return n(e)
                                }
                            })
                        })
                    }
                }, {
                    key: "abort",
                    value: function() {
                        this._abort = !0
                    }
                }]) && Hb(t.prototype, n), r && Hb(t, r), e
            }();

            function qb(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            ro(Wb.prototype);
            var Yb = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._resultArray = [], this._currentStr = -1, this._tag = null, this._fixedNumeration = !1, this._numeration = !1, this._tagStrNum = 0
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "getResult",
                    value: function() {
                        return this.writeString("\n", 81, 81), this._resultArray.join("")
                    }
                }, {
                    key: "_currentStrLength",
                    value: function() {
                        var e = this._resultArray[this._currentStr];
                        return e ? e.length : 0
                    }
                }, {
                    key: "newTag",
                    value: function(e, t) {
                        this._tag = e || null, l.a.isUndefined(t) ? (this._numeration = !1, this._fixedNumeration = !1, this._tagStrNum = 0) : l.a.isNumber(t) ? (this._tagStrNum = t, this._numeration = !0, this._fixedNumeration = !0) : l.a.isBoolean(t) && (this._tagStrNum = 0, this._numeration = t, this._fixedNumeration = !1)
                    }
                }, {
                    key: "newString",
                    value: function(e) {
                        this.writeString("\n", 81, 81), this._currentStr++, this._resultArray.push(""), e ? this.writeString(e, 1, 6) : this._tag && this.writeString(this._tag, 1, 6), this._numeration && (this._fixedNumeration || this._tagStrNum++, 1 !== this._tagStrNum && this.writeString(this._tagStrNum.toString(), 10, 8))
                    }
                }, {
                    key: "writeEntireString",
                    value: function(e, t, n) {
                        t || (t = 81);
                        for (var r = 0; r < e.length; r++) this._currentStrLength() === t && r !== e.length - 1 && (this.newString(), n && this.writeString(n.tag, n.begin, n.end)), "\n" === e[r] ? this.newString() : this.writeString(e[r])
                    }
                }, {
                    key: "writeString",
                    value: function(e, t, n) {
                        var r, o = this._resultArray[this._currentStr],
                            i = o ? o.length : 0;
                        if (!l.a.isUndefined(e)) {
                            l.a.isNumber(t) || (t = i + 1), l.a.isNumber(n) || (n = i + e.length);
                            var a = t < n ? n : t,
                                s = t < n ? t : n;
                            if ((r = l.a.isString(e) ? e : e.toString()).length > Math.abs(t - n) + 1 && (r = r.substr(0, Math.abs(t - n + 1))), s > i + 1) this._resultArray[this._currentStr] += " ".repeat(s - i - 1);
                            else if (s <= i) {
                                var c = this._resultArray[this._currentStr];
                                this._resultArray[this._currentStr] = c.slice(0, s - 1)
                            }
                            if (n < t) r = " ".repeat(t - n + 1 - r.length) + r;
                            11 === s && this._numeration && 1 !== this._tagStrNum && (r = " ".concat(r)), this._resultArray[this._currentStr] += r, a > (o = this._resultArray[this._currentStr]).length && (this._resultArray[this._currentStr] += " ".repeat(a - o.length))
                        }
                    }
                }, {
                    key: "writeBondsArray",
                    value: function(e, t) {
                        for (var n = this._getSubArrays(e, 4), r = 0; r < n.length; r++) {
                            this.newString(), this.writeString(t._serial, 11, 7);
                            for (var o = 0; o < n[r].length; o++) {
                                var i = n[r][o]._left._serial === t._serial ? n[r][o]._right._serial : n[r][o]._left._serial;
                                this.writeString(i, 16 + 5 * o, 12 + 5 * o)
                            }
                        }
                    }
                }, {
                    key: "_getSubArrays",
                    value: function(e, t) {
                        for (var n = [], r = 0; r < e.length; r += t) n.push(e.slice(r, r + t));
                        return n
                    }
                }, {
                    key: "writeMatrix",
                    value: function(e, t, n) {
                        for (var r = 0; r < 3; r++) {
                            this.newString(), this.writeString(n, 14, 18), this.writeString((r + 1).toString(), 19, 19), this.writeString(t.toString(), 23, 20);
                            for (var o = 0; o < 3; o++) {
                                var i = parseFloat(e.elements[4 * r + o]).toFixed(6);
                                this.writeString(i.toString(), 33 + 10 * o, 24 + 10 * o)
                            }
                            var a = parseFloat(e.elements[4 * r + 3]).toFixed(5);
                            this.writeString(a.toString(), 68, 55)
                        }
                    }
                }, {
                    key: "writeMatrices",
                    value: function(e, t) {
                        if (e)
                            for (var n = new c.Matrix4, r = 0; r < e.length; r++) n.copy(e[r]).transpose(), this.writeMatrix(n, r + 1, t)
                    }
                }]) && qb(t.prototype, n), r && qb(t, r), e
            }();

            function Xb(e) {
                return (Xb = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function $b(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Kb(e, t) {
                return !t || "object" !== Xb(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Zb(e) {
                return (Zb = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Qb(e, t) {
                return (Qb = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Jb = function(e) {
                function t(e, n) {
                    var r;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (r = Kb(this, Zb(t).call(this, e, n)))._tags = ["HEADER", "TITLE", "COMPND", "REMARK", "HELIX", "SHEET", "ATOM and HETATM", "CONECT"], r._result = null, r._tagExtractors = {
                        HEADER: r._extractHEADER,
                        TITLE: r._extractTITLE,
                        "ATOM and HETATM": r._extractATOM,
                        CONECT: r._extractCONECT,
                        COMPND: r._extractCOMPND,
                        REMARK: r._extractREMARK,
                        HELIX: r._extractHELIX,
                        SHEET: r._extractSHEET
                    }, r._stringForRemark350 = "COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN\nBIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE\nMOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS\nGIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND\nCRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.", r._stringForRemark290 = "CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS\nTHE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM\nRECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY\nRELATED MOLECULES.", r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Qb(e, t)
                }(t, Wb), n = t, (r = [{
                    key: "exportSync",
                    value: function() {
                        var e = new Yb;
                        if (!this._source) return this._result;
                        for (var t = 0; t < this._tags.length; t++) {
                            var n = this._tags[t],
                                r = this._tagExtractors[n];
                            l.a.isFunction(r) && r.call(this, e)
                        }
                        return this._result = e.getResult(), this._result
                    }
                }, {
                    key: "_extractHEADER",
                    value: function(e) {
                        if (this._source.metadata) {
                            var t = this._source.metadata;
                            e.newTag("HEADER"), e.newString(), t.classification && e.writeString(t.classification, 11, 50), t.date && e.writeString(t.date, 51, 59), t.id && e.writeString(t.id, 63, 66)
                        }
                    }
                }, {
                    key: "_extractTITLE",
                    value: function(e) {
                        if (this._source.metadata) {
                            var t = this._source.metadata;
                            if (t.title) {
                                e.newTag("TITLE", !0);
                                for (var n = 0; n < t.title.length; n++) e.newString(), e.writeString(t.title[n], 11, 80)
                            }
                        }
                    }
                }, {
                    key: "_extractCONECT",
                    value: function(e) {
                        if (this._source._atoms) {
                            var t = this._source._atoms;
                            e.newTag("CONECT");
                            for (var n = 0; n < t.length; n++) {
                                var r = t[n]._bonds.filter(function(e) {
                                    return e._fixed
                                });
                                0 !== r.length && e.writeBondsArray(r.reverse(), t[n])
                            }
                        }
                    }
                }, {
                    key: "_extractSHEET",
                    value: function(e) {
                        if (this._source._sheets) {
                            e.newTag("SHEET");
                            for (var t = this._source._sheets, n = 0; n < t.length; n++)
                                if (t[n]._strands)
                                    for (var r = t[n]._strands, o = 0; o < r.length; o++) e.newString(), e.writeString(o + 1, 10, 8), e.writeString(t[n]._name, 14, 12), e.writeString(r.length, 16, 15), e.writeString(r[o].init._type._name, 18, 20), e.writeString(r[o].init._chain._name, 22, 22), e.writeString(r[o].init._sequence, 26, 23), e.writeString(r[o].init._icode, 27, 27), e.writeString(r[o].term._type._name, 29, 31), e.writeString(r[o].init._chain._name, 33, 33), e.writeString(r[o].term._sequence, 37, 34), e.writeString(r[o].term._icode, 38, 38), e.writeString(r[o].sense, 40, 39)
                        }
                    }
                }, {
                    key: "_extractHELIX",
                    value: function(e) {
                        if (this._source._helices) {
                            e.newTag("HELIX");
                            for (var t = this._source._helices, n = 0; n < t.length; n++) {
                                var r = t[n],
                                    o = l.a.invert(lt);
                                e.newString(), e.writeString(r.serial, 10, 8), e.writeString(r.name, 14, 12), e.writeString(r.init._type._name, 16, 18), e.writeString(r.init._chain._name, 20, 20), e.writeString(r.init._sequence, 25, 22), e.writeString(r.init._icode, 26, 26), e.writeString(r.term._type._name, 28, 30), e.writeString(r.term._chain._name, 32, 32), e.writeString(r.term._sequence, 37, 34), e.writeString(r.term._icode, 38, 38), e.writeString(o[r.type], 40, 39), e.writeString(r.comment, 41, 70), e.writeString(r.length, 76, 72)
                            }
                        }
                    }
                }, {
                    key: "_extractATOM",
                    value: function(e) {
                        if (this._source._atoms)
                            for (var t = this._source._atoms, n = 0; n < t.length; n++) {
                                var r = t[n]._het ? "HETATM" : "ATOM";
                                e.newString(r);
                                var o = t[n].element.name.length > 1 || t[n]._name._name.length > 3 ? 13 : 14;
                                e.writeString(t[n]._serial, 11, 7), e.writeString(t[n]._name._name, o, 16), e.writeString(String.fromCharCode(t[n]._location), 17, 17), e.writeString(t[n]._residue._type._name, 20, 18), e.writeString(t[n]._residue._chain._name, 22, 22), e.writeString(t[n]._residue._sequence, 26, 23), e.writeString(t[n]._residue._icode, 27, 27), e.writeString(t[n]._position.x.toFixed(3), 38, 31), e.writeString(t[n]._position.y.toFixed(3), 46, 39), e.writeString(t[n]._position.z.toFixed(3), 54, 47), e.writeString(t[n]._occupancy.toFixed(2), 60, 55), e.writeString(t[n]._temperature.toFixed(2), 66, 61), e.writeString(t[n].element.name, 78, 77), t[n]._charge && e.writeString(t[n]._charge, 79, 80)
                            }
                    }
                }, {
                    key: "_extractCOMPND",
                    value: function(e) {
                        if (this._source._molecules) {
                            var t = this._source._molecules;
                            e.newTag("COMPND", !0);
                            for (var n = 0; n < t.length; n++) {
                                var r = this._getMoleculeChains(t[n]);
                                e.newString(), e.writeString("MOL_ID: ".concat(t[n]._index, ";"), 11, 80), e.newString(), e.writeString("MOLECULE: ".concat(t[n]._name, ";"), 11, 80), e.newString(), e.writeString("CHAIN: ", 11, 18);
                                var o = "".concat(r.join(", "), ";");
                                e.writeEntireString(o, 81)
                            }
                        }
                    }
                }, {
                    key: "_extractREMARK",
                    value: function(e) {
                        this._Remark290(e), this._Remark350(e)
                    }
                }, {
                    key: "_Remark290",
                    value: function(e) {
                        if (this._source.symmetry && 0 !== this._source.symmetry.length) {
                            var t = this._source.symmetry;
                            e.newTag("REMARK", 290), e.newString(), e.newString(), e.writeEntireString(this._stringForRemark290), e.writeMatrices(t, "SMTRY"), e.newString(), e.newString(), e.writeString("REMARK: NULL", 11, 80)
                        }
                    }
                }, {
                    key: "_Remark350",
                    value: function(e) {
                        if (this._source.units) {
                            var t = this._source.units,
                                n = 0;
                            e.newTag("REMARK", 350), e.newString(), e.newString(), e.writeEntireString(this._stringForRemark350);
                            for (var r = t.filter(function(e) {
                                    return e instanceof rn
                                }), o = 0; o < r.length; o++) {
                                e.newString(), e.newString(), n++, e.writeString("BIOMOLECULE: ".concat(n), 11, 80);
                                var i = r[o].chains.join(", ");
                                e.newString(), e.writeString("APPLY THE FOLLOWING TO CHAINS: "), e.writeEntireString(i, 69, {
                                    tag: "AND CHAINS: ",
                                    begin: 31,
                                    end: 42
                                });
                                var a = r[o].matrices;
                                e.writeMatrices(a, "BIOMT")
                            }
                        }
                    }
                }, {
                    key: "_getMoleculeChains",
                    value: function(e) {
                        var t = e._residues.map(function(e) {
                            return e._chain._name
                        });
                        return t.filter(function(e, n) {
                            return t.indexOf(e) === n
                        })
                    }
                }]) && $b(n.prototype, r), o && $b(n, o), t
            }();
            Jb.formats = ["pdb"];
            var ew = {
                loaders: Pv,
                parsers: jb,
                exporters: new Gb([Jb])
            };

            function tw(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var nw = new c.Color,
                rw = function() {
                    function e() {
                        ! function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this._width = 0, this._height = 0, this._widthHalf = 0, this._heightHalf = 0, this._vector = new c.Vector3, this._viewMatrix = new c.Matrix4, this._projectionMatrix = new c.Matrix4, this._domElement = document.createElement("div"), this._domElement.style.overflow = "hidden", this._domElement.style.position = "absolute", this._domElement.style.top = "0", this._domElement.style.zIndex = "0", this._domElement.style.pointerEvents = "none"
                    }
                    var t, n, r;
                    return t = e, (n = [{
                        key: "getElement",
                        value: function() {
                            return this._domElement
                        }
                    }, {
                        key: "reset",
                        value: function() {
                            for (var e = this.getElement(); e.firstChild;) e.removeChild(e.firstChild)
                        }
                    }, {
                        key: "setSize",
                        value: function(e, t) {
                            this._width = e, this._height = t, this._widthHalf = this._width / 2, this._heightHalf = this._height / 2, this._domElement.style.width = "".concat(e, "px"), this._domElement.style.height = "".concat(t, "px")
                        }
                    }, {
                        key: "_renderObject",
                        value: function(e, t, n) {
                            function r(e, t, n) {
                                return nw.setHex(e), nw.lerp(t, n), "#".concat(nw.getHexString())
                            }

                            function o(e) {
                                return nw.setHex(e), "#".concat(nw.getHexString())
                            }
                            if (e instanceof gr) {
                                if (this._vector.setFromMatrixPosition(e.matrixWorld), void 0 !== e.userData && void 0 !== e.userData.offset) {
                                    var i = new c.Vector3(e.userData.offset.x, e.userData.offset.y, 0);
                                    this._vector.add(i.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis()))
                                }
                                this._vector.applyMatrix4(this._viewMatrix);
                                var a = this._vector.z > -t.near ? "hidden" : "visible",
                                    s = 1e4 * (t.far - -this._vector.z) / (t.far - t.near),
                                    l = e.getElement();
                                if (void 0 === n.fog) l.style.color = o(e.userData.color), "transparent" !== e.userData.background && (l.style.background = o(e.userData.background));
                                else {
                                    var u = c.Math.smoothstep(-this._vector.z, n.fog.near, n.fog.far);
                                    l.style.color = r(e.userData.color, n.fog.color, u), "transparent" !== e.userData.background && (l.style.background = r(e.userData.background, n.fog.color, u))
                                }
                                this._vector.applyMatrix4(this._projectionMatrix);
                                var p = "".concat(e.userData !== {} ? e.userData.translation : "translate(-50%, -50%) ", "translate(").concat(this._vector.x * this._widthHalf + this._widthHalf, "px,").concat(-this._vector.y * this._heightHalf + this._heightHalf, "px)");
                                l.style.visibility = a, l.style.WebkitTransform = p, l.style.MozTransform = p, l.style.oTransform = p, l.style.transform = p, l.style.zIndex = Number(s).toFixed(0), l.parentNode !== this._domElement && this._domElement.appendChild(l)
                            }
                            for (var f = 0, h = e.children.length; f < h; f++) this._renderObject(e.children[f], t, n)
                        }
                    }, {
                        key: "render",
                        value: function(e, t) {
                            e.updateMatrixWorld(), null === t.parent && t.updateMatrixWorld(), t.matrixWorldInverse.getInverse(t.matrixWorld), this._viewMatrix.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)), this._projectionMatrix.copy(t.projectionMatrix), this._renderObject(e, t, e)
                        }
                    }]) && tw(t.prototype, n), r && tw(t, r), e
                }();

            function ow(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }
            var iw = {
                NONE: -1,
                ROTATE: 0,
                TRANSLATE: 1,
                SCALE_PAN: 2,
                TRANSLATE_PIVOT: 3
            };

            function aw(e, t, n, r) {
                this.objects = e;
                var o = ow(e, 1);
                this.object = o[0], this.camera = t, this.pivot = n, this.axis = new c.Vector3(0, 0, 1), this.options = r, this.lastRotation = {
                    axis: new c.Vector3,
                    angle: 0
                }
            }

            function sw(e, t, n, r, o) {
                h.call(this);
                var i = this;
                this.object = e, this.objectPivot = t, this.camera = n, this.domElement = void 0 !== r ? r : document, this.getAltObj = o, this.enabled = !0, this.hotkeysEnabled = !0, this.screen = {
                    left: 0,
                    top: 0,
                    width: 0,
                    height: 0
                }, this.options = {
                    rotateFactor: Math.PI,
                    axisRotateFactor: 4 * Math.PI,
                    intertia: !0,
                    dynamicDampingFactor: .1,
                    intertiaThreshold: .001
                }, this._state = iw.NONE, this._mousePrevPos = new c.Vector2, this._mouseCurPos = new c.Vector2, this._originalCameraPos = new c.Vector3, this._mainObj = new aw([this.object], this.camera, new c.Vector3(0, 0, 0), this.options), this._altObj = new aw([this.object], this.camera, new c.Vector3(0, 0, 0), this.options), this._affectedObj = this._mainObj, this._isAltObjFreeRotationAllowed = !0, this._isTranslationAllowed = !0, this._isKeysTranslatingObj = !1, this._pressedKeys = [], this._clock = new R.Timer, this._clock.start(), this._lastUpdateTime = this._clock.getElapsedTime(), this._listeners = [{
                    obj: i.domElement,
                    type: "mousedown",
                    handler: function(e) {
                        i.mousedown(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "mouseup",
                    handler: function(e) {
                        i.mouseup(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "mousemove",
                    handler: function(e) {
                        i.mousemove(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "mousewheel",
                    handler: function(e) {
                        i.mousewheel(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "DOMMouseScroll",
                    handler: function(e) {
                        i.mousewheel(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "mouseout",
                    handler: function(e) {
                        i.mouseup(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "touchstart",
                    handler: function(e) {
                        i.touchstartend(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "touchend",
                    handler: function(e) {
                        i.touchstartend(e)
                    }
                }, {
                    obj: i.domElement,
                    type: "touchmove",
                    handler: function(e) {
                        i.touchmove(e)
                    }
                }, {
                    obj: i.getKeyBindObject(),
                    type: "keydown",
                    handler: function(e) {
                        i.keydownup(e)
                    }
                }, {
                    obj: i.getKeyBindObject(),
                    type: "keyup",
                    handler: function(e) {
                        i.keydownup(e)
                    }
                }, {
                    obj: window,
                    type: "resize",
                    handler: function() {
                        i.handleResize()
                    }
                }, {
                    obj: window,
                    type: "blur",
                    handler: function() {
                        i.resetKeys()
                    }
                }, {
                    obj: i.domElement,
                    type: "contextmenu",
                    handler: function(e) {
                        i.contextmenu(e)
                    }
                }];
                for (var a = 0; a < this._listeners.length; a++) {
                    var s = this._listeners[a];
                    s.obj.addEventListener(s.type, s.handler)
                }
                this.handleResize(), this.resetKeys(), this.update()
            }
            aw.prototype._rotate = function(e) {
                var t = 0 === this.pivot.x && 0 === this.pivot.y && 0 === this.pivot.z,
                    n = this.object.matrix.clone();
                t ? n.multiply((new c.Matrix4).makeRotationFromQuaternion(e)) : (n.multiply((new c.Matrix4).makeTranslation(this.pivot.x, this.pivot.y, this.pivot.z)), n.multiply((new c.Matrix4).makeRotationFromQuaternion(e)), n.multiply((new c.Matrix4).makeTranslation(-this.pivot.x, -this.pivot.y, -this.pivot.z)));
                var r = new c.Vector3,
                    o = new c.Quaternion,
                    i = new c.Vector3;
                if (n.decompose(r, o, i), !t)
                    for (var a = 0; a < this.objects.length; ++a) this.objects[a].position.copy(r);
                for (var s = 0; s < this.objects.length; ++s) this.objects[s].quaternion.copy(o), this.objects[s].updateMatrix()
            }, aw.prototype.setObjects = function(e) {
                this.objects = e;
                var t = ow(e, 1);
                this.object = t[0]
            }, aw.prototype.rotate = function(e, t, n) {
                var r = this.mouse2rotation(e, t, n);
                r.angle && this._rotate((new c.Quaternion).setFromAxisAngle(r.axis, r.angle)), this.lastRotation = r
            }, aw.prototype.translate = function(e) {
                var t = new c.Vector3(e.x / this.camera.projectionMatrix.elements[0], e.y / this.camera.projectionMatrix.elements[5], 0),
                    n = t.length();
                t.normalize();
                var r = (new c.Matrix4).getInverse(this.object.matrixWorld);
                t.transformDirection(r);
                var o = this.pivot.clone();
                this.object.localToWorld(o), n *= Math.abs(o.z - this.camera.position.z), n /= this.object.matrixWorld.getMaxScaleOnAxis();
                for (var i = 0; i < this.objects.length; ++i) this.objects[i].translateOnAxis(t, n)
            }, aw.prototype.update = function(e, t) {
                if (0 !== H.now.autoRotation) {
                    var n;
                    if (H.now.autoRotationAxisFixed || 0 === this.lastRotation.axis.length()) {
                        var r = (new c.Matrix4).getInverse(this.object.matrixWorld);
                        n = new c.Vector3(0, 1, 0).transformDirection(r)
                    } else n = this.lastRotation.axis;
                    return this._rotate((new c.Quaternion).setFromAxisAngle(n, H.now.autoRotation * e)), !0
                }
                if (this.options.intertia && this.lastRotation.angle) {
                    var o = this.lastRotation.angle * Math.pow(1 - this.options.dynamicDampingFactor, 40 * t);
                    if (!(Math.abs(o) <= this.options.intertiaThreshold)) return this._rotate((new c.Quaternion).setFromAxisAngle(this.lastRotation.axis, o)), !0;
                    this.lastRotation.angle = 0
                }
                return !1
            }, aw.prototype.stop = function() {
                this.lastRotation.angle = 0
            }, aw.prototype.mouse2rotation = function(e, t, n) {
                var r = {
                    axis: new c.Vector3,
                    angle: 0
                };
                if (n) r.axis.copy(this.axis), r.angle = this.options.axisRotateFactor * (t.y - e.y);
                else {
                    var o = t.clone().sub(e),
                        i = o.length();
                    if (0 === i) return r;
                    var a = this.pivot.clone();
                    this.object.localToWorld(a);
                    var s = (new c.Vector3).subVectors(this.camera.position, a),
                        l = s.clone().normalize(),
                        u = this.camera.up.clone().normalize(),
                        p = (new c.Vector3).crossVectors(u, l).normalize();
                    u.setLength(o.y), p.setLength(o.x);
                    var f = (new c.Vector3).copy(u.add(p));
                    r.axis.crossVectors(f, s), r.angle = -i * this.options.rotateFactor
                }
                var h = (new c.Matrix4).getInverse(this.object.matrixWorld);
                return r.axis.transformDirection(h), r.angle < 0 && (r.axis.negate(), r.angle = -r.angle), r
            }, sw.prototype = Object.create(h.prototype), sw.prototype.constructor = sw, sw.prototype.resetKeys = function() {
                this._pressedKeys[37] = !1, this._pressedKeys[38] = !1, this._pressedKeys[39] = !1, this._pressedKeys[40] = !1
            }, sw.prototype.contextmenu = function(e) {
                e.stopPropagation(), e.preventDefault()
            }, sw.prototype.handleResize = function() {
                if (this.domElement === document) this.screen.left = 0, this.screen.top = 0, this.screen.width = window.innerWidth, this.screen.height = window.innerHeight;
                else {
                    var e = this.domElement.getBoundingClientRect(),
                        t = this.domElement.ownerDocument.documentElement;
                    this.screen.left = e.left + window.pageXOffset - t.clientLeft, this.screen.top = e.top + window.pageYOffset - t.clientTop, this.screen.width = e.width, this.screen.height = e.height
                }
            }, sw.prototype.enable = function(e) {
                this.enabled = e
            }, sw.prototype.enableHotkeys = function(e) {
                this.hotkeysEnabled = e
            }, sw.prototype.allowTranslation = function(e) {
                this._isTranslationAllowed = e
            }, sw.prototype.allowAltObjFreeRotation = function(e) {
                this._isAltObjFreeRotationAllowed = e
            }, sw.prototype.keysTranslateObj = function(e) {
                this._isKeysTranslatingObj = e
            }, sw.prototype.isEditingAltObj = function() {
                return (this._state === iw.ROTATE || this._state === iw.TRANSLATE) && this._affectedObj === this._altObj
            }, sw.prototype.getMouseOnCircle = function(e, t) {
                var n = Math.min(this.screen.width, this.screen.height);
                return 0 === n ? new c.Vector2(0, 0) : new c.Vector2((e - .5 * this.screen.width - this.screen.left) / n, (.5 * this.screen.height + this.screen.top - t) / n)
            }, sw.prototype.getMouseViewport = function(e, t) {
                return 0 === this.screen.width || 0 === this.screen.height ? new c.Vector2(0, 0) : new c.Vector2(2 * (e - .5 * this.screen.width - this.screen.left) / this.screen.width, 2 * (.5 * this.screen.height + this.screen.top - t) / this.screen.height)
            }, sw.prototype.stop = function() {
                this._mainObj.stop(), this._altObj.stop()
            }, sw.prototype.rotateByMouse = function(e) {
                this._affectedObj.rotate(this._mousePrevPos, this._mouseCurPos, e), this.dispatchEvent({
                    type: "change",
                    action: "rotate",
                    angle: this._affectedObj.lastRotation.angle
                })
            }, sw.prototype.rotate = function(e) {
                this.object.quaternion.multiply(e)
            }, sw.prototype.getOrientation = function() {
                return this.object.quaternion
            }, sw.prototype.setOrientation = function(e) {
                this.object.quaternion.copy(e)
            }, sw.prototype.translate = function() {
                var e = this._mouseCurPos.clone();
                e.sub(this._mousePrevPos), this._affectedObj.translate(e), this.dispatchEvent({
                    type: "change",
                    action: "translate"
                })
            }, sw.prototype.getScale = function() {
                return this.object.scale.x
            }, sw.prototype.setScale = function(e) {
                this.object.scale.set(e, e, e)
            }, sw.prototype.scale = function(e) {
                e <= 0 || this.setScale(this.object.scale.x * e)
            }, sw.prototype.update = function() {
                var e = this._clock.getElapsedTime(),
                    t = e - this._lastUpdateTime;
                if (this._state === iw.NONE) {
                    var n = e - this._lastMouseMoveTime;
                    (this._mainObj.update(t, n) || this._altObj.update(t, n)) && this.dispatchEvent({
                        type: "change",
                        action: "auto"
                    })
                }
                if (H.now.panning || this._isKeysTranslatingObj) {
                    var r = Number(this._pressedKeys[39]) - Number(this._pressedKeys[37]),
                        o = Number(this._pressedKeys[38]) - Number(this._pressedKeys[40]);
                    if (0 !== r || 0 !== o) {
                        var i = t;
                        if (this._isKeysTranslatingObj) {
                            var a = this.getAltObj();
                            a.objects.length > 0 && (this._altObj.setObjects(a.objects), this._altObj.pivot = a.pivot, "axis" in a ? this._altObj.axis = a.axis.clone() : this._altObj.axis.set(0, 0, 1), this._altObj.translate(new c.Vector2(i * r, i * o)), this.dispatchEvent({
                                type: "change",
                                action: "translate"
                            }))
                        } else i *= 10 * (H.now.inversePanning ? -1 : 1), this.camera.translateX(i * r), this.camera.translateY(i * o), this.dispatchEvent({
                            type: "change",
                            action: "pan"
                        })
                    }
                }
                this._lastUpdateTime = e
            }, sw.prototype.reset = function() {
                this._state = iw.NONE, this.object.quaternion.copy(new c.Quaternion(0, 0, 0, 1))
            }, sw.prototype.mousedown = function(e) {
                if (!1 !== this.enabled && this._state === iw.NONE) {
                    if (e.preventDefault(), e.stopPropagation(), this._state === iw.NONE)
                        if (0 === e.button) {
                            this._affectedObj.stop();
                            var t = !1;
                            if (e.altKey) {
                                var n = this.getAltObj();
                                (t = n.objects.length > 0) && (this._altObj.setObjects(n.objects), this._altObj.pivot = n.pivot, "axis" in n ? this._altObj.axis = n.axis.clone() : this._altObj.axis.set(0, 0, 1))
                            }
                            this._affectedObj = t ? this._altObj : this._mainObj, this._state = t && e.ctrlKey && this._isTranslationAllowed ? iw.TRANSLATE : iw.ROTATE
                        } else 2 === e.button && (this._state = iw.TRANSLATE_PIVOT);
                    this._state === iw.ROTATE && (this._mouseCurPos.copy(this.getMouseOnCircle(e.pageX, e.pageY)), this._mousePrevPos.copy(this._mouseCurPos)), this._state !== iw.TRANSLATE && this._state !== iw.TRANSLATE_PIVOT || (this._mouseCurPos.copy(this.getMouseViewport(e.pageX, e.pageY)), this._mousePrevPos.copy(this._mouseCurPos))
                }
            }, sw.prototype.mousemove = function(e) {
                if (!1 !== this.enabled && this._state !== iw.NONE) switch (e.preventDefault(), e.stopPropagation(), this._state) {
                    case iw.ROTATE:
                        this._mousePrevPos.copy(this._mouseCurPos), this._mouseCurPos.copy(this.getMouseOnCircle(e.pageX, e.pageY)), this.rotateByMouse(e.altKey && !this._isAltObjFreeRotationAllowed || e.shiftKey), this._lastMouseMoveTime = this._clock.getElapsedTime();
                        break;
                    case iw.TRANSLATE:
                        this._mousePrevPos.copy(this._mouseCurPos), this._mouseCurPos.copy(this.getMouseViewport(e.pageX, e.pageY)), this.translate();
                        break;
                    case iw.TRANSLATE_PIVOT:
                        this._mousePrevPos.copy(this._mouseCurPos), this._mouseCurPos.copy(this.getMouseViewport(e.pageX, e.pageY)), this.translatePivotByMouse()
                }
            }, sw.prototype.mousewheel = function(e) {
                if (!1 !== this.enabled && H.now.zooming && this._state === iw.NONE && !e.shiftKey) {
                    e.preventDefault();
                    var t = 0;
                    e.wheelDelta ? t = e.wheelDelta / 40 : e.detail && (t = -e.detail / 3);
                    var n = 1 + .05 * t;
                    n = Math.max(n, .01), this.scale(n), this.dispatchEvent({
                        type: "change",
                        action: "zoom",
                        factor: n
                    })
                }
            }, sw.prototype.mouseup = function(e) {
                !1 !== this.enabled && this._state !== iw.NONE && (e.preventDefault(), e.stopPropagation(), this._state = iw.NONE, this._clock.getElapsedTime() - this._lastMouseMoveTime > .1 && this._affectedObj.stop())
            }, sw.prototype.touchstartend = function(e) {
                if (!1 !== this.enabled) switch (e.preventDefault(), e.stopPropagation(), e.touches.length) {
                    case 1:
                        this._state = iw.ROTATE, this._mouseCurPos.copy(this.getMouseOnCircle(e.touches[0].pageX, e.touches[0].pageY)), this._mousePrevPos.copy(this._mouseCurPos);
                        break;
                    case 2:
                        this._mainObj.stop(), this._altObj.stop(), this._state = iw.SCALE_PAN;
                        var t = e.touches[0].pageX - e.touches[1].pageX,
                            n = e.touches[0].pageY - e.touches[1].pageY;
                        this._touchDistanceCur = this._touchDistanceStart = Math.sqrt(t * t + n * n), this._scaleStart = this.object.scale.x, this._originalPinchCenter = new c.Vector2(.5 * (e.touches[0].pageX + e.touches[1].pageX), .5 * (e.touches[0].pageY + e.touches[1].pageY)), this._originalCameraPos.copy(this.camera.position);
                        break;
                    default:
                        this._state = iw.NONE
                }
            }, sw.prototype.touchmove = function(e) {
                if (!1 !== this.enabled && this._state !== iw.NONE) switch (e.preventDefault(), e.stopPropagation(), this._state) {
                    case iw.ROTATE:
                        this._mousePrevPos.copy(this._mouseCurPos), this._mouseCurPos.copy(this.getMouseOnCircle(e.touches[0].pageX, e.touches[0].pageY)), this.rotateByMouse(!1), this._lastMouseMoveTime = this._clock.getElapsedTime();
                        break;
                    case iw.SCALE_PAN:
                        if (H.now.zooming) {
                            var t = e.touches[0].pageX - e.touches[1].pageX,
                                n = e.touches[0].pageY - e.touches[1].pageY;
                            this._touchDistanceCur = Math.sqrt(t * t + n * n);
                            var r = this.object.scale.x,
                                o = this._scaleStart * this._touchDistanceCur / this._touchDistanceStart;
                            this.setScale(o), this.dispatchEvent({
                                type: "change",
                                action: "zoom",
                                factor: 0 === r ? 1 : o / r
                            })
                        }
                        if (H.now.panning) {
                            var i = new c.Vector2(.5 * (e.touches[0].pageX + e.touches[1].pageX), .5 * (e.touches[0].pageY + e.touches[1].pageY));
                            i.sub(this._originalPinchCenter), this.camera.position.x = this._originalCameraPos.x - .1 * i.x, this.camera.position.y = this._originalCameraPos.y + .1 * i.y, this.dispatchEvent({
                                type: "change",
                                action: "pan"
                            })
                        }
                }
            }, sw.prototype.keydownup = function(e) {
                if (!1 !== this.enabled && !1 !== this.hotkeysEnabled) switch (e.keyCode) {
                    case 37:
                    case 38:
                    case 39:
                    case 40:
                        this._pressedKeys[e.keyCode] = "keydown" === e.type, e.preventDefault(), e.stopPropagation()
                }
            }, sw.prototype.getKeyBindObject = function() {
                return window.top
            }, sw.prototype.dispose = function() {
                for (var e = 0; e < this._listeners.length; e++) {
                    var t = this._listeners[e];
                    t.obj.removeEventListener(t.type, t.handler)
                }
            }, sw.prototype.translatePivotByMouse = function() {
                var e = this._mouseCurPos.clone();
                e.sub(this._mousePrevPos), this.translatePivotInWorld(H.now.translationSpeed * e.x, H.now.translationSpeed * e.y, 0)
            }, sw.prototype.translatePivotInWorld = function(e, t, n) {
                var r = this.objectPivot.position;
                r.applyMatrix4(this.object.matrixWorld), r.setX(r.x + e), r.setY(r.y + t), r.setZ(r.z + n);
                var o = (new c.Matrix4).getInverse(this.object.matrixWorld);
                r.applyMatrix4(o), this.dispatchEvent({
                    type: "change"
                })
            }, sw.prototype.translatePivot = function(e, t, n) {
                var r = this.objectPivot.position;
                r.setX(r.x + e), r.setY(r.y + t), r.setZ(r.z + n), this.dispatchEvent({
                    type: "change"
                })
            };
            var lw = sw;

            function cw(e, t, n) {
                h.call(this);
                var r = this;
                this.gfxObj = e, this.camera = t, this.domElement = void 0 !== n ? n : document, this.screen = {
                    left: 0,
                    top: 0,
                    width: 0,
                    height: 0
                }, this._lastMousePos = new c.Vector2(0, 0), this._mouseTotalDist = 0, this._lastClickBeginTime = -1e3, this._lastClickPos = new c.Vector2(0, 0), this._clickBeginTime = 0, this._clock = new R.Timer, this._clock.start(), this._listeners = [{
                    obj: r.domElement,
                    type: "mousedown",
                    handler: function(e) {
                        r.mousedown(e)
                    }
                }, {
                    obj: r.domElement,
                    type: "mouseup",
                    handler: function(e) {
                        r.mouseup(e)
                    }
                }, {
                    obj: r.domElement,
                    type: "mousemove",
                    handler: function(e) {
                        r.mousemove(e)
                    }
                }, {
                    obj: r.domElement,
                    type: "touchstart",
                    handler: function(e) {
                        r.touchstart(e)
                    }
                }, {
                    obj: r.domElement,
                    type: "touchend",
                    handler: function(e) {
                        r.touchend(e)
                    }
                }, {
                    obj: window,
                    type: "resize",
                    handler: function() {
                        r.handleResize()
                    }
                }];
                for (var o = 0; o < this._listeners.length; o++) {
                    var i = this._listeners[o];
                    i.obj.addEventListener(i.type, i.handler)
                }
                this.handleResize()
            }
            cw.prototype = Object.create(h.prototype), cw.prototype.constructor = cw, cw.prototype.reset = function() {
                this.picked = {}, this.dispatchEvent({
                    type: "newpick",
                    obj: {}
                })
            }, cw.prototype.handleResize = function() {
                if (this.domElement === document) this.screen.left = 0, this.screen.top = 0, this.screen.width = window.innerWidth, this.screen.height = window.innerHeight;
                else {
                    var e = this.domElement.getBoundingClientRect(),
                        t = this.domElement.ownerDocument.documentElement;
                    this.screen.left = e.left + window.pageXOffset - t.clientLeft, this.screen.top = e.top + window.pageYOffset - t.clientTop, this.screen.width = e.width, this.screen.height = e.height
                }
            }, cw.prototype.pickObject = function(e) {
                var t, n = {},
                    r = this.gfxObj;
                if (r) {
                    var o = new c.Raycaster;
                    if (o.setFromCamera(e, this.camera), (t = o.intersectObject(r, !1)).length > 0) {
                        var i = t[0],
                            a = new c.Vector3;
                        if (H.now.draft.clipPlane && this.hasOwnProperty("clipPlaneValue")) {
                            var s;
                            for (s = 0; s < t.length && (i = t[s], a.copy(i.point), a.applyMatrix4(this.camera.matrixWorldInverse), !(a.z <= -this.clipPlaneValue)); ++s);
                            s === t.length && (i = null)
                        }
                        if (null != i && H.now.fog && this.hasOwnProperty("fogFarValue") && (a.copy(i.point), a.applyMatrix4(this.camera.matrixWorldInverse), a.z <= -this.fogFarValue && (i = null)), null != i && (i.residue || i.atom)) {
                            var l = i.residue || i.atom.getResidue();
                            "chain" === H.now.pick ? n = {
                                chain: l.getChain()
                            } : "molecule" === H.now.pick ? n = {
                                molecule: l.getMolecule()
                            } : i.residue || "residue" === H.now.pick ? n = {
                                residue: l
                            } : i.atom && (n = {
                                atom: i.atom
                            })
                        }
                    }
                }
                this.picked = n, this.dispatchEvent({
                    type: "newpick",
                    obj: n
                })
            }, cw.prototype.getMouseInViewport = function(e, t) {
                return new c.Vector2((e - this.screen.left) / this.screen.width * 2 - 1, -(t - this.screen.top) / this.screen.height * 2 + 1)
            }, cw.prototype.mousedown = function(e) {
                e.preventDefault(), e.stopPropagation(), 0 === e.button && (this._lastMousePos = this.getMouseInViewport(e.pageX, e.pageY), this._mouseTotalDist = 0, this._clickBeginTime = this._clock.getElapsedTime())
            }, cw.prototype.mousemove = function(e) {
                e.preventDefault(), e.stopPropagation();
                var t = this.getMouseInViewport(e.pageX, e.pageY);
                this._mouseTotalDist += t.sub(this._lastMousePos).length()
            }, cw.prototype.mouseup = function(e) {
                var t = this;
                if (e.preventDefault(), e.stopPropagation(), 0 === e.button && this._mouseTotalDist < .01) {
                    var n = this._clock.getElapsedTime(),
                        r = this.getMouseInViewport(e.pageX, e.pageY);
                    if (n - this._lastClickBeginTime < .7)
                        if ((new c.Vector2).subVectors(r, this._lastClickPos).length() < .01) return this.dispatchEvent({
                            type: "dblclick",
                            obj: this.picked
                        }), this._lastClickPos = r, void(this._lastClickBeginTime = -1e3);
                    setTimeout(function() {
                        t.pickObject(r)
                    }, 0), this._lastClickPos = r, this._lastClickBeginTime = this._clickBeginTime
                }
            }, cw.prototype.touchstart = function(e) {
                e.preventDefault(), e.stopPropagation(), 1 === e.touches.length && (this._lastTouchdownPos = this.getMouseInViewport(e.touches[0].pageX, e.touches[0].pageY))
            }, cw.prototype.touchend = function(e) {
                var t = this;
                (e.preventDefault(), e.stopPropagation(), 0 === e.touches.length && 1 === e.changedTouches.length) && (this.getMouseInViewport(e.changedTouches[0].pageX, e.changedTouches[0].pageY).sub(this._lastTouchdownPos).length() < .01 && setTimeout(function() {
                    t.pickObject(t._lastTouchdownPos)
                }, 0))
            }, cw.prototype.dispose = function() {
                for (var e = 0; e < this._listeners.length; e++) {
                    var t = this._listeners[e];
                    t.obj.removeEventListener(t.type, t.handler)
                }
            };
            var uw = cw;

            function pw(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var fw = function() {
                function e(t, n) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._target = t, this._targetCamera = n, this._camera = new c.PerspectiveCamera(n.fov, n.aspect, 1, 100), this._object = new c.AxesHelper(1), this._scene = new c.Scene, this._scene.add(this._object), this._full = new c.Vector2, this._update()
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "_update",
                    value: function() {
                        var e = this._targetCamera.fov,
                            t = this._camera;
                        t.aspect = this._targetCamera.aspect, t.setMinimalFov(e), t.setDistanceToFit(1, e), t.updateProjectionMatrix(), this._object.quaternion.copy(this._target.quaternion)
                    }
                }, {
                    key: "render",
                    value: function(e) {
                        this._update(), e.getSize(this._full);
                        var t = .25 * this._full.width,
                            n = .25 * this._full.height,
                            r = e.autoClear;
                        e.autoClear = !1, e.setViewport(0, 0, t, n), e.clear(!1, !0, !1), e.render(this._scene, this._camera), e.setViewport(0, 0, this._full.width, this._full.height), e.autoClear = r
                    }
                }]) && pw(t.prototype, n), r && pw(t, r), e
            }();

            function hw(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var dw = 1 << 19,
                mw = 1 << 20,
                yw = ["helix", "strand"],
                vw = ["fs", "ps", "ns", "us"];

            function _w(e, t) {
                for (var n = t._residues, r = n.length, o = new Uint8Array(r), i = t._atoms, a = 0, s = e.length; a < s; ++a) {
                    o[i[a]._residue._index] = e[a]
                }
                for (var l = [], c = 0; c < r;) {
                    if (0 !== o[c]) {
                        for (var u = c, p = o[c]; c < r - 1 && o[c + 1] === p && n[c].isConnected(n[c + 1]);) ++c;
                        l.push({
                            start: u,
                            end: c,
                            type: yw[p - 1]
                        })
                    }++c
                }
                return l
            }

            function gw(e) {
                return e >= dw ? e - mw : e
            }
            var bw = function() {
                function e(t, n, r) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._complex = t, this._secondary = null, this.isLoading = !1, this._framesRange = {
                        start: 0,
                        end: -1
                    }, this.frameIsReady = !1, this._buffer = null, this._frameRequest = null, this._callbacks = r, "function" == typeof n ? (this._framesRequestLength = 1, this._downloadDataFn = n) : this.parseBinaryData(n, !0), this.reset(), this.setFrame(0)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "_prepareBuffer",
                    value: function(e, t) {
                        if (null == e && (e = 0), null == t && (t = e + this._framesRequestLength), void 0 !== this._framesCount && (t = Math.min(this._framesCount - 1, t)), this._downloadDataFn) {
                            var n = this;
                            this._buffer || (this._buffer = {}), this._buffer.state = "downloading", this.isLoading = !0, n._callbacks && "function" == typeof n._callbacks.onLoadStatusChanged && n._callbacks.onLoadStatusChanged(), this._downloadDataFn({
                                start: e,
                                end: t + 1
                            }, function(r) {
                                if (n.isLoading = !1, n._callbacks && "function" == typeof n._callbacks.onLoadStatusChanged && n._callbacks.onLoadStatusChanged(), n._buffer = {
                                        data: r,
                                        state: "ready",
                                        start: e,
                                        end: t
                                    }, null !== n._frameRequest) {
                                    var o = n._frameRequest;
                                    n._frameRequest = null, n.setFrame(o)
                                }
                            }, function() {
                                n.isLoading = !1, n._callbacks && "function" == typeof n._callbacks.onError && n._callbacks.onError("Streaming failed")
                            })
                        }
                    }
                }, {
                    key: "_parseBuffer",
                    value: function() {
                        if (this._buffer && "ready" === this._buffer.state) {
                            this._framesRange = {
                                start: this._buffer.start,
                                end: this._buffer.end
                            }, this.parseBinaryData(this._buffer.data, !1);
                            var e = (this._buffer.end + 1) % this._framesCount;
                            if (e >= this._framesCount && (e = 0), this._buffer = {
                                    state: "none"
                                }, this._prepareBuffer(e, e + this._framesRequestLength), null !== this._frameRequest) {
                                var t = this._frameRequest;
                                this._frameRequest = null, this.setFrame(t)
                            }
                        }
                    }
                }, {
                    key: "parseBinaryData",
                    value: function(e) {
                        var t = new DataView(e),
                            n = 0,
                            r = t.getUint32(n, !0);
                        n += 4;
                        var o = t.getUint32(n, !0);
                        this._framesCount = o, this._framesRange.end = this._framesRange.end > 0 ? Math.min(this._framesRange.end, o - 1) : o - 1, n += 4, this._atomsCount = r;
                        this._framesRequestLength = Math.ceil(1048576 / (8 * r));
                        var i = this._framesRange.end - this._framesRange.start + 1;
                        if (r !== this._complex._atoms.length || e.byteLength !== 12 + i * r * 8) throw new Error;
                        for (var a = this._complex, s = t.getUint32(n, !0), l = 0; s > 1e3 && l < vw.length - 1;) s /= 1e3, ++l;
                        this._timeStep = "".concat(s.toString(), " ").concat(vw[l]), n += 4;
                        for (var c = [], u = new Float32Array(i * r * 3), p = 0, f = new Int8Array(r), h = 0; h < i; ++h) {
                            for (var d = 0; d < r; ++d) {
                                var m = t.getUint32(n, !0);
                                n += 4;
                                var y = t.getUint32(n, !0);
                                n += 4;
                                var v = (4026531840 & y) >>> 28,
                                    _ = gw((268435200 & y) >>> 8 >> 0),
                                    g = gw(((255 & y) << 12 | (4293918720 & m) >>> 20) >> 0),
                                    b = gw((1048575 & m) >> 0);
                                f[d] = 0, v > 0 && v < 4 ? f[d] = 1 : 4 === v && (f[d] = 2), u[p++] = _ / 100, u[p++] = g / 100, u[p++] = b / 100
                            }
                            c.push(_w(f, a))
                        }
                        this._secondaryData = c, this._data = u
                    }
                }, {
                    key: "nextFrame",
                    value: function() {
                        this.setFrame((this._currFrame + 1) % this._framesCount)
                    }
                }, {
                    key: "needsColorUpdate",
                    value: function(e) {
                        return e instanceof cm
                    }
                }, {
                    key: "getAtomColor",
                    value: function(e, t) {
                        return e.getResidueColor(this._residues[t._residue._index], this._complex)
                    }
                }, {
                    key: "getResidueColor",
                    value: function(e, t) {
                        return e.getResidueColor(this._residues[t._index], this._complex)
                    }
                }, {
                    key: "_updateSecondary",
                    value: function() {
                        var e, t = this._residues,
                            n = t.length;
                        for (e = 0; e < n; ++e) t[e]._secondary = null;
                        var r = this._secondaryData[this._currFrame - this._framesRange.start];
                        for (e = 0, n = r.length; e < n; ++e)
                            for (var o = r[e], i = o.start, a = o.end, s = {
                                    _start: t[i],
                                    _end: t[a],
                                    type: o.type,
                                    generic: o.generic
                                }, l = i; l <= a; ++l) t[l]._secondary = s
                    }
                }, {
                    key: "reset",
                    value: function() {
                        var e = this._complex._residues,
                            t = e.length;
                        this._residues = new Array(t);
                        for (var n = this._residues, r = function() {
                                return this._secondary
                            }, o = 0; o < t; ++o) n[o] = {
                            _type: e[o]._type,
                            _isValid: e[o]._isValid,
                            _controlPoint: null,
                            _wingVector: null,
                            _secondary: null,
                            getSecondary: r
                        }
                    }
                }, {
                    key: "setFrame",
                    value: function(e) {
                        if (this.frameIsReady = !1, e >= this._framesRange.start && e <= this._framesRange.end) this._currFrame = e, this._cachedResidues = !1, this._updateSecondary(), this.frameIsReady = !0;
                        else if (this._frameRequest = e, this._buffer) {
                            switch (this._buffer.state) {
                                case "none":
                                    this._prepareBuffer(e);
                                    break;
                                case "ready":
                                    this._parseBuffer()
                            }
                        } else this._prepareBuffer(e)
                    }
                }, {
                    key: "disableEvents",
                    value: function() {
                        this._callbacks = null
                    }
                }, {
                    key: "getAtomPos",
                    value: function(t) {
                        var n = e._vec,
                            r = this._data,
                            o = 3 * (this._atomsCount * (this._currFrame - this._framesRange.start) + t);
                        return n.set(r[o], r[o + 1], r[o + 2]), n
                    }
                }, {
                    key: "getResidues",
                    value: function() {
                        return this._cachedResidues ? this._residues : (this._complex.updateToFrame(this), this._residues)
                    }
                }]) && hw(t.prototype, n), r && hw(t, r), e
            }();
            ! function(e, t, n) {
                t in e ? Object.defineProperty(e, t, {
                    value: n,
                    enumerable: !0,
                    configurable: !0,
                    writable: !0
                }) : e[t] = n
            }(bw, "_vec", new c.Vector3);
            var ww = bw;

            function xw(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Sw = function() {
                function e(t, n) {
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, e), this.constructor === e) throw new Error("Can not instantiate abstract class!");
                    this.params = t, this.opts = l.a.merge(R.deriveDeep(H.now.objects[this.type], !0), n), this.needsRebuild = !1, this._mesh = null, this.id = null
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "identify",
                    value: function() {
                        var e = {
                                type: this.type,
                                params: this.params
                            },
                            t = R.objectsDiff(this.opts, H.now.modes[this.id]);
                        return l.a.isEmpty(t) || (e.opts = t), e
                    }
                }, {
                    key: "toString",
                    value: function() {
                        return "o=".concat(this.type, ",").concat(this.params.join(",")) + R.compareOptionsWithDefaults(this.opts, H.defaults.objects[this.type])
                    }
                }, {
                    key: "getGeometry",
                    value: function() {
                        return this._mesh
                    }
                }, {
                    key: "destroy",
                    value: function() {
                        this._mesh && $r.destroyObject(this._mesh)
                    }
                }]) && xw(t.prototype, n), r && xw(t, r), e
            }();
            Sw.prototype.type = "__";
            var Cw = Sw;

            function Pw(e) {
                return (Pw = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ew(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function Ow(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function Aw(e, t) {
                return !t || "object" !== Pw(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Tw(e) {
                return (Tw = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function kw(e, t) {
                return (kw = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Rw = function(e) {
                function t(e, n) {
                    var r;
                    if (function(e, t) {
                            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                        }(this, t), r = Aw(this, Tw(t).call(this, e, n)), e.length < 2) throw new Error("Wrong number of argumets on line object creation!");
                    var o = Ew(e, 2);
                    return r._id1 = o[0], r._id2 = o[1], r
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && kw(e, t)
                }(t, Cw), n = t, (r = [{
                    key: "_getAtomFromName",
                    value: function(e, t) {
                        var n = e.getAtomByFullname(t);
                        if (!n) throw new Error(t + " - Wrong atom format it must be '#CHAIN_NAME.#NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')");
                        return n
                    }
                }, {
                    key: "build",
                    value: function(e) {
                        var t = new c.Geometry;
                        this._atom1 = this._getAtomFromName(e, this._id1), this._atom2 = this._getAtomFromName(e, this._id2), t.vertices[0] = this._atom1._position.clone(), t.vertices[1] = this._atom2._position.clone(), t.dynamic = !0, t.computeBoundingBox(), this._line = new Cl.Line(t, new Gr({
                            lights: !1,
                            overrideColor: !0,
                            dashedLine: !0,
                            fogTransparent: H.now.bg.transparent
                        })), this._line.computeLineDistances(), this._line.material.setUberOptions({
                            fixedColor: new c.Color(this.opts.color),
                            dashedLineSize: this.opts.dashSize,
                            dashedLinePeriod: this.opts.dashSize + this.opts.gapSize
                        }), this._line.material.updateUniforms(), this._line.raycast = function(e, t) {}, this._mesh = this._line;
                        var n = e.getTransforms();
                        n.length > 0 && (this._mesh = new c.Group, this._mesh.add(this._line), $r.applyTransformsToMeshes(this._mesh, n))
                    }
                }, {
                    key: "updateToFrame",
                    value: function(e) {
                        if (this._atom1 && this._atom2 && this._line) {
                            var t = this._line.geometry;
                            t.vertices[0].copy(e.getAtomPos(this._atom1._index)), t.vertices[1].copy(e.getAtomPos(this._atom2._index)), this._line.computeLineDistances(), t.computeBoundingSphere(), t.verticesNeedUpdate = !0
                        }
                    }
                }]) && Ow(n.prototype, r), o && Ow(n, o), t
            }();
            Rw.prototype.constructor = Rw, Rw.prototype.type = "line";
            var Iw = Rw,
                Mw = "varying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",
                Nw = "uniform sampler2D srcTex;\nuniform vec2 srcTexSize;\nvarying vec2 vUv;\n\n#ifdef DEPTH_OUTLINE\n  uniform sampler2D srcDepthTex; //depthTexture\n  uniform vec3 color;\n  uniform float threshold;\n#endif\n\nvoid main() {\n\n  vec2 pixelSize = vec2(1, 1) / srcTexSize;\n\n  #ifdef DEPTH_OUTLINE\n    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\n    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\n    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\n    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\n    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\n    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\n    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\n    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\n\n    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\n    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\n\n    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n\n    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\n\n  #else\n    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\n    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\n    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\n    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\n    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\n    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\n    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\n    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\n\n    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\n    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\n\n    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n    gl_FragColor = grad;\n  #endif\n}\n",
                Lw = c.UniformsUtils.merge([{
                    srcTex: {
                        type: "t",
                        value: null
                    },
                    srcDepthTex: {
                        type: "t",
                        value: null
                    },
                    srcTexSize: {
                        type: "v2",
                        value: new c.Vector2(512, 512)
                    },
                    color: {
                        type: "v3",
                        value: null
                    },
                    threshold: {
                        type: "f",
                        value: null
                    },
                    opacity: {
                        type: "f",
                        value: 1
                    }
                }]);

            function jw(e) {
                var t = c.UniformsUtils.clone(Lw);
                for (var n in e) t.hasOwnProperty(n) && (t[n].value = e[n]);
                return t
            }

            function Dw(e) {
                c.ShaderMaterial.call(this), this.depth = !1;
                var t = {
                    uniforms: jw(e),
                    vertexShader: Mw,
                    fragmentShader: Nw,
                    transparent: !0,
                    depthTest: !1,
                    depthWrite: !1
                };
                c.ShaderMaterial.prototype.setValues.call(this, t), this.setValues(e)
            }
            Dw.prototype = Object.create(c.ShaderMaterial.prototype), Dw.prototype.constructor = Dw, Dw.prototype.copy = function(e) {
                return c.ShaderMaterial.prototype.copy.call(this, e), this.depth = e.depth, this
            }, Dw.prototype.setValues = function(e) {
                if (void 0 !== e) {
                    c.ShaderMaterial.prototype.setValues.call(this, e);
                    var t = {};
                    this.depth && (t.DEPTH_OUTLINE = 1), this.defines = t
                }
            };
            var Vw = Dw,
                Fw = "// edge end finding algorithm parameters\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n// constants\nfloat fxaaQualityEdgeThreshold = 0.125;\nfloat fxaaQualityEdgeThresholdMin = 0.0625;\nfloat fxaaQualitySubpix = 0.7; //0.65;\n// global params\nuniform sampler2D srcTex;\nuniform vec2 srcTexelSize;\nuniform vec3 bgColor;\n// from vs\nvarying vec2 vUv;\n//=====================================================================//\n// calc luminance from rgb\n//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\nfloat FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\n                                                                           // for non-real scene rendering\n// texture sampling by pixel position(coords) and offset(in pixels)\n vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\n  #ifdef BG_TRANSPARENT\n    vec4 color = texture2D( tex, pos + off * res );\n    return mix(color.rgb, bgColor, 1.0 - color.a);\n  #else\n    return texture2D( tex, pos + off * res ).xyz;\n  #endif\n}\nvec3 FxaaTexTop(sampler2D tex, vec2 pos) {\n  #ifdef BG_TRANSPARENT\n    vec4 color = texture2D( tex, pos );\n    return mix(color.rgb, bgColor, 1.0 - color.a);\n  #else\n    return texture2D( tex, pos).xyz;\n  #endif\n}\nvec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\n  return texture2D( tex, pos);\n}\n\n//=====================================================================//\nvoid main() {\n  // renaming\n  vec2 posM = vUv;\n  // get luminance for neighbours\n  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\n  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\n  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\n  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\n  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\n  // find max and min luminance\n  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\n  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\n  // calc maximum non-edge range\n  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n  float range = rangeMax - rangeMin;\n  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n  // exit when luma contrast is small (is not edge)\n  if(range < rangeMaxClamped){\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\n    return;\n  }\n  float subpixRcpRange = 1.0/range;\n  // calc other neighbours luminance\n  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\n  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\n  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\n  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\n/*--------------span calculation and subpix amount calulation-----------------*/\n  float lumaNS = lumaN + lumaS;\n  float lumaWE = lumaW + lumaE;\n  float subpixNSWE = lumaNS + lumaWE;\n  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n  float lumaNESE = lumaNE + lumaSE;\n  float lumaNWNE = lumaNW + lumaNE;\n  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n  float lumaNWSW = lumaNW + lumaSW;\n  float lumaSWSE = lumaSW + lumaSE;\n  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n  float edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------subpix amount calulation------------------------------*/\n  float subpixNWSWNESE = lumaNWSW + lumaNESE;\n  float lengthSign = srcTexelSize.x;\n  bool horzSpan = edgeHorz >= edgeVert;\n   // debug  code edge span visualization\n/*'  if (horzSpan)\n      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n  else\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n  return;*/\n  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n  if(!horzSpan) lumaN = lumaW;\n  if(!horzSpan) lumaS = lumaE;\n  if(horzSpan) lengthSign = srcTexelSize.y;\n  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n  float gradientN = lumaN - lumaM;\n  float gradientS = lumaS - lumaM;\n  float lumaNN = lumaN + lumaM;\n  float lumaSS = lumaS + lumaM;\n  bool pairN = abs(gradientN) >= abs(gradientS);\n  float gradient = max(abs(gradientN), abs(gradientS));\n  if(pairN) lengthSign = -lengthSign;\n  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n/*--------------------------------------------------------------------------*/\n  vec2 posB;\n  posB = posM;\n  vec2 offNP;\n  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\n  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\n  if(!horzSpan) posB.x += lengthSign * 0.5;\n  if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n  vec2 posN;\n  posN = posB - offNP * FXAA_QUALITY_P0;\n  vec2 posP;\n  posP = posB + offNP * FXAA_QUALITY_P0;\n  float subpixD = ((-2.0)*subpixC) + 3.0;\n  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\n  float subpixE = subpixC * subpixC;\n  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\n/*--------------------------------------------------------------------------*/\n  if(!pairN) lumaNN = lumaSS;\n  float gradientScaled = gradient * 1.0/4.0;\n  float lumaMM = lumaM - lumaNN * 0.5;\n  float subpixF = subpixD * subpixE;\n  bool lumaMLTZero = lumaMM < 0.0;\n/*---------------------looped edge-end search-------------------------------*/\n  lumaEndN -= lumaNN * 0.5;\n  lumaEndP -= lumaNN * 0.5;\n  bool doneN = abs(lumaEndN) >= gradientScaled;\n  bool doneP = abs(lumaEndP) >= gradientScaled;\n  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\n  bool doneNP = (!doneN) || (!doneP);\n  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n  if(doneNP) {\n    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n    doneN = abs(lumaEndN) >= gradientScaled;\n    doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\n    doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 3)\n      if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 4)\n          if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 5)\n               if(doneNP) {\n                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                 doneN = abs(lumaEndN) >= gradientScaled;\n                 doneP = abs(lumaEndP) >= gradientScaled;\n                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\n                 doneNP = (!doneN) || (!doneP);\n                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                 #if (FXAA_QUALITY_PS > 6)\n                   if(doneNP) {\n                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                     doneN = abs(lumaEndN) >= gradientScaled;\n                     doneP = abs(lumaEndP) >= gradientScaled;\n                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\n                     doneNP = (!doneN) || (!doneP);\n                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                     #if (FXAA_QUALITY_PS > 7)\n                       if(doneNP) {\n                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\n                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\n                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                         doneN = abs(lumaEndN) >= gradientScaled;\n                         doneP = abs(lumaEndP) >= gradientScaled;\n                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\n                         doneNP = (!doneN) || (!doneP);\n                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n                       }\n                     #endif\n                   }\n                 #endif\n               }\n             #endif\n           }\n         #endif\n      }\n    #endif\n  }\n/*----------------calculate subpix offset due to edge ends-------------------*/\n  float dstN = posM.x - posN.x;\n  float dstP = posP.x - posM.x;\n  if(!horzSpan) dstN = posM.y - posN.y;\n  if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n  float spanLength = (dstP + dstN);\n  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n  float spanLengthRcp = 1.0 / spanLength;\n/*--------------------------------------------------------------------------*/\n  bool directionN = dstN < dstP;\n  float dst = min(dstN, dstP);\n  bool goodSpan = directionN ? goodSpanN : goodSpanP;\n  float subpixG = subpixF * subpixF;\n  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n  float subpixH = subpixG * fxaaQualitySubpix;\n/*-----------------calc texture offest using subpix-------------------------*/\n  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\n  float offset = pixelOffsetSubpix * lengthSign;\n  #ifdef BG_TRANSPARENT\n    // get original texel\n    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\n    // calc step to blended texel\n    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\n    // get neighboring texel\n    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\n    //  calc blend factor from offset\n    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\n    f = abs(f);\n    // calc alpha (special formula to emulate blending with bg)\n    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\n    // calc color (special formula to emulate blending with bg)\n    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\n  #else\n    if(!horzSpan) {\n       posM.x += offset;\n    } else {\n       posM.y += offset;\n    }\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\n  #endif\n  return;\n}\n",
                Bw = c.UniformsUtils.merge([{
                    srcTex: {
                        type: "t",
                        value: null
                    },
                    srcTexelSize: {
                        type: "v2",
                        value: new c.Vector2(1 / 512, 1 / 512)
                    },
                    bgColor: {
                        type: "c",
                        value: new c.Color(16777215)
                    }
                }]);

            function zw(e) {
                c.ShaderMaterial.call(this), this.bgTransparent = !1, c.ShaderMaterial.prototype.setValues.call(this, {
                    uniforms: c.UniformsUtils.clone(Bw),
                    vertexShader: Mw,
                    fragmentShader: Fw,
                    transparent: !1,
                    depthTest: !1,
                    depthWrite: !1
                }), this.setValues(e)
            }
            zw.prototype = Object.create(c.ShaderMaterial.prototype), zw.prototype.constructor = zw, zw.prototype.setValues = function(e) {
                if (void 0 !== e) {
                    c.ShaderMaterial.prototype.setValues.call(this, e);
                    var t = {};
                    this.bgTransparent && (t.BG_TRANSPARENT = 1), this.defines = t
                }
            };
            var Uw = zw,
                Gw = "#define MAX_SAMPLES_COUNT 32\n\nuniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\nuniform sampler2D noiseTexture;\nuniform vec2      noiseTexelSize;\nuniform sampler2D diffuseTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D normalTexture;\nuniform vec2      srcTexelSize;\nuniform vec2      camNearFar;\nuniform mat4      projMatrix;\n\nuniform float aspectRatio;\nuniform float tanHalfFOV;\n\nuniform float kernelRadius;\nuniform float depthThreshold;\nuniform float factor;\n\nuniform vec2 fogNearFar;\nvarying vec2 vUv;\n\nfloat CalcViewZ(vec2 screenPos)\n{\n  float depth = texture2D(depthTexture, screenPos).x;\n  // [0, 1]->[-1, 1]\n  float clipedZ = 2.0 * depth - 1.0;\n  // see THREE.js camera.makeFrustum for projection details\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\n}\n\nvec3 ViewPosFromDepth(vec2 screenPos)\n{\n  vec3 viewPos;\n  viewPos.z = CalcViewZ(screenPos);\n  //[0, 1]->[-1, 1]\n  vec2 projPos = 2.0 * screenPos - 1.0;\n  // reconstruct viewposition in right-handed sc with z to viewer\n  viewPos.xy = vec2(\n                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\n                    projPos.y * tanHalfFOV * abs(viewPos.z)\n                   );\n  return viewPos;\n}\n\nvoid main() {\n  vec3 viewPos = ViewPosFromDepth(vUv);\n  // remap coordinates to prevent noise exture rescale\n  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\n  //[0, 1] -> [-1, 1]\n  vec3 normal = (texture2D(normalTexture, vUv).rgb * 2.0 - 1.0);\n  // get random vector for sampling sphere rotation\n  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\n  randN = normalize(randN);\n  // build TBN (randomly rotated around normal)\n  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\n  vec3 bitangent = cross(tangent, normal);\n  mat3 TBN = mat3(tangent, bitangent, normal);\n  // calc AO value\n  float AO = 0.0;\n  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\n    // rotate sampling kernel around normal\n    vec3 reflectedSample = TBN * samplesKernel[i];\n    // get sample\n    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\n\n    // project sample to screen to get sample's screen pos\n    vec4 SampleScrPos = vec4(samplePos, 1.0);\n    // eye -> clip\n    SampleScrPos = projMatrix * SampleScrPos;\n    // normalize\n    SampleScrPos.xy /= SampleScrPos.w;\n    //[-1, 1] -> [0, 1]\n    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\n\n    // get view z for sample projected to the objct surface\n    float sampleDepth = CalcViewZ(SampleScrPos.xy);\n    // calc occlusion made by object surface at the sample\n    AO += step(samplePos.z, sampleDepth);\n  }\n  // add fog to the AO value\n  AO *= 1.0 - smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z);\n  // calc result AO-map color\n  AO = 1.0 - max(0.0, AO / 32.0 * factor); // TODO use MAX_SAMPLES_COUNT\n  // check if the fragment doesn't belong to background(?)\n  if (abs(- viewPos.z - camNearFar.y) < 0.1) { // FIXME remove temporal fix for background darkening\n    gl_FragColor = vec4(1.0);\n    return;\n  }\n  // write value to AO-map\n  gl_FragColor = vec4(AO, AO, AO, 1.0);\n}\n",
                Hw = "#define MAX_SAMPLES_COUNT 5\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\nuniform sampler2D aoMap;\nuniform sampler2D depthTexture;\nuniform vec2      srcTexelSize;\n\nvarying vec2 vUv;\n\nvoid main() {\n  float x = vUv.x;\n  float y = vUv.y;\n  vec4 res = vec4(0.0);\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\n  float weightSum = 0.0;\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\n    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\n    float depth = texture2D(depthTexture, samplePos).x;\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\n    res += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )) * weight;\n    weightSum += weight;\n  }\n  gl_FragColor = res / weightSum;\n}\n",
                Ww = "#define MAX_SAMPLES_COUNT 5\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\nuniform sampler2D diffuseTexture;\nuniform sampler2D aoMap;\nuniform sampler2D depthTexture;\nuniform vec2      srcTexelSize;\n\nvarying vec2 vUv;\n\nvoid main() {\n  float x = vUv.x;\n  float y = vUv.y;\n  vec4 res = vec4(0.0);\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\n  float weightSum = 0.0;\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\n    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\n    float depth = texture2D(depthTexture, samplePos).x;\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\n    res += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)) * weight;\n    weightSum += weight;\n  }\n  res /= weightSum;\n  vec4 color = texture2D(diffuseTexture, vec2(x, y));\n  gl_FragColor = vec4(color.rgb * res.rgb, color.a);\n}",
                qw = c.UniformsUtils.merge([{
                    noiseTexture: {
                        type: "t",
                        value: null
                    },
                    noiseTexelSize: {
                        type: "v2",
                        value: new c.Vector2(1 / 512, 1 / 512)
                    },
                    diffuseTexture: {
                        type: "t",
                        value: null
                    },
                    normalTexture: {
                        type: "t",
                        value: null
                    },
                    depthTexture: {
                        type: "t",
                        value: null
                    },
                    srcTexelSize: {
                        type: "v2",
                        value: new c.Vector2(1 / 512, 1 / 512)
                    },
                    camNearFar: {
                        type: "v2",
                        value: new c.Vector2(1, 10)
                    },
                    projMatrix: {
                        type: "mat4",
                        value: new c.Matrix4
                    },
                    aspectRatio: {
                        type: "f",
                        value: 0
                    },
                    tanHalfFOV: {
                        type: "f",
                        value: 0
                    },
                    samplesKernel: {
                        type: "v3v",
                        value: null
                    },
                    kernelRadius: {
                        type: "f",
                        value: 1
                    },
                    depthThreshold: {
                        type: "f",
                        value: 1
                    },
                    factor: {
                        type: "f",
                        value: 1
                    },
                    fogNearFar: {
                        type: "v2",
                        value: new c.Vector2(100, 100)
                    }
                }]),
                Yw = c.UniformsUtils.merge([{
                    diffuseTexture: {
                        type: "t",
                        value: null
                    },
                    depthTexture: {
                        type: "t",
                        value: null
                    },
                    srcTexelSize: {
                        type: "v2",
                        value: new c.Vector2(1 / 512, 1 / 512)
                    },
                    aoMap: {
                        type: "t",
                        value: null
                    },
                    samplesOffsets: {
                        type: "fv1",
                        value: null
                    },
                    camNearFar: {
                        type: "v2",
                        value: new c.Vector2(1, 10)
                    },
                    projMatrix: {
                        type: "mat4",
                        value: new c.Matrix4
                    },
                    aspectRatio: {
                        type: "f",
                        value: 0
                    },
                    tanHalfFOV: {
                        type: "f",
                        value: 0
                    }
                }]);

            function Xw(e, t) {
                var n = c.UniformsUtils.clone(t);
                for (var r in e) n.hasOwnProperty(r) && (n[r].value = e[r]);
                return n
            }
            var $w = {
                    AOMaterial: function(e) {
                        var t = {
                            uniforms: Xw(e, qw),
                            vertexShader: Mw,
                            fragmentShader: Gw,
                            transparent: !1,
                            depthTest: !1,
                            depthWrite: !1
                        };
                        return new c.ShaderMaterial(t)
                    },
                    HorBilateralBlurMaterial: function(e) {
                        var t = {
                            uniforms: Xw(e, Yw),
                            vertexShader: Mw,
                            fragmentShader: Hw,
                            transparent: !1,
                            depthTest: !1,
                            depthWrite: !1
                        };
                        return new c.ShaderMaterial(t)
                    },
                    VertBilateralBlurMaterial: function(e) {
                        var t = {
                            uniforms: Xw(e, Yw),
                            vertexShader: Mw,
                            fragmentShader: Ww,
                            transparent: !1,
                            depthTest: !1,
                            depthWrite: !1
                        };
                        return new c.ShaderMaterial(t)
                    }
                },
                Kw = "uniform sampler2D srcL;\nuniform sampler2D srcR;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 l = texture2D(srcL, vUv);\n  vec4 r = texture2D(srcR, vUv);\n  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\n}\n",
                Zw = c.UniformsUtils.merge([{
                    srcL: {
                        type: "t",
                        value: null
                    },
                    srcR: {
                        type: "t",
                        value: null
                    }
                }]);

            function Qw(e) {
                var t = c.UniformsUtils.clone(Zw);
                for (var n in e) t.hasOwnProperty(n) && (t[n].value = e[n]);
                return t
            }
            var Jw = function(e) {
                var t = {
                    uniforms: Qw(e),
                    vertexShader: Mw,
                    fragmentShader: Kw,
                    transparent: !1,
                    depthTest: !1,
                    depthWrite: !1
                };
                return new c.ShaderMaterial(t)
            };

            function ex(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function tx(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function nx(e, t, n) {
                return t && tx(e.prototype, t), n && tx(e, n), e
            }
            var rx = function() {
                    function e() {
                        ex(this, e), this.position = new c.Vector3(0, 0, 0), this.scale = 1, this.orientation = new c.Quaternion(0, 0, 0, 1)
                    }
                    return nx(e, [{
                        key: "set",
                        value: function(e, t, n) {
                            this.position = e, this.scale = t, this.orientation = n
                        }
                    }]), e
                }(),
                ox = new(function() {
                    function e() {
                        ex(this, e)
                    }
                    return nx(e, [{
                        key: "setup",
                        value: function(e, t) {
                            this._startTime = void 0, this._endTime = void 0, this._srcView = e, this._dstView = t, this._isMoving = !1
                        }
                    }, {
                        key: "isMoving",
                        value: function() {
                            return this._isMoving
                        }
                    }, {
                        key: "wasStarted",
                        value: function() {
                            return void 0 !== this._startTime && void 0 !== this._endTime
                        }
                    }, {
                        key: "start",
                        value: function() {
                            this._startTime = Date.now();
                            var e = H.now.interpolateViews ? 1500 : 0;
                            this._endTime = this._startTime + e, this._isMoving = !0
                        }
                    }, {
                        key: "getCurrentView",
                        value: function() {
                            if (void 0 === this._srcView || void 0 === this._dstView || !this._isMoving || !this.wasStarted()) return {
                                success: !1
                            };
                            var e = this.createView(),
                                t = Date.now();
                            if (t > this._endTime) return e = this._dstView, this._reset(), {
                                success: !0,
                                view: e
                            };
                            var n = (t - this._startTime) / (this._endTime - this._startTime);
                            return e.position.copy(this._srcView.position), e.position.lerp(this._dstView.position, n), e.scale = (1 - n) * this._srcView.scale + n * this._dstView.scale, e.orientation.copy(this._srcView.orientation), e.orientation.slerp(this._dstView.orientation, n), {
                                success: !0,
                                view: e
                            }
                        }
                    }, {
                        key: "_reset",
                        value: function() {
                            this._startTime = this._endTime = 0, this._isMoving = !1
                        }
                    }, {
                        key: "createView",
                        value: function() {
                            return new rx
                        }
                    }]), e
                }()),
                ix = H.now.fbxprec,
                ax = ';  FBX 6.1.0 project file\n; Copyright (C) 1997-2007 Autodesk Inc. and/or its licensors.\n; All rights reserved.\n; ----------------------------------------------------\n\n  FBXHeaderExtension:  {\n  FBXHeaderVersion: 1003\n  FBXVersion: 6100\n  CreationTimeStamp:  {\n    Version: 1000\n    Year: 2015\n    Month: 12\n    Day: 7\n    Hour: 17\n    Minute: 34\n    Second: 53\n    Millisecond: 369\n  }\n Creator: "FBX SDK/FBX Plugins build 20080212"\n  OtherFlags:  {\n    FlagPLE: 0\n  }\n}\nreationTime: "2015-12-07 17:34:53:369"\nreator: "FBX SDK/FBX Plugins build 20080212"\n\n; Document Description\n;------------------------------------------------------------------\n\n  Document:  {\n Name: ""\n}\n\n; Document References\n;------------------------------------------------------------------\n\n  References:  {\n}\n\n; Object definitions\n;------------------------------------------------------------------\n\n  Definitions:  {\n  Version: 100\n  Count: 3\n  ObjectType: "Model" {\n    Count: 1\n  }\n  ObjectType: "SceneInfo" {\n    Count: 1\n  }\n  ObjectType: "GlobalSettings" {\n    Count: 1\n  }\n}\n\n; Object properties\n;------------------------------------------------------------------\n\n  Objects:  {\n  Model: "Model::Sphere01", "Mesh" {\n    Version: 232\n    Properties60:  {\n      Property: "QuaternionInterpolate", "bool", "",0\n      Property: "RotationOffset", "Vector3D", "",0,0,0\n      Property: "RotationPivot", "Vector3D", "",0,0,0\n      Property: "ScalingOffset", "Vector3D", "",0,0,0\n      Property: "ScalingPivot", "Vector3D", "",0,0,0\n      Property: "TranslationActive", "bool", "",0\n      Property: "TranslationMin", "Vector3D", "",0,0,0\n      Property: "TranslationMax", "Vector3D", "",0,0,0\n      Property: "TranslationMinX", "bool", "",0\n      Property: "TranslationMinY", "bool", "",0\n      Property: "TranslationMinZ", "bool", "",0\n      Property: "TranslationMaxX", "bool", "",0\n      Property: "TranslationMaxY", "bool", "",0\n      Property: "TranslationMaxZ", "bool", "",0\n      Property: "RotationOrder", "enum", "",0\n      Property: "RotationSpaceForLimitOnly", "bool", "",0\n      Property: "RotationStiffnessX", "double", "",0\n      Property: "RotationStiffnessY", "double", "",0\n      Property: "RotationStiffnessZ", "double", "",0\n      Property: "AxisLen", "double", "",10\n      Property: "PreRotation", "Vector3D", "",0,0,0\n      Property: "PostRotation", "Vector3D", "",0,0,0\n      Property: "RotationActive", "bool", "",0\n      Property: "RotationMin", "Vector3D", "",0,0,0\n      Property: "RotationMax", "Vector3D", "",0,0,0\n      Property: "RotationMinX", "bool", "",0\n      Property: "RotationMinY", "bool", "",0\n      Property: "RotationMinZ", "bool", "",0\n      Property: "RotationMaxX", "bool", "",0\n      Property: "RotationMaxY", "bool", "",0\n      Property: "RotationMaxZ", "bool", "",0\n      Property: "InheritType", "enum", "",1\n      Property: "ScalingActive", "bool", "",0\n      Property: "ScalingMin", "Vector3D", "",1,1,1\n      Property: "ScalingMax", "Vector3D", "",1,1,1\n      Property: "ScalingMinX", "bool", "",0\n      Property: "ScalingMinY", "bool", "",0\n      Property: "ScalingMinZ", "bool", "",0\n      Property: "ScalingMaxX", "bool", "",0\n      Property: "ScalingMaxY", "bool", "",0\n      Property: "ScalingMaxZ", "bool", "",0\n      Property: "GeometricTranslation", "Vector3D", "",0,0,0\n      Property: "GeometricRotation", "Vector3D", "",0,0,0\n      Property: "GeometricScaling", "Vector3D", "",1,1,1\n      Property: "MinDampRangeX", "double", "",0\n      Property: "MinDampRangeY", "double", "",0\n      Property: "MinDampRangeZ", "double", "",0\n      Property: "MaxDampRangeX", "double", "",0\n      Property: "MaxDampRangeY", "double", "",0\n      Property: "MaxDampRangeZ", "double", "",0\n      Property: "MinDampStrengthX", "double", "",0\n      Property: "MinDampStrengthY", "double", "",0\n      Property: "MinDampStrengthZ", "double", "",0\n      Property: "MaxDampStrengthX", "double", "",0\n      Property: "MaxDampStrengthY", "double", "",0\n      Property: "MaxDampStrengthZ", "double", "",0\n      Property: "PreferedAngleX", "double", "",0\n      Property: "PreferedAngleY", "double", "",0\n      Property: "PreferedAngleZ", "double", "",0\n      Property: "LookAtProperty", "object", ""\n      Property: "UpVectorProperty", "object", ""\n      Property: "Show", "bool", "",1\n      Property: "NegativePercentShapeSupport", "bool", "",1\n      Property: "DefaultAttributeIndex", "int", "",0\n      Property: "Lcl Translation", "Lcl Translation", "A+",-0.169204741716385,-0.507614195346832,0\n      Property: "Lcl Rotation", "Lcl Rotation", "A+",0,0,0\n      Property: "Lcl Scaling", "Lcl Scaling", "A+",1,1,1\n      Property: "Visibility", "Visibility", "A+",1\n      Property: "BBoxMin", "Vector3D", "N",0,0,0\n      Property: "BBoxMax", "Vector3D", "N",0,0,0\n    }\n    MultiLayer: 0\n    MultiTake: 1\n    Shading: T\n   Culling: "CullingOff"\n',
                sx = 'NodeAttributeName: "Geometry::Sphere01"\n}\nceneInfo: "SceneInfo::GlobalInfo", "UserData" {\n Type: "UserData"\n  Version: 100\n  MetaData:  {\n    Version: 100\n   Title: ""\n   Subject: ""\n   Author: ""\n   Keywords: ""\n   Revision: ""\n   Comment: ""\n  }\n  Properties60:  {\n    Property: "DocumentUrl", "KString", "", "D:\\depot\\MolViewer\\Assets\\models\\test1.FBX"\n    Property: "SrcDocumentUrl", "KString", "", "D:\\depot\\MolViewer\\Assets\\models\\test1.FBX"\n   Property: "Original", "Compound", ""\n   Property: "Original|ApplicationVendor", "KString", "", "Autodesk"\n   Property: "Original|ApplicationName", "KString", "", "3ds Max"\n   Property: "Original|ApplicationVersion", "KString", "", "2009.0"\n   Property: "Original|DateTime_GMT", "DateTime", "", "07/12/2015 14:34:53.369"\n    Property: "Original|FileName", "KString", "", "D:\\depot\\MolViewer\\Assets\\models\\test1.FBX"\n   Property: "LastSaved", "Compound", ""\n   Property: "LastSaved|ApplicationVendor", "KString", "", "Autodesk"\n   Property: "LastSaved|ApplicationName", "KString", "", "3ds Max"\n   Property: "LastSaved|ApplicationVersion", "KString", "", "2009.0"\n   Property: "LastSaved|DateTime_GMT", "DateTime", "", "07/12/2015 14:34:53.369"\n  }\n}\nlobalSettings:  {\n  Version: 1000\n  Properties60:  {\n    Property: "UpAxis", "int", "",2\n    Property: "UpAxisSign", "int", "",1\n    Property: "FrontAxis", "int", "",1\n    Property: "FrontAxisSign", "int", "",-1\n    Property: "CoordAxis", "int", "",0\n    Property: "CoordAxisSign", "int", "",1\n    Property: "UnitScaleFactor", "double", "",2.54\n  }\n}\n}\n\n; Object relations\n;------------------------------------------------------------------\n\n  Relations:  {\n  Model: "Model::Sphere01", "Mesh" {\n  }\n  SceneInfo: "SceneInfo::GlobalInfo", "UserData" {\n  }\n}\n\n; Object connections\n;------------------------------------------------------------------\n\n  Connections:  {\n Connect: "OO", "Model::Sphere01", "Model::Scene"\n}\n\n;Object data\n;------------------------------------------------------------------\n\n  ObjectData:  {\n}\n;Takes and animation section\n;----------------------------------------------------\n\n  Takes:  {\n Current: "Take 001"\n}\n;Version 5 settings\n;------------------------------------------------------------------\n\n  Version5:  {\n  AmbientRenderSettings:  {\n    Version: 101\n    AmbientLightColor: 0.533333003520966,0.533333003520966,0.533333003520966,1\n  }\n  FogOptions:  {\n    FlogEnable: 0\n    FogMode: 0\n    FogDensity: 0.002\n    FogStart: 0.3\n    FogEnd: 1000\n    FogColor: 1,1,1,1\n  }\n  Settings:  {\n   FrameRate: "30"\n    TimeFormat: 1\n    SnapOnFrames: 0\n    ReferenceTimeIndex: -1\n    TimeLineStartTime: 0\n    TimeLineStopTime: 153953860000\n  }\n  RendererSetting:  {\n   DefaultCamera: ""\n    DefaultViewingMode: 0\n  }\n}\n\n';

            function lx(e) {
                var t;
                switch (e.code) {
                    case FileError.QUOTA_EXCEEDED_ERR:
                        t = "QUOTA_EXCEEDED_ERR";
                        break;
                    case FileError.NOT_FOUND_ERR:
                        t = "NOT_FOUND_ERR";
                        break;
                    case FileError.SECURITY_ERR:
                        t = "SECURITY_ERR";
                        break;
                    case FileError.INVALID_MODIFICATION_ERR:
                        t = "INVALID_MODIFICATION_ERR";
                        break;
                    case FileError.INVALID_STATE_ERR:
                        t = "INVALID_STATE_ERR";
                        break;
                    default:
                        t = "Unknown Error"
                }
                throw new Error(t)
            }
            var cx = null;

            function ux() {}

            function px(e) {
                for (var t = [], n = 0, r = e.length; n < r; ++n) t[n] = e[n].toFixed(ix);
                return t = t.join(",")
            }

            function fx(e, t, n, r, o, i) {
                return e.add(t, "".concat(n, ": 0 {\n") + 'Version: 101\nName: ""\nMappingInformationType: "ByVertice"\n' + 'ReferenceInformationType: "Direct"\n'.concat(r, ": ").concat(o, "\n") + "}\n", !1, !0), "".concat(i, "LayerElement:  {\n") + 'Type: "'.concat(n, '"\n') + "TypedIndex: 0\n}\n"
            }

            function hx(e, t) {
                var n = R.allocateTyped(Float32Array, e.length + t.length);
                return n.set(e), n.set(t, e.length), n
            }

            function dx(e, t) {
                var n = R.allocateTyped(Int32Array, t.index.array);
                if (null === e.indices) return e.indices = n, e.positions = R.allocateTyped(Float32Array, t.attributes.position.array), e.normals = R.allocateTyped(Float32Array, t.attributes.normal.array), void(e.colors = R.allocateTyped(Float32Array, t.attributes.color.array));
                e.indices = function(e, t, n) {
                    var r = e.length,
                        o = r + t.length,
                        i = R.allocateTyped(Int32Array, o);
                    i.set(e), i.set(t, r);
                    for (var a = r; a < o; ++a) i[a] += n;
                    return i
                }(e.indices, n, e.positions.length / 3), e.positions = hx(e.positions, t.attributes.position.array), e.normals = hx(e.normals, t.attributes.normal.array), e.colors = hx(e.colors, t.attributes.color.array)
            }

            function mx(e, t) {
                ! function(e) {
                    for (var t = 0, n = e.length; t < n; ++t) t % 3 == 2 && (e[t] = ~e[t])
                }(t.indices), t.colors = function(e) {
                        for (var t = e.length / 3 * 4, n = R.allocateTyped(Float32Array, t), r = 0, o = 0, i = e.length / 3; o < i; ++o) n[r++] = e[3 * o], n[r++] = e[3 * o + 1], n[r++] = e[3 * o + 2], n[r++] = 1;
                        return n
                    }(t.colors),
                    function(e, t, n, r, o, i) {
                        var a = "totals.txt";
                        e.add(a, ax, !1, !1), e.add(a, "Vertices: ", !1, !0), e.add(a, px(n), !1, !0), e.add(a, "\nPolygonVertexIndex: ", !1, !0), e.add(a, px(t), !1, !0), e.add(a, "\nGeometryVersion: 124\n", !1, !0);
                        var s = "Layer: 0 {\nVersion: 100\n";
                        null !== r && (s = fx(e, a, "LayerElementNormal", "Normals", px(r), s)), null !== o && (s = fx(e, a, "LayerElementColor", "Colors", px(o), s)), null !== i && (s = fx(e, a, "LayerElementUV", "UV", px(i), s)), s += "}\n", e.add(a, s, !1, !0), e.add(a, sx, !1, !0)
                    }(e, t.indices, t.positions, t.normals, t.colors, null)
            }
            ux.prototype.queue = [], ux.prototype.busy = !1, ux.prototype.add = function(e, t, n, r) {
                this.queue.push([e, t, n, r]), this.busy || this.next()
            }, ux.prototype.next = function() {
                var e, t, n, r, o, i = this.queue.shift(),
                    a = this;
                i && !a.busy && (this.busy = !0, e = i[0], t = i[1], n = i[2], r = i[3], o = function() {
                    a.busy = !1, a.next()
                }, cx.root.getFile(e, {
                    create: !r
                }, function(e) {
                    e.createWriter(function(e) {
                        var i = new Blob([t], {
                            type: n ? "octet/stream" : "text/plain"
                        });
                        r ? (e.onwriteend = function() {
                            o()
                        }, e.seek(e.length), e.write(i)) : (e.onwriteend = function() {
                            0 === e.length && t.length > 0 ? e.write(i) : o()
                        }, e.truncate(0))
                    }, lx)
                }, lx))
            };
            var yx = function(e, t, n) {
                ix = H.now.fbxprec, window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem, window.requestFileSystem(window.TEMPORARY, 1073741824, function(r) {
                    var o = new ux;
                    cx = r, n && (function(e, t, n, r, o) {
                            e.add(n, "", !1, !1), t.forEachAtom(function(i) {
                                var a = i.getPosition(),
                                    s = new c.Color(o.getAtomColor(i, t)),
                                    l = "ATOM ".concat(i._index, " ").concat(a.x, " ").concat(a.y, " ").concat(a.z, " ").concat(r.calcAtomRadius(i), " ").concat(s.r, " ").concat(s.g, " ").concat(s.b, "\n");
                                e.add(n, l, !1, !0)
                            })
                        }(o, e, "atoms.txt", t), function(e, t, n) {
                            e.add(n, "", !1, !1), t.forEachBond(function(t) {
                                var r = "BIND ".concat(t._left._index, " ").concat(t._right._index, "\n");
                                e.add(n, r, !1, !0)
                            }), e.add(n, "TED", !1, !0)
                        }(o, e, "bonds.txt")),
                        function(e, t, n) {
                            var r = {
                                indices: null
                            };

                            function o(e) {
                                e instanceof c.Mesh && dx(r, e.geometry);
                                for (var t = 0, n = e.children.length; t < n; t++) o(e.children[t])
                            }
                            for (var i = 0, a = n.length; i < a; ++i) o(n[i].buildGeometry(t));
                            mx(e, r)
                        }(o, e, t)
                }, lx)
            };

            function vx(e, t) {
                this.context = e, this._opts = l.a.merge({
                    path: "/"
                }, t)
            }
            ro(vx.prototype), vx.prototype.removeCookie = function(e) {
                var t = this._toCount(e),
                    n = this._getSimpleCookie(t);
                if (n) {
                    this._removeSimpleCookie(t), n = parseInt(n, 10);
                    for (var r = 0; r < n; ++r) this._removeSimpleCookie(e + r)
                } else this._removeSimpleCookie(e)
            }, vx.prototype.setCookie = function(e, t) {
                this.removeCookie(e);
                var n = function(e, t) {
                        for (var n = e.length, r = [], o = 0, i = 0; o < n; i++) r[i] = e.slice(o, o += t);
                        return r
                    }(t = encodeURIComponent(t), 4e3 - e.length - 1),
                    r = n.length;
                if (1 !== r) {
                    var o = this._toCount(e);
                    this._setSimpleCookie(o, r.toString());
                    for (var i = 0; i < r; ++i) this._setSimpleCookie(e + i, n[i])
                } else this._setSimpleCookie(e, t)
            }, vx.prototype.getCookie = function(e) {
                var t = this._toCount(e),
                    n = this._getSimpleCookie(t);
                if (!n) return this._getSimpleCookie(e);
                n = parseInt(n, 10);
                for (var r = [], o = 0; o < n; ++o) r[o] = this._getSimpleCookie(e + o);
                return r.join("")
            }, vx.prototype._toCount = function(e) {
                return e + "Cnt"
            }, vx.prototype._removeSimpleCookie = function(e) {
                document.cookie = "".concat(e, "=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")
            }, vx.prototype._getExpirationDate = function() {
                var e = new Date;
                return e.setFullYear(e.getFullYear() + 10), e
            }, vx.prototype._setSimpleCookie = function(e, t) {
                document.cookie = "".concat(e, "=").concat(t, ";expires=").concat(this._getExpirationDate().toUTCString(), ";path=").concat(this._opts.path)
            }, vx.prototype._getSimpleCookie = function(e) {
                var t = document.cookie.match(new RegExp("(?:^|; )".concat(e, "=([^;]*)")));
                return t ? decodeURIComponent(t[1]) : ""
            }, vx.prototype._exists = function(e) {
                return document.cookie.match(new RegExp("(?:^|; )".concat(e, "=([^;]*)")))
            };
            var _x = vx;

            function gx(e) {
                return (gx = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function bx(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }

            function wx(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function xx(e, t) {
                return !t || "object" !== gx(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Sx(e) {
                return (Sx = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Cx(e, t) {
                return (Cx = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var Px = function(e) {
                function t(e) {
                    var n;
                    return function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), (n = xx(this, Sx(t).call(this))).gamepad = null, n.axes = [0, 0], n.thumbpadIsPressed = !1, n.triggerIsPressed = !1, n.gripsArePressed = !1, n.menuIsPressed = !1, n.matrixAutoUpdate = !1, n.contrId = e, n.standingMatrix = new c.Matrix4, n
                }
                var n, r, o;
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Cx(e, t)
                }(t, c["Object3D"]), n = t, (r = [{
                    key: "getGamepad",
                    value: function() {
                        return this.gamepad
                    }
                }, {
                    key: "getButtonState",
                    value: function(e) {
                        return "thumbpad" === e ? this.thumbpadIsPressed : "trigger" === e ? this.triggerIsPressed : "grips" === e ? this.gripsArePressed : "menu" === e ? this.menuIsPressed : null
                    }
                }, {
                    key: "findGamepad",
                    value: function(e) {
                        for (var t = navigator.getGamepads && navigator.getGamepads(), n = 0, r = 0; n < t.length; n++) {
                            var o = t[n];
                            if (o && ("OpenVR Gamepad" === o.id || o.id.startsWith("Oculus Touch") || o.id.startsWith("Spatial Controller"))) {
                                if (r === e) return o;
                                r++
                            }
                        }
                        return null
                    }
                }, {
                    key: "update",
                    value: function() {
                        if (this.gamepad = this.findGamepad(this.contrId), this.gamepad && this.gamepad.pose) {
                            if (null === this.gamepad.pose) return;
                            var e = this.gamepad.pose;
                            if (null !== e.position && this.position.fromArray(e.position), null !== e.orientation && this.quaternion.fromArray(e.orientation), this.matrix.compose(this.position, this.quaternion, this.scale), this.matrix.premultiply(this.standingMatrix), this.matrix.decompose(this.position, this.quaternion, this.scale), this.matrixWorldNeedsUpdate = !0, this.visible = !0, this.axes[0] !== this.gamepad.axes[0] || this.axes[1] !== this.gamepad.axes[1]) {
                                var t = bx(this.gamepad.axes, 2);
                                this.axes[0] = t[0], this.axes[1] = t[1], this.dispatchEvent({
                                    type: "axischanged",
                                    axes: this.axes
                                })
                            }
                            this.thumbpadIsPressed !== this.gamepad.buttons[0].pressed && (this.thumbpadIsPressed = this.gamepad.buttons[0].pressed, this.dispatchEvent({
                                type: this.thumbpadIsPressed ? "thumbpaddown" : "thumbpadup",
                                axes: this.axes
                            })), this.triggerIsPressed !== this.gamepad.buttons[1].pressed && (this.triggerIsPressed = this.gamepad.buttons[1].pressed, this.dispatchEvent({
                                type: this.triggerIsPressed ? "triggerdown" : "triggerup"
                            })), this.gripsArePressed !== this.gamepad.buttons[2].pressed && (this.gripsArePressed = this.gamepad.buttons[2].pressed, this.dispatchEvent({
                                type: this.gripsArePressed ? "gripsdown" : "gripsup"
                            })), this.menuIsPressed !== this.gamepad.buttons[3].pressed && (this.menuIsPressed = this.gamepad.buttons[3].pressed, this.dispatchEvent({
                                type: this.menuIsPressed ? "menudown" : "menuup"
                            }))
                        } else this.visible = !1
                    }
                }]) && wx(n.prototype, r), o && wx(n, o), t
            }();

            function Ex(e) {
                return (Ex = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }

            function Ox(e, t) {
                return !t || "object" !== Ex(t) && "function" != typeof t ? function(e) {
                    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                    return e
                }(e) : t
            }

            function Ax(e) {
                return (Ax = Object.setPrototypeOf ? Object.getPrototypeOf : function(e) {
                    return e.__proto__ || Object.getPrototypeOf(e)
                })(e)
            }

            function Tx(e, t) {
                return (Tx = Object.setPrototypeOf || function(e, t) {
                    return e.__proto__ = t, e
                })(e, t)
            }
            var kx = function(e) {
                function t(e) {
                    var n;
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, t), n = Ox(this, Ax(t).call(this, e));
                    var r = new c.CylinderGeometry(.04, .04, .3),
                        o = new Gr({
                            lights: !1,
                            overrideColor: !0
                        });
                    o.setUberOptions({
                        fixedColor: new c.Color(4474111)
                    }), o.updateUniforms();
                    var i = new c.Mesh(r, o);
                    return i.quaternion.setFromAxisAngle(new c.Vector3(1, 0, 0), Math.PI / 2), n.add(i), n
                }
                return function(e, t) {
                    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
                    e.prototype = Object.create(t && t.prototype, {
                        constructor: {
                            value: e,
                            writable: !0,
                            configurable: !0
                        }
                    }), t && Tx(e, t)
                }(t, Px), t
            }();

            function Rx(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            var Ix = function() {
                function e(t) {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e), this._mainCamera = new c.PerspectiveCamera, this._cameraWasStored = !1, this._button = null, this._onToggle = t, this._molContainer = new $r.RCGroup, this._user = new $r.RCGroup, this._scalingPivot = new c.Object3D, this._user.add(this._scalingPivot), this._controller1 = new kx(0), this._controller2 = new kx(1), this._user.add(this._controller1), this._user.add(this._controller2), this._pressedGripsCounter = 0, this._distance = 0, this._gfx = null;
                    var n = this;

                    function r(e) {
                        n._pressedGripsCounter++, 2 === n._pressedGripsCounter ? (n._distance = n._controller1.position.distanceTo(n._controller2.position), $r.getMiddlePoint(n._controller1.position, n._controller2.position, n._scalingPivot.position), n._scalingPivot.scale.set(1, 1, 1), n._scalingPivot.updateMatrix(), n._scalingPivot.updateMatrixWorld(), n._scalingPivot.addSavingWorldTransform(n._molContainer)) : 1 === n._pressedGripsCounter && e.target.addSavingWorldTransform(n._molContainer)
                    }

                    function o(e) {
                        (n._pressedGripsCounter--, 1 === n._pressedGripsCounter) ? (n._gfx.scene.addSavingWorldTransform(n._molContainer), (e.target === n._controller1 ? n._controller2 : n._controller1).addSavingWorldTransform(n._molContainer)) : 0 === n._pressedGripsCounter && n._gfx.scene.addSavingWorldTransform(n._molContainer)
                    }
                    n._controller1.addEventListener("gripsdown", r), n._controller1.addEventListener("gripsup", o), n._controller2.addEventListener("gripsdown", r), n._controller2.addEventListener("gripsup", o)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "toggle",
                    value: function(e, t) {
                        void 0 === t && v.warn("WebVR couldn't be enabled, because gfx is not defined");
                        this._gfx = t;
                        var n = t ? t.renderer : null;
                        if (!n) throw new Error("No renderer is available to toggle WebVR");
                        if (!t.camera) throw new Error("No camera is available to toggle WebVR");
                        if (e && !n.vr.enabled) this._mainCamera.copy(t.camera), this._cameraWasStored = !0, n.vr.enabled = !0, this._button ? this._button.style.display = "block" : (this._button = function(e) {
                            function t(t, n) {
                                n.style.display = "", n.style.cursor = "pointer", n.style.left = "calc(50% - 50px)", n.style.width = "100px", n.textContent = "ENTER VR", n.onmouseenter = function() {
                                    n.style.opacity = "1.0"
                                }, n.onmouseleave = function() {
                                    n.style.opacity = "0.5"
                                }, n.onclick = function() {
                                    t.isPresenting ? t.exitPresent() : (t.requestPresent([{
                                        source: e.getCanvas()
                                    }]), e.translateMolecule())
                                }, e.setDevice(t)
                            }

                            function n(t) {
                                t.style.display = "", t.style.cursor = "auto", t.style.left = "calc(50% - 75px)", t.style.width = "150px", t.textContent = "VR NOT FOUND", t.onmouseenter = null, t.onmouseleave = null, t.onclick = null, e.setDevice(null)
                            }

                            function r(e) {
                                e.style.position = "absolute", e.style.bottom = "20px", e.style.padding = "12px 6px", e.style.border = "1px solid #fff", e.style.borderRadius = "4px", e.style.background = "transparent", e.style.color = "#fff", e.style.font = "normal 13px sans-serif", e.style.textAlign = "center", e.style.opacity = "0.5", e.style.outline = "none", e.style.zIndex = "999"
                            }
                            if ("getVRDisplays" in navigator) {
                                var o = document.createElement("button");
                                return o.style.display = "none", r(o), window.addEventListener("vrdisplayconnect", function(e) {
                                    t(e.display, o)
                                }, !1), window.addEventListener("vrdisplaydisconnect", function(e) {
                                    n(o)
                                }, !1), window.addEventListener("vrdisplaypresentchange", function(e) {
                                    o.textContent = e.display.isPresenting ? "EXIT VR" : "ENTER VR"
                                }, !1), navigator.getVRDisplays().then(function(e) {
                                    e.length > 0 ? t(e[0], o) : n(o)
                                }), o
                            }
                            var i = document.createElement("a");
                            return i.href = "https://webvr.info", i.innerHTML = "WEBVR NOT SUPPORTED", i.style.left = "calc(50% - 90px)", i.style.width = "180px", i.style.textDecoration = "none", r(i), i
                        }(this), document.body.appendChild(this._button)), this._user && t.scene.add(this._user), H.set("fog", !1), t.scene.add(this._molContainer), this._molContainer.add(t.root), this._controller1.standingMatrix = n.vr.getStandingMatrix(), this._controller2.standingMatrix = n.vr.getStandingMatrix();
                        else if (!e && n.vr.enabled) {
                            var r = this.getDevice();
                            r && r.isPresenting && r.exitPresent(), n.vr.enabled = !1, this._button && (this._button.style.display = "none"), this._cameraWasStored && t.camera.copy(this._mainCamera), H.set("fog", !0);
                            var o = this._molContainer.children[0];
                            o && t.scene.add(o), this._molContainer.parent.remove(this._molContainer), this._user && t.scene.remove(this._user)
                        }
                        this._onToggle && this._onToggle(e)
                    }
                }, {
                    key: "updateMoleculeScale",
                    value: function() {
                        if (this._controller1 && this._controller2) {
                            this._controller1.update(), this._controller2.update();
                            if (2 === this._pressedGripsCounter) {
                                $r.getMiddlePoint(this._controller1.position, this._controller2.position, this._scalingPivot.position);
                                var e = this._controller1.position.distanceTo(this._controller2.position),
                                    t = e / this._distance;
                                this._scalingPivot.scale.multiplyScalar(t), this._distance = e
                            }
                        }
                    }
                }, {
                    key: "translateMolecule",
                    value: function() {
                        if (this.getDevice()) {
                            var e = this._gfx,
                                t = e.camera,
                                n = this._molContainer;
                            n.matrix.identity(), n.position.set(0, 0, -1.3), n.updateMatrix(), n.matrixWorld.multiplyMatrices(t.matrixWorld, n.matrix), e.scene.addSavingWorldTransform(n)
                        }
                    }
                }, {
                    key: "getDevice",
                    value: function() {
                        var e = this._gfx && this._gfx.renderer ? this._gfx.renderer.vr : null;
                        return e && e.enabled ? e.getDevice() : null
                    }
                }, {
                    key: "setDevice",
                    value: function(e) {
                        var t = this._gfx && this._gfx.renderer ? this._gfx.renderer.vr : null;
                        t && t.setDevice(e)
                    }
                }, {
                    key: "getCanvas",
                    value: function() {
                        var e = this._gfx;
                        return e && e.renderer ? e.renderer.domElement : null
                    }
                }]) && Rx(t.prototype, n), r && Rx(t, r), e
            }();

            function Mx(e, t) {
                return function(e) {
                    if (Array.isArray(e)) return e
                }(e) || function(e, t) {
                    var n = [],
                        r = !0,
                        o = !1,
                        i = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        o = !0, i = e
                    } finally {
                        try {
                            r || null == s.return || s.return()
                        } finally {
                            if (o) throw i
                        }
                    }
                    return n
                }(e, t) || function() {
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }()
            }
            var Nx, Lx, jx, Dx, Vx, Fx, Bx, zx, Ux, Gx, Hx, Wx, qx, Yx, Xx, $x = hr.selectors,
                Kx = hr.Atom,
                Zx = hr.Residue,
                Qx = hr.Chain,
                Jx = hr.Molecule,
                eS = 0,
                tS = 1,
                nS = 2,
                rS = R.createElement;

            function oS(e) {
                var t = e.lastIndexOf(".");
                return t >= 0 && (e = e.substr(0, t)), e
            }

            function iS(e, t, n) {
                void 0 !== n ? e.debug("".concat(t, "... ").concat(Math.floor(100 * n), "%")) : e.debug("".concat(t, "..."))
            }

            function aS() {
                return H.now.fogColorEnable ? H.now.fogColor : H.now.bg.color
            }

            function sS(e) {
                h.call(this), this._opts = l.a.merge({
                    settingsCookie: "settings",
                    cookiePath: "/"
                }, e), this._gfx = null, this._container = e && e.container || document.getElementById("miew-container") || l.a.head(document.getElementsByClassName("miew-container")) || document.body, this._containerRoot = this._container, this._running = !1, this._halting = !1, this._building = !1, this._needRender = !0, this._hotKeysEnabled = !0, this.settings = H;
                var t = v;
                t.console = !1, t.level = "info", this.logger = t, this._cookies = new _x(this), this.restoreSettings(), e && e.settings && this.settings.set(e.settings), this._spinner = null, this._loading = [], this._animInterval = null, this._visuals = {}, this._curVisualName = null, this._objects = [], this._sourceWindow = null, this._srvTopoSource = null, this._srvAnimSource = null, this.reset(), this._repr && t.debug("Selected ".concat(this._repr.mode.name, " mode with ").concat(this._repr.colorer.name, " colorer."));
                var n = this;
                sS.registeredPlugins.forEach(function(e) {
                    e.call(n)
                }), this._initOnSettingsChanged()
            }

            function lS(e, t) {
                for (var n = e; n.firstChild;) n.removeChild(n.firstChild);
                n.appendChild(t)
            }
            sS.prototype = Object.create(h.prototype), sS.prototype.constructor = sS, sS.prototype.getMaxRepresentationCount = function() {
                return Oy.NUM_REPRESENTATION_BITS
            }, sS.prototype.init = function() {
                var e = this._container,
                    t = R.createElement("div", {
                        class: "miew-canvas"
                    });
                lS(e, t), this._container = t;
                var n = document.createDocumentFragment();
                if (n.appendChild(this._msgMode = rS("div", {
                        class: "mode-message overlay"
                    }, rS("p", {}, "COMPONENT EDIT MODE"))), n.appendChild(this._msgAtomInfo = rS("div", {
                        class: "atom-info overlay"
                    }, rS("p", {}, ""))), e.appendChild(n), null !== this._gfx) return !0;
                var r = this;
                this._showMessage("Viewer is being initialized...");
                try {
                    this._initGfx(), this._initListeners(), this._spinner = new u.a({
                        lines: 13,
                        length: 28,
                        width: 14,
                        radius: 42,
                        color: "#fff",
                        zIndex: 700
                    }), window.top.addEventListener("keydown", function(e) {
                        r._onKeyDown(e)
                    }), window.top.addEventListener("keyup", function(e) {
                        r._onKeyUp(e)
                    }), this._objectControls = new lw(this._gfx.root, this._gfx.pivot, this._gfx.camera, this._gfx.renderer.domElement, function() {
                        return r._getAltObj()
                    }), this._objectControls.addEventListener("change", function(e) {
                        switch (e.action) {
                            case "rotate":
                                r.dispatchEvent({
                                    type: "rotate",
                                    angle: e.angle
                                });
                                break;
                            case "zoom":
                                r.dispatchEvent({
                                    type: "zoom",
                                    factor: e.factor
                                })
                        }
                        r.dispatchEvent({
                            type: "transform"
                        }), r._needRender = !0
                    });
                    var o = this._gfx;
                    this._picker = new uw(o.root, o.camera, o.renderer.domElement), this._picker.addEventListener("newpick", function(e) {
                        r._onPick(e)
                    }), this._picker.addEventListener("dblclick", function(e) {
                        r._onDblClick(e)
                    }), H._changed["bg.color"] || H.set("bg.color", H.now.themes[H.now.theme])
                } catch (e) {
                    if ("TypeError" !== e.name || "Cannot read property 'getExtension' of null" !== e.message) throw this._showMessage("Viewer initialization failed."), e;
                    return this._showMessage("Could not create WebGL context."), !1
                }
                var i = this._opts && this._opts.load;
                if (i) {
                    var a = this._opts && this._opts.type;
                    this.load(i, {
                        fileType: a,
                        keepRepsInfo: !0
                    })
                }
                return !0
            }, sS.prototype.term = function() {
                this._showMessage("Viewer has been terminated."), this._loading.forEach(function(e) {
                    e.cancel()
                }), this._loading.length = 0, this.halt(), this._gfx = null
            }, sS.prototype._showMessage = function(e) {
                var t = document.createElement("div");
                t.setAttribute("class", "miew-message"), t.appendChild(document.createElement("p")).appendChild(document.createTextNode(e)), lS(this._container, t)
            }, sS.prototype._showCanvas = function() {
                lS(this._container, this._gfx.renderer.domElement)
            }, sS.prototype._initGfx = function() {
                var e = this,
                    t = {
                        width: this._container.clientWidth,
                        height: this._container.clientHeight
                    },
                    n = {
                        preserveDrawingBuffer: !0,
                        alpha: !0,
                        premultipliedAlpha: !1
                    };
                H.now.antialias && (n.antialias = !0), t.renderer2d = new rw, t.renderer = new c.WebGLRenderer(n), t.renderer.shadowMap.enabled = !1, t.renderer.shadowMap.type = c.PCFShadowMap, Ar.init(t.renderer), t.renderer.getContext().getExtension("EXT_frag_depth") || H.set("zSprites", !1), t.renderer.getContext().getExtension("WEBGL_depth_texture") && t.renderer.getContext().getExtension("WEBGL_draw_buffers") || H.set("ao", !1), t.renderer.autoClear = !1, t.renderer.setPixelRatio(window.devicePixelRatio), t.renderer.setSize(t.width, t.height), t.renderer.setClearColor(H.now.bg.color, Number(!H.now.bg.transparent)), t.renderer.clearColor(), t.renderer2d.setSize(t.width, t.height), t.camera = new c.PerspectiveCamera(H.now.camFov, t.width / t.height, H.now.camNear, H.now.camFar), t.camera.setMinimalFov(H.now.camFov), t.camera.position.z = H.now.camDistance, t.camera.updateProjectionMatrix(), t.camera.layers.set($r.LAYERS.DEFAULT), t.camera.layers.enable($r.LAYERS.VOLUME), t.camera.layers.enable($r.LAYERS.VOLUME_BFPLANE), t.stereoCam = new c.StereoCamera, t.scene = new c.Scene;
                var r = aS();
                t.scene.fog = new c.Fog(r, H.now.camNear, H.now.camFar), t.root = new $r.RCGroup, t.scene.add(t.root), t.pivot = new $r.RCGroup, t.root.add(t.pivot), t.selectionScene = new c.Scene, t.selectionRoot = new c.Group, t.selectionRoot.matrixAutoUpdate = !1, t.selectionScene.add(t.selectionRoot), t.selectionPivot = new c.Group, t.selectionPivot.matrixAutoUpdate = !1, t.selectionRoot.add(t.selectionPivot);
                var o = new c.DirectionalLight(16777215, .45);
                o.position.set(0, .414, 1), o.layers.enable($r.LAYERS.TRANSPARENT), o.castShadow = !0, o.shadow = new c.DirectionalLightShadow, o.shadow.bias = .09, o.shadow.radius = H.now.shadow.radius;
                var i = Math.max(t.width, t.height) * window.devicePixelRatio;
                o.shadow.mapSize.width = i, o.shadow.mapSize.height = i, t.scene.add(o);
                var a = new c.AmbientLight(6710886);
                a.layers.enable($r.LAYERS.TRANSPARENT), t.scene.add(a), t.axes = new fw(t.root, t.camera), t.offscreenBuf = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.NearestFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !0
                }), t.renderer.getContext().getExtension("WEBGL_depth_texture") && (t.offscreenBuf.depthTexture = new c.DepthTexture, t.offscreenBuf.depthTexture.type = c.UnsignedShortType), t.offscreenBuf2 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !1
                }), t.offscreenBuf3 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !1
                }), t.offscreenBuf4 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !1
                }), t.volBFTex = t.offscreenBuf3, t.volFFTex = t.offscreenBuf4, t.volWFFTex = t.offscreenBuf, t.renderer.getContext().getExtension("OES_texture_float") ? (t.offscreenBuf5 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    type: c.FloatType,
                    depthBuffer: !1
                }), t.offscreenBuf6 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    type: c.FloatType,
                    depthBuffer: !1
                }), t.offscreenBuf7 = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    type: c.FloatType,
                    depthBuffer: !0
                }), t.volBFTex = t.offscreenBuf5, t.volFFTex = t.offscreenBuf6, t.volWFFTex = t.offscreenBuf7) : this.logger.warn("Device doesn't support OES_texture_float extension"), t.stereoBufL = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !1
                }), t.stereoBufR = new c.WebGLRenderTarget(t.width * window.devicePixelRatio, t.height * window.devicePixelRatio, {
                    minFilter: c.LinearFilter,
                    magFilter: c.LinearFilter,
                    format: c.RGBAFormat,
                    depthBuffer: !1
                }), this._gfx = t, this._showCanvas(), "WEBVR" === H.now.stereo && (this.webVR = new Ix(function() {
                    e._needRender = !0, e._onResize()
                }), this.webVR.toggle(!0, t)), this._container.appendChild(t.renderer2d.getElement());
                var s = new L;
                s.domElement.style.position = "absolute", s.domElement.style.right = "0", s.domElement.style.bottom = "0", this._container.appendChild(s.domElement), this._fps = s, this._fps.show(H.now.fps)
            }, sS.prototype._initListeners = function() {
                var e = this;
                window.addEventListener("resize", function() {
                    e._onResize()
                })
            }, sS.prototype._makeUniqueVisualName = function(e) {
                if (!e) return Math.random().toString();
                for (var t = e, n = 1; this._visuals.hasOwnProperty(t);) t = "".concat(e, " (").concat(n.toString(), ")"), n++;
                return t
            }, sS.prototype._addVisual = function(e) {
                if (!e) return null;
                var t = this._makeUniqueVisualName(e.name);
                return e.name = t, this._visuals[t] = e, this._gfx.pivot.add(e), e.getSelectionGeo && this._gfx.selectionPivot.add(e.getSelectionGeo()), t
            }, sS.prototype._removeVisual = function(e) {
                var t = "",
                    n = null;
                e instanceof Qr ? (t = e.name, n = e) : "string" == typeof e && (t = e, n = this._visuals[t]), n && this._visuals.hasOwnProperty(t) && this._visuals[t] === n && (t === this._curVisualName && (this._curVisualName = void 0), delete this._visuals[t], n.release(), this._needRender = !0)
            }, sS.prototype._forEachVisual = function(e) {
                for (var t in this._visuals) this._visuals.hasOwnProperty(t) && e(this._visuals[t])
            }, sS.prototype._releaseAllVisuals = function() {
                if (this._gfx && this._gfx.pivot) {
                    for (var e in this._visuals) this._visuals.hasOwnProperty(e) && this._visuals[e].release();
                    this._visuals = {}
                }
            }, sS.prototype._forEachComplexVisual = function(e) {
                if (this._gfx && this._gfx.pivot)
                    for (var t in this._visuals) this._visuals.hasOwnProperty(t) && this._visuals[t] instanceof Oy && e(this._visuals[t])
            }, sS.prototype._getComplexVisual = function(e) {
                e = e || this._curVisualName;
                var t = null,
                    n = null;
                return this._forEachComplexVisual(function(r) {
                    t = r, r.name === e && (n = r)
                }), n || t
            }, sS.prototype._getVolumeVisual = function() {
                var e = null;
                return this._forEachVisual(function(t) {
                    t instanceof Uy && (e = t)
                }), e
            }, sS.prototype._getVisualForComplex = function(e) {
                if (!e) return null;
                var t = null;
                return this._forEachComplexVisual(function(n) {
                    n.getComplex() === e && (t = n)
                }), t
            }, sS.prototype.getVisuals = function() {
                return Object.keys(this._visuals)
            }, sS.prototype.getCurrentVisual = function() {
                return this._curVisualName
            }, sS.prototype.setCurrentVisual = function(e) {
                this._visuals[e] && (this._curVisualName = e)
            }, sS.prototype.run = function() {
                var e = this;
                if (!this._running) {
                    if (this._running = !0, this._halting) return void(this._halting = !1);
                    this._objectControls.enable(!0), ((this.webVR ? this.webVR.getDevice() : null) || window).requestAnimationFrame(function() {
                        return e._onTick()
                    })
                }
            }, sS.prototype.halt = function() {
                this._running && (this._discardComponentEdit(), this._discardFragmentEdit(), this._objectControls.enable(!1), this._halting = !0)
            }, sS.prototype.enableHotKeys = function(e) {
                this._hotKeysEnabled = e, this._objectControls.enableHotkeys(e)
            }, sS.prototype._onResize = function() {
                this._needRender = !0;
                var e = this._gfx;
                e.width = this._container.clientWidth, e.height = this._container.clientHeight, e.camera.aspect = e.width / e.height, e.camera.setMinimalFov(H.now.camFov), e.camera.updateProjectionMatrix(), e.renderer.setSize(e.width, e.height), e.renderer2d.setSize(e.width, e.height), this.dispatchEvent({
                    type: "resize"
                })
            }, sS.prototype._resizeOffscreenBuffers = function(e, t, n) {
                var r = this._gfx,
                    o = "NONE" === (n = n || "NONE") || "ANAGLYPH" === n,
                    i = o ? 1 : .5;
                r.offscreenBuf.setSize(i * e, t), r.offscreenBuf2.setSize(i * e, t), r.offscreenBuf3.setSize(i * e, t), r.offscreenBuf4.setSize(i * e, t), r.offscreenBuf5 && r.offscreenBuf5.setSize(i * e, t), r.offscreenBuf6 && r.offscreenBuf6.setSize(i * e, t), r.offscreenBuf7 && r.offscreenBuf7.setSize(i * e, t), o && (r.stereoBufL.setSize(e, t), r.stereoBufR.setSize(e, t))
            }, sS.prototype._onTick = function() {
                var e = this;
                if (this._halting) return this._running = !1, void(this._halting = !1);
                this._fps.update();
                var t = this.webVR ? this.webVR.getDevice() : null;
                (t || window).requestAnimationFrame(function() {
                    return e._onTick()
                }), this._onUpdate(), this._needRender && (this._onRender(), this._needRender = !H.now.suspendRender || "WEBVR" === H.now.stereo || !!t)
            }, sS.prototype._getBSphereRadius = function() {
                var e = 0;
                return this._forEachVisual(function(t) {
                    e = Math.max(e, t.getBoundaries().boundingSphere.radius)
                }), e * this._objectControls.getScale()
            }, sS.prototype._updateFog = function() {
                var e, t, n, r = this._gfx;
                if (H.now.fog) {
                    if (void 0 === r.scene.fog || null === r.scene.fog) {
                        var o = aS();
                        r.scene.fog = new c.Fog(o), this._setUberMaterialValues({
                            fog: H.now.fog
                        })
                    }
                    e = r.scene.fog, t = r.camera.position.z, n = this._getBSphereRadius(), e.near = t - n * H.now.fogNearFactor, e.far = t + n * H.now.fogFarFactor
                } else r.scene.fog && (r.scene.fog = void 0, this._setUberMaterialValues({
                    fog: H.now.fog
                }))
            }, sS.prototype._onUpdate = function() {
                void 0 !== this.isScriptingCommandAvailable && this.isScriptingCommandAvailable() && !this._building && this.callNextCmd(), this._objectControls.update(), this._forEachComplexVisual(function(e) {
                    e.getComplex().update()
                }), H.now.autobuild && !this._loading.length && !this._building && this._needRebuild() && this.rebuild(), this._loading.length || this._building || this._needRebuild() || this._updateView(), this._updateFog(), this._gfx.renderer.vr.enabled && this.webVR.updateMoleculeScale()
            }, sS.prototype._onRender = function() {
                var e = this._gfx;
                e.scene.updateMatrixWorld(), e.camera.updateMatrixWorld(), this._clipPlaneUpdateValue(this._getBSphereRadius()), this._updateShadow(this._getBSphereRadius()), this._fogFarUpdateValue(), e.renderer.setRenderTarget(null), e.renderer.clear(), this._renderFrame(H.now.stereo)
            }, sS.prototype._renderFrame = (Nx = new Jw, Lx = new c.Vector2, function(e) {
                var t = this._gfx,
                    n = t.renderer;
                switch ("NONE" !== e && (t.stereoCam.aspect = "ANAGLYPH" === e ? 1 : .5, t.camera.focus = t.camera.position.z, t.stereoCam.update(t.camera)), n.getSize(Lx), this._resizeOffscreenBuffers(Lx.width * window.devicePixelRatio, Lx.height * window.devicePixelRatio, e), e) {
                    case "WEBVR":
                    case "NONE":
                        this._renderScene(t.camera, !1);
                        break;
                    case "SIMPLE":
                    case "DISTORTED":
                        n.setScissorTest(!0), n.setScissor(0, 0, Lx.width / 2, Lx.height), n.setViewport(0, 0, Lx.width / 2, Lx.height), this._renderScene(this._gfx.stereoCam.cameraL, "DISTORTED" === e), n.setScissor(Lx.width / 2, 0, Lx.width / 2, Lx.height), n.setViewport(Lx.width / 2, 0, Lx.width / 2, Lx.height), this._renderScene(this._gfx.stereoCam.cameraR, "DISTORTED" === e), n.setScissorTest(!1);
                        break;
                    case "ANAGLYPH":
                        this._renderScene(this._gfx.stereoCam.cameraL, !1, t.stereoBufL), this._renderScene(this._gfx.stereoCam.cameraR, !1, t.stereoBufR), Nx.uniforms.srcL.value = t.stereoBufL, Nx.uniforms.srcR.value = t.stereoBufR, t.renderer.renderScreenQuad(Nx)
                }
                t.renderer2d.render(t.scene, t.camera), H.now.axes && t.axes && !t.renderer.vr.enabled && t.axes.render(n)
            }), sS.prototype._onThemeChanged = (jx = /\s*theme-\w+\b/g, function() {
                var e = H.now.theme,
                    t = this._containerRoot;
                t.className = "".concat(t.className.replace(jx, ""), " theme-").concat(e), H.set("bg.color", H.now.themes[e]), this._needRender = !0
            }), sS.prototype._onBgColorChanged = function() {
                var e = this._gfx,
                    t = aS();
                e && (e.scene.fog && e.scene.fog.color.set(t), e.renderer.setClearColor(H.now.bg.color, Number(!H.now.bg.transparent))), this._needRender = !0
            }, sS.prototype._onFogColorChanged = function() {
                var e = this._gfx,
                    t = aS();
                e && e.scene.fog && e.scene.fog.color.set(t), this._needRender = !0
            }, sS.prototype._setUberMaterialValues = function(e) {
                this._gfx.root.traverse(function(t) {
                    (t instanceof c.Mesh || t instanceof c.LineSegments || t instanceof c.Line) && t.material instanceof Gr && (t.material.setValues(e), t.material.needsUpdate = !0)
                })
            }, sS.prototype._setMRT = function(e, t) {
                var n = this._gfx,
                    r = n.renderer.getContext(),
                    o = r.getExtension("WEBGL_draw_buffers"),
                    i = n.renderer.properties;
                n.renderer.setRenderTarget(t);
                var a = i.get(t.texture).__webglTexture;
                r.bindTexture(r.TEXTURE_2D, a), n.renderer.setRenderTarget(e);
                var s = i.get(e).__webglFramebuffer,
                    l = i.get(e.texture).__webglTexture;
                r.bindFramebuffer(r.FRAMEBUFFER, s), s.width = e.width, s.height = e.height, r.framebufferTexture2D(r.FRAMEBUFFER, r.COLOR_ATTACHMENT0, r.TEXTURE_2D, l, 0), r.framebufferTexture2D(r.FRAMEBUFFER, o.COLOR_ATTACHMENT1_WEBGL, r.TEXTURE_2D, a, 0), o.drawBuffersWEBGL([r.COLOR_ATTACHMENT0, o.COLOR_ATTACHMENT1_WEBGL])
            }, sS.prototype._renderScene = function(e, t, n) {
                t = t || !1, n = n || null;
                var r = this._gfx;
                if (r.renderer.setClearColor(H.now.bg.color, Number(!H.now.bg.transparent)), r.renderer.setRenderTarget(n), r.renderer.clear(), r.renderer.vr.enabled) r.renderer.render(r.scene, e);
                else {
                    r.renderer.setRenderTarget(r.offscreenBuf), r.renderer.clear();
                    var o = null !== this._getComplexVisual(),
                        i = this._getVolumeVisual(),
                        a = o && H.now.ao;
                    a && this._setMRT(r.offscreenBuf, r.offscreenBuf4), "prepass" === H.now.transparency ? this._renderWithPrepassTransparency(e, r.offscreenBuf) : "standard" === H.now.transparency && (r.renderer.setRenderTarget(r.offscreenBuf), r.renderer.render(r.scene, e));
                    var s = o && H.now.outline.on,
                        l = o && H.now.fxaa,
                        c = null !== i && null != i.getMesh().material,
                        u = a || s || c || l || t ? r.offscreenBuf2 : n,
                        p = r.offscreenBuf;
                    a ? (this._performAO(p, r.offscreenBuf4, r.offscreenBuf.depthTexture, u, r.offscreenBuf3, r.offscreenBuf2), l || t || c || s || (r.renderer.setRenderTarget(n), r.renderer.renderScreenQuadFromTex(u.texture, 1))) : (r.renderer.setRenderTarget(u), r.renderer.renderScreenQuadFromTex(p.texture, 1)), s && (p = u, u = c || l || t ? r.offscreenBuf3 : n, null != p && this._renderOutline(e, r.offscreenBuf, p, u)), this._renderSelection(e, r.offscreenBuf, u), c && (r.renderer.setRenderTarget(r.offscreenBuf), r.renderer.renderScreenQuadFromTex(u.texture, 1), u = r.offscreenBuf, this._renderVolume(i, e, u, r.volBFTex, r.volFFTex, r.volWFFTex), l || t || (r.renderer.setRenderTarget(n), r.renderer.renderScreenQuadFromTex(u.texture, 1))), p = u, l && (u = t ? r.offscreenBuf2 : n, this._performFXAA(p, u), p = u), t && (u = n, this._performDistortion(p, u, !0))
                }
            }, sS.prototype._performDistortion = function() {
                var e = new c.Scene,
                    t = new c.OrthographicCamera(-1, 1, 1, -1, -500, 1e3),
                    n = new c.ShaderMaterial({
                        uniforms: {
                            srcTex: {
                                type: "t",
                                value: null
                            },
                            aberration: {
                                type: "fv3",
                                value: new c.Vector3(1)
                            }
                        },
                        vertexShader: "varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }",
                        fragmentShader: "varying vec2 vUv; uniform sampler2D srcTex; uniform vec3 aberration;void main() {vec2 uv = vUv * 2.0 - 1.0;gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;gl_FragColor.a = 1.0;}",
                        transparent: !1,
                        depthTest: !1,
                        depthWrite: !1
                    }),
                    r = $r.buildDistorionMesh(10, 10, H.now.debug.stereoBarrel);
                return e.add(new Cl.Mesh(r, n)),
                    function(r, o, i) {
                        this._gfx.renderer.setRenderTarget(o), this._gfx.renderer.clear(), i ? (n.uniforms.srcTex.value = r.texture, n.uniforms.aberration.value.set(.995, 1, 1.01), this._gfx.renderer.render(e, t)) : this._gfx.renderer.renderScreenQuadFromTexWithDistortion(r, H.now.debug.stereoBarrel)
                    }
            }(), sS.prototype._renderOutline = (Dx = new Vw({
                depth: !0
            }), function(e, t, n, r) {
                var o = this._gfx;
                Dx.uniforms.srcTex.value = n.texture, Dx.uniforms.srcDepthTex.value = t.depthTexture, Dx.uniforms.srcTexSize.value.set(t.width, t.height), Dx.uniforms.color.value = new c.Color(H.now.outline.color), Dx.uniforms.threshold.value = H.now.outline.threshold, o.renderer.setRenderTarget(r), o.renderer.renderScreenQuad(Dx)
            }), sS.prototype._renderSelection = function() {
                var e = new Vw;
                return function(t, n, r) {
                    var o = this._gfx;
                    o.renderer.setClearColor("black", 0), o.selectionPivot.children.length > 0 ? (o.renderer.setRenderTarget(n), o.renderer.clear(!0, !1, !1), o.selectionRoot.matrix = o.root.matrix, o.selectionPivot.matrix = o.pivot.matrix, o.renderer.render(o.selectionScene, t)) : (o.renderer.setRenderTarget(null), o.renderer.renderDummyQuad(n)), o.renderer.setRenderTarget(r), o.renderer.renderScreenQuadFromTex(n.texture, .6), e.uniforms.srcTex.value = n.texture, e.uniforms.srcTexSize.value.set(n.width, n.height), o.renderer.renderScreenQuad(e)
                }
            }(), sS.prototype._checkVolumeRenderingSupport = function(e) {
                if (!e) return !1;
                var t = this._gfx,
                    n = t.renderer.getRenderTarget();
                t.renderer.setRenderTarget(e);
                var r = t.renderer.getContext(),
                    o = r.checkFramebufferStatus(r.FRAMEBUFFER);
                return t.renderer.setRenderTarget(n), o === r.FRAMEBUFFER_COMPLETE || (this.logger.warn("Device doesn't support electron density rendering"), !1)
            }, sS.prototype._renderVolume = (Fx = new Ry.BackFacePosMaterial, Bx = new Ry.FrontFacePosMaterial, zx = (new c.Matrix4).makeTranslation(.5, .5, .5), Ux = new c.Matrix4, function(e, t, n, r, o, i) {
                var a = this._gfx;
                if (void 0 === Vx && (Vx = this._checkVolumeRenderingSupport(r)), Vx) {
                    var s = e.getMesh();
                    s.rebuild(t), a.renderer.setClearColor("black", 0), a.renderer.setRenderTarget(r), a.renderer.clear(), a.renderer.setRenderTarget(o), a.renderer.clear(), a.renderer.setRenderTarget(i), a.renderer.clear(), a.renderer.setRenderTarget(r), t.layers.set($r.LAYERS.VOLUME_BFPLANE), a.renderer.render(a.scene, t), t.layers.set($r.LAYERS.VOLUME), a.scene.overrideMaterial = Fx, a.renderer.render(a.scene, t), a.renderer.setRenderTarget(o), t.layers.set($r.LAYERS.VOLUME), a.scene.overrideMaterial = Bx, a.renderer.render(a.scene, t), a.scene.overrideMaterial = null, t.layers.set($r.LAYERS.DEFAULT), Ux.getInverse(s.matrixWorld), Gr.prototype.uberOptions.world2colorMatrix.multiplyMatrices(zx, Ux), t.layers.set($r.LAYERS.COLOR_FROM_POSITION), a.renderer.setRenderTarget(i), a.renderer.render(a.scene, t);
                    var l = s.material;
                    l.uniforms._BFRight.value = r.texture, l.uniforms._FFRight.value = o.texture, l.uniforms._WFFRight.value = i.texture, t.layers.set($r.LAYERS.VOLUME), a.renderer.setRenderTarget(n), a.renderer.render(a.scene, t), t.layers.set($r.LAYERS.DEFAULT)
                }
            }), sS.prototype._renderWithPrepassTransparency = function(e, t) {
                var n = this._gfx;
                n.renderer.setRenderTarget(t), e.layers.set($r.LAYERS.DEFAULT), n.renderer.render(n.scene, e), e.layers.set($r.LAYERS.PREPASS_TRANSPARENT), n.renderer.context.colorMask(!1, !1, !1, !1), n.renderer.render(n.scene, e), n.renderer.context.colorMask(!0, !0, !0, !0), e.layers.set($r.LAYERS.TRANSPARENT), n.renderer.render(n.scene, e), e.layers.set($r.LAYERS.DEFAULT)
            }, sS.prototype._performFXAA = (Gx = new Uw, function(e, t) {
                if (void 0 !== e && void 0 !== t) {
                    var n = this._gfx;
                    n.renderer.setClearColor(H.now.bg.color, Number(!H.now.bg.transparent)), n.renderer.setRenderTarget(t), n.renderer.clear(), Gx.uniforms.srcTex.value = e.texture, Gx.uniforms.srcTexelSize.value.set(1 / e.width, 1 / e.height), Gx.uniforms.bgColor.value.set(H.now.bg.color), Gx.bgTransparent !== H.now.bg.transparent && (Gx.setValues({
                        bgTransparent: H.now.bg.transparent
                    }), Gx.needsUpdate = !0), n.renderer.renderScreenQuad(Gx)
                }
            }), sS.prototype._performAO = (Hx = new $w.AOMaterial, Wx = new $w.HorBilateralBlurMaterial, qx = new $w.VertBilateralBlurMaterial, Yx = [new c.Vector3(.295184, .077723, .068429), new c.Vector3(-.271976, -.365221, .838363), new c.Vector3(.547713, .467576, .488515), new c.Vector3(.662808, -.031733, .584758), new c.Vector3(-.025717, .218955, .657094), new c.Vector3(-.310153, -.365223, .370701), new c.Vector3(-.101407, -.006313, .747665), new c.Vector3(-.769138, .360399, .086847), new c.Vector3(-.271988, -.27514, .905353), new c.Vector3(.09674, -.566901, .700151), new c.Vector3(.562872, -.735136, .094647), new c.Vector3(.379877, .359278, .190061), new c.Vector3(.519064, -.023055, .405068), new c.Vector3(-.301036, .114696, .088885), new c.Vector3(-.282922, .598305, .487214), new c.Vector3(-.181859, .25167, .679702), new c.Vector3(-.191463, -.635818, .512919), new c.Vector3(-.293655, .427423, .078921), new c.Vector3(-.267983, .680534, .13288), new c.Vector3(.139611, .319637, .477439), new c.Vector3(-.352086, .31104, .653913), new c.Vector3(.321032, .805279, .487345), new c.Vector3(.073516, .820734, .414183), new c.Vector3(-.155324, .589983, .41146), new c.Vector3(.335976, .170782, .527627), new c.Vector3(.46346, -.355658, .167689), new c.Vector3(.222654, .59655, .769406), new c.Vector3(.922138, -.04207, .147555), new c.Vector3(-.72705, -.329192, .369826), new c.Vector3(-.090731, .53382, .463767), new c.Vector3(-.323457, -.876559, .238524), new c.Vector3(-.663277, -.372384, .342856)], Xx = [-2, -1, 0, 1, 2], function(e, t, n, r, o, i) {
                if (e && t && n && r && o && i) {
                    var a = this._gfx;
                    Hx.uniforms.diffuseTexture.value = e.texture, Hx.uniforms.depthTexture.value = n, Hx.uniforms.normalTexture.value = t.texture, Hx.uniforms.srcTexelSize.value.set(1 / e.width, 1 / e.height), Hx.uniforms.camNearFar.value.set(a.camera.near, a.camera.far), Hx.uniforms.projMatrix.value = a.camera.projectionMatrix, Hx.uniforms.aspectRatio.value = a.camera.aspect, Hx.uniforms.tanHalfFOV.value = Math.tan(.5 * c.Math.DEG2RAD * a.camera.fov), Hx.uniforms.samplesKernel.value = Yx;
                    var s = new c.Vector3,
                        l = new c.Quaternion,
                        u = new c.Vector3;
                    a.root.matrix.decompose(s, l, u), Hx.uniforms.kernelRadius.value = H.now.debug.ssaoKernelRadius * u.x, Hx.uniforms.depthThreshold.value = 2 * this._getBSphereRadius(), Hx.uniforms.factor.value = H.now.debug.ssaoFactor, Hx.uniforms.noiseTexture.value = jr.noiseTexture, Hx.uniforms.noiseTexelSize.value.set(1 / jr.noiseWidth, 1 / jr.noiseHeight);
                    var p = a.scene.fog;
                    p && Hx.uniforms.fogNearFar.value.set(p.near, p.far), Hx.transparent = !1, a.renderer.setRenderTarget(i), a.renderer.renderScreenQuad(Hx), Wx.uniforms.aoMap.value = i.texture, Wx.uniforms.srcTexelSize.value.set(1 / i.width, 1 / i.height), Wx.uniforms.depthTexture.value = n, Wx.uniforms.samplesOffsets.value = Xx, a.renderer.setRenderTarget(o), a.renderer.renderScreenQuad(Wx), qx.uniforms.aoMap.value = o.texture, qx.uniforms.diffuseTexture.value = e.texture, qx.uniforms.srcTexelSize.value.set(1 / o.width, 1 / o.height), qx.uniforms.depthTexture.value = n, qx.uniforms.samplesOffsets.value = Xx, a.renderer.setRenderTarget(r), a.renderer.renderScreenQuad(qx)
                }
            }), sS.prototype.reset = function() {
                this._picker && this._picker.reset(), this._lastPick = null, this._releaseAllVisuals(), this._setEditMode(eS), this._resetObjects(), this._gfx && ($r.clearTree(this._gfx.pivot), this._gfx.renderer2d.reset()), this.setNeedRender()
            }, sS.prototype._resetScene = function() {
                this._objectControls.reset(), this._objectControls.allowTranslation(!0), this._objectControls.allowAltObjFreeRotation(!0), this.resetReps(), this.resetPivot(), this.rebuildAll()
            }, sS.prototype.resetView = function() {
                this._picker && this._picker.reset(), this._setEditMode(eS), this._resetScene(), this._forEachComplexVisual(function(e) {
                    e.updateSelectionMask({}), e.rebuildSelectionGeometry()
                })
            }, sS.prototype._export = function(e) {
                var t = l.a.head(ew.exporters.find({
                    format: e
                }));
                return t ? this._visuals[this._curVisualName] instanceof Oy ? new t(this._visuals[this._curVisualName]._complex, {
                    binary: !0
                }).export().then(function(e) {
                    return e
                }) : this._visuals[this._curVisualName] instanceof Uy ? Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")) : Promise.reject(new Error("Unexpected format of data")) : (this.logger.error("Could not find suitable exporter for this source"), Promise.reject(new Error("Could not find suitable exporter for this source")))
            };
            var cS = /^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,
                uS = /^(?:pc|pubchem):\s*([a-z]+)$/i,
                pS = /^([a-z][a-z\d\-+.]*):/i;
///////////////////////////////////////////////////////
            function fS(e, t, n) {
                return new Promise(function(r) {
                    if (n.shouldCancel()) throw new Error("Operation cancelled");
                    e = function(e, t) {
                        if (!l.a.isString(e)) return e;
                        var n = cS.exec(e);
                        if (n) {
                            var r = Mx(n, 3),
                                o = r[1],
                                i = void 0 === o ? "pdb" : o,
                                a = r[2];
                            switch (i = i.toLowerCase(), a = a.toUpperCase(), i) {
                                case "pdb":
                                    e = "https://files.rcsb.org/download/".concat(a, ".pdb");
                                    break;
                                case "cif":
                                    e = "https://files.rcsb.org/download/".concat(a, ".cif");
                                    break;
                                case "mmtf":
                                    e = "https://mmtf.rcsb.org/v1.0/full/".concat(a);
                                    break;
                                case "ccp4":
                                    e = "https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(a.toLowerCase(), ".ccp4");
                                    break;
                                case "dsn6":
                                    e = "https://edmaps.rcsb.org/maps/".concat(a.toLowerCase(), "_2fofc.dsn6");
                                    break;
                                default:
                                    throw new Error("Unexpected data format shortcut")
                            }
                            return t.fileType = i, t.fileName = "".concat(a, ".").concat(i), t.sourceType = "url", e
                        }
                        var s = uS.exec(e);
                        if (s) {
                            var c = s[1].toLowerCase();
                            return e = "https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/".concat(c, "/JSON?record_type=3d"), t.fileType = "pubchem", t.fileName = "".concat(c, ".json"), t.sourceType = "url", e
                        }
                        return "url" !== t.sourceType && void 0 !== t.sourceType || (t.sourceType = "url", pS.test(e) || (e = R.resolveURL(e))), e
                    }(e, t);
                    var o = l.a.head(ew.loaders.find({
                        type: t.sourceType,
                        source: e
                    }));
                    if (!o) throw new Error("Could not find suitable loader for this source");
                    var i = t.fileName || o.extractName(e);
                    if (i) {
                        var a = Mx(R.splitFileName(i), 2),
                            s = a[0],
                            c = a[1];
                        l.a.defaults(t, {
                            name: s,
                            fileExt: c,
                            fileName: i
                        })
                    }! function(e) {
                        var t = e.binary;
                        if (void 0 !== e.fileType) {
                            var n = l.a.head(ew.parsers.find({
                                format: e.fileType
                            }));
                            if (!n) throw new Error("Could not find suitable parser for this format");
                            t = n.binary || !1
                        }
                        if (void 0 === t && void 0 !== e.fileExt) {
                            var r = l.a.head(ew.parsers.find({
                                ext: e.fileExt
                            }));
                            r && (t = r.binary || !1)
                        }
                        void 0 !== e.fileExt && ".man" === e.fileExt.toLowerCase() && (e.binary = !0, e.animation = !0), void 0 !== t && void 0 !== e.binary && e.binary !== t && e.context.logger.warn("Overriding incorrect binary mode"), e.binary = t || !1
                    }(t);
                    var u = l.a.get(t, "preset.expression");
                    if (!l.a.isUndefined(u) && (u = JSON.parse(u)) && u.settings)
                        for (var p = ["singleUnit", "draft.waterBondingHack"], f = 0, h = p.length; f < h; ++f) {
                            var d = p[f],
                                m = l.a.get(u.settings, d);
                            l.a.isUndefined(m) || H.set(d, m)
                        }
                    var y = new o(e, t);
                    y.context = t.context, n.addEventListener("cancel", function() {
                        return y.abort()
                    }), y.addEventListener("progress", function(e) {
                        e.lengthComputable && e.total > 0 ? iS(y.logger, "Fetching", e.loaded / e.total) : iS(y.logger, "Fetching")
                    }), console.time("fetch"), r(y.load().then(function(e) {
                        return console.timeEnd("fetch"), t.context.logger.info("Fetching finished"), n.notify({
                            type: "fetchingFinished",
                            data: e
                        }), e
                    }).catch(function(e) {
                        throw console.timeEnd("fetch"), t.context.logger.debug(e.message), e.stack && t.context.logger.debug(e.stack), t.context.logger.error("Fetching failed"), n.notify({
                            type: "fetchingFinished",
                            error: e
                        }), e
                    }))
                })
            }
            sS.prototype.load = function(e, t) {
                var n = this;
                t = l.a.merge({}, t, {
                    context: this
                }), this.settings.now.use.multiFile || (this._loading.length && (this._loading.forEach(function(e) {
                    e.cancel()
                }), this._loading.length = 0), t.animation || this.reset(!0)), this.dispatchEvent({
                    type: "load",
                    options: t,
                    source: e
                });
                var r = new z;
                this._loading.push(r), r.addEventListener("notification", function(e) {
                    n.dispatchEvent(e.slaveEvent)
                }), this._spinner.spin(this._container);
                var o = function(e) {
                    var t = n._loading.indexOf(r);
                    return -1 !== t && n._loading.splice(t, 1), n._spinner.stop(), n._refreshTitle(), e
                };
                return fS(e, t, r).then(function(e) {
                    return function(e, t, n) {
                        return new Promise(function(r, o) {
                            if (n.shouldCancel()) throw new Error("Operation cancelled");
                            if (n.notify({
                                    type: "convert"
                                }), t.mdFile) {
                                for (var i = new Array(e.length), a = 0; a < e.length; a++) i[a] = e.charCodeAt(a);
                                var s = new Uint8Array(i),
                                    l = new File([s], t.fileName);
                                console.time("convert"), sS.prototype.srvTopologyConvert(l, t.mdFile, function(e, i, a) {
                                    console.timeEnd("convert"), e ? (t.converted = !0, t.amberFileName = t.fileName, t.convertedFile = new File([s], t.fileName), t.fileName = null, t.fileType = "pdb", n.notify({
                                        type: "convertingFinished"
                                    }), r(i)) : (t.converted = !1, v.error(a), t.error = a, n.notify({
                                        type: "convertingFinished",
                                        error: a
                                    }), o(new Error(a)))
                                })
                            } else t.converted = !0, r(e)
                        })
                    }(e, t, r)
                }).then(function(e) {
                    return function(e, t, n) {
                        if (n.shouldCancel()) return Promise.reject(new Error("Operation cancelled"));
                        n.notify({
                            type: "parse"
                        });
                        var r = l.a.head(ew.parsers.find({
                            format: t.fileType,
                            ext: t.fileExt,
                            data: e
                        }));
                        if (!r) return Promise.reject(new Error("Could not find suitable parser"));
                        var o = new r(e, t);
                        return o.context = t.context, n.addEventListener("cancel", function() {
                            return o.abort()
                        }), console.time("parse"), o.parse().then(function(e) {
                            return console.timeEnd("parse"), n.notify({
                                type: "parsingFinished",
                                data: e
                            }), e
                        }).catch(function(e) {
                            throw console.timeEnd("parse"), t.error = e, t.context.logger.debug(e.message), e.stack && t.context.logger.debug(e.stack), t.context.logger.error("Parsing failed"), n.notify({
                                type: "parsingFinished",
                                error: e
                            }), e
                        })
                    }(e, t, r)
                }).then(function(e) {
                    var r = n._onLoad(e, t);
                    return o(r)
                }).catch(function(e) {
                    throw n.logger.error("Could not load data"), n.logger.debug(e), o(e)
                })
            }, sS.prototype.unload = function(e) {
                this._removeVisual(e || this.getCurrentVisual()), this.resetPivot()
            }, sS.prototype._startAnimation = function(e) {
                this._stopAnimation();
                var t = this,
                    n = this._getComplexVisual();
                if (null !== n) {
                    try {
                        this._frameInfo = new ww(n.getComplex(), e, {
                            onLoadStatusChanged: function() {
                                t.dispatchEvent({
                                    type: "mdPlayerStateChanged",
                                    state: {
                                        isPlaying: t._isAnimating,
                                        isLoading: !t._frameInfo || t._frameInfo.isLoading
                                    }
                                })
                            },
                            onError: function(e) {
                                t._stopAnimation(), t.logger.error(e)
                            }
                        })
                    } catch (e) {
                        return void this.logger.error("Animation file does not fit to current complex!")
                    }
                    this._continueAnimation()
                } else this.logger.error("Unable to start animation - no molecule is loaded.")
            }, sS.prototype._startMdAnimation = function(e, t) {
                this._stopAnimation();
                var n = this,
                    r = this._getComplexVisual();
                if (null !== r) {
                    try {
                        this._frameInfo = new ww(r.getComplex(), this.srvStreamMdFn(e, t), {
                            onLoadStatusChanged: function() {
                                n.dispatchEvent({
                                    type: "mdPlayerStateChanged",
                                    state: {
                                        isPlaying: n._isAnimating,
                                        isLoading: !n._frameInfo || n._frameInfo.isLoading
                                    }
                                })
                            },
                            onError: function(e) {
                                n._stopAnimation(), n.logger.error(e)
                            }
                        })
                    } catch (e) {
                        return void this.logger.error("Animation file does not fit to current complex!")
                    }
                    this._continueAnimation()
                } else this.logger.error("Unable to start animation - no molecule is loaded.")
            }, sS.prototype._pauseAnimation = function() {
                null !== this._animInterval && (this._isAnimating = !1, clearInterval(this._animInterval), this._animInterval = null, this._frameInfo && this.dispatchEvent({
                    type: "mdPlayerStateChanged",
                    state: {
                        isPlaying: this._isAnimating,
                        isLoading: this._frameInfo.isLoading
                    }
                }))
            }, sS.prototype._continueAnimation = function() {
                this._isAnimating = !0;
                var e = 1e3 / H.now.maxfps;
                e = Number.isNaN(e) ? 0 : e;
                var t = this,
                    n = t._gfx.pivot,
                    r = this._getComplexVisual();
                r && (r.resetSelectionMask(), r.rebuildSelectionGeometry(), this._msgAtomInfo.style.opacity = 0), this._animInterval = setInterval(function() {
                    if (t.dispatchEvent({
                            type: "mdPlayerStateChanged",
                            state: {
                                isPlaying: t._isAnimating,
                                isLoading: t._frameInfo.isLoading
                            }
                        }), t._frameInfo.frameIsReady) {
                        n.updateToFrame(t._frameInfo), t._updateObjsToFrame(t._frameInfo), t._refreshTitle(" Frame ".concat(t._frameInfo._currFrame, " of ").concat(t._frameInfo._framesCount, " time interval - ").concat(t._frameInfo._timeStep));
                        try {
                            t._frameInfo.nextFrame()
                        } catch (e) {
                            return t.logger.error("Error during animation"), void t._stopAnimation()
                        }
                        t._needRender = !0
                    }
                }, e)
            }, sS.prototype._stopAnimation = function() {
                null !== this._animInterval && (clearInterval(this._animInterval), this._frameInfo.disableEvents(), this._frameInfo = null, this._animInterval = null, this._srvAnimSource = null, this.dispatchEvent({
                    type: "mdPlayerStateChanged",
                    state: null
                }))
            }, sS.prototype._onLoad = function(e, t) {
                var n = this._gfx,
                    r = null;
                if (t.animation) return this._refreshTitle(), this._startAnimation(e), null;
                if (this._stopAnimation(), t && t.keepRepsInfo || (this._opts.reps = null, this._opts._objects = null), "Complex" === e.id) {
                    var o = e;
                    t.fileName ? o.name = o.name || oS(t.fileName).toUpperCase() : t.amberFileName ? o.name = o.name || oS(t.amberFileName).toUpperCase() : o.name = "Dynamic ".concat(t.fileType, " molecule"), r = this._addVisual(new Oy(o.name, o)), this._curVisualName = r;
                    var i = this.info();
                    if (this.logger.info("Parsed ".concat(t.fileName, " (").concat(i.atoms, " atoms, ").concat(i.bonds, " bonds, ").concat(i.residues, " residues, ").concat(i.chains, " chains).")), l.a.isNumber(this._opts.unit) && o.setCurrentUnit(this._opts.unit), t.preset) this.srvPresetApply(t.preset);
                    else if (H.now.autoPreset) switch (t.fileType) {
                        case "cml":
                            this.resetReps("small");
                            break;
                        case "pdb":
                        case "mmtf":
                        case "cif":
                            ! function(e) {
                                var t = !1;
                                return e.forEachComponent(function(e) {
                                    e.forEachResidue(function(e) {
                                        e._isValid && (t = !0)
                                    })
                                }), t
                            }(o) ? this.resetReps("small"): this.resetReps("macro");
                            break;
                        default:
                            this.resetReps("default")
                    } else this.resetReps("default")
                } else "Volume" === e.id && (this.resetEd(), r = this._onLoadEd(e));
                return n.camera.updateProjectionMatrix(), this._updateFog(), n.root.resetTransform(), this.resetPivot(), this.resetPan(), this._objectControls.setScale(H.now.radiusToFit / this._getBSphereRadius()), this._resetObjects(), H.now.autoResolution && this._tweakResolution(), this._opts.view && (this.view(this._opts.view), delete this._opts.view), t.error ? this.dispatchEvent({
                    type: "onParseError",
                    error: t.error
                }) : this.dispatchEvent({
                    type: "onParseDone"
                }), this._refreshTitle(), t.convertedFile && t.mdFile && this._startMdAnimation(t.mdFile, t.convertedFile), r
            }, sS.prototype.resetEd = function() {
                this._edLoader && (this._edLoader.abort(), this._edLoader = null), this._removeVisual(this._getVolumeVisual()), this._needRender = !0
            }, sS.prototype.loadEd = function(e) {
                var t = this;
                this.resetEd();
                var n = l.a.head(ew.loaders.find({
                    source: e
                }));
                if (!n) return this.logger.error("Could not find suitable loader for this source"), Promise.reject(new Error("Could not find suitable loader for this source"));
                var r = this._edLoader = new n(e, {
                    binary: !0
                });
                return r.context = this, r.load().then(function(e) {
                    var n = l.a.head(ew.parsers.find({
                        format: "ccp4"
                    }));
                    if (!n) throw new Error("Could not find suitable parser for this source");
                    var r = new n(e);
                    return r.context = t, r.parse().then(function(e) {
                        t._onLoadEd(e)
                    })
                }).catch(function(e) {
                    t.logger.error("Could not load ED data"), t.logger.debug(e)
                })
            }, sS.prototype._onLoadEd = function(e) {
                e.normalize();
                var t = new Uy("volume", e);
                t.getMesh().layers.set($r.LAYERS.VOLUME);
                var n = this._addVisual(t);
                return this._needRender = !0, n
            }, sS.prototype._needRebuild = function() {
                var e = !1;
                return this._forEachComplexVisual(function(t) {
                    e = e || t.needsRebuild()
                }), e
            }, sS.prototype._rebuildObjects = function() {
                var e, t, n = this,
                    r = this._gfx,
                    o = [];
                for (e = 0; e < r.pivot.children.length; ++e) {
                    var i = r.pivot.children[e];
                    i instanceof Qr || o.push(i)
                }
                for (e = 0; e < o.length; ++e) o[e].parent.remove(o[e]);
                setTimeout(function() {
                    var o = n._objects;
                    for (e = 0, t = o.length; e < t; ++e) {
                        var i = o[e];
                        i.needsRebuild && i.build(), i.getGeometry() && r.pivot.add(i.getGeometry())
                    }
                }, 10)
            }, sS.prototype.changeUnit = function(e, t) {
                var n = this._getComplexVisual(t);
                if (!n) throw new Error("There is no complex to change!");

                function r() {
                    var e = n ? n.getComplex().getCurrentUnit() : 0,
                        t = e > 0 ? "Bio molecule ".concat(e) : "Asymmetric unit";
                    return "Current unit: ".concat(e, " (").concat(t, ")")
                }
                return void 0 === e ? r() : (l.a.isString(e) && (e = Math.max(parseInt(e, 10), 0)), n.getComplex().setCurrentUnit(e) && this._resetScene(), r())
            }, sS.prototype.rebuild = function() {
                if (this._building) this.logger.warn("Miew.rebuild(): already building!");
                else {
                    this._building = !0, this.dispatchEvent({
                        type: "rebuild"
                    }), this._rebuildObjects(), this._gfx.renderer2d.reset();
                    var e = [];
                    this._forEachComplexVisual(function(t) {
                        t.needsRebuild() && e.push(t.rebuild().then(function() {
                            return new Promise(function(e) {
                                t.rebuildSelectionGeometry(), e()
                            })
                        }))
                    });
                    var t = this;
                    this._spinner.spin(this._container), Promise.all(e).then(function() {
                        t._spinner.stop(), t._needRender = !0, t._refreshTitle(), t._building = !1
                    })
                }
            }, sS.prototype.rebuildAll = function() {
                this._forEachComplexVisual(function(e) {
                    e.setNeedsRebuild()
                })
            }, sS.prototype._refreshTitle = function(e) {
                var t;
                e = void 0 === e ? "" : e;
                var n = this._getComplexVisual();
                if (n) {
                    t = n.getComplex().name;
                    var r = n.repGet(n.repCurrent());
                    t += r ? "  ".concat(r.mode.name, " Mode") : ""
                } else t = Object.keys(this._visuals).length > 0 ? "Unknown" : "No Data";
                t += e, this.dispatchEvent({
                    type: "titleChanged",
                    data: t
                })
            }, sS.prototype.setNeedRender = function() {
                this._needRender = !0
            }, sS.prototype._extractRepresentation = function() {
                var e = this,
                    t = [];
                this._forEachComplexVisual(function(n) {
                    if (0 !== n.getSelectionCount()) {
                        var r = n.buildSelectorFromMask(1 << n.getSelectionBit()),
                            o = H.now.presets.default,
                            i = n.repAdd({
                                selector: r,
                                mode: o[0].mode.id,
                                colorer: o[0].colorer.id,
                                material: o[0].material.id
                            });
                        i < 0 ? n.repCount() === Oy.NUM_REPRESENTATION_BITS && e.logger.warn("Number of representations is limited to ".concat(Oy.NUM_REPRESENTATION_BITS)) : (n.repCurrent(i), t.push(n.name))
                    }
                }), t.length > 0 && (this.logger.report("New representation from selection for complexes: ".concat(t.join(", "))), this.dispatchEvent({
                    type: "repAdd"
                }))
            }, sS.prototype._setReps = function(e) {
                e = e || this._opts && this._opts.reps || [], this._forEachComplexVisual(function(t) {
                    return t.resetReps(e)
                })
            }, sS.prototype.applyPreset = function(e) {
                for (var t = H.now.presets, n = [e || H.defaults.preset, H.defaults.preset, Object.keys(t)[0]], r = null, o = 0; !r && o < n.length; ++o) H.set("preset", n[o]), (r = t[H.now.preset]) || this.logger.warn('Unknown preset "'.concat(H.now.preset, '"'));
                this._setReps(r)
            }, sS.prototype.resetReps = function(e) {
                var t = this._opts && this._opts.reps;
                t ? this._setReps(t) : this.applyPreset(e)
            }, sS.prototype.repCount = function(e) {
                var t = this._getComplexVisual(e);
                return t ? t.repCount() : 0
            }, sS.prototype.repCurrent = function(e, t) {
                var n = this._getComplexVisual(t),
                    r = n ? n.repCurrent(e) : -1;
                return e && r !== e && this.logger.warn("Representation ".concat(e, " was not found. Current rep remains unchanged.")), r
            }, sS.prototype.rep = function(e, t) {
                var n = this._getComplexVisual("");
                return n ? n.rep(e, t) : null
            }, sS.prototype.repGet = function(e, t) {
                var n = this._getComplexVisual(t);
                return n ? n.repGet(e) : null
            }, sS.prototype.repAdd = function(e, t) {
                var n = this._getComplexVisual(t);
                return n ? n.repAdd(e) : -1
            }, sS.prototype.repRemove = function(e, t) {
                var n = this._getComplexVisual(t);
                return n ? n.repRemove(e) : null
            }, sS.prototype.repHide = function(e, t, n) {
                this._needRender = !0;
                var r = this._getComplexVisual(n);
                return r ? r.repHide(e, t) : null
            }, sS.prototype._setEditMode = function(e) {
                this._editMode = e;
                var t = this._msgMode;
                t && (t.style.opacity = e === eS ? 0 : 1, e !== eS && (t.getElementsByTagName("p")[0].innerHTML = e === tS ? "COMPONENT EDIT MODE" : "FRAGMENT EDIT MODE"));
                this.dispatchEvent({
                    type: "editModeChanged",
                    data: e === eS
                })
            }, sS.prototype._enterComponentEditMode = function() {
                if (this._editMode === eS) {
                    var e = [];
                    this._forEachComplexVisual(function(t) {
                        var n = t.beginComponentEdit();
                        n && e.push(n)
                    }), e !== [] && (this._editors = e, this.logger.info("COMPONENT EDIT MODE -- ON"), this._setEditMode(tS), this._objectControls.keysTranslateObj(!0))
                }
            }, sS.prototype._applyComponentEdit = function() {
                if (this._editMode === tS) {
                    this._objectControls.stop(), this._objectControls.keysTranslateObj(!1);
                    for (var e = 0; e < this._editors.length; ++e) this._editors[e].apply();
                    this._editors = [], this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"), this._setEditMode(eS), this.rebuildAll()
                }
            }, sS.prototype._discardComponentEdit = function() {
                if (this._editMode === tS) {
                    this._objectControls.stop(), this._objectControls.keysTranslateObj(!1);
                    for (var e = 0; e < this._editors.length; ++e) this._editors[e].discard();
                    this._editors = [], this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"), this._setEditMode(eS), this._needRender = !0
                }
            }, sS.prototype._enterFragmentEditMode = function() {
                if (this._editMode === eS) {
                    var e = [];
                    if (this._forEachComplexVisual(function(t) {
                            t instanceof Oy && t.getSelectionCount() > 0 && e.push(t)
                        }), 1 === e.length) {
                        var t = e[0].beginFragmentEdit();
                        t && (this._editors = [t], this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"), this._setEditMode(nS), this._objectControls.allowTranslation(!1), this._objectControls.allowAltObjFreeRotation(t.isFreeRotationAllowed()), this._needRender = !0)
                    }
                }
            }, sS.prototype._applyFragmentEdit = function() {
                if (this._editMode === nS) {
                    this._objectControls.stop();
                    for (var e = 0; e < this._editors.length; ++e) this._editors[e].apply();
                    this._editors = [], this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"), this._setEditMode(eS), this._objectControls.allowTranslation(!0), this._objectControls.allowAltObjFreeRotation(!0), this.rebuildAll()
                }
            }, sS.prototype._discardFragmentEdit = function() {
                if (this._editMode === nS) {
                    this._objectControls.stop();
                    for (var e = 0; e < this._editors.length; ++e) this._editors[e].discard();
                    this._editors = [], this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"), this._setEditMode(eS), this._objectControls.allowTranslation(!0), this._objectControls.allowAltObjFreeRotation(!0), this._needRender = !0
                }
            }, sS.prototype.resetPan = function() {
                this._gfx.camera.position.x = 0, this._gfx.camera.position.y = 0, this.dispatchEvent({
                    type: "transform"
                })
            }, sS.prototype._onPick = function(e) {
                if (H.now.picking && null === this._animInterval && this._editMode !== nS && !this._objectControls.isEditingAltObj()) {
                    var t = null;
                    if (e.obj.atom ? (t = e.obj.atom.getResidue().getChain().getComplex(), this._lastPick = e.obj.atom) : e.obj.residue ? (t = e.obj.residue.getChain().getComplex(), this._lastPick = e.obj.residue) : e.obj.chain ? (t = e.obj.chain.getComplex(), this._lastPick = e.obj.chain) : e.obj.molecule ? (t = e.obj.molecule.getComplex(), this._lastPick = e.obj.molecule) : this._lastPick = null, t) {
                        var n = this._getVisualForComplex(t);
                        n && (r(n), this._needRender = !0)
                    } else this._forEachComplexVisual(r), this._needRender = !0;
                    this._updateInfoPanel(), this.dispatchEvent(e)
                }

                function r(t) {
                    t.updateSelectionMask(e.obj), t.rebuildSelectionGeometry()
                }
            }, sS.prototype._onDblClick = function(e) {
                "atom" in e.obj ? this.setPivotAtom(e.obj.atom) : "residue" in e.obj ? this.setPivotResidue(e.obj.residue) : this.resetPivot(), this.resetPan(), this._needRender = !0
            }, sS.prototype._onKeyDown = function(e) {
                if (this._running && this._hotKeysEnabled) switch (e.keyCode) {
                    case "C".charCodeAt(0):
                        H.now.editing && this._enterComponentEditMode();
                        break;
                    case "F".charCodeAt(0):
                        H.now.editing && this._enterFragmentEditMode();
                        break;
                    case "A".charCodeAt(0):
                        switch (this._editMode) {
                            case tS:
                                this._applyComponentEdit();
                                break;
                            case nS:
                                this._applyFragmentEdit()
                        }
                        break;
                    case "D".charCodeAt(0):
                        switch (this._editMode) {
                            case tS:
                                this._discardComponentEdit();
                                break;
                            case nS:
                                this._discardFragmentEdit()
                        }
                        break;
                    case "S".charCodeAt(0):
                        e.preventDefault(), e.stopPropagation(), H.set("ao", !H.now.ao), this._needRender = !0;
                        break;
                    case 107:
                        e.preventDefault(), e.stopPropagation(), this._forEachComplexVisual(function(e) {
                            e.expandSelection(), e.rebuildSelectionGeometry()
                        }), this._updateInfoPanel(), this._needRender = !0;
                        break;
                    case 109:
                        e.preventDefault(), e.stopPropagation(), this._forEachComplexVisual(function(e) {
                            e.shrinkSelection(), e.rebuildSelectionGeometry()
                        }), this._updateInfoPanel(), this._needRender = !0
                }
            }, sS.prototype._onKeyUp = function(e) {
                this._running && this._hotKeysEnabled && e.keyCode === "X".charCodeAt(0) && this._extractRepresentation()
            }, sS.prototype._updateInfoPanel = function() {
                var e, t, n = this._msgAtomInfo.getElementsByTagName("p")[0],
                    r = 0;
                for (this._forEachComplexVisual(function(e) {
                        r += e.getSelectionCount()
                    }); n.firstChild;) n.removeChild(n.firstChild);
                if (0 !== r) {
                    var o = "".concat(String(r), " atom").concat(1 !== r ? "s" : "", " selected");
                    null !== this._lastPick && (o += ", the last pick:");
                    var i = "",
                        a = "",
                        s = "";
                    if (this._lastPick instanceof Kx) {
                        t = (e = this._lastPick)._residue;
                        var l = e.getName();
                        a = null !== l.getNode() ? l.getNode() : l.getString();
                        var c = 32 !== e._location ? String.fromCharCode(e._location) : "";
                        i = "".concat(e.element.fullName, " #").concat(e._serial).concat(c, ":       ").concat(t._chain._name, ".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim(), "."), "string" == typeof a && (i += a), s = "Coord: (".concat(e._position.x.toFixed(2).toString(), ",     ").concat(e._position.y.toFixed(2).toString(), ",     ").concat(e._position.z.toFixed(2).toString(), ")")
                    } else this._lastPick instanceof Zx ? (t = this._lastPick, i = "".concat(t._type._fullName, ":       ").concat(t._chain._name, ".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim())) : this._lastPick instanceof Qx ? i = "chain ".concat(this._lastPick._name) : this._lastPick instanceof Jx && (i = "molecule ".concat(this._lastPick._name));
                    if (n.appendChild(document.createTextNode(o)), "" !== i && (n.appendChild(document.createElement("br")), n.appendChild(document.createTextNode(i))), "string" != typeof a) {
                        var u = a.cloneNode(!0);
                        u.style.fontSize = "85%", n.appendChild(u)
                    }
                    "" !== s && (n.appendChild(document.createElement("br")), n.appendChild(document.createTextNode(s))), this._msgAtomInfo.style.opacity = 1
                } else this._msgAtomInfo.style.opacity = 0
            }, sS.prototype._getAltObj = function() {
                if (this._editors) {
                    for (var e = null, t = 0; t < this._editors.length; ++t) {
                        var n = this._editors[t].getAltObj();
                        if (n.objects.length > 0) {
                            if (e) {
                                e = null;
                                break
                            }
                            e = n
                        }
                    }
                    if (e) return e
                }
                return {
                    objects: [],
                    pivot: new c.Vector3(0, 0, 0)
                }
            }, sS.prototype.resetPivot = function() {
                var e = new c.Box3;
                this._forEachVisual(function(t) {
                    e.union(t.getBoundaries().boundingBox)
                }), e.getCenter(this._gfx.pivot.position), this._gfx.pivot.position.negate(), this.dispatchEvent({
                    type: "transform"
                })
            }, sS.prototype.setPivotResidue = function(e) {
                var t = this._getVisualForComplex(e.getChain().getComplex());
                if (t) {
                    var n = this._gfx.pivot.position;
                    if (e._controlPoint) n.copy(e._controlPoint);
                    else {
                        for (var r = 0, o = 0, i = 0, a = e._atoms.length, s = 0; s < a; ++s) {
                            var l = e._atoms[s]._position;
                            r += l.x / a, o += l.y / a, i += l.z / a
                        }
                        n.set(r, o, i)
                    }
                    n.applyMatrix4(t.matrix), n.negate(), this.dispatchEvent({
                        type: "transform"
                    })
                }
            }, sS.prototype.setPivotAtom = function(e) {
                var t = this._getVisualForComplex(e.getResidue().getChain().getComplex());
                if (t) {
                    var n = this._gfx.pivot.position;
                    n.copy(e._position), n.applyMatrix4(t.matrix), n.negate(), this.dispatchEvent({
                        type: "transform"
                    })
                }
            }, sS.prototype.benchmarkGfx = function(e) {
                var t = this,
                    n = new qy(this._gfx.renderer);
                return new Promise(function(r) {
                    e || H.now.autoResolution ? (t.dispatchEvent({
                        type: "profile"
                    }), t._spinner.spin(t._container), n.runOnTicks(50, 1e3, 2e3).then(function(e) {
                        t._gfxScore = 0, e >= 5 && (t._gfxScore = 1e3 / n.mean()), e > 0 && (t._gfxScore = .5 * e), t._spinner.stop(), r()
                    })) : r()
                })
            }, sS.prototype.screenshot = function(e, t) {
                var n, r, o, i = this._gfx;
                if (t = t || e || i.height, (e = e || i.width) === i.width && t === i.height) n = i.renderer.domElement.toDataURL("image/png");
                else {
                    var a = i.camera.aspect,
                        s = i.camera.fov,
                        l = (o = i.camera.fov, Math.tan(c.Math.degToRad(.5 * o))) * Math.min(i.width, i.height) / i.height,
                        u = e / t;
                    i.camera.aspect = u, i.camera.fov = (r = l / Math.min(u, 1), 2 * c.Math.radToDeg(Math.atan(r))), i.camera.updateProjectionMatrix(), i.renderer.setDrawingBufferSize(e, t, 1), this._renderFrame(H.now.stereo), n = i.renderer.domElement.toDataURL("image/png"), i.camera.aspect = a, i.camera.fov = s, i.camera.updateProjectionMatrix(), i.renderer.setDrawingBufferSize(i.width, i.height, window.devicePixelRatio), this._needRender = !0
                }
                return n
            }, sS.prototype.screenshotSave = function(e, t, n) {
                var r = this.screenshot(t, n);
                R.shotDownload(r, e)
            }, sS.prototype.save = function(e) {
                var t = this;
                this._export(e.fileType).then(function(n) {
                    var r = t._visuals[t._curVisualName]._complex.name;
                    R.download(n, r, e.fileType)
                }).catch(function(e) {
                    t.logger.error("Could not export data"), t.logger.debug(e)
                })
            }, sS.prototype._tweakResolution = function() {
                var e = [
                        ["poor", 100],
                        ["low", 500],
                        ["medium", 1e3],
                        ["high", 5e3],
                        ["ultra", Number.MAX_VALUE]
                    ],
                    t = 0;
                if (this._forEachComplexVisual(function(e) {
                        t += e.getComplex().getAtomCount()
                    }), t > 0)
                    for (var n = 1e6 * this._gfxScore / t, r = 0; r < e.length; ++r)
                        if (n < e[r][1]) {
                            this._autoChangeResolution(e[r][0]);
                            break
                        }
            }, sS.prototype._autoChangeResolution = function(e) {
                e !== H.now.resolution && this.logger.report('Your rendering resolution was changed to "'.concat(e, '" for best performance.')), H.now.resolution = e
            }, sS.prototype.saveSettings = function() {
                this._cookies.setCookie(this._opts.settingsCookie, JSON.stringify(this.settings.getDiffs(!0)))
            }, sS.prototype.restoreSettings = function() {
                try {
                    var e = this._cookies.getCookie(this._opts.settingsCookie),
                        t = e ? JSON.parse(e) : {};
                    this.settings.applyDiffs(t, !0)
                } catch (e) {
                    this.logger.error("Cookies parse error: ".concat(e.message))
                }
            }, sS.prototype.resetSettings = function() {
                this.settings.reset()
            }, sS.prototype.setOptions = function(e) {
                "string" == typeof e && (e = sS.options.fromAttr(e)), e.reps && (this._opts.reps = null), l.a.merge(this._opts, e), e.settings && this.set(e.settings), this._opts._objects = e._objects, this._resetObjects(), e.load && this.load(e.load, {
                    fileType: e.type
                }), e.preset && (H.now.preset = e.preset), e.reps && this.resetReps(e.preset), this._opts.view && (this.view(this._opts.view), delete this._opts.view);
                var t = this._getComplexVisual();
                t && (t.getComplex().resetCurrentUnit(), l.a.isNumber(e.unit) && t.getComplex().setCurrentUnit(e.unit), this.resetView(), this.rebuildAll())
            }, sS.prototype.info = function(e) {
                var t = this._getComplexVisual(e);
                if (!t) return {};
                var n = t.getComplex(),
                    r = n.metadata;
                return {
                    id: r.id || n.name || "UNKNOWN",
                    title: r.title && r.title.join(" ") || "UNKNOWN DATA",
                    atoms: n.getAtomCount(),
                    bonds: n.getBondCount(),
                    residues: n.getResidueCount(),
                    chains: n.getChainCount()
                }
            }, sS.prototype.addObject = function(e, t) {
                var n = null;
                if (e.type === Iw.prototype.type && (n = Iw), null === n) throw new Error("Unknown scene object type - ".concat(e.type));
                try {
                    var r = new n(e.params, e.opts);
                    this._addSceneObject(r)
                } catch (e) {
                    if (t) throw e;
                    this.logger.debug("Error during scene object creation: ".concat(e.message))
                }
                this._needRender = !0
            }, sS.prototype._addSceneObject = function(e) {
                var t = this._getComplexVisual();
                e.build && t && (e.build(t.getComplex()), this._gfx.pivot.add(e.getGeometry()));
                var n = this._objects;
                n[n.length] = e
            }, sS.prototype._updateObjsToFrame = function(e) {
                for (var t = this._objects, n = 0, r = t.length; n < r; ++n) t[n].updateToFrame && t[n].updateToFrame(e)
            }, sS.prototype._resetObjects = function() {
                var e = this._opts._objects;
                if (this._objects = [], e)
                    for (var t = 0, n = e.length; t < n; ++t) this.addObject(e[t], !1)
            }, sS.prototype.removeObject = function(e) {
                var t = this._objects[e];
                if (!t) throw new Error("Scene object with index ".concat(e, " does not exist"));
                t.destroy(), this._objects.splice(e, 1), this._needRender = !0
            }, sS.prototype.getURL = function(e) {
                return ve.toURL(this.getState(l.a.defaults(e, {
                    compact: !0,
                    settings: !1,
                    view: !1
                })))
            }, sS.prototype.getScript = function(e) {
                return ve.toScript(this.getState(l.a.defaults(e, {
                    compact: !0,
                    settings: !0,
                    view: !0
                })))
            }, sS.prototype._compareReps = function(e, t) {
                var n = {},
                    r = 0;
                e && (r = e.repCount());
                var o = H.defaults.presets[H.now.preset],
                    i = t;
                void 0 === o || o.length > r ? (i = !1, n.preset = "empty") : H.now.preset !== H.defaults.preset && (n.preset = H.now.preset);
                for (var a = [], s = !0, c = 0, u = r; c < u; ++c) a[c] = e.repGet(c).compare(i ? o[c] : null), l.a.isEmpty(a[c]) || (s = !1);
                return s || (n.reps = a), n
            }, sS.prototype.getState = function(e) {
                var t = {};
                e = l.a.defaults(e, {
                    compact: !0,
                    settings: !1,
                    view: !1
                });
                var n = this._getComplexVisual();
                if (null !== n) {
                    var r = n.getComplex(),
                        o = r.metadata;
                    if (o.id) {
                        var i = o.format ? "".concat(o.format, ":") : "";
                        t.load = i + o.id
                    }
                    var a = r.getCurrentUnit();
                    1 !== a && (t.unit = a)
                }
                var s = this._compareReps(n, e.compact);
                s.preset && (t.preset = s.preset), s.reps && (t.reps = s.reps);
                for (var c = this._objects, u = [], p = 0, f = c.length; p < f; ++p) u[p] = c[p].identify();
                if (c.length > 0 && (t._objects = u), e.view && (t.view = this.view()), e.settings) {
                    var h = this.settings.getDiffs(!1);
                    l.a.isEmpty(h) || (t.settings = h)
                }
                return t
            }, sS.prototype.get = function(e, t) {
                return H.get(e, t)
            }, sS.prototype._updateShadow = function(e) {
                for (var t = 0; t < this._gfx.scene.children.length; t++)
                    if (void 0 !== this._gfx.scene.children[t].shadow) {
                        var n = this._gfx.scene.children[t];
                        n.shadow.bias = .09 * e, n.shadow.camera.bottom = -e, n.shadow.camera.top = e, n.shadow.camera.left = -e, n.shadow.camera.right = e;
                        var r = n.position.length();
                        n.shadow.camera.far = r + e + 10, n.shadow.camera.near = r - e - 10, n.shadow.camera.near = n.shadow.camera.near > .1 ? n.shadow.camera.near : .1, n.shadow.camera.updateProjectionMatrix()
                    }
            }, sS.prototype._clipPlaneUpdateValue = function(e) {
                var t = Math.max(this._gfx.camera.position.z - e * H.now.draft.clipPlaneFactor, H.now.camNear),
                    n = {
                        clipPlaneValue: t
                    };
                this._forEachComplexVisual(function(e) {
                    e.setUberOptions(n)
                });
                for (var r = 0, o = this._objects.length; r < o; ++r) {
                    var i = this._objects[r];
                    i._line && i._line.material.setUberOptions(n)
                }
                null !== this._picker && (this._picker.clipPlaneValue = t)
            }, sS.prototype._fogFarUpdateValue = function() {
                null !== this._picker && (this._gfx.scene.fog ? this._picker.fogFarValue = this._gfx.scene.fog.far : this._picker.fogFarValue = void 0)
            }, sS.prototype._updateMaterials = function(e) {
                var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
                    n = arguments.length > 2 ? arguments[2] : void 0;
                this._forEachComplexVisual(function(r) {
                    return r.setMaterialValues(e, t, n)
                });
                for (var r = 0, o = this._objects.length; r < o; ++r) {
                    var i = this._objects[r];
                    i._line && (i._line.material.setValues(e), i._line.material.needsUpdate = !0)
                }
            }, sS.prototype._fogAlphaChanged = function() {
                this._forEachComplexVisual(function(e) {
                    e.setUberOptions({
                        fogAlpha: H.now.fogAlpha
                    })
                })
            }, sS.prototype._initOnSettingsChanged = function() {
                var e = this,
                    t = function(t, n) {
                        (t = l.a.isArray(t) ? t : [t]).forEach(function(t) {
                            e.settings.addEventListener("change:".concat(t), n)
                        })
                    };
                t("theme", function() {
                    e._onThemeChanged()
                }), t("bg.color", function() {
                    e._onBgColorChanged()
                }), t("ao", function() {
                    e._setUberMaterialValues({
                        normalsToGBuffer: H.now.ao
                    })
                }), t("fogColor", function() {
                    e._onFogColorChanged()
                }), t("fogColorEnable", function() {
                    e._onFogColorChanged()
                }), t("bg.transparent", function(t) {
                    var n = e._gfx;
                    n && n.renderer.setClearColor(H.now.bg.color, Number(!H.now.bg.transparent)), e._updateMaterials({
                        fogTransparent: t.value
                    }), e.rebuildAll()
                }), t("draft.clipPlane", function(t) {
                    e._updateMaterials({
                        clipPlane: t.value
                    }), e.rebuildAll()
                }), t("shadow.on", function(t) {
                    var n = {
                            shadowmap: t.value,
                            shadowmapType: H.now.shadow.type
                        },
                        r = e._gfx;
                    r && (r.renderer.shadowMap.enabled = n.shadowmap), e._updateMaterials(n, !0, function(e) {
                        !0 === n.shadowmap ? $r.prepareObjMaterialForShadow(e) : e.customDepthMaterial = null
                    }), e._needRender = !0
                }), t("shadow.type", function(t) {
                    H.now.shadow.on && (e._updateMaterials({
                        shadowmapType: t.value
                    }, !0), e._needRender = !0)
                }), t("shadow.radius", function(t) {
                    for (var n = 0; n < e._gfx.scene.children.length; n++) {
                        if (void 0 !== e._gfx.scene.children[n].shadow) e._gfx.scene.children[n].shadow.radius = t.value, e._needRender = !0
                    }
                }), t("fps", function() {
                    e._fps.show(H.now.fps)
                }), t(["fog", "fogNearFactor", "fogFarFactor"], function() {
                    e._updateFog(), e._needRender = !0
                }), t("fogAlpha", function() {
                    e._fogAlphaChanged()
                }), t("autoResolution", function(t) {
                    t.value && !e._gfxScore && e.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")
                }), t("stereo", function() {
                    "WEBVR" === H.now.stereo && void 0 === e.webVR && (e.webVR = new Ix(function() {
                        e._needRender = !0, e._onResize()
                    })), e.webVR && e.webVR.toggle("WEBVR" === H.now.stereo, e._gfx)
                }), t(["transparency", "resolution", "palette"], function() {
                    e.rebuildAll()
                }), t(["axes", "fxaa", "ao", "outline.on", "outline.color", "outline.threshold"], function() {
                    e._needRender = !0
                })
            }, sS.prototype.set = function(e, t) {
                H.set(e, t)
            }, sS.prototype.select = function(e, t) {
                var n = this._getComplexVisual();
                if (n) {
                    var r = e;
                    l.a.isString(e) && (r = $x.parse(e).selector), n.select(r, t), this._updateInfoPanel(), this._needRender = !0
                }
            };
            var hS = "1";
            sS.prototype.view = function(e) {
                var t, n, r, o = this,
                    i = this._gfx.pivot,
                    a = [],
                    s = "ZXY";
                return void 0 === e ? (t = i.position, n = o._objectControls.getScale() / H.now.radiusToFit, (r = new c.Euler).setFromQuaternion(o._objectControls.getOrientation(), s), a = [t.x, t.y, t.z, n, r.x, r.y, r.z], hS + R.arrayToBase64(a, Float32Array)) : (function() {
                    40 === e.length && (e = "0".concat(e));
                    var t = e[0];
                    if (a = R.arrayFromBase64(e.substr(1), Float32Array), t !== hS) {
                        if ("0" !== t) return void o.logger.warn("Encoded view version mismatch, stored as ".concat(t, " vs ").concat(hS, " expected"));
                        a[3] /= 8
                    }
                    var n = ox.createView();
                    n.position.copy(i.position), n.scale = o._objectControls.getScale(), n.orientation.copy(o._objectControls.getOrientation());
                    var r = ox.createView();
                    r.position.set(a[0], a[1], a[2]), o._getComplexVisual() && r.position.sub(o._getComplexVisual().position), r.scale = a[3], r.orientation.setFromEuler(new c.Euler(a[4], a[5], a[6], s)), ox.setup(n, r)
                }(), e)
            }, sS.prototype._updateView = function() {
                var e = this._gfx.pivot;
                if (ox.wasStarted() || ox.start(), ox.isMoving()) {
                    var t = ox.getCurrentView();
                    if (t.success) {
                        var n = t.view;
                        e.position.copy(n.position), this._objectControls.setScale(n.scale * H.now.radiusToFit), this._objectControls.setOrientation(n.orientation), this.dispatchEvent({
                            type: "transform"
                        }), this._needRender = !0
                    }
                }
            }, sS.prototype.translate = function(e, t, n) {
                this._objectControls.translatePivot(e, t, n), this.dispatchEvent({
                    type: "transform"
                }), this._needRender = !0
            }, sS.prototype.rotate = function(e, t, n) {
                this._objectControls.rotate((new c.Quaternion).setFromEuler(new c.Euler(e, t, n, "XYZ"))), this.dispatchEvent({
                    type: "transform"
                }), this._needRender = !0
            }, sS.prototype.scale = function(e) {
                if (e <= 0) throw new RangeError("Scale should be greater than zero");
                this._objectControls.scale(e), this.dispatchEvent({
                    type: "transform"
                }), this._needRender = !0
            }, sS.prototype.pan = function(e, t) {
                this._gfx.camera.translateX(e), this._gfx.camera.translateY(t), this._needRender = !0
            }, sS.prototype.within = function(e, t) {
                var n = this._getComplexVisual();
                if (!n) return $x.None();
                e instanceof String && (e = $x.parse(e));
                var r = n.within(e, t);
                return r && (n.rebuildSelectionGeometry(), this._needRender = !0), r
            }, sS.prototype.projected = function(e, t) {
                var n = this._getComplexVisual(t);
                if (!n) return !1;
                var r = n.getComplex().getAtomByFullname(e);
                if (null === r) return !1;
                var o = r._position.clone();
                return this._gfx.pivot.updateMatrixWorldRecursive(), this._gfx.camera.updateMatrixWorldRecursive(), this._gfx.pivot.localToWorld(o), o.project(this._gfx.camera), {
                    x: .5 * (o.x + 1) * this._gfx.width,
                    y: .5 * (1 - o.y) * this._gfx.height
                }
            }, sS.prototype.dssp = function(e) {
                var t = this._getComplexVisual(e);
                t && (t.getComplex().dssp(), t._reprList.forEach(function(e) {
                    "CA" !== e.mode.id && "SS" !== e.colorer.id || (e.needsRebuild = !0)
                }))
            }, sS.prototype.exportCML = function() {
                var e = this;
                var t = e._getComplexVisual(),
                    n = t ? t.getComplex() : null;
                return n && n.originalCML ? (function(t) {
                    var n = function(e) {
                            var t = new c.Vector3,
                                n = new c.Vector3,
                                r = new c.Vector3;
                            e.extractBasis(t, n, r), t.normalize(), n.normalize(), r.normalize();
                            var o = new c.Matrix4;
                            return o.identity(), o.makeBasis(t, n, r), o
                        }(e._gfx.root.matrixWorld),
                        r = new c.Vector4(0, 0, 0, 0),
                        o = new c.Vector4(0, 0, 0, 0),
                        i = null,
                        a = null;
                    t.forEachAtom(function(e) {
                        e.xmlNodeRef && e.xmlNodeRef.xmlNode && (i = e.xmlNodeRef.xmlNode, a = e.getPosition(), r.set(a.x, a.y, a.z, 1), r.applyMatrix4(n), i.setAttribute("x3", r.x.toString()), i.setAttribute("y3", r.y.toString()), i.setAttribute("z3", r.z.toString()), i.removeAttribute("x2"), i.removeAttribute("y2"))
                    }), t.forEachSGroup(function(e) {
                        if (e.xmlNodeRef && e.xmlNodeRef.xmlNode) {
                            i = e.xmlNodeRef.xmlNode, a = e.getPosition(), r.set(a.x, a.y, a.z, 1);
                            var t = e.getCentralPoint();
                            null === t ? r.applyMatrix4(n) : (o.set(t.x, t.y, t.z, 0), r.add(o), r.applyMatrix4(n), o.set(t.x, t.y, t.z, 1), o.applyMatrix4(n), r.sub(o)), i.setAttribute("x", r.x.toString()), i.setAttribute("y", r.y.toString()), i.setAttribute("z", r.z.toString())
                        }
                    })
                }(n), (new XMLSerializer).serializeToString(n.originalCML)) : null
            }, sS.prototype.motm = function() {
                H.set("theme", "light"), H.set({
                    fogColorEnable: !0,
                    fogColor: 0,
                    outline: {
                        on: !0,
                        threshold: .01
                    },
                    bg: {
                        color: 16777215
                    }
                }), this._forEachComplexVisual(function(e) {
                    for (var t = [], n = e.getComplex(), r = Pd.get(H.now.palette), o = 0; o < n.getChainCount(); o++) {
                        var i = n._chains[o]._name,
                            a = r.getChainColor(i);
                        t[o] = {
                            selector: "chain ".concat(i),
                            mode: "VW",
                            colorer: ["CB", {
                                color: a,
                                factor: .9
                            }],
                            material: "FL"
                        }
                    }
                    e.resetReps(t)
                })
            }, sS.prototype.VERSION = "0.7.23+20190405.171328.afaebe9", l.a.assign(sS, {
                VERSION: sS.prototype.VERSION,
                registeredPlugins: [],
                chem: hr,
                io: ew,
                modes: ed,
                colorers: hy,
                materials: yy,
                palettes: Pd,
                options: ve,
                settings: H,
                utils: R,
                gfx: {
                    Representation: _y,
                    fbxExport: yx
                },
                thirdParty: {
                    lodash: l.a,
                    three: c
                }
            });
            var dS = sS,
                mS = n("2zIC"),
                yS = {
                    $help: ["Rendering mode shortcut", "    BS - balls and sticks mode", "    LN - lines mode", "    LC - licorice mode", "    VW - van der waals mode", "    TR - trace mode", "    TU - tube mode", "    CA - cartoon mode", "    SA - isosurface mode", "    QS - quick surface mode", "    SE - solvent excluded mode", "    TX - text mode"],
                    BS: {
                        $help: ["   Balls and sticks", "      aromrad = <number> #aromatic radius", "      atom = <number>    #atom radius", "      bond = <number>    #bond radius", "      multibond = <bool> #use multibond", "      showarom = <bool>  #show aromatic", "      space = <number>   #space value\n"]
                    },
                    CA: {
                        $help: ["   Cartoon", "      arrow = <number>   #arrow size", "      depth = <number>   #depth of surface", "      heightSegmentsRatio = <number>", "      radius = <number>  #tube radius", "      tension = <number> #", "      width = <number>  #secondary width\n"]
                    },
                    LN: {
                        $help: ["   Lines", "      atom = <number>    #atom radius", "      chunkarom = <number>", "      multibond = <bool> #use multibond", "      showarom = <bool>  #show aromatic", "      offsarom = <number>\n"]
                    },
                    LC: {
                        $help: ["   Licorice", "      aromrad = <number> #aromatic radius", "      bond = <number>    #bond radius", "      multibond = <bool> #use multibond", "      showarom = <bool>  #show aromatic", "      space = <number>   #space value\n"]
                    },
                    VW: {
                        $help: ["   Van der Waals", "      nothing\n"]
                    },
                    TR: {
                        $help: ["   Trace", "      radius = <number>  #tube radius\n"]
                    },
                    TU: {
                        $help: ["   Tube", "      heightSegmentsRatio = <number>", "      radius = <number>  #tube radius", "      tension = <number> \n"]
                    },
                    SA: {
                        $help: ["   Surface", "      zClip = <bool> #clip z plane\n"]
                    },
                    QS: {
                        $help: ["   Quick surface", "      isoValue = <number>", "      scale = <number>", "      wireframe = <bool>", "      zClip = <bool> #clip z plane\n"]
                    },
                    SE: {
                        $help: ["   Solvent excluded surface", "      zClip = <bool> #clip z plane\n"]
                    },
                    TX: {
                        $help: ["   Text mode", '      template = <format string> string that can include "{{ id }}"', "          it will be replaced by value, id can be one of next:", "          serial, name, type, sequence, residue, chain, hetatm, water\n", '      horizontalAlign = <string> {"left", "right", "center"}', '      verticalAlign = <string> {"top", "bottom", "middle"}', "      dx = <number> #offset along x", "      dy = <number> #offset along y", "      dz = <number> #offset along z", "      fg = <string> #text color modificator", "           could be keyword, named color or hex", "      fg = <string> #back color modificator", "           could be keyword, named color or hex", "      showBg = <bool> #if set show background", "           plate under text"]
                    }
                },
                vS = {
                    $help: ["Coloring mode shortcut", "    EL - color by element", "    CH - color by chain", "    SQ - color by sequence", "    RT - color by residue type", "    SS - color by secondary structure", "    UN - uniform"],
                    UN: {
                        $help: ["Parameters of coloring modes customization", "   Uniform", "      color = <number|color> #RGB->HEX->dec\n"],
                        color: {
                            $help: Object.keys(Pd.get(H.now.palette).namedColors).sort().join("\n")
                        }
                    }
                },
                _S = {
                    $help: ["Material shortcut", "    DF - diffuse", "    TR - transparent", "    SF - soft plastic", "    PL - glossy plastic", "    ME - metal", "    GL - glass"]
                },
                gS = {
                    $help: ["Short (packed) representation description as a set of variables", "    s=<EXPRESSION>", "        selector property", "    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]", "        render mode property", "    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]", "        color mode property", "    mt=<MATERIAL_ID>", "        material property"],
                    s: {
                        $help: "Selection expression string as it is in menu->representations->selection"
                    },
                    m: yS,
                    c: vS,
                    mt: _S
                },
                bS = {
                    $help: ["Parameters of rendering modes customization: modes", "Parameters of colorer customization: colorers", "Autobuild: autobuild = (<number>|<bool>)"],
                    modes: yS,
                    colorers: vS
                },
                wS = {
                    $help: ["help (<cmd name>| <path to property>)", "You can get detailed information about command options", '   using "help cmd.opt.opt.[...]"\n', "   you can use one line comments", "   everything started from (#|//) will be skipped", "   Example: >build //some comment\n", "List of available commands:"],
                    reset: {
                        $help: ["Reload current object, delete all representations", "    Nothing will work until load new object"]
                    },
                    load: {
                        $help: ["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])", "    Load new pdb object from selected source"],
                        PDBID: {
                            $help: "pdb id in remote molecule database"
                        },
                        URL: {
                            $help: "url to source file"
                        },
                        f: {
                            $help: ["open file system dialog to fetch local file", "optionally you can determine trajectory file", "via URL for *.top model"]
                        }
                    },
                    clear: {
                        $help: "No args. Clear terminal"
                    },
                    add: {
                        $help: ["add [<REP_NAME>] [<DESCRIPTION>]", "    Add new item to representation set with", "    default or <DESCRIPTION> params"],
                        REP_NAME: {
                            $help: "Identifier string [_,a-z,A-Z,0-9] can not start from digit"
                        },
                        DESCRIPTION: gS
                    },
                    rep: {
                        $help: ["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]", "    set current representation by name or index", "    edit current representation by <DESCRIPTION>"],
                        REP_NAME: {
                            $help: ["Identifier string [_,a-z,A-Z,0-9] can not start from digit", "Must be declared before"]
                        },
                        REP_INDEX: {
                            $help: "Index of available representation"
                        },
                        DESCRIPTION: gS
                    },
                    remove: {
                        $help: ["remove (<REP_NAME>|<REP_INDEX>)", "Remove representation by name or index"],
                        REP_NAME: {
                            $help: ["Identifier string [_,a-z,A-Z,0-9] can not start from digit", "Must be declared before"]
                        },
                        REP_INDEX: {
                            $help: "Index of available representation"
                        }
                    },
                    selector: {
                        $help: ["selector <EXPRESSION>", "   set selector from EXPRESSION to current representation"],
                        EXPRESSION: {
                            $help: "Selection expression string as it is in menu->representations->selection"
                        }
                    },
                    mode: {
                        $help: ["mode <MODE_ID> [<PARAMETER>=<VALUE>...]", "   set rendering mode and apply parameters to current representation"],
                        MODE_ID: yS
                    },
                    color: {
                        $help: ["color <COLORER_ID> [<PARAMETER>=<VALUE>...]", "   set colorer and apply parameters to current representation"],
                        COLORER_ID: vS
                    },
                    material: {
                        $help: ["material <MATERIAL_ID>", "   set material to current representation"],
                        MATERIAL_ID: _S
                    },
                    build: {
                        $help: "build help str",
                        add: {
                            $help: "build.add",
                            new: {
                                $help: ["add.new", "add.new new line 1", "add.new new line 2", "add.new new line 3"]
                            }
                        },
                        del: {
                            $help: "build.del"
                        }
                    },
                    list: {
                        $help: ["list [-e|-s|<REP_NAME>|<REP_INDEX>]", "Print representations if no args print list of representations", "    -e expand list and show all representations", "    -s show all user-registered selectors", "    <REP_NAME>|<REP_INDEX> show only current representation"]
                    },
                    hide: {
                        $help: ["hide (<REP_NAME>|<REP_INDEX>)", "Hide representation referenced in args"]
                    },
                    show: {
                        $help: ["show (<REP_NAME>|<REP_INDEX>)", "Show representation referenced in args"]
                    },
                    get: {
                        $help: ["get <PARAMETER>", "Print <PARAMETER> value", "    <PARAMETER> - path to option use get.PARAMETER to get more info"],
                        PARAMETER: bS
                    },
                    set: {
                        $help: ["set <PARAMETER> <VALUE>", "Set <PARAMETER> with <VALUE>", "    <PARAMETER> - path to option use set.PARAMETER to get more info"],
                        PARAMETER: bS
                    },
                    set_save: {
                        $help: ["set_save", "Save current settings to cookie"]
                    },
                    set_restore: {
                        $help: ["set_restore", "Load and apply settings from cookie"]
                    },
                    set_reset: {
                        $help: ["set_reset", "Reset current settings to the defaults"]
                    },
                    preset: {
                        $help: ["preset [<PRESET>]", "Reset current representation or set preset to <PRESET>"],
                        PRESET: {
                            $help: ["default", "wire", "small", "macro"]
                        }
                    },
                    unit: {
                        $help: ["unit [<unit_id>]", "Change current biological structure view. Zero <unit_id> value means asymmetric unit,", "positive values set an assembly with corresponding number.", "Being called with no parameters command prints current unit information."]
                    },
                    view: {
                        $help: ["view [<ENCODED_VIEW>]", "Get current encoded view or set if ENCODED_VIEW placed as argument"],
                        ENCODED_VIEW: {
                            $help: ["encoded view matrix string (binary code)"]
                        }
                    },
                    rotate: {
                        $help: ["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...", "Rotate scene"]
                    },
                    scale: {
                        $help: ["scale <SCALE>", "Scale scene"]
                    },
                    select: {
                        $help: ["select <SELECTOR_STRING> [as <SELECTOR_NAME>]", "Select atoms using selector defined in SELECTOR_STRING", "    and if SELECTOR_NAME is defined register it in viewer", "    you can use it later as a complex selector"]
                    },
                    within: {
                        $help: ["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>", "Build within named selector", "    DISTANCE        <number>", "    SELECTOR_STRING <string(selection language)>", "    SELECTOR_NAME   <identifier>"]
                    },
                    url: {
                        $help: ["url [-s] [-v]", "Report URL encoded scene", "    if -s set that include settings in the URL", "    if -v set that include view in the URL"]
                    },
                    screenshot: {
                        $help: ["screenshot [<WIDTH> [<HEIGHT>]]", "Make a screenshot of the scene", "    WIDTH  <number> in pixels", "    HEIGHT <number> in pixels, equal to WIDTH by default"]
                    },
                    line: {
                        $help: ["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]", "Draw dashed line between two specified atoms"]
                    },
                    removeobj: {
                        $help: ["removeobj <id>", "Remove scene object by its index. Indices could be obtained by <listobj> command"]
                    },
                    listobj: {
                        $help: ["listobj", "Display the list of all existing scene objects"]
                    },
                    file_list: {
                        $help: ["file_list [(<FILE_ID>|FILE_NAME)] [-f=<STARTS_FROM>]", "Report registered files on server or presets in file if defined FILE_ID or FILE_NAME", "    also you can use -f flag for fast search", "    entity by starting part of name"]
                    },
                    file_register: {
                        $help: ["file_register ", "Try register current opened file to server"]
                    },
                    file_delete: {
                        $help: ["file_delete (<FILE_ID>|FILE_NAME) [-f]", "Delete file from server", "    if -f not set then file will be deleted", "        only when it has not got any presets in it", "    if -f set then file will be deleted anyway"]
                    },
                    preset_add: {
                        $help: ["preset_add <PRESET_NAME> ", "Create new preset from current viewer state", "    to current opened file on server"]
                    },
                    preset_delete: {
                        $help: ["preset_delete (<PRESET_ID>|<PATH_TO_PRESET>)", "Delete preset from server"]
                    },
                    preset_update: {
                        $help: ["preset_update <(<PRESET_ID>|<PATH_TO_PRESET>)", "Update due the current viewer state"]
                    },
                    preset_rename: {
                        $help: ["preset_rename (<PRESET_ID>|<PATH_TO_PRESET>) <PRESET_NAME>", "Rename preset"]
                    },
                    preset_open: {
                        $help: ["preset_open (<PRESET_ID>|<PATH_TO_PRESET>)", "Load preset"]
                    },
                    create_scenario: {
                        $help: ["create_scenario <SCENARIO_NAME>", "    Creates scenario context for future work with them"]
                    },
                    reset_scenario: {
                        $help: ["reset_scenario", "    Clear current scenario context"]
                    },
                    add_scenario_item: {
                        $help: ["add_scenario_item", "    pdb=(<pdbid> | <file_id>)", "    prst=(<preset_name in pdbid>|<preset_id>)", "    delay=<number>", "    desc=<string>\n", "    Add item to context and update scenario on server", "    Pay attention that order of arguments is important"]
                    },
                    delete_scenario: {
                        $help: ["delete_scenario (<SCENARIO_ID>|<SCENARIO_NAME>)", "    Deletes scenario from server"]
                    },
                    list_scenario: {
                        $help: ["list_scenario [-e [<SCENARIO_ID>|<SCENARIO_NAME>]]", "    Report scenario list, when -e is set reports expanded", "    If set -e <id> then reports only requested scenario"]
                    }
                };

            function xS(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }

            function SS(e) {
                return e instanceof Array ? new Xt.Range(e[0], e[1]) : new Xt.Range(e, e)
            }

            function CS(e) {
                var t = Xt.keyword(e[0]);
                if (!t || !t.SelectorClass) return null;
                var n = null,
                    r = t.SelectorClass.prototype;
                return r instanceof Xt.PrefixOperator && 2 === e.length ? n = t(CS(e[1])) : r instanceof Xt.InfixOperator && 3 === e.length ? n = t(CS(e[1]), CS(e[2])) : r instanceof Xt.RangeListSelector && 2 === e.length ? n = t(function(e) {
                    for (var t = [], n = 0; n < e.length; ++n) t.push(SS(e[n]));
                    return new Xt.RangeList(t)
                }(e[1])) : r instanceof Xt.ValueListSelector && 2 === e.length ? n = t(function(e) {
                    for (var t = [], n = 0; n < e.length; ++n) t.push(e[n]);
                    return new Xt.ValueList(t)
                }(e[1])) : r instanceof Xt.Selector && 1 === e.length && (n = t()), n
            }
            var PS = function() {
                function e() {
                    ! function(e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    }(this, e)
                }
                var t, n, r;
                return t = e, (n = [{
                    key: "createSelectorFromNode",
                    value: function(e) {
                        return CS(e)
                    }
                }]) && xS(t.prototype, n), r && xS(t, r), e
            }();

            function ES(e) {
                return function(e) {
                    if (Array.isArray(e)) {
                        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];
                        return n
                    }
                }(e) || function(e) {
                    if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e)
                }(e) || function() {
                    throw new TypeError("Invalid attempt to spread non-iterable instance")
                }()
            }

            function OS(e, t) {
                if (null == e) return {};
                var n, r, o = function(e, t) {
                    if (null == e) return {};
                    var n, r, o = {},
                        i = Object.keys(e);
                    for (r = 0; r < i.length; r++) n = i[r], t.indexOf(n) >= 0 || (o[n] = e[n]);
                    return o
                }(e, t);
                if (Object.getOwnPropertySymbols) {
                    var i = Object.getOwnPropertySymbols(e);
                    for (r = 0; r < i.length; r++) n = i[r], t.indexOf(n) >= 0 || Object.prototype.propertyIsEnumerable.call(e, n) && (o[n] = e[n])
                }
                return o
            }

            function AS(e) {
                return (AS = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }
            var TS = dS.chem.selectors,
                kS = dS.modes,
                RS = dS.colorers,
                IS = dS.materials,
                MS = dS.palettes,
                NS = dS.options,
                LS = dS.settings;

            function jS() {}
            var DS = function() {
                var e = new jS;
                return function() {
                    return e
                }
            }();

            function VS() {
                this.representationMap = {}, this.representationID = {}
            }
            VS.prototype.get = function(e) {
                return this.representationMap[e] || this.representationID[e] || "<no name>"
            }, VS.prototype.add = function(e, t) {
                if (void 0 !== t) {
                    if (this.representationMap.hasOwnProperty(e)) return "This name has already existed, registered without name";
                    this.representationMap[e.toString()] = t, this.representationID[t] = e.toString()
                }
                return "Representation ".concat(e, " successfully added")
            }, VS.prototype.remove = function(e) {
                e && this.representationID.hasOwnProperty(e) && (delete this.representationMap[this.representationID[e]], delete this.representationID[e]);
                var t = Object.keys(this.representationID).sort();
                for (var n in t)
                    if (t.hasOwnProperty(n)) {
                        var r = t[n];
                        r > e && (this.representationID[r - 1] = this.representationID[r], this.representationMap[this.representationID[r]] -= 1, delete this.representationID[r])
                    }
            }, VS.prototype.clear = function() {
                this.representationMap = {}, this.representationID = {}
            };
            var FS = new VS;

            function BS() {}

            function zS(e) {
                var t = {
                    s: "selector",
                    m: "mode",
                    c: "colorer",
                    mt: "material",
                    mode: "modes",
                    color: "colorers",
                    colorer: "colorers",
                    select: "selector",
                    material: "materials",
                    selector: "selector"
                } [e];
                return void 0 === t ? e : t
            }
            BS.prototype.list = function(e, t, n) {
                var r = "";
                if (e && void 0 !== t && (void 0 === n || "-e" === n))
                    for (var o = e.repCount(), i = 0; i < o; i++) r += this.listRep(e, t, i, n);
                return r
            }, BS.prototype.listRep = function(e, t, n, r) {
                var o = "",
                    i = e.repGet(n);
                if (!i) return v.warn("Rep ".concat(n, " does not exist!")), o;
                var a = n,
                    s = t.get(a),
                    l = i.mode,
                    c = i.colorer,
                    u = i.selectorString,
                    p = i.materialPreset;
                return o += "#".concat(a, " : ").concat(l.name).concat("<no name>" === s ? "" : ", ".concat(s), "\n"), void 0 !== r && (o += '    selection : "'.concat(u, '"\n'), o += "    mode      : (".concat(l.id, "), ").concat(l.name, "\n"), o += "    colorer   : (".concat(c.id, "), ").concat(c.name, "\n"), o += "    material  : (".concat(p.id, "), ").concat(p.name, "\n")), o
            }, BS.prototype.listSelector = function(e, t) {
                var n = "";
                for (var r in t) t.hasOwnProperty(r) && (n += "".concat(r, ' : "').concat(t[r], '"\n'));
                return n
            }, BS.prototype.listObjs = function(e) {
                var t = e._objects;
                if (!t || !Array.isArray(t) || 0 === t.length) return "There are no objects on the scene";
                for (var n = [], r = 0, o = t.length; r < o; ++r) n[r] = "".concat(r, ": ").concat(t[r].toString());
                return n.join("\n")
            }, BS.prototype.joinHelpStr = function(e) {
                return e instanceof Array ? e.join("\n") : e
            }, BS.prototype.help = function(e) {
                if (l.a.isUndefined(e)) return "".concat(this.joinHelpStr(wS.$help), "\n").concat(l.a.slice(l.a.sortBy(l.a.keys(wS)), 1).join(", "), "\n");
                var t = l.a.get(wS, e);
                return l.a.isUndefined(t) ? this.help() : "".concat(this.joinHelpStr(t.$help), "\n")
            }, BS.prototype.load = function(e, t) {
                if (void 0 !== e && void 0 !== t && "-f" !== t) {
                    e.awaitWhileCMDisInProcess();
                    var n = function() {
                        return e.finishAwaitingCMDInProcess()
                    };
                    e.load(t).then(n, n)
                }
            }, BS.prototype.checkArg = function(e, t, n) {
                if (void 0 !== e && void 0 !== t) {
                    if ("selector" === zS(e)) {
                        var r = TS.parse(t);
                        if (void 0 !== r.error) throw {
                            message: r.error
                        };
                        return void 0 !== n && n ? r.selector : t
                    }
                    for (var o, i = {
                            colorers: RS,
                            modes: kS,
                            materials: IS
                        }, a = e; a !== o;) a = zS(o = a);
                    if (void 0 === i[a].get(t)) throw {
                        message: "".concat(t, " is not existed in ").concat(a)
                    };
                    return t
                }
                return DS
            }, BS.prototype.propagateProp = function(e, t) {
                if (void 0 !== e) {
                    var n = NS.adapters[AS(l.a.get(LS.defaults, e))];
                    if (void 0 === n) throw {
                        message: "".concat(e, " is not existed")
                    };
                    if ((e.endsWith(".color") || e.endsWith(".baseColor") || e.endsWith(".EL.carbon")) && "number" != typeof t && (t = MS.get(LS.now.palette).getNamedColor(t)), e.endsWith(".fg") || e.endsWith(".bg"))
                        if ("number" != typeof t) {
                            var r = MS.get(LS.now.palette).getNamedColor(t, !0);
                            void 0 !== r && (t = "0x".concat(r.toString(16)))
                        } else t = "0x".concat(t.toString(16));
                    if (e.endsWith(".template") && (t = t.replace(/\\n/g, "\n")), void 0 !== t && n(t) !== t && n(t) !== t > 0) throw {
                        message: "".concat(e, ' must be a "').concat(AS(l.a.get(LS.defaults, e)), '"')
                    };
                    if ("theme" === e) {
                        for (var o = Object.keys(LS.defaults.themes), i = !1, a = 0; a < o.length; a++)
                            if (t === o[a]) {
                                i = !0;
                                break
                            } if (!i) throw {
                            message: "".concat(e, " must be one of [").concat(o, "]")
                        }
                    }
                }
                return t
            }, BS.prototype.unquoteString = function(e) {
                return R.unquoteString(e)
            };
            var US = new BS;

            function GS(e, t, n, r) {
                return this.pdbId = -1, this.presetId = -1, this.delay = -1, this.description = "", void 0 !== e && (this.pdbId = e), void 0 !== t && (this.presetId = t), void 0 !== n && (this.delay = n), void 0 !== r && (this.description = r), this
            }

            function HS() {
                return this.scenarioId = -1, this.data = [], this
            }

            function WS(e) {
                return this.id = -1, this.name = e, this.script = new HS, this
            }

            function qS() {
                this.isOnApllyPresetEventInitialized = !1, this.scenarioContext = new WS
            }
            HS.prototype.addItem = function(e, t) {
                this.scenarioId = e, this.data.push(t)
            }, qS.prototype.requestScenarioID = function(e, t, n, r) {
                var o = this;
                e.awaitWhileCMDisInProcess(), void 0 !== t && e.srvScenarioList(function(i) {
                    if (i instanceof Array) {
                        var a = l.a.filter(i, function(e) {
                            return void 0 !== e.name && e.name.toLowerCase() === t.toLowerCase() || e.id === Number(t)
                        });
                        a.length < 1 ? (void 0 !== r && r("File not found"), o.finish(e)) : a.length > 1 ? (void 0 !== r && r("There are two or more files, please specify one by file_id"), o.finish(e)) : void 0 !== n ? n(a[0].id) : o.finish(e)
                    } else o.finish(e)
                }, function(t) {
                    void 0 !== t && void 0 !== r && r(t), o.finish(e)
                })
            }, qS.prototype.requestPdbID = function(e, t, n, r) {
                var o = this;
                var i = t.split("/");
                if (e.awaitWhileCMDisInProcess(), 1 !== i.length) void 0 !== r && r("Path can contain only file name or id"), o.finish(e);
                else {
                    var a = Number(i[0]);
                    Number.isNaN(a) ? e.srvTopologyFind(i[0], function(t) {
                        t instanceof Array ? t.length < 1 ? (void 0 !== r && r("File not found"), o.finish(e)) : t.length > 1 ? (void 0 !== r && r("There are two or more files, please specify one by file_id"), o.finish(e)) : void 0 !== n ? n(t[0].id) : o.finish(e) : o.finish(e)
                    }, function(t) {
                        void 0 !== t && void 0 !== r && r(t), o.finish(e)
                    }) : n(a)
                }
            }, qS.prototype.requestPresetId = function(e, t, n, r) {
                var o = this,
                    i = t.split("/");

                function a(t) {
                    void 0 !== t && void 0 !== r && r(t), o.finish(e)
                }

                function s(t) {
                    if (t instanceof Array) {
                        var a = l.a.filter(t, function(e) {
                            return e.name.toLowerCase() === i[1].toLowerCase() || e.id === Number(i[1])
                        });
                        a.length < 1 ? (void 0 !== r && r("Preset not found"), o.finish(e)) : a.length > 1 ? (void 0 !== r && r("There are two or more presets, please specify one by preset_id"), o.finish(e)) : void 0 !== n ? n(a[0].id) : o.finish(e)
                    } else o.finish(e)
                }
                e.awaitWhileCMDisInProcess(), 2 !== i.length ? (void 0 !== r && r("Path can has 2 levels only (pdb/preset)"), o.finish(e)) : this.requestPdbID(e, i[0], function(t) {
                    e.srvPresetList(t, s, a)
                }, a)
            }, qS.prototype.createScenario = function(e) {
                this.scenarioContext = new WS(e)
            }, qS.prototype.resetScenario = function() {
                this.scenarioContext = new WS
            }, qS.prototype.deleteScenario = function(e, t, n, r) {
                var o = this;

                function i(n) {
                    void 0 !== n && t(n), o.finish(e)
                }

                function a(t) {
                    void 0 !== t && n(t), o.finish(e)
                }

                function s(t) {
                    e.srvScenarioDelete(t, i, a), o.finish(e)
                }
                this.init(e, t), e.awaitWhileCMDisInProcess(), "number" == typeof r ? s(r) : this.requestScenarioID(e, r, s, a)
            }, qS.prototype.listScenario = function(e, t, n, r) {
                var o = this;
                this.init(e, t), e.awaitWhileCMDisInProcess(), e.srvScenarioList(function(n) {
                    if (n instanceof Array) {
                        for (var i = "", a = 0, s = n.length; a < s; ++a) {
                            var l = void 0 === r,
                                c = "-e" === r || n[a].id === Number(r) || n[a].name === r;
                            if ((l || c) && (i += "id : ".concat(n[a].id, ", name : ").concat(n[a].name, "\n"), c)) {
                                var u = JSON.parse(n[a].script).data;
                                i += "scenario : \n";
                                for (var p = 0, f = u.length; p < f; ++p) i += "    index : ".concat(p, "\n"), i += "        pdbId       : ".concat(u[p].pdbId, "\n"), i += "        presetId    : ".concat(u[p].presetId, "\n"), i += "        delay       : ".concat(u[p].delay, "\n"), i += "        description : ".concat(u[p].description, "\n")
                            }
                        }
                        t(i)
                    }
                    o.finish(e)
                }, function(t) {
                    void 0 !== t && n(t), o.finish(e)
                })
            }, qS.prototype.addScenarioItem = function() {
                for (var e = arguments.length, t = new Array(e), n = 0; n < e; n++) t[n] = arguments[n];
                var r = t.miew,
                    o = t.echo,
                    i = t.error,
                    a = this;

                function s(e, t) {
                    a.scenarioContext.id = e, void 0 !== t && o(t), a.finish(r)
                }

                function c(e) {
                    void 0 !== e && i(e), a.finish(r)
                }
                if (this.init(r, o), r.awaitWhileCMDisInProcess(), void 0 === a.scenarioContext.name) return c("No scenario context created yet: use create_scenario <name>"), void a.finish(r);
                if (7 !== t.length) return 5 === arguments.length ? (i("not supported now"), void a.finish(r)) : (i("internal interpreter error"), void a.finish(r));
                var u, p, f, h, d = t[3],
                    m = t[4],
                    y = t[5],
                    v = t[6];
                if (l.a.isString(d)) this.requestPdbID(r, d, function(e) {
                    e >= 0 && a.addScenarioItem.apply(a, t.concat([e]))
                }, c);
                else if (l.a.isString(m)) this.requestPresetId(r, "".concat(d, "/").concat(m), function(e) {
                    e >= 0 && a.addScenarioItem.apply(a, t.concat([e]))
                }, c);
                else {
                    if ("number" != typeof d || "number" != typeof m) return c("Internal error"), void a.finish(r);
                    u = d, p = m, f = y, h = v, a.scenarioContext.script.addItem(a.scenarioContext.id, new GS(u, p, f, h)), r.srvScenarioAdd(a.scenarioContext.id, a.scenarioContext.name, JSON.stringify(a.scenarioContext.script), s, c)
                }
            }, qS.prototype.init = function(e, t) {
                var n = this;
                this.isOnApllyPresetEventInitialized || (e.addEventListener("presetApplyFinished", function() {
                    n.finish(e), void 0 !== t && t("Preset applied")
                }), this.isOnApllyPresetEventInitialized = !0)
            }, qS.prototype.finish = function(e) {
                e.finishAwaitingCMDInProcess()
            }, qS.prototype.fileList = function(e, t, n, r, o) {
                var i = this;

                function a(n) {
                    if (void 0 !== n)
                        for (var r = 0; r < n.length; r++)(void 0 === o || n[r].name.toLowerCase().startsWith(o.toLowerCase())) && t("".concat(n[r].name, ", id= ").concat(n[r].id));
                    i.finish(e)
                }

                function s(n) {
                    void 0 !== n && t("".concat(n, "\n")), i.finish(e)
                }
                this.init(e, t), e.awaitWhileCMDisInProcess(), void 0 === r || "" === r ? e.srvTopologyAll(a, s) : e.srvPresetList(r, a, s)
            }, qS.prototype.callSrvFunc = function() {
                for (var e = arguments.length, t = new Array(e), n = 0; n < e; n++) t[n] = arguments[n];
                var r = t.miew,
                    o = t.echo,
                    i = t.error,
                    a = t.funcName,
                    s = OS(t, ["miew", "echo", "error", "funcName"]),
                    l = this;
                this.init(r, o), r.awaitWhileCMDisInProcess();
                var c = r[a];
                void 0 !== c && t.length >= 4 ? c.call.apply(c, [r].concat(ES(s), [function(e) {
                    void 0 !== e && o(e), l.finish(r)
                }, function(e) {
                    void 0 !== e && i(e), l.finish(r)
                }])) : this.finish(r)
            }, qS.prototype.coroutineWithPresetPath = function(e, t, n, r, o, i) {
                var a = this;
                this.init(e, t), e.awaitWhileCMDisInProcess();
                var s = r.split("/");

                function c(n) {
                    void 0 !== n && t(n), a.finish(e)
                }

                function u(t) {
                    void 0 !== t && n(t), a.finish(e)
                }

                function p(t) {
                    if (t instanceof Array) {
                        var r = l.a.filter(t, function(e) {
                            return e.name.toLowerCase() === s[1].toLowerCase() || e.id === Number(s[1])
                        });
                        r.length < 1 ? (n("Preset not found"), a.finish(e)) : r.length > 1 ? (n("There are two or more presets, please specify one by preset_id"), a.finish(e)) : void 0 === i ? o.call(e, r[0].id, c, u) : o.call(e, r[0].id, i, c, u)
                    } else a.finish(e)
                }
                2 !== s.length ? (n("Path can has 2 levels only (pdb/preset)"), a.finish(e)) : e.srvTopologyFind(s[0], function(t) {
                    t instanceof Array ? t.length < 1 ? (n("File not found"), a.finish(e)) : t.length > 1 ? (n("There are two or more files, please specify one by file_id"), a.finish(e)) : e.srvPresetList(t[0].id, p, u) : a.finish(e)
                }, u)
            }, qS.prototype.coroutineWithFileName = function() {
                for (var e = arguments.length, t = new Array(e), n = 0; n < e; n++) t[n] = arguments[n];
                var r = t.miew,
                    o = t.echo,
                    i = t.error,
                    a = t.name,
                    s = t.callBack,
                    l = this;
                this.init(r), r.awaitWhileCMDisInProcess();
                var c = a.split("/");

                function u(e) {
                    void 0 !== e && o(e), l.finish(r)
                }

                function p(e) {
                    void 0 !== e && i(e), l.finish(r)
                }
                1 !== c.length ? (i("Path can contain only file name or id"), l.finish(r)) : r.srvTopologyFind(c[0], function(e) {
                    if (e instanceof Array)
                        if (e.length < 1) i("File not found");
                        else if (e.length > 1) i("There are two or more files, please specify one by file_id");
                    else switch (t.length) {
                        case 5:
                            s.call(r, e[0].id, u, p);
                            break;
                        case 6:
                            s.call(r, e[0].id, t[5], u, p);
                            break;
                        case 9:
                            s.call(t[5], t[6], t[7], t[8], e[0].id);
                            break;
                        case 10:
                            s.call(t[5], t[6], t[7], t[8], e[0].id, t[9]);
                            break;
                        default:
                            l.finish(r)
                    }
                    l.finish(r)
                }, p)
            };
            var YS = new qS;

            function XS(e) {
                if (e instanceof this.constructor) return e;
                e instanceof Array ? this._values = e.slice(0) : this._values = e ? [e] : []
            }
            XS.prototype.append = function(e) {
                var t = this._values;
                return t[t.length] = e, this
            }, XS.prototype.remove = function(e) {
                var t = this._values,
                    n = t.indexOf(e);
                return n >= 0 && t.splice(n, 1), this
            }, XS.prototype.toJSO = function(e, t, n) {
                for (var r = {}, o = this._values, i = 0, a = o.length; i < a; ++i) l.a.set(r, o[i].id, e.propagateProp("".concat(zS(t), ".").concat(n, ".").concat(o[i].id), o[i].val));
                return r
            };
            var $S = Object.create({});
            $S.Arg = function(e, t) {
                this.id = e, this.val = t
            }, $S.ArgList = XS, $S.miew = null, $S.echo = null, $S.representations = FS, $S.utils = US, $S.srv = YS, $S._ = l.a, $S.CreateObjectPair = function(e, t) {
                var n = {};
                return n[e] = t, n
            }, $S.keyRemap = zS, $S.Context = TS.Context, $S.ClearContext = TS.ClearContext, $S.NULL = DS, $S.notimplemented = function() {
                return this.NULL
            }, dS.prototype.script = function(e, t, n) {
                mS.parser.yy.miew = this, mS.parser.yy.echo = t, mS.parser.yy.error = n, void 0 === this.cmdQueue && (this.cmdQueue = []), void 0 === this.commandInAction && (this.commandInAction = !1), this.cmdQueue = this.cmdQueue.concat(e.split("\n"))
            }, dS.prototype.awaitWhileCMDisInProcess = function() {
                this.commandInAction = !0
            }, dS.prototype.finishAwaitingCMDInProcess = function() {
                this.commandInAction = !1
            }, dS.prototype.isScriptingCommandAvailable = function() {
                return void 0 !== this.commandInAction && !this.commandInAction && void 0 !== this.cmdQueue && this.cmdQueue.length > 0
            }, dS.prototype.callNextCmd = function() {
                if (this.isScriptingCommandAvailable()) {
                    var e = this.cmdQueue.shift(),
                        t = {
                            success: !1
                        };
                    try {
                        mS.parser.parse(e), t.success = !0
                    } catch (e) {
                        t.error = e.message, mS.parser.yy.error(t.error), this.finishAwaitingCMDInProcess()
                    }
                    return t
                }
                return ""
            }, dS.JSONConverter = PS, mS.parser.yy = $S, mS.parser.yy.parseError = mS.parser.parseError;
            var KS = dS;

            function ZS(e) {
                return (ZS = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                    return typeof e
                } : function(e) {
                    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                })(e)
            }
            var QS = KS.settings,
                JS = KS.JSONConverter,
                eC = KS.chem.selectors;

            function tC() {
                return QS.now.plugins.srv.url
            }
            QS.setPluginOpts("srv", {
                url: "/restapi/"
            });

            function nC(e) {
                if ("string" == typeof e)
                    if (e.match(/^[0-9A-Z]{4}$/i)) e = e.toUpperCase();
                    else if (e.match(/^data\/[0-9A-Z]{4}\.pdb$/i)) e = e.substr(5, 4).toUpperCase();
                else {
                    var t = document.createElement("a");
                    t.href = e, e = t.href
                }
                return e
            }
            KS.prototype.srvPluginRegister = function() {
                var e = this;
                this.addEventListener("load", function(t) {
                    var n = t && t.options;
                    e._srvTopologyFile = n && n.topologyFile ? n.topologyFile : null, e._srvAnimationFile = n && n.animationFile ? n.animationFile : null, e._srvPreset = n && n.preset ? n.preset : null;
                    var r = t.source;
                    r instanceof File && r.name.match(/.man$/i) ? e._srvAnimSource = nC(r) : e._srvTopoSource = nC(r), n && n.mdFile && (e._srvAnimSource = n.mdFile)
                })
            }, KS.registeredPlugins.push(KS.prototype.srvPluginRegister), KS.prototype.srvTopologyAll = function(e, t) {
                var n = this,
                    r = o.a.get("".concat(tC(), "topology/all"), function(e) {
                        e && "OK" === e.status && e.payload ? n._topologyList = e.payload : n._topologyList = []
                    }),
                    i = "DONE",
                    a = null;
                return r.fail(function() {
                    n._topologyList = [], i = "FAILED", a = "HTTP Request failed"
                }).always(function() {
                    "FAILED" === i && "function" == typeof t ? t(a) : "function" == typeof e && e(n._topologyList)
                })
            }, KS.prototype.srvTopologyFilter = function(e, t, n) {
                var r = function(n) {
                    "function" == typeof t && t(l.a.filter(n, function(t) {
                        return 0 === t.name.toLowerCase().indexOf(e.toLowerCase())
                    }))
                };
                this._topologyList ? r(this._topologyList) : this.srvTopologyAll(r, n)
            }, KS.prototype.srvTopologyFind = function(e, t, n) {
                if (e) {
                    var r = function(n) {
                        "function" == typeof t && t(l.a.filter(n, function(t) {
                            return t.name.toLowerCase() === e.toLowerCase() || t.source.toLowerCase() === e.toLowerCase()
                        }))
                    };
                    this._topologyList ? r(this._topologyList) : this.srvTopologyAll(r, n)
                } else t(null)
            }, KS.prototype.srvTopologyGetById = function(e, t, n) {
                if (e) {
                    var r = function(r) {
                        var o = l.a.filter(r, function(t) {
                            return +t.id == +e
                        });
                        o && 1 === o.length && "function" == typeof t ? t(o[0]) : o && 1 === o.length || "function" != typeof n || n("Topology not found")
                    };
                    this._topologyList ? r(this._topologyList) : this.srvTopologyAll(r, n)
                } else t(null)
            }, KS.prototype.srvCurrentTopologyIsRegistered = function(e, t, n) {
                if (this._srvTopoSource && !this._srvTopologyFile) {
                    var r = (o = this._srvTopoSource instanceof File ? this._srvTopoSource.name : this._srvTopoSource, i = o.toUpperCase().split("/"), a = i[i.length - 1], i = a.split("\\"), 1 === (i = (a = i[i.length - 1]).split(".")).length ? i[0] : "".concat(i[i.length - 2], ".").concat(i[i.length - 1]));
                    this.srvTopologyFind(r, function(n) {
                        n && n.length > 0 ? e(r, n[0]) : t(r)
                    }, n)
                } else this._srvTopologyFile ? e(this._srvTopologyFile.name, this._srvTopologyFile) : t();
                var o, i, a
            }, KS.prototype.srvTopologyRegister = function(e, t) {
                var n = this,
                    r = n._srvTopoSource,
                    i = n._srvAnimSource,
                    a = function(r, o, i) {
                        var a = o + (n._srvTopologyFile ? " at #".concat(String(n._srvTopologyFile.id)) : "") + (i ? " : ".concat(i) : "");
                        n.logger.report(a), r ? n.srvPresetCreate("Default preset", e, t) : "function" == typeof t && t(i)
                    };
                n.srvCurrentTopologyIsRegistered(function(e) {
                    a(!1, "FAILED", "".concat(e, " is already registered"))
                }, function() {
                    var e;
                    return (r instanceof File ? o.a.ajax({
                        type: "POST",
                        url: "".concat(tC(), "file/upload"),
                        data: (e = new FormData, e.append("topologyFile", r), i && e.append("mdFile", i), e),
                        processData: !1,
                        contentType: !1,
                        cache: !1
                    }) : o.a.post("".concat(tC(), "file/upload"), {
                        topologyFile: r
                    })).done(function(e) {
                        var t = e && e.message ? e.message : null;
                        e && "OK" === e.status && e.payload && e.payload.pdbFile ? (n._srvTopologyFile = e.payload.pdbFile, n._srvAnimationFile = e.payload.mdFile, n._topologyList && n._topologyList.push(n._srvTopologyFile), a(!0, "REGISTERED", t)) : a(!1, "FAILED", t)
                    }).fail(function() {
                        n._srvTopologyFile = null, n._srvAnimationFile = null, a(!1, "FAILED", "HTTP Request failed")
                    })
                }, function(e) {
                    a(!1, "FAILED", e)
                })
            }, KS.prototype.srvTopologyConvert = function(e, t, n) {
                var r;
                return o.a.ajax({
                    type: "POST",
                    url: "".concat(tC(), "file/convert"),
                    data: (r = new FormData, r.append("topologyFile", e), r.append("mdFile", t), r),
                    processData: !1,
                    contentType: !1,
                    cache: !1
                }).done(function(e) {
                    var t = !0,
                        r = null,
                        o = e;
                    e.status && "ERROR" === e.status && (r = e.message, t = !1), n(t, o, r)
                }).fail(function() {
                    n(!1, null, "HTTP Request failed")
                })
            }, KS.prototype.srvTopologyDelete = function(e, t, n, r) {
                var i = this;
                i.srvTopologyGetById(e, function(a) {
                    return o.a.ajax({
                        type: "DELETE",
                        url: "".concat(tC(), "topology/").concat(a.id, "?force=").concat(t ? "true" : "false"),
                        contentType: "",
                        data: ""
                    }).done(function(t) {
                        var o = t && t.message ? t.message : null,
                            a = !1;
                        if (t && "OK" === t.status) {
                            a = !0;
                            var s = i._topologyList.filter(function(t) {
                                return t.id === +e
                            })[0];
                            if (s) {
                                var l = i._topologyList.indexOf(s);
                                l >= 0 && i._topologyList.splice(l, 1)
                            }
                            i._srvTopologyFile && i._srvTopologyFile.id === +e && (i._srvTopologyFile = null)
                        }
                        a && "function" == typeof n ? n(o) : a || "function" != typeof r || r(o)
                    }).fail(function() {
                        "function" == typeof r && r("HTTP Request failed")
                    })
                }, r)
            }, KS.prototype.srvQuery = function(e, t) {
                var n = this,
                    r = function(r, o, i) {
                        n._srvTopologyFile = r;
                        var a = o + (r ? " at #".concat(String(r.id)) : "") + (i ? " : ".concat(i) : "");
                        n.logger.debug(a), r && "function" == typeof e ? e(r) : r || "function" != typeof t || t(i)
                    };
                this.srvCurrentTopologyIsRegistered(function(e, t) {
                    r(t, "REGISTERED", null)
                }, function() {
                    r(null, "MISSING", null)
                }, function(e) {
                    r(null, "FAILURE", e)
                })
            }, KS.prototype.srvPresetList = function(e, t, n) {
                var r = [],
                    i = null;
                return o.a.get("".concat(tC(), "preset/pdb/").concat(e), function(e) {
                    e && "OK" === e.status && e.payload && (r = e.payload)
                }).fail(function() {
                    r = [], i = "HTTP Request failed"
                }).always(function() {
                    i || "function" != typeof t ? i && "function" == typeof n && n(i) : t(r)
                })
            }, KS.prototype.srvPresetGetById = function(e, t, n) {
                var r = null,
                    i = null;
                return o.a.get("".concat(tC(), "preset/").concat(e), function(e) {
                    e && "OK" === e.status && e.payload && (r = e.payload)
                }).fail(function() {
                    r = null, i = "HTTP Request failed"
                }).always(function() {
                    r && "function" == typeof t ? t(r) : r || "function" != typeof n || n(i || "Preset not found")
                })
            }, KS.prototype.srvPresetRename = function(e, t, n, r) {
                this.srvPresetGetById(e, function(e) {
                    return o.a.ajax({
                        type: "POST",
                        url: "".concat(tC(), "preset"),
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify({
                            id: e.id,
                            name: t,
                            expression: e.expression,
                            pdbFile: {
                                id: e.pdbFile.id
                            }
                        })
                    }).done(function(e) {
                        var t = e && e.message ? e.message : null,
                            o = !1;
                        e && "OK" === e.status && (o = !0), o && "function" == typeof n ? n(t) : o || "function" != typeof r || r(t)
                    }).fail(function() {
                        "function" == typeof r && r("HTTP Request failed")
                    })
                }, r)
            }, KS.prototype.srvPresetUpdate = function(e, t, n) {
                var r = this,
                    i = function(e) {
                        var i = r.getState({
                            settings: !0,
                            view: !0
                        });
                        if (delete i.load, i.reps)
                            for (var a = 0, s = i.reps.length; a < s; ++a) {
                                var l = i.reps[a];
                                if (l.hasOwnProperty("selector") && (l.selector = eC.parse(l.selector).selector, l.selector.toJSON && (l.selector = l.selector.toJSON())), l.hasOwnProperty("mode") && Array.isArray(l.mode) && l.mode[1].hasOwnProperty("subset")) {
                                    var c = eC.parse(l.mode[1].subset).selector;
                                    c.toJSON && (l.mode[1].subset = c.toJSON())
                                }
                            }
                        return e.expression = JSON.stringify(i), o.a.ajax({
                            type: "POST",
                            url: "".concat(tC(), "preset"),
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify({
                                id: e.id,
                                name: e.name,
                                expression: e.expression,
                                pdbFile: {
                                    id: e.pdbFile.id
                                }
                            })
                        }).done(function(e) {
                            var r = e && e.message ? e.message : null,
                                o = !1;
                            e && "OK" === e.status && (o = !0), o && "function" == typeof t ? t(r) : o || "function" != typeof n || n(r)
                        }).fail(function() {
                            "function" == typeof n && n("HTTP Request failed")
                        })
                    };
                null === e && r._srvPreset ? this.srvPresetGetById(r._srvPreset.id, i, n) : null !== e ? this.srvPresetGetById(e, i, n) : n("No preset for update")
            }, KS.prototype.srvPresetCreate = function(e, t, n) {
                var r = this.getState({
                    settings: !0,
                    view: !0
                });
                if (delete r.load, r.reps)
                    for (var i = 0, a = r.reps.length; i < a; ++i) {
                        var s = r.reps[i];
                        if (s.hasOwnProperty("selector") && (s.selector = eC.parse(s.selector).selector, s.selector.toJSON && (s.selector = s.selector.toJSON())), s.hasOwnProperty("mode") && Array.isArray(s.mode) && s.mode[1].hasOwnProperty("subset")) {
                            var l = eC.parse(s.mode[1].subset).selector;
                            l.toJSON && (s.mode[1].subset = l.toJSON())
                        }
                    }
                var c, u = this,
                    p = function(e, r, o) {
                        var i = r + (-1 !== e ? " at #".concat(String(e)) : "") + (o ? " : ".concat(o) : "");
                        u.logger.debug(i), -1 !== e && "function" == typeof t ? t(o) : -1 === e && "function" == typeof n && n(o)
                    };
                if (this._srvTopologyFile) {
                    var f = {
                        name: e,
                        expression: JSON.stringify(r),
                        pdbFile: {
                            id: this._srvTopologyFile.id
                        }
                    };
                    this._srvAnimationFile && (f.mdFile = {
                        id: this._srvAnimationFile.id
                    }), c = o.a.ajax({
                        type: "POST",
                        url: "".concat(tC(), "preset"),
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(f)
                    })
                } else c = o.a.Deferred().reject().promise();
                return c.done(function(e) {
                    var t = e && e.message ? e.message : null,
                        n = "FAILURE",
                        r = -1;
                    e && "OK" === e.status && (n = "ADDED", r = e.payload ? e.payload.id : -1), p(r, n, t)
                }).fail(function() {
                    p(-1, "FAILURE", "HTTP Request failed")
                })
            }, KS.prototype.srvPresetApply = function(e, t, n) {
                var r = this,
                    o = function(e) {
                        var n;
                        if (n = l.a.cloneDeep(QS.now.plugins), QS.reset(), QS.set({
                                plugins: n
                            }), !r._srvTopologyFile || r._srvTopologyFile.id !== e.pdbFile.id) return r.reset(), r._opts.reps = null, r.applyPreset("empty"), void r.load("".concat(tC(), "topology/").concat(e.pdbFile.id, "/download"), {
                            fileType: "pdb",
                            sourceType: "url",
                            fileName: e.pdbFile.path,
                            topologyFile: e.pdbFile,
                            animationFile: e.mdFile,
                            preset: e
                        });
                        r._srvPreset = e, e.elDensityFile ? r.loadEd("".concat(tC(), "edensity/").concat(e.elDensityFile.id, "/download")) : r.resetEd();
                        var o, i = JSON.parse(e.expression);
                        if (o = i.hasOwnProperty("preset") && void 0 !== QS.now.presets[i.preset] ? QS.now.presets[i.preset] : QS.now.presets.default, i.reps)
                            for (var a = new JS, s = 0, c = i.reps.length; s < c; ++s) {
                                var u = i.reps[s],
                                    p = o[Math.min(s, o.length - 1)];
                                if (u.colorer = u.colorer || p.colorer, u.mode = u.mode || p.mode, u.material = u.material || p.material, u.hasOwnProperty("selector") ? u.selector = a.createSelectorFromNode(u.selector) : u.selector = p.selector, u.hasOwnProperty("mode") && Array.isArray(u.mode) && u.mode[1].hasOwnProperty("subset")) {
                                    var f = a.createSelectorFromNode(u.mode[1].subset);
                                    null !== f && (u.mode[1].subset = f.toString())
                                }
                            }!i.reps && i.hasOwnProperty("preset") && void 0 !== QS.now.presets[i.preset] && (i.reps = o), r._complexVisual && r._complexVisual.getComplex().resetAtomMask(0), r.setOptions(i), e.mdFile && r._startMdAnimation(e.mdFile, e.pdbFile), "function" == typeof t ? t("Preset applied") : r.dispatchEvent({
                                type: "presetApplyFinished",
                                msg: "Preset applied"
                            })
                    };
                "object" === ZS(e) ? o(e) : r.srvPresetGetById(e, o, n)
            }, KS.prototype.srvPresetDelete = function(e, t, n) {
                return o.a.ajax({
                    type: "DELETE",
                    url: "".concat(tC(), "preset/").concat(e),
                    contentType: "",
                    data: ""
                }).done(function(e) {
                    var r = e && e.message ? e.message : null,
                        o = e && "OK" === e.status;
                    o && "function" == typeof t ? t(r) : o || "function" != typeof n || n(r)
                }).fail(function() {
                    "function" == typeof n && n("HTTP Request failed")
                })
            }, KS.prototype.srvScenarioAdd = function(e, t, n, r, i) {
                var a = this,
                    s = function(e, t, n) {
                        var o = t + (-1 !== e ? " at #".concat(String(e)) : "") + (n ? " : ".concat(n) : "");
                        a.logger.debug(o), -1 !== e && "function" == typeof r ? r(e, n) : -1 === e && "function" == typeof i && i(n)
                    },
                    l = {
                        name: t,
                        script: n
                    };
                return e >= 0 && (l.id = e), o.a.ajax({
                    type: "POST",
                    url: "".concat(tC(), "scenario"),
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(l)
                }).done(function(e) {
                    var t = e && e.message ? e.message : null,
                        n = "FAILURE",
                        r = -1;
                    e && "OK" === e.status && (n = "ADDED", r = e.payload ? e.payload.id : -1), s(r, n, t)
                }).fail(function() {
                    s(-1, "FAILURE", "HTTP Request failed")
                })
            }, KS.prototype.srvScenarioDelete = function(e, t, n) {
                return o.a.ajax({
                    type: "DELETE",
                    url: "".concat(tC(), "scenario/?scenarioId=").concat(e),
                    contentType: "",
                    data: ""
                }).done(function(e) {
                    var r = e && e.message ? e.message : null,
                        o = e && "OK" === e.status;
                    o && "function" == typeof t ? t(r) : o || "function" != typeof n || n(r)
                }).fail(function() {
                    "function" == typeof n && n("HTTP Request failed")
                })
            }, KS.prototype.srvScenarioList = function(e, t) {
                var n = [],
                    r = null;
                return o.a.get("".concat(tC(), "scenario"), function(e) {
                    e && "OK" === e.status && e.payload && (n = e.payload)
                }).fail(function() {
                    n = [], r = "HTTP Request failed"
                }).always(function() {
                    r || "function" != typeof e ? r && "function" == typeof t && t(r) : e(n)
                })
            }, KS.prototype.srvStreamMdFn = function(e, t) {
                return "string" == typeof e && t instanceof File ? function(n, r, o) {
                    var i = n && void 0 !== n.everyFrame ? n.everyFrame : 1,
                        a = n && void 0 !== n.recalculateSecondaryStructure ? n.recalculateSecondaryStructure : 0,
                        s = n && void 0 !== n.start ? n.start : null,
                        l = n && void 0 !== n.end ? n.end : null,
                        c = new FormData;
                    c.append("topologyFile", t), c.append("mdFile", e), c.append("everyFrame", i), c.append("recalculateSecondaryStructure", a), c.append("start", s), c.append("end", l);
                    var u = new XMLHttpRequest;
                    u.responseType = "arraybuffer", u.onerror = function(e) {
                        "function" == typeof o && o(e)
                    }, u.onload = function() {
                        200 === u.status ? "function" == typeof r && r(u.response) : "function" == typeof o && o("HTTP Request error")
                    }, u.open("POST", "".concat(tC(), "md/stream"), !0), u.send(c)
                } : function(n, r, o) {
                    var i = n && void 0 !== n.everyFrame ? n.everyFrame : 1,
                        a = n && void 0 !== n.recalculateSecondaryStructure ? n.recalculateSecondaryStructure : 0,
                        s = n && void 0 !== n.start ? n.start : null,
                        l = n && void 0 !== n.end ? n.end : null,
                        c = "".concat(tC(), "md/").concat(e.id, "/download?pdbId=").concat(t.id, "&everyFrame=").concat(i, "&recalculateSecondaryStructure=").concat(a);
                    s && (c += "&start=".concat(s)), l && (c += "&end=".concat(l));
                    var u = new XMLHttpRequest;
                    u.responseType = "arraybuffer", u.onerror = function(e) {
                        "function" == typeof o && o(e)
                    }, u.onload = function() {
                        200 === u.status ? "function" == typeof r && r(u.response) : "function" == typeof o && o("HTTP Request error")
                    }, u.open("GET", c, !0), u.send()
                }
            };
            var rC = KS,
                oC = '<div id="miew-menu">\n  \x3c!-- Title bar --\x3e\n\n  <div class="titlebar" style="display: none">\n    <span data-field="title">3D Molecular Viewer</span>\n\n    <span class="md-player" style="position: absolute;margin-left: 20px;">\n      <span class="glyphicon glyphicon-play" aria-hidden="true" style="font-size: large; cursor: pointer;" data-btn-type="md-player-play"></span>\n      <span class="glyphicon glyphicon-pause" aria-hidden="true" style="font-size: large; cursor: pointer;" data-btn-type="md-player-pause"></span>\n      <span class="glyphicon glyphicon-refresh rotating" data-btn-type="md-player-loading"></span>\n    </span>\n\n    <div class="btns-miew-titlebar btns-miew-titlebar-left btns-miew-titlebar-main-menu">\n      <button class="btn btn-default btn-titlebar" data-toggle="miew-main-menu" data-state="on" data-tooltip="tooltip" data-placement="bottom" title="Open menu">\n        <span class="glyphicon glyphicon-menu-hamburger"></span>\n      </button>\n\n      <button id="miew-terminal-btn" type="button" class="btn btn-default btn-titlebar" data-toggle="miew-terminal" data-state="on" data-tooltip="tooltip" data-placement="bottom" title="Terminal">\n        <span class="glyphicon glyphicon-menu-right"></span>\n      </button>\n    </div>\n    <div class="blog-nav btns-miew-titlebar btns-miew-titlebar-right btns-miew-titlebar-toolbar">\n\n      <button type="button" class="btn btn-default btn-titlebar blog-nav-item" data-toggle="toolbar" data-value="miew-menu-toolbar-mode"  data-tooltip="tooltip" data-placement="bottom" title="Display mode">\n        <span class="glyphicon glyphicon-picture"></span>\n      </button>\n\n      <button type="button" class="btn btn-default btn-titlebar blog-nav-item" data-toggle="toolbar" data-value="miew-menu-toolbar-colorer"  data-tooltip="tooltip" data-placement="bottom" title="Display color">\n        <span class="glyphicon glyphicon-tint"></span>\n      </button>\n\n      \x3c!-- button type="button" class="btn btn-default btn-titlebar blog-nav-item" data-toggle="toolbar" data-value="miew-menu-toolbar-resolution"  data-tooltip="tooltip" data-placement="bottom" title="Resolution">\n        <span class="glyphicon glyphicon-stats"></span>\n      </button --\x3e\n\n    </div>\n\n  </div>\n  <div class="toolbar container-fluid" data-toolbar-type="miew-menu-toolbar-mode" style="display: none">\n    <div class="pseudo-row">\n      <div class="row">\n        <h5 class="text-center">Display mode</h5>\n      </div>\n      <div class="row">\n\n      </div>\n    </div>\n  </div>\n  <div class="toolbar container-fluid" data-toolbar-type="miew-menu-toolbar-colorer" style="display: none">\n    <div class="pseudo-row">\n      <div class="row">\n        <h5 class="text-center">Display color</h5>\n      </div>\n      <div class="row">\n\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- div class="toolbar container-fluid" data-toolbar-type="miew-menu-toolbar-resolution" style="display: none">\n    <div class="pseudo-row">\n      <div class="row">\n        <h5 class="text-center">Resolution</h5>\n      </div>\n      <div class="row">\n        <a href="#" class="thumbnail" data-toggle="resolution-immediate" data-value="poor">\n          <img src="images/resolution/poor.png">\n          <div class="caption text-center"><small>Poor</small></div>\n        </a>\n        <a href="#" class="thumbnail" data-toggle="resolution-immediate" data-value="low">\n          <img src="images/resolution/low.png">\n          <div class="caption text-center"><small>Low</small></div>\n        </a>\n        <a href="#" class="thumbnail" data-toggle="resolution-immediate" data-value="medium">\n          <img src="images/resolution/medium.png">\n          <div class="caption text-center"><small>Medium</small></div>\n        </a>\n        <a href="#" class="thumbnail" data-toggle="resolution-immediate" data-value="high">\n          <img src="images/resolution/high.png">\n          <div class="caption text-center"><small>High</small></div>\n        </a>\n        <a href="#" class="thumbnail" data-toggle="resolution-immediate" data-value="ultra">\n          <img src="images/resolution/ultra.png">\n          <div class="caption text-center"><small>Ultra</small></div>\n        </a>\n      </div>\n    </div>\n  </div --\x3e\n\n  <div class="container miew-terminal" style="display: none;">\n      <div class="row col-xs-12 col-sm-12 panel panel-default panel-menu panel-dark" data-panel-type="miew-menu-panel-terminal" style="background-color: transparent">\n        <div class="miew-terminal-body">\n          <div class="terminal-window"></div>\n        </div>\n      </div>\n  </div>\n\n  \x3c!-- Main menu --\x3e\n\n  <div class="container main-menu" style="display: none">\n    <div class="row">\n\n      \x3c!-- Left panel --\x3e\n\n      <div class="col-xs-12 col-sm-3 panel panel-default panel-menu panel-dark" data-panel-type="miew-menu-panel-main">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="miew-main-menu" data-state="off"><span class="glyphicon glyphicon-menu-hamburger"></span></button>\n          <h3 class="panel-title visible-xs">Menu</h3>\n        </div>\n        <div class="panel-body list-group">\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-info">\n            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Info</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-presets">\n            <span class="glyphicon glyphicon-folder-open"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Load</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-gallery">\n            <span class="glyphicon glyphicon-star"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Gallery</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-representation">\n            <span class="glyphicon glyphicon-picture"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Representations</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-render">\n            <span class="glyphicon glyphicon-eye-open"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Render settings</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-tools">\n            <span class="glyphicon glyphicon-wrench"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            Tools</a>\n          <a href="#" class="list-group-item" data-toggle="panel" data-value="miew-menu-panel-about">\n            <span class="glyphicon glyphicon-question-sign"></span>&nbsp;\x3c!-- span class="glyphicon glyphicon-menu-right pull-right"></span --\x3e\n            About</a>\n        </div>\n      </div>\n\n      \x3c!-- Info panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-info">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Info</h3>\n        </div>\n        <div class="panel-body"></div>\n      </div>\n\n      \x3c!-- Load panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-presets" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left main-back-button visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <button class="btn btn-default btn-titlebar pull-left presets-back-button hidden presets-panel-action" data-presets-panel-action="navigate-back"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Load</h3>\n        </div>\n        <div class="panel-body">\n          <div class="main">\n            <form data-form-type="miew-menu-form-load-pdb" style="margin-bottom:20px; ">\n              <div class="form-group">\n                <label class="control-label">PDB or AMBER prmtop (PDB ID, URL or local file)</label>\n                <div class="input-group" style="margin-bottom: 10px;">\n                  <input type="text" class="form-control presets-panel-action" placeholder="PDB ID or URL..." data-pdb-url-type="main" data-presets-panel-action="pdb-inputs-text" data-presets-panel-events="input,propertychange,paste,change">\n                  <span class="input-group-btn">\n                    <span class="btn btn-primary miew-panel-btn-tooltip"><span class="glyphicon glyphicon-folder-open"></span><input type="file" class="form-control presets-panel-action" data-pdb-url-type="main" data-presets-panel-action="pdb-inputs-file"  data-presets-panel-events="change"></span>\n                    <span data-btn-type="miew-menu-btn-browse-file" style="visibility:hidden;"><input type="file"></span>\n                  </span>\n                </div>\n                <div class="alert alert-warning" role="alert" data-pdb-url-type="main"></div>\n                <div class="alert alert-danger" role="alert" data-pdb-url-type="main"></div>\n                <label class="control-label" data-pdb-url-type="sub">AMBER coordinate/restart file (URL)</label>\n\n                \x3c!-- --\x3e\n                <div style="margin-bottom: 10px;" data-pdb-url-type="sub">\n                  <input type="text" class="form-control presets-panel-action" placeholder="URL..." data-pdb-url-type="sub" data-presets-panel-action="pdb-inputs-text" data-presets-panel-events="input,propertychange,paste,change">\n                </div>\n                \x3c!-- --\x3e\n                \x3c!--<div class="input-group" style="margin-bottom: 10px;" data-pdb-url-type="sub">--\x3e\n                  \x3c!--<input type="text" class="form-control presets-panel-action" placeholder="URL..." data-pdb-url-type="sub" data-presets-panel-action="pdb-inputs-text" data-presets-panel-events="input,propertychange,paste">--\x3e\n                  \x3c!--<span class="input-group-btn">--\x3e\n                    \x3c!--<span class="btn btn-primary miew-panel-btn-tooltip disabled"><span class="glyphicon glyphicon-folder-open disabled"></span>--\x3e\n                      \x3c!--&lt;!&ndash;<input type="file" class="form-control presets-panel-action" data-pdb-url-type="sub" data-presets-panel-action="pdb-inputs-file" data-presets-panel-events="change">&ndash;&gt;--\x3e\n                    \x3c!--</span>--\x3e\n                  \x3c!--</span>--\x3e\n                \x3c!--</div>--\x3e\n                <div class="alert alert-warning" role="alert" data-pdb-url-type="sub"></div>\n                <div class="alert alert-danger" role="alert" data-pdb-url-type="sub"></div>\n              </div>\n              <div class="row">\n                <div class="col-sm-6 col-xs-6" style="padding:0px">\n                  \x3c!-- block:READONLY_SERVER-1 --\x3e<span class="pull-left btn btn-primary presets-panel-action" data-presets-panel-action="pdb-register">Add current file to server</span>\x3c!-- endblock:READONLY_SERVER-1 --\x3e\n                </div>\n                <div class="col-sm-6 col-xs-6" style="padding:0px">\n                  <span class="pull-right btn btn-danger presets-panel-action" data-tooltip="tooltip" data-presets-panel-action="pdb-inputs-clear" style="min-width: 150px; margin-left: 10px;">Cancel</span>\n                  <span class="pull-right btn btn-primary presets-panel-action" data-tooltip="tooltip" data-presets-panel-action="pdb-load" style="min-width: 150px; margin-left: 10px;">Load</span>\n                </div>\n              </div>\n            </form>\n\n            <form data-form-type="miew-menu-form-auto-preset">\n              <ul class="list-group">\n                <li class="list-group-item"><label>Automatic preset on load</label> <div class="pull-right">\n                  <input type="checkbox" data-dir="settings" data-toggle="autoPreset" data-size="mini" title="Automatic preset">\n                </div></li>\n                <li class="list-group-item"><label>Skip water</label> <div class="pull-right">\n                  <input type="checkbox" data-dir="settings" data-toggle="nowater" data-size="mini" title="Skip water">\n                </div></li>\n              </ul>\n            </form>\n\n            <div class="progress miew-presets-panel-progress hidden">\n              <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n              </div>\n            </div>\n\n            <div data-form-type="miew-menu-form-configured-pdb-files">\n              <div class="form-group">\n                <div class="row">\n                  <div class="col-xs-10 col-sm-9" style="padding:0px">\n                    <label class="control-label">Configured PDB files</label>\n                  </div>\n                  <div class="col-xs-2 col-sm-3" style="text-align: right">\n                      <span class="glyphicon glyphicon-refresh miew-configured-pdb-list-action miew-configured-pdb-list-action-refresh presets-panel-action" data-presets-panel-action="pdb-list-refresh"></span>\n                  </div>\n                </div>\n                <input type="text" class="form-control miew-configured-pdb-list-search-field presets-panel-action" placeholder="Search name..." data-presets-panel-action="pdb-list-search" data-presets-panel-events="input,propertychange,paste">\n              </div>\n              <div class="list-group miew-configured-pdb-list">\n              </div>\n              <nav aria-label="Page navigation" style="text-align: center">\n                <ul class="pagination miew-configured-pdb-list-pagination" style="margin:0px;"></ul>\n              </nav>\n            </div>\n          </div>\n\n          <div class="sub">\n            <div class="progress miew-presets-sub-panel-progress hidden">\n              <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n              </div>\n            </div>\n            <div style="text-align: right;">\n              <a class="btn presets-panel-action" data-btn-type="miew-menu-btn-refresh-presets" data-presets-panel-action="preset-list-refresh">\n                <span class="glyphicon glyphicon-refresh" style="color: #337ab7;"></span>\n              </a>\n            </div>\n            <div class="miew-menu-form-presets">\n              <div class="alert alert-warning" role="alert" data-label-type="miew-label-empty-preset-list" style="text-align: center;">There are no presets for this molecule.\x3c!-- block:READONLY_SERVER-2 --\x3e Add new preset or try to reload the list.\x3c!-- endblock:READONLY_SERVER-2 --\x3e</div>\n              <div class="list-group"></div>\n            </div>\n            \x3c!-- block:READONLY_SERVER-3 --\x3e\n            <div class="input-group">\n              <input type="text" class="form-control presets-panel-action" data-presets-panel-action="preset-input-refresh" data-presets-panel-events="input,propertychange,paste" placeholder="New preset name" data-input-type="miew-menu-input-new-preset-name">\n              <span class="input-group-btn">\n                <a class="btn btn-primary presets-panel-action" data-presets-panel-action="preset-create" type="button" data-btn-type="miew-menu-btn-add-preset">\n                  <span class="glyphicon glyphicon-plus"></span>\n                  Add new preset\n                </a>\n              </span>\n            </div>\n            <div>\n              <div class="alert alert-info" role="alert" data-label-type="miew-label-add-new-preset-info" style="margin-top: 10px; text-align: center;">Load pdb file first to create new preset.</div>\n            </div>\n            \x3c!-- endblock:READONLY_SERVER-3 --\x3e\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Gallery panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-gallery" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Gallery</h3>\n        </div>\n        <div class="panel-body">\n          <div class="container-fluid">\n            <div class="row-fluid">\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="pc:serotonin" data-query="p=small&mt=ME&v=1P1erPnlYqD3sL7u8kNxQPmZl0L4NUDlA0c6VPg%3D%3D">\n                <a href="#" class="thumbnail">\n                  <img src="images/serotonin.png">\n                  <div class="caption text-center">Serotonin</div>\n                </a>\n              </div>\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="data/1CRN.pdb" data-query="p=macro">\n                <a href="#" class="thumbnail">\n                  <img src="images/1CRN.png">\n                  <div class="caption text-center">1CRN <small>(0.3k)</small></div>\n                </a>\n              </div>\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="1AID" data-query="p=macro&m=CS&c=CH&r=1&s=hetatm+and+altloc+A&v=1XA99wmIQG8LRIls%2BLXGoPRDqTb%2BdvOC/PEyQPg%3D%3D">\n                <a href="#" class="thumbnail">\n                  <img src="images/1AID.png">\n                  <div class="caption text-center">1AID <small>(1.6k)</small></div>\n                </a>\n              </div>\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="2BFU" data-query="p=macro&c=CH&r=2&s=all&m=CS&c=CH&mt=TR&v=1AAAAgAAAAIAAAACAAtq6O7plpT4VEF6%2B1/WQPQ%3D%3D">\n                <a href="#" class="thumbnail">\n                  <img src="images/2BFU.png">\n                  <div class="caption text-center">2BFU <small>(5.2k)</small></div>\n                </a>\n              </div>\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="5B40" data-query="p=macro&r=2&s=nucleic&m=CS&c=SS&mt=TR&v=1EBjRwvhTz0CYbo7BE0KGPBxejb/3yk2//Wb1vg%3D%3D">\n                <a href="#" class="thumbnail">\n                  <img src="images/5B40.png">\n                  <div class="caption text-center">5B40 <small>(11.8k)</small></div>\n                </a>\n              </div>\n              <div class="col-xs-6 col-sm-4" data-toggle="preset-pdb" data-value="mmtf:4TNW" data-query="p=macro&c=SQ&v=1xQCuQgIrbUHD9arAmmsnPIj8NL/mF6u%2Bx26BPg%3D%3D">\n                <a href="#" class="thumbnail">\n                  <img src="images/4TNW.png">\n                  <div class="caption text-center">4TNW <small>(30.4k)</small></div>\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Representation panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-representation" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Representations</h3>\n        </div>\n        <div class="panel-body">\n          <div class="dropdown" id="miew-source-dropdown" style="margin-bottom: 0.5em; display: none">\n            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n              <span class="glyphicon glyphicon-file"></span> <span id="miew-source-name">File</span>\n              <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu" id="miew-source-list">\n            </ul>\n          </div>\n\n          <div class="panel-group miew-repr-list" role="tablist" aria-multiselectable="true" style="padding-bottom: 5px; margin-bottom: 0;">\n\n          </div>\n\n          <div class="btn-group miew-repr-list-controls" role="group">\n            <a class="btn btn-primary" type="button" data-btn-type="miew-menu-btn-add-repr">\n              <span class="glyphicon glyphicon-plus"></span>\n              Add new representation\n            </a>\n            <a class="btn btn-default" type="button" data-btn-type="miew-menu-btn-del-repr">\n              <span class="glyphicon glyphicon-trash"></span>\n              Delete current representation\n            </a>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Render panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-render" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Render settings</h3>\n        </div>\n        <div class="panel-body">\n\n          <form data-form-type="miew-menu-form-render">\n\n            <ul class="list-group">\n              \x3c!-- Resolution --\x3e\n              <li class="list-group-item" data-toggle="combobox-panel" data-value="miew-menu-panel-resolution">Resolution\n              <span class="pull-right">\n                <span class="text-muted"></span>\n                <span class="glyphicon glyphicon-menu-right"></span>\n              </span>\n              </li>\n              \x3c!-- Resolution autodetection --\x3e\n              <li class="list-group-item"><label>Resolution autodetection</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="autoResolution" data-size="mini" title="Resolution autodetection">\n              </span></li>\n              \x3c!-- Fog --\x3e\n              <li class="list-group-item"><label>Fog</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="fog" data-size="mini" title="Fog">\n              </span></li>\n              \x3c!-- Axes --\x3e\n              <li class="list-group-item"><label>Axes</label> <div class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="axes" data-size="mini" title="Axes">\n              </div></li>\n              \x3c!-- FPS --\x3e\n              <li class="list-group-item"><label>FPS counter</label> <div class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="fps" data-size="mini" title="FPS counter">\n              </div></li>\n              \x3c!-- Palette --\x3e\n              <li class="list-group-item" data-toggle="combobox-panel" data-value="miew-menu-panel-palette">Palette\n              <span class="pull-right">\n                <span class="text-muted"></span>\n                <span class="glyphicon glyphicon-menu-right"></span>\n              </span>\n              </li>\n              \x3c!-- Background color --\x3e\n              <li class="list-group-item"><label>Background color</label> <div class="checkbox-background pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="theme" data-size="mini" data-on-text="Dark" data-off-text="Light" data-handle-width="46" data-label-width="0"  title="Background color">\n              </div></li>\n              \x3c!-- FXAA --\x3e\n              <li class="list-group-item"><label>FXAA</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="fxaa" data-size="mini"  title="FXAA">\n              </span></li>\n              \x3c!-- Amient Occlusion --\x3e\n              <li class="list-group-item"><label>Ambient Occlusion</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="ao" data-size="mini"  title="Ambient Occlusion">\n              </span></li>\n              \x3c!-- Shadow Map --\x3e\n              <li class="list-group-item"><label>Shadow Map</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="shadow.on" data-size="mini"  title="ShadowMap">\n              </span></li>\n              \x3c!-- Clip plane --\x3e\n              <li class="list-group-item"><label>Clip Plane</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="draft.clipPlane" data-size="mini" title="Clip Plane">\n              </span></li>\n              \x3c!-- Outline --\x3e\n              <li class="list-group-item"><label>Outline</label> <span class="pull-right">\n                <input type="checkbox" data-dir="settings" data-toggle="outline.on" data-size="mini"  title="Outline">\n              </span></li>\n\n            </ul>\n\n          </form>\n\n        </div>\n      </div>\n\n      \x3c!-- Tools panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-tools" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Tools</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="dssp"><span class="glyphicon glyphicon-sort"></span>&nbsp;\n              Assign secondary structure\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="reset-view"><span class="glyphicon glyphicon-refresh"></span>&nbsp;\n              Reset view\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="screenshot"><span class="glyphicon glyphicon-camera"></span>&nbsp;\n              Screenshot\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="get-url"><span class="glyphicon glyphicon-link"></span>&nbsp;\n              Get URL\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="get-script"><span class="glyphicon glyphicon-list-alt"></span>&nbsp;\n              Get script\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="save-settings"><span class="glyphicon glyphicon-log-in"></span>&nbsp;\n              Save settings\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="restore-settings"><span class="glyphicon glyphicon-log-out"></span>&nbsp;\n              Restore settings\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="reset-settings"><span class="glyphicon glyphicon-refresh"></span>&nbsp;\n              Reset settings\n            </a>\n            <a href="#" class="list-group-item" data-toggle="miew-menu-tools" data-value="fbx-export" style="display: none"><span class="glyphicon glyphicon-floppy-save"></span>&nbsp;\n              Export FBX\n            </a>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- About panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-about" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left visible-xs" data-toggle="main-panel" data-value="miew-menu-panel-main"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">About</h3>\n        </div>\n        <div class="panel-body">\n          <div style="left: 0;top: 40px;position: absolute;">\n            <a href="https://github.com/epam/miew">\n              <img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png">\n            </a>\n          </div>\n          <div class="text-center">\n            <img src="images/logo.svg">\n            <h3 class="text-center" style="max-width:35ex;margin:20px auto 10px">\n              <span style="white-space:nowrap;">Miew &ndash; 3D Molecular Viewer</span>\n              <small class="PACKAGE_VERSION" style="white-space:nowrap;"></small>\n            </h3>\n\n            <p>Copyright  20152019 EPAM Systems, Inc.</p>\n            <p><a href="https://epa.ms/miew">https://epa.ms/miew</a></p>\n          </div>\n          <hr>\n          <h2>Keyboard and mouse shortcuts</h2>\n          <div>\n            <table class="table">\n            <thead>\n              <tr><th>Key</th><th>Action</th></tr>\n            </thead>\n            <tbody>\n              <tr><td colspan="2"><b>Camera and object controls</b></td></tr>\n              <tr><td><kbd>LMB</kbd></td><td>Click to select object part</td></tr>\n              <tr><td>&nbsp;</td><td>Double click to change object rotation center</td></tr>\n              <tr><td>&nbsp;</td><td>Drag to rotate object in 3D</td></tr>\n              <tr><td><kbd>Shift</kbd> + <kbd>LMB</kbd></td><td>Drag to rotate object in Z plane</td></tr>\n              <tr><td><kbd>Mouse Wheel</kbd></td><td>Scale object</td></tr>\n              <tr><td><kbd>RMB</kbd></td><td>Drag to shift molecule</td></tr>\n\n              <tr><td colspan="2"><b>Component / fragment edit mode</b></td></tr>\n              <tr><td><kbd>C</kbd> / <kbd>F</kbd></td><td>Enter the component or fragment edit mode</td></tr>\n              <tr><td><kbd>A</kbd> / <kbd>D</kbd></td><td>Apply or discard changes</td></tr>\n              <tr><td><kbd>Alt</kbd> + <kbd>LMB</kbd></td><td>Drag to rotate component / fragment in 3D</td></tr>\n              <tr><td><kbd>Alt</kbd> + <kbd>Shift</kbd> + <kbd>LMB</kbd></td><td>Drag to rotate component / fragment in Z plane</td></tr>\n              <tr><td><kbd>Alt</kbd> + <kbd>Ctrl</kbd> + <kbd>LMB</kbd></td><td>Drag to translate component in Z plane</td></tr>\n\n              <tr><td colspan="2"><b>Other</b></td></tr>\n              <tr><td><kbd>X</kbd></td><td>Extract selection as a new representation</td></tr>\n            </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Mode panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-mode" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-representation"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Display mode</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Color panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-color" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-representation"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Display color</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Palette panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-palette" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-render"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Display palette</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Material presets panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-matpreset" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-representation"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Material</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Color panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-select-color" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-representation"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Choose color</h3>\n        </div>\n        <div class="panel-body">\n          <div class="row">\n\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Resolution panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-resolution" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-render"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Render resolution</h3>\n        </div>\n        <div class="panel-body">\n          <div class="list-group">\n            <a href="#" class="list-group-item" data-toggle="resolution" data-value="poor">Poor</a>\n            <a href="#" class="list-group-item" data-toggle="resolution" data-value="low">Low</a>\n            <a href="#" class="list-group-item" data-toggle="resolution" data-value="medium">Medium</a>\n            <a href="#" class="list-group-item" data-toggle="resolution" data-value="high">High</a>\n            <a href="#" class="list-group-item" data-toggle="resolution" data-value="ultra">Ultra</a>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Selection panel --\x3e\n\n      <div class="col-xs-12 col-sm-9 panel panel-default panel-menu" data-panel-type="miew-menu-panel-selection" style="display: none">\n        <div class="panel-heading">\n          <button class="btn btn-default btn-titlebar pull-left" data-toggle="panel" data-value="miew-menu-panel-representation"><span class="glyphicon glyphicon-menu-left"></span></button>\n          <h3 class="panel-title">Selection</h3>\n        </div>\n        <div class="panel-body">\n            <div class="form-group">\n              <label>Selection string</label>\n              <div class="input-group">\n                <input type="text" class="form-control">\n                <span class="input-group-btn"><button class="btn btn-primary" type="button" data-btn-type="miew-menu-btn-apply-sel">Apply</button></span>\n              </div>\n              <span class="help-block">For example:\n                "<a href="#">all</a>",\n                "<a href="#">not hetatm</a>",\n                "<a href="#">hetatm and not water</a>",\n                "<a href="#">residue ALA, CYS</a>",\n                "<a href="#">serial 1:10, 20:30 and elem C,N</a>".\n                </span>\n            </div>\n            <div class="alert alert-danger" style="display:none; font-family: \'Anonymous Pro\',\'Consolas\',\'Courier New\',Courier,monospace; white-space: pre"></div>\n\n          <div class="row">\n            <div class="col-xs-6 col-sm-6 column">\n              <ul class="nav nav-tabs">\n                <li class="active"><a data-toggle="tab" href="[data-tab-content=singleword]">Single</a></li>\n                <li><a data-toggle="tab" href="[data-tab-content=keyword]">Key</a></li>\n                <li><a data-toggle="tab" href="[data-tab-content=value]">Value</a></li>\n              </ul>\n\n              <div class="tab-content">\n                <div data-tab-content="singleword" class="tab-pane fade in active">\n                  <div class="list-group">\n\n                  </div>\n                </div>\n                <div data-tab-content="keyword" class="tab-pane fade">\n                  <div class="list-group">\n\n                  </div>\n                </div>\n                <div data-tab-content="value" class="tab-pane fade">\n                  <div class="list-group">\n\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class="col-xs-6 col-sm-6 column calc">\n              <a class="col-xs-6 btn btn-default btn-calc" data-toggle="selection-input" data-value=" ">SPACE</a>\n              <a class="col-xs-3 btn btn-default btn-calc delete" data-delete-type="clear">CLEAR</a>\n              <a class="col-xs-3 btn btn-default btn-calc delete" data-delete-type="backspace"><span class="glyphicon glyphicon-arrow-left"></span></a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value="and ">and</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value="or ">or</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value="not ">not</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="A">A</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="7">7</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="8">8</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="9">9</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="B">B</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="4">4</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="5">5</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="6">6</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="C">C</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="1">1</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="2">2</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="3">3</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="D">D</a>\n              <a class="col-xs-3 btn btn-default btn-calc digit" data-toggle="selection-input" data-value="0">0</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value="(">(</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value=")">)</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="H">H</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value=",">,</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value=":">:</a>\n              <a class="col-xs-3 btn btn-default btn-calc" data-toggle="selection-input" data-value="&#34;">"</a>\n              <a class="col-xs-3 btn btn-default btn-calc char" data-toggle="selection-input" data-value="O">O</a>\n          </div>\n          </div>\n          <div></div>\n        </div>\n      </div>\n\n    </div>\n\n    \x3c!--Tooltips panel container--\x3e\n    <div class="miew-menu-panel-tooltips">\n    </div>\n  </div>\n\n  \x3c!-- Modals --\x3e\n  <div class="miew-menu-modals">\n    \x3c!-- URL Modal --\x3e\n    <div class="modal fade" data-modal-type="miew-menu-modal-url" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n            <h4 class="modal-title">Url</h4>\n          </div>\n          <div class="modal-body">\n\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Script modal --\x3e\n    <div class="modal fade" data-modal-type="miew-menu-modal-script" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n            <h4 class="modal-title">Script</h4>\n          </div>\n          <div class="modal-body">\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Rename preset --\x3e\n    <div class="modal fade" data-modal-type="miew-menu-modal-rename-preset" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">Rename preset</h4>\n          </div>\n          <div class="modal-body">\n            <input type="text" data-preset-id="">\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            <button type="button" class="btn btn-primary presets-panel-action" data-presets-panel-action="preset-rename-confirm" data-dismiss="modal" data-btn-type="miew-menu-btn-modal-rename">Rename</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="modal fade" data-modal-type="miew-menu-modal-remove-pdb" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">Removing PDB</h4>\n          </div>\n          <div class="modal-body">\n\n          </div>\n          <div class="modal-footer">\n            <div class="pull-left"><input type="checkbox" id="pdb-force-delete"><span style="margin-left: 10px;">Force delete</span></div>\n            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            <button type="button" class="btn btn-danger presets-panel-action" data-dismiss="modal" data-btn-type="miew-menu-btn-modal-remove-pdb" data-presets-panel-action="pdb-remove-confirm">Remove</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="modal fade" data-modal-type="miew-menu-modal-remove-preset" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">Removing preset</h4>\n          </div>\n          <div class="modal-body">\n\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            <button type="button" class="btn btn-danger presets-panel-action" data-dismiss="modal" data-btn-type="miew-menu-btn-modal-remove-preset" data-presets-panel-action="preset-remove-confirm">Remove</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="modal fade" data-modal-type="miew-menu-modal-global-error" tabindex="-1" role="dialog">\n      <div class="modal-dialog modal-lg" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title"></h4>\n          </div>\n          <div class="modal-body">\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</div>\n',
                iC = (n("G1gL"), n("dABf"), n("CbsS"), KS.chem.selectors),
                aC = KS.io.parsers,
                sC = KS.gfx,
                lC = sC.Representation,
                cC = sC.fbxExport,
                uC = KS.modes,
                pC = KS.colorers,
                fC = KS.palettes,
                hC = KS.materials,
                dC = KS.settings,
                mC = KS.utils,
                yC = mC.createElement,
                vC = mC.hexColor;

            function _C(e) {
                return e instanceof Array && (e = e[0]), e
            }

            function gC(e) {
                var t = !1;
                return e._forEachComplexVisual(function() {
                    t = !0
                }), t
            }

            function bC(e, t) {
                var n = e._getComplexVisual();
                return n ? n.getComplex().getNumAtomsBySelector(t) : -1
            }

            function wC(e, t) {
                var n = dC.now.theme;
                l.a.forEach(o.a.parseHTML(oC), function(t) {
                    return e.parentNode.appendChild(t)
                }), e.className = "".concat(e.className.replace(/\s*theme-\w+\b/g, ""), " theme-").concat(n), this._viewer = t, this._menuId = "#miew-menu", this._titlebar = o()("".concat(this._menuId, " .titlebar")), this._menu = o()("".concat(this._menuId, " .main-menu")), this._curPanelID = "miew-menu-panel-info", this._curMenuItem = "miew-menu-panel-info", this._xs = !1, this._curReprIdx = 0, this._menu.find(".PACKAGE_VERSION").text(KS.VERSION), this._singleWordsPrimary = ["all", "none", "water", "hetatm", "protein", "basic", "acidic", "charged", "polar", "nonpolar", "aromatic", "nucleic", "purine", "pyrimidine", "polarh", "nonpolarh"], this._singleWords = ["all", "none", "water", "hetatm", "protein", "basic", "acidic", "charged", "polar", "nonpolar", "aromatic", "nucleic", "purine", "pyrimidine", "polarh", "nonpolarh"], this._keyWordsPrimary = ["serial", "name", "elem", "residue", "sequence", "chain", "altloc"], this._init(), this._initializeTerminal()
            }
            wC.prototype._initializeTerminal = function() {
                var e = this,
                    t = this,
                    n = null,
                    r = "",
                    i = o()("#miew-menu [data-btn-type=miew-menu-btn-browse-file] input");
                i.change(function() {
                    if (o()(i).val()) {
                        var e, a = o()(i)[0].files;
                        a.length > 0 && (null !== n && (e = {
                            mdFile: n[1]
                        }), t._viewer.load(a[0], e))
                    }
                    r = "", o()(i).val("")
                }), this._terminal = o()("".concat(this._menuId, " .miew-terminal")), this._terminalWindow = this._terminal.find(".terminal-window"), this._terminalWindow.on("click", function() {
                    return e._hideToolbarPanel()
                }), this._term = this._terminalWindow.terminal(function(e, o) {
                    if (t._viewer) {
                        var a = (e = e.trim()).split(/\s+/);
                        "load" === a[0] && "-f" === a[1] ? (r = e.substr(e.indexOf("-f") + 2), n = r.match(/(?:"([^"]*)"|'([^']*)')/), "" !== r ? null !== n && n[0] === r.trim() && n[1].indexOf(".nc") === n[1].length - 3 ? i.click() : o.error("You can use only URL string to *.nc file to determine trajectory") : (n = null, i.click())) : t._viewer.script(e, function(e) {
                            o.echo(e)
                        }, function(e) {
                            o.error(e)
                        })
                    } else o.error("Miew is not initialized.")
                }, {
                    greetings: "Miew - 3D Molecular Viewer\nCopyright  2015-2019 EPAM Systems, Inc.\n",
                    prompt: "miew> ",
                    name: "miew",
                    scrollOnEcho: !0,
                    height: "100%",
                    keydown: function(e, t) {
                        if (192 === e.keyCode) return !1
                    },
                    onInit: function(e) {
                        if (t._viewer) {
                            var n = {
                                error: "#f00",
                                warn: "#990",
                                report: "#1a9cb0"
                            };
                            t._viewer.logger.addEventListener("message", function(t) {
                                var r = t.message.replace("[", "(").replace("]", ")");
                                e.echo("[[b;".concat(n[t.level] || "#666", ";]").concat(r, "]"))
                            })
                        }
                    }
                })
            }, wC.prototype._fillSelectionColorCombo = function(e) {
                for (var t = this, n = document.createDocumentFragment(), r = (fC.get(e) || fC.first).namedColorsArray, i = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-select-color]")), a = 0, s = r.length; a < s; a++) {
                    var l = vC(r[a][1]),
                        c = yC("div", {
                            class: "col-xs-2 col-sm-2",
                            "data-toggle": "selectcolor",
                            "data-value": l
                        }, [yC("a", {
                            href: "#",
                            class: "thumbnail",
                            style: "text-align:center;"
                        }, yC("img", {
                            src: "images/empty_icon.png",
                            style: "background-color: ".concat(l, ";"),
                            "data-tooltip": "tooltip",
                            "data-placement": "bottom",
                            title: r[a][0]
                        }))]);
                    n.appendChild(c)
                }
                o()(i.get(0).lastElementChild.firstElementChild).empty(), i.get(0).lastElementChild.firstElementChild.appendChild(n), o()("".concat(t._menuId, " [data-toggle=selectcolor]")).on("click", function() {
                    var e = t._getCurReprPropertyId("miew-menu-panel-select-color");
                    o()("".concat(t._menuId, ' [data-value="').concat(e, '"]')).removeClass("active"), i.get(0).firstElementChild.firstElementChild.click();
                    var n = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list ") + ".panel.valid:eq(".concat(t._curReprIdx, ") [data-value=miew-menu-panel-select-color]")),
                        r = this.getAttribute("data-value");
                    n[0].lastChild.firstElementChild.setAttribute("data-id", r), n[0].lastChild.firstElementChild.firstElementChild.style.backgroundColor = r
                }), i.find(".panel-heading:first-of-type button:first-of-type").on("click", function() {
                    var e = t._getCurReprPropertyId("miew-menu-panel-select-color");
                    o()("".concat(t._menuId, ' [data-toggle=selectcolor][data-value="').concat(e, '"]')).removeClass("active")
                })
            }, wC.prototype._fillCombo = function(e, t, n, r) {
                for (var i, a = this, s = document.createDocumentFragment(), l = o()("".concat(a._menuId, " [data-panel-type=").concat(e, "]")).get(0), c = r.all, u = 0, p = c.length; u < p; u++) {
                    var f = c[u];
                    f = f.prototype || f, i = yC("a", {
                        href: "#",
                        class: "list-group-item",
                        "data-toggle": t,
                        "data-value": f.id
                    }, [yC("div", {
                        class: "media-left"
                    }, yC("img", {
                        class: "media-object",
                        src: "images/".concat(t, "/").concat(f.id, ".png"),
                        width: "48",
                        height: "48"
                    })), yC("div", {
                        class: "media-body media-middle"
                    }, f.name)]), s.appendChild(i)
                }
                l.lastElementChild.firstElementChild.appendChild(s), o()("".concat(a._menuId, " [data-toggle=").concat(t, "]")).on("click", function() {
                    var t, r = this.getAttribute("data-value");
                    "miew-menu-panel-palette" === e ? (t = dC.get(n), dC.set(n, r)) : t = a._getCurReprPropertyId(e), o()("".concat(a._menuId, ' [data-value="').concat(t, '"]')).removeClass("active"), l.firstElementChild.firstElementChild.click()
                }), o()("".concat(a._menuId, ' [data-toggle=combobox-panel][data-value="').concat(e, '"]')).on("click", function() {
                    var t;
                    t = "miew-menu-panel-palette" === e ? dC.get(n) : a._getCurReprPropertyId(e), o()("".concat(a._menuId, ' a[data-value="').concat(t, '"]')).addClass("active")
                }), o()("".concat(a._menuId, " [data-panel-type=").concat(e, "] .panel-heading:first-of-type button:first-of-type")).on("click", function() {
                    var t;
                    t = "miew-menu-panel-palette" === e ? dC.get(n) : a._getCurReprPropertyId(e), o()("".concat(a._menuId, ' a[data-value="').concat(t, '"]')).removeClass("active")
                })
            }, wC.prototype._initReprListItemListeners = function(e) {
                var t = this,
                    n = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list"));
                n.find(".panel:eq(".concat(e, ") .panel-heading")).on("click", function(e) {
                    var r = n.find(".panel.valid").index(o()(e.currentTarget).parent()),
                        i = n.find(".panel.valid:eq(".concat(r, ") .panel-heading .btn span"));
                    if (e.target !== i[0] && e.target !== i[1]) {
                        var a = n.find(".panel.valid:eq(".concat(t._curReprIdx, ") .panel-heading"));
                        a.removeClass("active"), (a = n.find(".panel.valid:eq(".concat(t._curReprIdx, ") .panel-collapse"))).collapse("hide"), t._curReprIdx = r, (a = n.find(".panel.valid:eq(".concat(t._curReprIdx, ") .panel-heading"))).addClass("active"), n.find(".panel.valid:eq(".concat(t._curReprIdx, ") .panel-collapse")).collapse("show")
                    }
                }), n.find(".panel:eq(".concat(e, ") input[type=checkbox]")).bootstrapSwitch(), n.find(".panel:eq(".concat(e, ") .panel-heading .btn-visible")).on("click", function() {
                    n.find(".panel:eq(".concat(e, ") .panel-heading .btn-visible")).hide(), n.find(".panel:eq(".concat(e, ") .panel-heading .btn-invisible")).show()
                }), n.find(".panel:eq(".concat(e, ") .panel-heading .btn-invisible")).on("click", function() {
                    n.find(".panel:eq(".concat(e, ") .panel-heading .btn-invisible")).hide(), n.find(".panel:eq(".concat(e, ") .panel-heading .btn-visible")).show()
                }), n.find(".panel:eq(".concat(e, ') [data-toggle="combobox-panel"]')).on("click", function() {
                    return t._getPanelSelector(t._curPanelID).hide(), t._curPanelID = this.getAttribute("data-value"), t._getPanelSelector(t._curPanelID).show(), !1
                }), n.find(" .panel:eq(".concat(e, ") input[type=number]")).on("input", function(e) {
                    var t = o()(e.currentTarget);
                    parseFloat(t.attr("min")) > parseFloat(t.val()) && (t.val(parseFloat(t.attr("min"))), t.change()), parseFloat(t.attr("max")) < parseFloat(t.val()) && (t.val(parseFloat(t.attr("max"))), t.change())
                }), n.find(".panel:eq(".concat(e, ") .spinner-dec-btn")).on("click", function(t) {
                    var r = t.currentTarget.getAttribute("data-value"),
                        o = n.find(".panel:eq(".concat(e, ") [data-type=").concat(r, "]"));
                    parseFloat(o.attr("min")) < parseFloat(o.val()) && (o.val((10 * o.val() - 10 * o.attr("step")) / 10), o.change())
                }), n.find(".panel:eq(".concat(e, ") .spinner-inc-btn")).on("click", function(t) {
                    var r = t.currentTarget.getAttribute("data-value"),
                        o = n.find(".panel:eq(".concat(e, ") [data-type=").concat(r, "]"));
                    parseFloat(o.attr("max")) > parseFloat(o.val()) && (o.val((10 * o.val() + 10 * o.attr("step")) / 10), o.change())
                }), n.find(".panel:eq(".concat(e, ") [data-toggle=combobox-panel][data-value=miew-menu-panel-mode]")).on("click", function() {
                    var e = this.firstElementChild.firstElementChild.getAttribute("data-id");
                    o()("".concat(t._menuId, ' a[data-value="').concat(e, '"][data-toggle=mode]')).addClass("active")
                }), n.find(".panel:eq(".concat(e, ") [data-toggle=combobox-panel][data-value=miew-menu-panel-color]")).on("click", function() {
                    var e = this.firstElementChild.firstElementChild.getAttribute("data-id");
                    o()("".concat(t._menuId, ' a[data-value="').concat(e, '"][data-toggle=colorer]')).addClass("active")
                }), n.find(".panel:eq(".concat(e, ") [data-toggle=combobox-panel][data-value=miew-menu-panel-matpreset]")).on("click", function() {
                    var e = this.firstElementChild.firstElementChild.getAttribute("data-id");
                    o()("".concat(t._menuId, ' a[data-value="').concat(e, '"]')).addClass("active")
                }), n.find(".panel:eq(".concat(e, ") [data-toggle=combobox-panel][data-value=miew-menu-panel-select-color]")).on("click", function() {
                    var e = this.lastChild.firstElementChild.getAttribute("data-id");
                    o()("".concat(t._menuId, ' [data-toggle=selectcolor][data-value="').concat(e, '"]')).addClass("active")
                }), n.find(".panel:eq(".concat(e, ") [data-toggle=combobox-panel][data-value=miew-menu-panel-selection]")).on("click", function() {
                    var e = n.find(".panel.valid:eq(".concat(t._curReprIdx, ") [data-value=miew-menu-panel-selection]")),
                        r = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-selection]"));
                    r.find("input").val("".concat(e[0].firstElementChild.firstElementChild.textContent, " ")), r.find('.nav-tabs a[href="[data-tab-content=singleword]"]').tab("show"), t._onSelectorChanged(r)
                })
            }, wC.prototype._addReprListItem = function(e, t, n) {
                var r = o()("".concat(this._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list")),
                    i = r.find(".panel.valid").length,
                    a = yC("div", {
                        class: "panel panel-default valid"
                    }, [yC("div", {
                        class: "panel-heading",
                        role: "tab"
                    }, yC("h4", {
                        class: "panel-title"
                    }, [yC("button", {
                        class: "btn btn-default btn-invisible"
                    }, yC("span", {
                        class: "glyphicon glyphicon-unchecked"
                    })), yC("button", {
                        class: "btn btn-default btn-visible"
                    }, yC("span", {
                        class: "glyphicon glyphicon-check"
                    })), yC("a", {
                        role: "button",
                        "data-toggle": "collapse",
                        "data-parent": ".panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list",
                        href: "#repr".concat(t + 1),
                        "aria-expanded": "true",
                        "aria-controls": "[data-number=repr-".concat(String(t + 1), "]")
                    }, "#".concat(String(i + 1), ": ").concat(n.mode.name)), yC("div", {
                        class: "pseudo-div"
                    }, yC("span", {
                        class: "pull-right badge"
                    }, String(gC(this._viewer) ? bC(this._viewer, n.selector) : "0")))])), yC("div", {
                        "data-number": "repr-".concat(String(t + 1)),
                        class: "panel-collapse collapse",
                        role: "tabpanel",
                        "aria-labelledby": "head-repr-".concat(String(t + 1))
                    }, yC("ul", {
                        class: "list-group row"
                    }, [yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-toggle": "combobox-panel",
                        "data-value": "miew-menu-panel-selection"
                    }, ["Selection", yC("span", {
                        class: "pull-right"
                    }, [yC("label", {
                        class: "text-muted",
                        "data-type": "selection-target",
                        style: "word-break: break-all"
                    }, String(n.selector)), yC("span", {
                        class: "glyphicon glyphicon-menu-right"
                    })])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-toggle": "combobox-panel",
                        "data-value": "miew-menu-panel-mode"
                    }, ["Mode", yC("span", {
                        class: "pull-right"
                    }, [yC("span", {
                        class: "text-muted",
                        "data-id": n.mode.id
                    }, n.mode.shortName), yC("span", {
                        class: "glyphicon glyphicon-menu-right"
                    })])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-toggle": "combobox-panel",
                        "data-value": "miew-menu-panel-color"
                    }, ["Color", yC("span", {
                        class: "pull-right"
                    }, [yC("span", {
                        class: "text-muted",
                        "data-id": n.colorer.id
                    }, n.colorer.shortName), yC("span", {
                        class: "glyphicon glyphicon-menu-right"
                    })])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-toggle": "combobox-panel",
                        "data-value": "miew-menu-panel-select-color"
                    }, [yC("span", {}, "Color name"), yC("span", {
                        class: "pull-right"
                    }, [yC("a", {
                        href: "#ucolor",
                        class: "thumbnail",
                        "data-id": vC(16777215)
                    }, yC("img", {
                        src: "images/empty_icon.png",
                        style: "background-color: ".concat(vC(16777215), ";")
                    })), yC("span", {
                        class: "glyphicon glyphicon-menu-right"
                    })])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-toggle": "combobox-panel",
                        "data-value": "miew-menu-panel-matpreset"
                    }, ["Material", yC("span", {
                        class: "pull-right"
                    }, [yC("span", {
                        class: "text-muted",
                        "data-id": n.materialPreset.id
                    }, n.materialPreset.shortName), yC("span", {
                        class: "glyphicon glyphicon-menu-right"
                    })])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-type": "surf-param-rad"
                    }, ["Radius scale", yC("span", {
                        class: "input-group pull-right"
                    }, [yC("span", {
                        class: "input-group-addon spinner-dec-btn",
                        "data-toggle": "spinner",
                        "data-value": "rad"
                    }, yC("span", {
                        class: "glyphicon glyphicon-minus"
                    })), yC("input", {
                        type: "number",
                        class: "form-control",
                        "data-type": "rad",
                        value: "1.0",
                        min: "0",
                        max: "2",
                        step: "0.1"
                    }), yC("span", {
                        class: "input-group-addon spinner-inc-btn",
                        "data-toggle": "spinner",
                        "data-value": "rad"
                    }, yC("span", {
                        class: "glyphicon glyphicon-plus"
                    }))])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-type": "surf-param-iso"
                    }, ["Isosurface threshold", yC("span", {
                        class: "input-group pull-right"
                    }, [yC("span", {
                        class: "input-group-addon spinner-dec-btn",
                        "data-toggle": "spinner",
                        "data-value": "iso"
                    }, yC("span", {
                        class: "glyphicon glyphicon-minus"
                    })), yC("input", {
                        type: "number",
                        class: "form-control",
                        "data-type": "iso",
                        value: "0.5",
                        min: "0",
                        max: "10",
                        step: "0.5"
                    }), yC("span", {
                        class: "input-group-addon spinner-inc-btn",
                        "data-toggle": "spinner",
                        "data-value": "iso"
                    }, yC("span", {
                        class: "glyphicon glyphicon-plus"
                    }))])]), yC("li", {
                        class: "list-group-item col-xs-12 col-sm-12",
                        "data-type": "surf-param-zclip"
                    }, [yC("label", {}, "Z clipping"), yC("span", {
                        class: "pull-right"
                    }, yC("input", {
                        type: "checkbox",
                        "data-dir": "representation",
                        "data-toggle": "zClip",
                        "data-size": "mini",
                        title: "Z clipping"
                    }))])]))]);
                if (e.appendChild(a), "SA" === n.mode.id || "SE" === n.mode.id || "QS" === n.mode.id || "CS" === n.mode.id ? r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-zclip]")).show() : r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-zclip]")).hide(), "QS" === n.mode.id ? r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-rad]")).show() : r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-rad]")).hide(), "QS" === n.mode.id || "CS" === n.mode.id ? r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-iso]")).show() : r.find(".panel:eq(".concat(t, ") .panel-collapse [data-type=surf-param-iso]")).hide(), "UN" === n.colorer.id || "CB" === n.colorer.id) {
                    var s = r.find(".panel:eq(".concat(t, ") [data-value=miew-menu-panel-select-color]")),
                        l = vC(n.colorer.opts.color);
                    s[0].firstElementChild.innerHTML = "".concat(n.colorer.name, " color"), s[0].lastChild.firstElementChild.setAttribute("data-id", l), s[0].lastChild.firstElementChild.firstElementChild.style.backgroundColor = l, s.show()
                } else r.find(".panel:eq(".concat(t, ") [data-value=miew-menu-panel-select-color]")).hide();
                r.find(".panel:eq(".concat(t, ") input[type=checkbox]")).bootstrapSwitch("state", n.mode.opts.zClip), r.find(".panel:eq(".concat(t, ") [data-type=rad]")).val(n.mode.opts.scale), r.find(".panel:eq(".concat(t, ") [data-type=iso]")).val(n.mode.opts.isoValue);
                var c = r.find(".panel:eq(".concat(t, ") [data-value=miew-menu-panel-mode]"));
                c.removeData("mvdata"), c.data("mvdata", n.mode.opts);
                var u = r.find(".panel:eq(".concat(t, ") [data-value=miew-menu-panel-color]"));
                u.removeData("mvdata"), u.data("mvdata", n.colorer.opts), "SA" !== n.mode.id && "SE" !== n.mode.id || r.find(".panel:eq(".concat(t, ") [data-type=rad]")).val(n.mode._radScale), n.visible ? (r.find(".panel:eq(".concat(t, ") .panel-heading .btn-visible")).show(), r.find(".panel:eq(".concat(t, ") .panel-heading .btn-invisible")).hide()) : (r.find(".panel:eq(".concat(t, ") .panel-heading .btn-visible")).hide(), r.find(".panel:eq(".concat(t, ") .panel-heading .btn-invisible")).show()), this._initReprListItemListeners(t)
            }, wC.prototype._getCurReprPropertyId = function(e) {
                return o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list")).find(".panel.valid:eq(".concat(this._curReprIdx, ') [data-value="').concat(e, '"]'))[0].lastChild.firstElementChild.getAttribute("data-id")
            }, wC.prototype._getCurReprSelector = function() {
                return o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list")).find(".panel.valid:eq(".concat(this._curReprIdx, ") [data-type=selection-target]"))[0].textContent
            }, wC.prototype._copyCurReprListItem = function(e) {
                var t = o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list")),
                    n = t.find(".panel.valid:eq(".concat(this._curReprIdx, ")"));
                n.find(".panel-heading").removeClass("active"), n.find(".panel-collapse").collapse("hide");
                var r = t.find(".panel.valid:eq(".concat(this._curReprIdx, ") .panel-collapse")).attr("data-number"),
                    i = r.substr(0, r.lastIndexOf("-") + 1) + (e + 1);
                n.clone().appendTo(t), n.find(".panel-heading").addClass("active"), n.find(".panel-collapse").collapse("show");
                var a = t.find(".panel:eq(".concat(e, ")")),
                    s = a.html().replace(new RegExp(r.replace("-", "\\-"), "g"), i);
                a.html(s), a.addClass("added");
                var l = (a = a.find(".panel-heading a")).html(),
                    c = t.find(".panel.valid").length;
                a.html("#".concat(String(c)).concat(l.substring(l.indexOf(":"))));
                var u = n.find("[type=checkbox][data-toggle=zClip]")[0].checked,
                    p = t.find(".panel:eq(".concat(e, ") [data-type=surf-param-zclip]"));
                p.empty(), a.find("[type=checkbox]").bootstrapSwitch("state", u), p[0].appendChild(yC("label", {}, "Z clipping")), p[0].appendChild(yC("span", {
                    class: "pull-right"
                }, yC("input", {
                    type: "checkbox",
                    "data-dir": "representation",
                    "data-toggle": "zClip",
                    "data-size": "mini",
                    title: "Z clipping"
                }))), t.find(".panel:eq(".concat(e, ") input[type=checkbox]")).bootstrapSwitch("state", u);
                var f = n.find("[data-type=iso]").val();
                t.find(".panel:eq(".concat(e, ") [data-type=iso]")).val(f);
                var h = n.find("[data-type=rad]").val();
                t.find(".panel:eq(".concat(e, ") [data-type=rad]")).val(h), this._initReprListItemListeners(e)
            }, wC.prototype._fillSourceList = function() {
                var e = this,
                    t = this._viewer.getVisuals();
                o()("#miew-source-dropdown").toggle(t.length > 1);
                var n = this._viewer.getCurrentVisual();

                function r(t) {
                    return function(n) {
                        e._viewer.setCurrentVisual(t), e._fillSourceList(), e._initReprList(), n.preventDefault()
                    }
                }
                document.getElementById("miew-source-name").textContent = n;
                for (var i = document.getElementById("miew-source-list"), a = document.createDocumentFragment(), s = 0, l = t.length; s < l; ++s) {
                    var c = t[s],
                        u = yC("a", {
                            href: "#"
                        }, c !== n ? c : [yC("b", null, c), yC("span", {
                            class: "glyphicon glyphicon-ok pull-right"
                        })]);
                    u.addEventListener("click", r(c)), a.appendChild(yC("li", null, u))
                }
                i.innerHTML = "", i.appendChild(a)
            }, wC.prototype._fillReprList = function() {
                var e = this,
                    t = o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list"));
                t.empty();
                for (var n = t.get(0), r = 0, i = e._viewer.repCount(); r < i; r++) {
                    var a = e._viewer.repGet(r);
                    e._addReprListItem(n, r, a)
                }
                o()("".concat(e._menuId, " [data-toggle=mode]")).on("click", function() {
                    var n = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") [data-value=miew-menu-panel-mode]")),
                        r = this.getAttribute("data-value"),
                        o = uC.get(r);
                    n[0].firstElementChild.firstElementChild.textContent = o.prototype.shortName, n[0].firstElementChild.firstElementChild.setAttribute("data-id", r);
                    var i = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") .panel-heading a")),
                        a = i.html();
                    i.html("".concat(a.substring(0, a.indexOf(":") + 1), " ").concat(o.prototype.name));
                    var s = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") .panel-collapse [data-type=surf-param-zclip]"));
                    "SA" === r || "SE" === r || "QS" === r || "CS" === r ? (s.show(), s.find("[type=checkbox][data-toggle=zClip]").bootstrapSwitch("state", dC.defaults.modes[r].zClip)) : s.hide();
                    var l = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") .panel-collapse [data-type=surf-param-iso]"));
                    "QS" === r || "CS" === r ? (l.show(), l.find("[data-type=iso]").val(dC.defaults.modes[r].isoValue)) : l.hide();
                    var c = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") .panel-collapse [data-type=surf-param-rad]"));
                    "QS" === r ? (c.show(), c.find("[data-type=rad]").val(dC.defaults.modes[r].scale)) : c.hide()
                }), o()("".concat(e._menuId, " [data-toggle=colorer]")).on("click", function() {
                    var n = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") [data-value=miew-menu-panel-color]")),
                        r = this.getAttribute("data-value"),
                        o = pC.get(r);
                    if (n[0].firstElementChild.firstElementChild.textContent = o.prototype.shortName, n[0].firstElementChild.firstElementChild.setAttribute("data-id", r), "UN" === r || "CB" === r) {
                        var i = "UN" === r ? "Uniform color" : "Carbon color",
                            a = "UN" === r ? dC.now.colorers.UN.color : dC.now.colorers.CB.color,
                            s = t.find(".panel:eq(".concat(e._curReprIdx, ") [data-value=miew-menu-panel-select-color]"));
                        s[0].firstElementChild.innerHTML = i, s[0].lastElementChild.firstElementChild.setAttribute("data-id", vC(a)), s[0].lastElementChild.firstElementChild.firstElementChild.style.backgroundColor = vC(a), s.show()
                    } else t.find(".panel:eq(".concat(e._curReprIdx, ") [data-value=miew-menu-panel-select-color]")).hide()
                }), o()("".concat(e._menuId, " [data-toggle=material]")).on("click", function() {
                    var n = t.find(".panel.valid:eq(".concat(e._curReprIdx, ") [data-value=miew-menu-panel-matpreset]")),
                        r = this.getAttribute("data-value"),
                        o = hC.get(r);
                    n[0].firstElementChild.firstElementChild.textContent = o.shortName, n[0].firstElementChild.firstElementChild.setAttribute("data-id", r)
                })
            }, wC.prototype._getPanelSelector = function(e) {
                return o()("".concat(this._menuId, " .panel-menu[data-panel-type=").concat(e, "]"))
            }, wC.prototype._init = function() {
                var e = this,
                    t = null;
                o()(function() {
                    o()("".concat(e._menuId, ' .titlebar [data-tooltip="tooltip"]')).tooltip({
                        trigger: "hover"
                    })
                }), e._xs = e._isXS(), o()("".concat(e._menuId, ' [data-value="').concat(e._curPanelID, '"]')).toggleClass("active"), o()("".concat(e._menuId, " [data-toggle=miew-main-menu]")).on("click", function() {
                    var t = this.getAttribute("data-state");
                    return "on" === t ? (e._onMenuOn(), !1) : "off" === t && (e._onMenuOff(), !1)
                }), o()("".concat(e._menuId, " [data-toggle=miew-terminal]")).on("click", function() {
                    var t = this.getAttribute("data-state");
                    return this.blur(), "on" === t ? (e._onTerminalOn(), this.setAttribute("data-state", "off"), !1) : "off" === t && (e._onTerminalOff(), this.setAttribute("data-state", "on"), !1)
                }), o()("".concat(e._menuId, " [data-toggle=miew-terminal]")).on("mousedown", function(e) {
                    return e.preventDefault(), !1
                }), o()(document).on("keydown", function(t) {
                    27 !== t.keyCode || t.isDefaultPrevented() || !0 === o()("".concat(e._menuId, " .main-menu")).is(":visible") && (!0 === o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).is(":visible") && e._curMenuItem === e._curPanelID ? e._onMenuOff() : e._getPanelSelector(e._curPanelID).get(0).firstElementChild.firstElementChild.click())
                }), o()("".concat(e._menuId, ' [data-toggle="panel"]')).on("click", function() {
                    return !0 === e._xs && o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).hide(), e._getPanelSelector(e._curPanelID).hide(), o()("".concat(e._menuId, ' a[data-value="').concat(e._curMenuItem, '"]')).removeClass("active"), e._curMenuItem = e._curPanelID = t = this.getAttribute("data-value"), e._getPanelSelector(e._curPanelID).show(), o()("".concat(e._menuId, ' a[data-value="').concat(t, '"]')).addClass("active"), !1
                }), o()("".concat(e._menuId, ' [data-toggle="main-panel"]')).on("click", function() {
                    return o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).show(), e._getPanelSelector(e._curPanelID).hide(), e._xs && o()("".concat(e._menuId, ' a[data-value="').concat(e._curMenuItem, '"]')).removeClass("active"), !1
                }), o()("".concat(e._menuId, ' [data-toggle="combobox-panel"]')).on("click", function() {
                    return e._getPanelSelector(e._curPanelID).hide(), e._curPanelID = t = this.getAttribute("data-value"), e._getPanelSelector(e._curPanelID).show(), !1
                }), o()("".concat(e._menuId, ' [data-toggle="toolbar"]')).on("click", function() {
                    if (!this.classList.contains("disabled")) {
                        this.blur();
                        var t = this.getAttribute("data-value");
                        if (o()("".concat(e._menuId, ' [data-toggle="toolbar"]')).each(function(e, n) {
                                n.getAttribute("data-value") !== t && n.classList.contains("active") && n.click()
                            }), o()("".concat(e._menuId, " [data-toolbar-type=").concat(t, "]")).toggle(), this.classList.toggle("active"), "miew-menu-toolbar-resolution" === t) {
                            var n = o()("".concat(e._menuId, ' [data-toggle="resolution-immediate"]') + '[data-value="'.concat(dC.now.resolution, '"]'));
                            !0 === this.classList.contains("active") ? n.addClass("active") : n.removeClass("active")
                        } else {
                            var r = t.substr(t.lastIndexOf("-") + 1, t.length),
                                i = o()("".concat(e._menuId, ' [data-toggle="').concat(r, '-immediate"]') + '[data-value="'.concat(_C(e._viewer.rep()[r]), '"]'));
                            !0 === this.classList.contains("active") ? i.addClass("active") : i.removeClass("active")
                        }
                    }
                }), e._menu.on("click", function(t) {
                    o()(t.target).hasClass("main-menu") && e._onMenuOff()
                }), o()("".concat(e._menuId, " input[type=checkbox][data-dir=settings]")).bootstrapSwitch(), o()("".concat(e._menuId, " input[type=checkbox][data-dir=settings]")).on("switchChange.bootstrapSwitch", function() {
                    var t = this.getAttribute("data-toggle");
                    "theme" === t ? e._viewer.set("theme", this.checked ? "dark" : "light") : e._viewer.set(t, this.checked)
                });
                var n = !1;

                function r(t) {
                    if (n) {
                        var r = 0,
                            o = t.originalEvent;
                        o.wheelDelta ? r = o.wheelDelta : o.detail && (r = 10 * -o.detail);
                        var i = e._viewer.settings.now.draft;
                        e._viewer.set({
                            draft: {
                                clipPlaneFactor: i.clipPlaneFactor - r * i.clipPlaneSpeed
                            }
                        })
                    }
                }
                o()(document).on("keyup keydown", function(e) {
                    n = e.shiftKey
                }), o()(document).on("mousewheel", function(e) {
                    return r(e)
                }), o()(document).on("DOMMouseScroll", function(e) {
                    return r(e)
                }), this._initMiewEventListeners(), this._initToolbar(), this._initInfoPanel(), this._initLoadPanel(), this._initReprPanel(), this._initRenderPanel(), this._initToolsPanel(), this._initSelectionPanel(), this._initMdPlayerControls()
            }, wC.prototype._initMiewEventListeners = function() {
                var e = this;
                this._viewer.addEventListener("load", function() {
                    e._setTitle("Loading"), e._setMdPlayerState()
                }), this._viewer.addEventListener("parse", function() {
                    e._setTitle("Parsing")
                }), this._viewer.addEventListener("convert", function() {
                    e._setTitle("Converting")
                }), this._viewer.addEventListener("rebuild", function() {
                    e._setTitle("Building geometry")
                }), this._viewer.addEventListener("profile", function() {
                    e._setTitle("Profiling")
                }), this._viewer.addEventListener("resize", function() {
                    e._onResize()
                }), this._viewer.addEventListener("parsingFinished", function(t) {
                    e._updateInfo(t.data), e._fillSourceList(), e._fillReprList()
                }), this._viewer.addEventListener("titleChanged", function(t) {
                    e._setTitle(t.data)
                }), this._viewer.addEventListener("mdPlayerStateChanged", function(t) {
                    e._setMdPlayerState(t.state)
                }), this._viewer.addEventListener("editModeChanged", function(t) {
                    e._enableToolbar(t.data)
                }), this._viewer.addEventListener("onParseError", function() {
                    e.presetsPanel.actions.pdb.inputs.refresh(e)
                }), this._viewer.addEventListener("onParseDone", function() {
                    e.presetsPanel.actions.pdb.inputs.refresh(e)
                })
            }, wC.prototype._initInfoPanel = function() {
                this._updateInfo()
            }, wC.prototype._initLoadPanel = function() {
                var e = this;
                o()("".concat(e._menuId, ' [data-form-type=miew-menu-form-load-pdb] [data-tooltip="tooltip"]')).tooltip({
                    trigger: "hover"
                }), o()("".concat(e._menuId, ' [data-toggle="preset-pdb"]')).on("click", function(t) {
                    var n = this.getAttribute("data-value"),
                        r = this.getAttribute("data-query");
                    return o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list")).empty(), e._viewer.load(n).then(function() {
                        e._viewer.setOptions(r || "")
                    }), e._onMenuOff(), t.preventDefault(), !1
                }), this._initPresetsPanelActions()
            }, wC.prototype._initReprPanel = function() {
                var e = this,
                    t = o()("".concat(e._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list"));
                o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-add-repr]")).on("click", function() {
                    var n = t.find(".panel").length;
                    if (n > 0) e._copyCurReprListItem(n);
                    else {
                        var r = uC.first,
                            i = pC.first,
                            a = new lC(0, new r, new i, iC.all());
                        e._addReprListItem(t.get(0), n, a), t.find(".panel:eq(".concat(n, ")")).addClass("added")
                    }
                    var s = t.find(".panel.valid").length;
                    2 === s ? o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-del-repr]")).removeClass("disabled") : s === e._viewer.getMaxRepresentationCount() && o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-add-repr]")).addClass("disabled"), t.find(".panel.valid:eq(".concat(s - 1, ") .panel-heading")).click(), e._reprListChanged = !0
                }), o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-del-repr]")).on("click", function() {
                    var n = t.find(".panel.valid").length,
                        r = e._curReprIdx,
                        i = t.find(".panel.valid:eq(".concat(r, ")"));
                    if (i.addClass("deleted"), i.hide(), i.removeClass("valid"), e._curReprIdx === n - 1) t.find(".panel.valid:eq(".concat(e._curReprIdx - 1, ") .panel-heading")).click();
                    else {
                        t.find(".panel.valid:eq(".concat(e._curReprIdx, ") .panel-heading")).click();
                        for (var a = e._curReprIdx; a < n - 1; ++a) {
                            var s = t.find(".panel.valid:eq(".concat(a, ") .panel-heading a")),
                                l = s.html();
                            s.html("#".concat(String(a + 1)).concat(l.substring(l.indexOf(":"))))
                        }
                    }
                    1 === (n = t.find(".panel.valid").length) ? o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-del-repr]")).addClass("disabled") : n === e._viewer.getMaxRepresentationCount() - 1 && o()("".concat(e._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-add-repr]")).removeClass("disabled"), e._reprListChanged = !0
                }), e._fillCombo("miew-menu-panel-mode", "mode", "mode", uC), e._fillCombo("miew-menu-panel-color", "colorer", "colorer", pC), e._fillCombo("miew-menu-panel-matpreset", "material", "materialPreset", hC)
            }, wC.prototype._displayGlobalErrorDialog = function(e, t) {
                var n = o()("".concat(this._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-global-error]")),
                    r = n.find(".modal-title").get(0),
                    i = n.find(".modal-body").get(0);
                o()(r).html(e), o()(i).html(t || "Some error occured."), n.modal({
                    keyboard: !0
                }, "show")
            }, wC.prototype.presetsPanel = {
                pdbList: {
                    filteredItems: [],
                    pageSize: 10,
                    currentPageIndex: 0,
                    totalPagesCount: null,
                    pagination: {
                        minimumItemsCount: 5
                    }
                },
                presetsList: {
                    pdb: null,
                    items: []
                },
                inputs: {
                    main: null,
                    sub: null
                },
                actions: {
                    pdb: {
                        list: {
                            page: null,
                            refresh: null,
                            search: null,
                            display: null,
                            select: null
                        },
                        load: null,
                        register: null,
                        remove: {
                            ask: null,
                            confirm: null
                        },
                        inputs: {
                            clear: null,
                            refresh: null,
                            file: null,
                            text: null
                        }
                    },
                    preset: {
                        list: {
                            refresh: null,
                            display: null
                        },
                        apply: null,
                        rename: {
                            ask: null,
                            confirm: null
                        },
                        update: null,
                        remove: {
                            ask: null,
                            confirm: null
                        },
                        input: {
                            clear: null,
                            refresh: null
                        },
                        create: null
                    },
                    navigate: {
                        back: null
                    }
                }
            }, wC.prototype._presetsPanelDisplayPdbProgress = function(e) {
                var t = o()("".concat(this._menuId, " .miew-presets-panel-progress"));
                e ? t.removeClass("hidden") : t.addClass("hidden")
            }, wC.prototype._presetsPanelDisplayPresetsProgress = function(e) {
                var t = o()("".concat(this._menuId, " .miew-presets-sub-panel-progress")),
                    n = o()("".concat(this._menuId, " .presets-panel-action[data-presets-panel-action=preset-list-refresh]")),
                    r = o()("".concat(this._menuId, " .miew-menu-form-presets .alert-warning"));
                e ? (t.removeClass("hidden"), n.addClass("hidden"), r.hide()) : (t.addClass("hidden"), n.removeClass("hidden"))
            }, wC.prototype._presetsPanelActionsPdbInputsRefresh = function(e) {
                var t = o()("".concat(e._menuId, " .presets-panel-action[data-presets-panel-action=pdb-load]")),
                    n = o()("".concat(e._menuId, " .presets-panel-action[data-presets-panel-action=pdb-inputs-clear]")),
                    r = o()("".concat(e._menuId, " .presets-panel-action[data-presets-panel-action=pdb-register]")),
                    i = o()(o()("[data-form-type=miew-menu-form-load-pdb] input[type=text][data-pdb-url-type=main]").get(0)),
                    a = o()(o()("[data-form-type=miew-menu-form-load-pdb] .alert-danger[data-pdb-url-type=main]").get(0)),
                    s = o()(o()("[data-form-type=miew-menu-form-load-pdb] .alert-warning[data-pdb-url-type=main]").get(0)),
                    l = o()(o()("[data-form-type=miew-menu-form-load-pdb] .control-label[data-pdb-url-type=sub]").get(0)),
                    c = o()(o()("[data-form-type=miew-menu-form-load-pdb] input[type=text][data-pdb-url-type=sub]").get(0)),
                    u = o()(o()("[data-form-type=miew-menu-form-load-pdb] div[data-pdb-url-type=sub]").get(0)),
                    p = o()(o()("[data-form-type=miew-menu-form-load-pdb] .alert-danger[data-pdb-url-type=sub]").get(0)),
                    f = o()(o()("[data-form-type=miew-menu-form-load-pdb] .alert-warning[data-pdb-url-type=sub]").get(0)),
                    h = function(e) {
                        var t = e.toLowerCase().split("/"),
                            n = t[t.length - 1];
                        return t = n.split("\\"), 1 === (t = (n = t[t.length - 1]).split(".")).length ? "" : t[t.length - 1]
                    },
                    d = null,
                    m = null,
                    y = function(e) {
                        e ? (l.removeClass("hidden"), u.removeClass("hidden")) : (l.addClass("hidden"), u.addClass("hidden"))
                    },
                    v = function(e, t) {
                        "main" === e ? t ? (a.html(t), a.removeClass("hidden")) : (a.html(t), a.addClass("hidden")) : t ? (p.html(t), p.removeClass("hidden")) : (p.html(t), p.addClass("hidden"))
                    },
                    _ = function(e, t) {
                        "main" === e ? t ? (s.html(t), s.removeClass("hidden")) : (s.html(t), s.addClass("hidden")) : t ? (f.html(t), f.removeClass("hidden")) : (f.html(t), f.addClass("hidden"))
                    };
                if (e._viewer.srvCurrentTopologyIsRegistered(function(e) {
                        r.addClass("disabled"), e ? r.html("".concat(e, " already registered at server")) : r.html("Add current file to server")
                    }, function(e) {
                        r.removeClass("disabled"), r.html("Add '".concat(e, "' to server"))
                    }), e.presetsPanel.inputs.isCorrect = !1, e.presetsPanel.inputs && e.presetsPanel.inputs.main) {
                    if (e.presetsPanel.inputs.main) {
                        var g;
                        e.presetsPanel.inputs.main instanceof File ? (i.val(e.presetsPanel.inputs.main.name), i.attr("disabled", "disabled"), g = h(e.presetsPanel.inputs.main.name)) : (i.removeAttr("disabled"), g = h(e.presetsPanel.inputs.main));
                        var b = aC.keys("extensions").sort(),
                            w = new RegExp("^(".concat(b.map(function(e) {
                                return e.substr(1)
                            }).join("|"), ")$")),
                            x = b.join(", ");
                        g.match(/^(top|prmtop)$/) ? (e.presetsPanel.inputs.mainIsAMBER = !0, e.presetsPanel.inputs.mainIsCorrect = !0) : e.presetsPanel.inputs.main instanceof File && !g.match(w) ? (e.presetsPanel.inputs.mainIsAMBER = !1, e.presetsPanel.inputs.mainIsCorrect = !1, e.presetsPanel.inputs.isCorrect = !1, e.presetsPanel.inputs.sub = null, d = "Only the following filename extensions are supported: ".concat(x)) : (e.presetsPanel.inputs.mainIsAMBER = !1, e.presetsPanel.inputs.mainIsCorrect = !0, e.presetsPanel.inputs.isCorrect = !1, e.presetsPanel.inputs.sub = null)
                    }
                    if (y(e.presetsPanel.inputs.mainIsAMBER), e.presetsPanel.inputs.mainIsAMBER)
                        if (e.presetsPanel.inputs.sub) {
                            var S;
                            e.presetsPanel.inputs.sub instanceof File ? (c.val(e.presetsPanel.inputs.sub.name), c.attr("disabled", "disabled"), S = h(e.presetsPanel.inputs.sub.name)) : (c.removeAttr("disabled"), S = h(e.presetsPanel.inputs.sub)), "nc" === S ? (e.presetsPanel.inputs.subIsCorrect = !0, e.presetsPanel.inputs.isCorrect = !0) : (e.presetsPanel.inputs.subIsCorrect = !1, e.presetsPanel.inputs.isCorrect = !1, m = "Only .nc files are supported.")
                        } else e.presetsPanel.inputs.subIsCorrect = !1, e.presetsPanel.inputs.isCorrect = !1;
                    else c.val(""), c.removeAttr("disabled"), e.presetsPanel.inputs.subIsCorrect = !0, e.presetsPanel.inputs.isCorrect = !0;
                    e.presetsPanel.inputs.isCorrect ? t.removeClass("disabled") : t.addClass("disabled"), e.presetsPanel.inputs.main || e.presetsPanel.inputs.sub ? n.removeClass("hidden") : n.addClass("hidden"), v("main", d), v("sub", m)
                } else t.addClass("disabled"), n.addClass("hidden"), i.val(""), i.removeAttr("disabled"), c.val(""), c.removeAttr("disabled"), y(!1), v("main", null), v("sub", null), _("main", null), _("sub", null)
            }, wC.prototype._presetsPanelActionsPdbInputsClear = function(e) {
                e.presetsPanel.inputs = {
                    main: null,
                    sub: null
                }, e.presetsPanel.actions.pdb.inputs.refresh(e)
            }, wC.prototype._presetsPanelActionsPdbRegister = function(e) {
                var t = function() {
                        e._presetsPanelDisplayPdbProgress(!1)
                    },
                    n = function() {
                        t(), e._initPresetsPanel()
                    },
                    r = function(n) {
                        t(), e._displayGlobalErrorDialog("Error creating preset", n)
                    };
                e._viewer.srvCurrentTopologyIsRegistered(function(t) {
                    e._displayGlobalErrorDialog("Error registering PDB", "Cannot register ".concat(t))
                }, function() {
                    e._presetsPanelDisplayPdbProgress(!0), e._viewer.srvTopologyRegister(n, r), e.presetsPanel.actions.pdb.inputs.refresh(e)
                })
            }, wC.prototype._presetsPanelActionsPdbLoad = function(e) {
                e._onMenuOff(), e.presetsPanel.inputs && !e.presetsPanel.inputs.mainIsAMBER ? e._viewer.load(e.presetsPanel.inputs.main) : e._viewer.load(e.presetsPanel.inputs.main, {
                    mdFile: e.presetsPanel.inputs.sub
                }), e.presetsPanel.actions.pdb.inputs.clear(e)
            }, wC.prototype._presetsPanelActionsPdbInputsFile = function(e, t) {
                var n = o()(t).data("pdb-url-type"),
                    r = o()("[data-form-type=miew-menu-form-load-pdb] input[type=text][data-pdb-url-type=".concat(n, "]")).get(0);
                if (o()(t).val()) {
                    var i = o()(t)[0].files;
                    i.length > 0 && (e.presetsPanel.inputs[n] = i[0], o()(r).val(i[0].name), o()(r).attr("disabled", "disabled"))
                }
                o()(t).val(""), e.presetsPanel.actions.pdb.inputs.refresh(e)
            }, wC.prototype._presetsPanelActionsPdbInputsText = function(e, t, n) {
                var r = o()(t).data("pdb-url-type");
                e.presetsPanel.inputs[r] = o()(t).val(), e.presetsPanel.actions.pdb.inputs.refresh(e), n && "change" === n.type && e.presetsPanel.inputs.isCorrect && e.presetsPanel.actions.pdb.load(e)
            }, wC.prototype._presetsPanelActionsPdbRemoveAsk = function(e, t) {
                var n = t.getAttribute("data-pdb-id"),
                    r = t.getAttribute("data-pdb-name"),
                    i = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-remove-pdb]")),
                    a = i.find(".modal-body").get(0),
                    s = i.find('button.presets-panel-action[data-presets-panel-action="pdb-remove-confirm"]').get(0);
                i.find("#pdb-force-delete").get(0).checked = !1, o()(a).html("Are you sure you want to delete ".concat(r, "?")), o()(s).attr("data-pdb-id", n), i.modal({
                    keyboard: !0
                }, "show")
            }, wC.prototype._presetsPanelActionsPdbRemoveConfirm = function(e, t) {
                var n = t.getAttribute("data-pdb-id"),
                    r = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-remove-pdb]")).find("#pdb-force-delete").get(0);
                e._presetsPanelDisplayPdbProgress(!0), e._viewer.srvTopologyDelete(n, r.checked, function() {
                    e._presetsPanelDisplayPdbProgress(!1), e.presetsPanel.actions.pdb.list.refresh(e, !0)
                }, function(t) {
                    e._presetsPanelDisplayPdbProgress(!1), e._displayGlobalErrorDialog("Error removing PDB", t)
                })
            }, wC.prototype._presetsPanelActionsPdbListGo = function(e, t) {
                var n, r = t.getAttribute("data-page-index");
                (n = "first" === r ? 0 : "last" === r ? e.presetsPanel.pdbList.totalPagesCount - 1 : +r) !== e.presetsPanel.pdbList.currentPageIndex && (e.presetsPanel.pdbList.currentPageIndex = n, e.presetsPanel.actions.pdb.list.display(e))
            }, wC.prototype._presetsPanelActionsPdbListDisplay = function(e) {
                var t = o()("".concat(e._menuId, " .miew-configured-pdb-list")).get(0);
                o()(t).empty();
                var n, r = document.createDocumentFragment(),
                    i = e.presetsPanel.pdbList,
                    a = i.currentPageIndex,
                    s = i.pageSize,
                    l = i.filteredItems;
                for (n = a * s; n < Math.min(l.length, (a + 1) * s); n++) {
                    var c = yC("span", {
                            class: "pull-right glyphicon glyphicon-remove miew-configured-pdb-list-item-action presets-panel-action",
                            "data-action": "remove",
                            "data-presets-panel-action": "pdb-remove-ask",
                            "data-pdb-id": l[n].id,
                            "data-pdb-name": l[n].name
                        }),
                        u = yC("a", {
                            href: "#",
                            class: "list-group-item miew-pdb-item presets-panel-action",
                            "data-pdb-id": l[n].id,
                            "data-pdb-name": l[n].name,
                            "data-presets-panel-action": "pdb-list-select"
                        }, [yC("span", {}, [l[n].name, c])]);
                    r.appendChild(u)
                }
                t.appendChild(r);
                var p = o()("".concat(e._menuId, " .miew-configured-pdb-list-pagination")).get(0);
                o()(p).empty();
                var f = e.presetsPanel.pdbList.totalPagesCount;
                if (f && !(f <= 1)) {
                    var h = [],
                        d = e.presetsPanel.pdbList.pagination.minimumItemsCount,
                        m = Math.floor(d / 2),
                        y = Math.max(0, a - m),
                        v = Math.max(a + m, y + d - 1);
                    for (v = Math.min(f - 1, v), (y = Math.max(0, Math.min(y, v - d + 1))) > 0 && (1 === y ? h.push(0) : h.push("first")), n = y; n <= v; n++) h.push(n);
                    v < f - 1 && (v === f - 2 ? h.push(f - 1) : h.push("last"));
                    var _, g, b = document.createDocumentFragment();
                    for (n = 0; n < h.length; n++) b.appendChild((_ = h[n], g = void 0, "first" === _ ? (g = yC("span", {
                        "aria-hidden": !0
                    }, null), o()(g).html("&laquo;")) : "last" === _ ? (g = yC("span", {
                        "aria-hidden": !0
                    }, null), o()(g).html("&raquo;")) : g = "".concat(_ + 1), yC("li", {
                        class: e.presetsPanel.pdbList.currentPageIndex === _ ? "active" : ""
                    }, yC("a", {
                        "data-page-index": _,
                        href: "#",
                        class: "presets-panel-action",
                        "data-presets-panel-action": "pdb-list-page"
                    }, g))));
                    p.appendChild(b)
                }
            }, wC.prototype._presetsPanelActionsPdbListRefresh = function(e, t) {
                var n = o()("".concat(e._menuId, " .miew-configured-pdb-list-search-field"));
                t && e._presetsPanelDisplayPdbProgress(!0);
                var r = function(t) {
                        e._presetsPanelDisplayPdbProgress(!1), e.presetsPanel.pdbList.filteredItems = t || [], e.presetsPanel.pdbList.totalPagesCount = Math.ceil(e.presetsPanel.pdbList.filteredItems.length / e.presetsPanel.pdbList.pageSize), e.presetsPanel.pdbList.currentPageIndex = 0, e.presetsPanel.actions.pdb.list.display(e)
                    },
                    i = function() {
                        e._presetsPanelDisplayPdbProgress(!1), e.presetsPanel.pdbList.filteredItems = [], e.presetsPanel.pdbList.totalPagesCount = 0, e.presetsPanel.pdbList.currentPageIndex = 0, e.presetsPanel.actions.pdb.list.display(e)
                    };
                t ? e._viewer.srvTopologyAll(function() {
                    e._viewer.srvTopologyFilter(n.val(), r, i)
                }, i) : e._viewer.srvTopologyFilter(n.val(), r, i)
            }, wC.prototype._presetsPanelActionsPdbListSearch = function(e) {
                e.presetsPanel.actions.pdb.list.refresh(e, !1)
            }, wC.prototype._presetsPanelActionsPdbListSelect = function(e, t) {
                var n = +t.getAttribute("data-pdb-id"),
                    r = t.getAttribute("data-pdb-name");
                e.presetsPanel.presetsList.pdb = e.presetsPanel.pdbList.filteredItems.filter(function(e) {
                    return e.id === n
                })[0];
                var i = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] .panel-title")),
                    a = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] div.main")),
                    s = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] div.sub")),
                    l = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.main-back-button")),
                    c = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.presets-back-button")),
                    u = o()("".concat(e._menuId, " .miew-menu-form-presets .list-group")).get(0),
                    p = o()("".concat(e._menuId, " .miew-menu-form-presets .alert-warning"));
                o()(u).empty(), i.html(r), a.hide(), p.hide(), s.show(), l.addClass("hidden"), c.removeClass("hidden"), e.presetsPanel.actions.preset.input.clear(e), e.presetsPanel.actions.preset.list.refresh(e)
            }, wC.prototype._presetsPanelActionsPresetsListRefresh = function(e) {
                if (e.presetsPanel.presetsList.pdb) {
                    e._presetsPanelDisplayPresetsProgress(!0), e._viewer.srvPresetList(e.presetsPanel.presetsList.pdb.id, function(t) {
                        e._presetsPanelDisplayPresetsProgress(!1), e.presetsPanel.presetsList.items = t || [], e.presetsPanel.actions.preset.list.display(e)
                    }, function() {
                        e.presetsPanel.presetsList.items = [], e.presetsPanel.actions.preset.list.display(e)
                    })
                }
            }, wC.prototype._presetsPanelActionsNavigateBack = function(e) {
                var t = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] .panel-title")),
                    n = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] div.main")),
                    r = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] div.sub")),
                    i = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.main-back-button")),
                    a = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.presets-back-button"));
                t.html("Presets"), n.show(), r.hide(), i.removeClass("hidden"), a.addClass("hidden")
            }, wC.prototype._presetsPanelActionsPresetApply = function(e, t) {
                e._onMenuOff(), e._viewer.srvPresetApply(+t.getAttribute("data-preset-id"))
            }, wC.prototype._presetsPanelActionsPresetRenameAsk = function(e, t) {
                var n = t.getAttribute("data-preset-id"),
                    r = t.getAttribute("data-preset-name"),
                    i = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-rename-preset]")),
                    a = i.find(".modal-body input").get(0),
                    s = i.find('button.presets-panel-action[data-presets-panel-action="preset-rename-confirm"]').get(0);
                o()(a).val(r), o()(s).attr("data-preset-id", n), i.modal({
                    keyboard: !0
                }, "show"), i.on("shown.bs.modal", function() {
                    var e = o()(this).find(".modal-body input")[0];
                    e.focus(), e.select()
                })
            }, wC.prototype._presetsPanelActionsPresetRenameConfirm = function(e, t) {
                var n = +t.getAttribute("data-preset-id"),
                    r = o()(t).closest("[data-modal-type=miew-menu-modal-rename-preset]").find(".modal-body input").get(0),
                    i = o()(r).val();
                e._presetsPanelDisplayPresetsProgress(!0), e._viewer.srvPresetRename(n, i, function() {
                    e._presetsPanelDisplayPresetsProgress(!1), e.presetsPanel.actions.preset.list.refresh(e)
                }, function(t) {
                    e._presetsPanelDisplayPresetsProgress(!1), e._displayGlobalErrorDialog("Error renaming preset", t)
                })
            }, wC.prototype._presetsPanelActionsPresetUpdate = function(e, t) {
                e._updateReprList();
                var n = +t.getAttribute("data-preset-id");
                e._presetsPanelDisplayPresetsProgress(!0), e._viewer.srvPresetUpdate(n, function() {
                    e._presetsPanelDisplayPresetsProgress(!1)
                }, function(t) {
                    e._presetsPanelDisplayPresetsProgress(!1), e._displayGlobalErrorDialog("Error updating preset", t)
                })
            }, wC.prototype._presetsPanelActionsPresetRemoveAsk = function(e, t) {
                var n = t.getAttribute("data-preset-id"),
                    r = t.getAttribute("data-preset-name"),
                    i = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-remove-preset]")),
                    a = i.find(".modal-body").get(0),
                    s = i.find('button.presets-panel-action[data-presets-panel-action="preset-remove-confirm"]').get(0);
                o()(a).html("Are you sure you want to delete '".concat(r, "'?")), o()(s).attr("data-preset-id", n), i.modal({
                    keyboard: !0
                }, "show")
            }, wC.prototype._presetsPanelActionsPresetRemoveConfirm = function(e, t) {
                var n = t.getAttribute("data-preset-id");
                e._presetsPanelDisplayPresetsProgress(!0);
                var r = function() {
                    e._presetsPanelDisplayPresetsProgress(!1)
                };
                e._viewer.srvPresetDelete(n, function() {
                    r(), e.presetsPanel.actions.preset.list.refresh(e)
                }, function(t) {
                    r(), e._displayGlobalErrorDialog("Error removing preset", t)
                })
            }, wC.prototype._presetsPanelActionsPresetsListDisplay = function(e) {
                var t = o()("".concat(e._menuId, " .miew-menu-form-presets .list-group")).get(0),
                    n = o()("".concat(e._menuId, " .miew-menu-form-presets .alert-warning"));
                o()(t).empty(), 0 === e.presetsPanel.presetsList.items.length ? n.show() : n.hide();
                for (var r, i, a = document.createDocumentFragment(), s = 0; s < e.presetsPanel.presetsList.items.length; s++) {
                    i = e.presetsPanel.presetsList.items[s];
                    var l = yC("span", {
                            class: "glyphicon glyphicon-pencil miew-configured-pdb-list-item-action presets-panel-action",
                            "data-presets-panel-action": "preset-rename-ask",
                            "data-preset-id": i.id,
                            "data-preset-name": i.name
                        }),
                        c = yC("span", {
                            class: "glyphicon glyphicon-floppy-save miew-configured-pdb-list-item-action presets-panel-action",
                            "data-presets-panel-action": "preset-update",
                            "data-preset-id": i.id,
                            "data-preset-name": i.name
                        }),
                        u = yC("span", {
                            class: "glyphicon glyphicon-remove miew-configured-pdb-list-item-action presets-panel-action",
                            "data-presets-panel-action": "preset-remove-ask",
                            "data-preset-id": i.id,
                            "data-preset-name": i.name
                        }),
                        p = yC("div", {
                            class: "pull-right"
                        }, [l, c, u]),
                        f = null;
                    i.mdFile && (f = yC("span", {
                        class: "glyphicon glyphicon-play-circle",
                        style: "margin-left:5px"
                    }, null)), r = yC("a", {
                        class: "list-group-item presets-panel-action",
                        href: "#",
                        "data-preset-id": i.id,
                        "data-presets-panel-action": "preset-apply"
                    }, [yC("span", {}, i.name), f, p]), a.appendChild(r)
                }
                t.appendChild(a)
            }, wC.prototype._presetsPanelActionsPresetInputClear = function(e) {
                var t = o()("".concat(e._menuId, ' input[data-input-type="miew-menu-input-new-preset-name"]')).get(0);
                o()(t).val(""), e.presetsPanel.actions.preset.input.refresh(e)
            }, wC.prototype._presetsPanelActionsPresetInputRefresh = function(e) {
                var t = o()("".concat(e._menuId, ' input[data-input-type="miew-menu-input-new-preset-name"]')).get(0),
                    n = o()("".concat(e._menuId, ' .presets-panel-action[data-presets-panel-action="preset-create"]')).get(0),
                    r = o()("".concat(e._menuId, ' div[data-label-type="miew-label-add-new-preset-info"]')).get(0);
                e._viewer._srvTopologyFile && e.presetsPanel.presetsList.pdb && e._viewer._srvTopologyFile.id === e.presetsPanel.presetsList.pdb.id ? o()(t).val() && o()(t).val().length > 0 ? (o()(n).removeClass("disabled"), o()(t).removeAttr("disabled"), o()(r).hide()) : (o()(n).addClass("disabled"), o()(t).removeAttr("disabled"), o()(r).hide()) : (o()(n).addClass("disabled"), o()(t).attr("disabled", "disabled"), o()(r).show())
            }, wC.prototype._presetsPanelActionsPresetCreate = function(e) {
                var t = o()("".concat(e._menuId, ' input.presets-panel-action[data-presets-panel-action="preset-input-refresh"]')).get(0);
                o()(t).addClass("disabled"), e._presetsPanelDisplayPresetsProgress(!0);
                var n = function() {
                    e._presetsPanelDisplayPresetsProgress(!1), e.presetsPanel.actions.preset.input.clear(e), o()(t).removeClass("disabled")
                };
                e._viewer.srvPresetCreate(o()(t).val(), function() {
                    n(), e.presetsPanel.actions.preset.list.refresh(e)
                }, function(t) {
                    n(), e._displayGlobalErrorDialog("Error creating preset", t)
                })
            }, wC.prototype._initPresetsPanelActions = function() {
                var e = this;
                e.presetsPanel.actions.pdb.inputs.refresh = e._presetsPanelActionsPdbInputsRefresh, e.presetsPanel.actions.pdb.inputs.clear = e._presetsPanelActionsPdbInputsClear, e.presetsPanel.actions.pdb.inputs.file = e._presetsPanelActionsPdbInputsFile, e.presetsPanel.actions.pdb.inputs.text = e._presetsPanelActionsPdbInputsText, e.presetsPanel.actions.pdb.register = e._presetsPanelActionsPdbRegister, e.presetsPanel.actions.pdb.load = e._presetsPanelActionsPdbLoad, e.presetsPanel.actions.pdb.remove.ask = e._presetsPanelActionsPdbRemoveAsk, e.presetsPanel.actions.pdb.remove.confirm = e._presetsPanelActionsPdbRemoveConfirm, e.presetsPanel.actions.pdb.list.refresh = e._presetsPanelActionsPdbListRefresh, e.presetsPanel.actions.pdb.list.page = e._presetsPanelActionsPdbListGo, e.presetsPanel.actions.pdb.list.display = e._presetsPanelActionsPdbListDisplay, e.presetsPanel.actions.pdb.list.search = e._presetsPanelActionsPdbListSearch, e.presetsPanel.actions.pdb.list.select = e._presetsPanelActionsPdbListSelect, e.presetsPanel.actions.navigate.back = e._presetsPanelActionsNavigateBack, e.presetsPanel.actions.preset.list.refresh = e._presetsPanelActionsPresetsListRefresh, e.presetsPanel.actions.preset.list.display = e._presetsPanelActionsPresetsListDisplay, e.presetsPanel.actions.preset.apply = e._presetsPanelActionsPresetApply, e.presetsPanel.actions.preset.rename.ask = e._presetsPanelActionsPresetRenameAsk, e.presetsPanel.actions.preset.rename.confirm = e._presetsPanelActionsPresetRenameConfirm, e.presetsPanel.actions.preset.update = e._presetsPanelActionsPresetUpdate, e.presetsPanel.actions.preset.remove.ask = e._presetsPanelActionsPresetRemoveAsk, e.presetsPanel.actions.preset.remove.confirm = e._presetsPanelActionsPresetRemoveConfirm, e.presetsPanel.actions.preset.input.refresh = e._presetsPanelActionsPresetInputRefresh, e.presetsPanel.actions.preset.input.clear = e._presetsPanelActionsPresetInputClear, e.presetsPanel.actions.preset.create = e._presetsPanelActionsPresetCreate, e.presetsPanel.actions.pdb.inputs.refresh(e);
                var t = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] div.sub")),
                    n = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.main-back-button")),
                    r = o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-presets] button.presets-back-button"));
                t.hide(), n.removeClass("hidden"), r.addClass("hidden");
                o()(document).on("click input propertychange paste change", ".presets-panel-action", function(t) {
                    if (o()(this).hasClass("disabled")) return !1;
                    if (o()(this).data("presets-panel-action")) {
                        var n = o()(this).data("presets-panel-events");
                        if (n && -1 === (n = n.split(",")).indexOf(t.type.toLowerCase())) return !0;
                        var r = o()(this).data("presets-panel-action").split("-"),
                            i = function e(t, n) {
                                if (!t) return null;
                                if (1 === n.length) return t[n[0]];
                                var r = n[0];
                                return n.splice(0, 1), e(t[r], n)
                            }(e.presetsPanel.actions, r);
                        if (i) return i(e, this, t), "paste" === t.type.toLowerCase()
                    }
                    return !0
                })
            }, wC.prototype._initPresetsPanel = function() {
                this.presetsPanel.actions.pdb.list.refresh(this, !0), this.presetsPanel.actions.pdb.inputs.refresh(this), this.presetsPanel.actions.preset.list.refresh(this), this.presetsPanel.actions.preset.input.refresh(this)
            }, wC.prototype._initRenderPanel = function() {
                var e = this;
                o()("".concat(e._menuId, " [data-toggle=resolution]")).on("click", function() {
                    var t = o()("".concat(e._menuId, " [data-value=miew-menu-panel-resolution]")),
                        n = this.getAttribute("data-value"),
                        r = dC.now.resolution;
                    o()("".concat(e._menuId, ' [data-value="').concat(r, '"]')).removeClass("active"), t[0].firstElementChild.firstElementChild.textContent = this.textContent, dC.set("resolution", n), o()("".concat(e._menuId, ' [data-value="').concat(n, '"]')).addClass("active"), o()("".concat(e._menuId, " button[data-value=miew-menu-panel-render]")).click()
                }), this._fillCombo("miew-menu-panel-palette", "palette", "palette", fC), o()("".concat(e._menuId, " [data-toggle=palette]")).on("click", function() {
                    var t = o()("".concat(e._menuId, " .list-group-item[data-value=miew-menu-panel-palette]")),
                        n = this.getAttribute("data-value"),
                        r = fC.get(n);
                    t[0].firstElementChild.firstElementChild.textContent = r ? r.name : "Unknown", e._fillSelectionColorCombo(n)
                })
            }, wC.prototype._initToolsPanel = function() {
                var e = this;
                o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-url]")).on("shown.bs.modal", function() {
                    var t = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-url] .modal-body"))[0].firstChild,
                        n = t.nodeValue;
                    if (document.createRange) {
                        var r = document.createRange();
                        r.setStart(t, 0), r.setEnd(t, n.length);
                        var i = window.getSelection();
                        i.removeAllRanges(), i.addRange(r)
                    }
                }), o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-url]")).on("keydown", function(e) {
                    27 === e.keyCode && e.preventDefault()
                }), o()("".concat(e._menuId, " [data-toggle=miew-menu-tools]")).on("click", function() {
                    var t;
                    switch (this.getAttribute("data-value")) {
                        case "dssp":
                            e._viewer.dssp(), e._onMenuOff();
                            break;
                        case "reset-view":
                            e._viewer.resetView(), e._initReprList(), e._onMenuOff();
                            break;
                        case "screenshot":
                            e._viewer.screenshotSave(), e._onMenuOff();
                            break;
                        case "get-url":
                            var n = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-url]"));
                            n.find(".modal-body")[0].textContent = e._viewer.getURL({
                                settings: !0,
                                view: !0
                            }), n.modal({
                                keyboard: !0
                            }, "show");
                            break;
                        case "get-script":
                            var r = o()("".concat(e._menuId, " .miew-menu-modals [data-modal-type=miew-menu-modal-script]"));
                            r.find(".modal-body")[0].innerHTML = e._viewer.getScript().replace(/(?:\r\n|\r|\n)/g, "<br />"), r.modal({
                                keyboard: !0
                            }, "show");
                            break;
                        case "fbx-export":
                            t = e._viewer._getComplexVisual(), cC(t._complex, t._reprList, !1), e._onMenuOff();
                            break;
                        case "save-settings":
                            e._viewer.saveSettings(), e._onMenuOff();
                            break;
                        case "restore-settings":
                            e._viewer.restoreSettings(), e._onMenuOff();
                            break;
                        case "reset-settings":
                            e._viewer.resetSettings(), e._onMenuOff();
                            break;
                        default:
                            e._onMenuOff()
                    }
                    return !1
                })
            }, wC.prototype._onSelectorChanged = function(e) {
                var t = e.find("input").get(0).value.trim() || "all",
                    n = e.find(".alert-danger").get(0),
                    r = iC.parse(t),
                    o = e.find("[data-btn-type=miew-menu-btn-apply-sel]");
                r.error ? (o.addClass("disabled"), n.style.display = "block", n.textContent = r.error) : (o.removeClass("disabled"), n.style.display = "none", n.textContent = "")
            }, wC.prototype._initSelectionPanel = function() {
                var e = this,
                    t = this,
                    n = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-selection]"));
                ! function() {
                    var e, r, o, i = document.createDocumentFragment(),
                        a = n.find("[data-tab-content=singleword]").get(0);
                    for (r = 0, o = t._singleWordsPrimary.length; r < o; r++) {
                        var s = t._singleWordsPrimary[r];
                        e = yC("a", {
                            href: "#",
                            class: "list-group-item frequent",
                            "data-toggle": "selection-input",
                            "data-value": "".concat(s, " ")
                        }, s), i.appendChild(e)
                    }
                    for (t._singleWords.sort(), r = 0, o = t._singleWords.length; r < o; r++) {
                        var l = t._singleWords[r]; - 1 === t._singleWordsPrimary.indexOf(l) && (e = yC("a", {
                            href: "#",
                            class: "list-group-item",
                            "data-toggle": "selection-input",
                            "data-value": "".concat(l, " ")
                        }, l), i.appendChild(e))
                    }
                    a.firstElementChild.appendChild(i)
                }(),
                function() {
                    for (var e, r = document.createDocumentFragment(), o = n.find("[data-tab-content=keyword]").get(0), i = 0, a = t._keyWordsPrimary.length; i < a; i++) {
                        var s = t._keyWordsPrimary[i];
                        e = yC("a", {
                            href: "#",
                            class: "list-group-item frequent keyword-item",
                            "data-toggle": "selection-input",
                            "data-value": "".concat(s, " ")
                        }, s), r.appendChild(e)
                    }
                    o.firstElementChild.appendChild(r)
                }();
                var r = n.find("input").get(0);
                r.addEventListener("input", function() {
                    return e._onSelectorChanged(n)
                }), r.addEventListener("change", function() {
                    return e._onSelectorChanged(n)
                }), n.find(".help-block a").on("click", function(e) {
                    return n.find("input").get(0).value = e.target.textContent, t._onSelectorChanged(n), !1
                }), n.find("[data-toggle=selection-input]").on("click", function(e) {
                    var r = e.target.getAttribute("data-value"),
                        i = o()("".concat(t._menuId, " .panel-menu[data-panel-type=miew-menu-panel-selection] input"));
                    i.val(i.val() + r), t._onSelectorChanged(n)
                }), n.find(".calc .delete").on("click", function() {
                    var e = n.find("input");
                    switch (this.getAttribute("data-delete-type")) {
                        case "clear":
                            e.val("");
                            break;
                        case "backspace":
                            e.val(e.val().slice(0, -1))
                    }
                    t._onSelectorChanged(n)
                }), o()("".concat(t._menuId, " .keyword-item")).on("click", function(e) {
                    var r = n.find("[data-tab-content=value] div");
                    r.empty(), r.off("click", ".value[data-toggle=selection-input]");
                    var i, a, s, l = document.createDocumentFragment(),
                        c = n.find("[data-tab-content=value]").get(0),
                        u = e.target.getAttribute("data-value").slice(0, -1),
                        p = [];
                    if (gC(t._viewer)) switch (u) {
                        case "name":
                            a = t._viewer, p = (s = a._getComplexVisual()) ? s.getComplex().getAtomNames() : 0;
                            break;
                        case "type":
                        case "elem":
                            p = function(e) {
                                var t = e._getComplexVisual();
                                return t ? t.getComplex().getElements() : 0
                            }(t._viewer);
                            break;
                        case "residue":
                            p = function(e) {
                                var t = e._getComplexVisual();
                                return t ? t.getComplex().getResidueNames() : 0
                            }(t._viewer);
                            break;
                        case "chain":
                            p = function(e) {
                                var t = e._getComplexVisual();
                                return t ? t.getComplex().getChainNames() : 0
                            }(t._viewer);
                            break;
                        case "altloc":
                            p = function(e) {
                                var t = e._getComplexVisual();
                                return t ? t.getComplex().getAltLocNames() : 0
                            }(t._viewer);
                            break;
                        default:
                            p = ["1", "2", "3", "4", "5"]
                    }
                    for (var f = 0, h = p.length; f < h; f++) {
                        var d = p[f];
                        i = yC("a", {
                            href: "#",
                            class: "list-group-item value",
                            "data-toggle": "selection-input",
                            "data-value": d
                        }, d), l.appendChild(i)
                    }
                    c.firstElementChild.appendChild(l), n.find('.nav-tabs a[href="[data-tab-content=value]"]').tab("show"), o()("".concat(t._menuId, " .value[data-toggle=selection-input]")).on("click", function(e) {
                        var r = mC.correctSelectorIdentifier(e.target.getAttribute("data-value")),
                            o = n.find("input");
                        o.val(o.val() + r), t._onSelectorChanged(n)
                    })
                }), n.find("[data-btn-type=miew-menu-btn-apply-sel]").on("click", function() {
                    if (!n.find("[data-btn-type=miew-menu-btn-apply-sel]").hasClass("disabled")) {
                        var e = n.find("input").val().trim() || "all";
                        o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list ") + ".panel.valid:eq(".concat(t._curReprIdx, ") .panel-collapse [data-value=miew-menu-panel-selection]"))[0].firstElementChild.firstElementChild.textContent = e;
                        var r = o()("".concat(t._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list ") + ".panel.valid:eq(".concat(t._curReprIdx, ") .panel-heading .badge")),
                            i = iC.parse(e),
                            a = bC(t._viewer, i.selector);
                        r[0].textContent = String(a), n.get(0).firstElementChild.firstElementChild.click()
                    }
                })
            }, wC.prototype._initToolbar = function() {
                var e, t = this,
                    n = document.createDocumentFragment();

                function r(r, i, a, s) {
                    for (var l = o()("".concat(t._menuId, " [data-toolbar-type=").concat(r, "]")).get(0), c = s.all, u = 0, p = c.length; u < p; u++) {
                        var f = c[u];
                        f = f.prototype || f, e = yC("a", {
                            href: "#",
                            class: "thumbnail",
                            "data-toggle": i,
                            "data-value": f.id
                        }, [yC("div", {
                            class: "toolbar-thumb",
                            style: "background:url(images/".concat(i.substring(0, i.indexOf("-")), "/").concat(f.id, ".png)")
                        }), yC("div", {
                            class: "caption text-center"
                        }, yC("small", {}, f.shortName))]), n.appendChild(e)
                    }
                    l.lastElementChild.lastElementChild.appendChild(n)
                }
                r("miew-menu-toolbar-mode", "mode-immediate", 0, uC), r("miew-menu-toolbar-colorer", "colorer-immediate", 0, pC), o()("".concat(t._menuId, ' [data-toggle="mode-immediate"]')).each(function(e, n) {
                    var r = n.getAttribute("data-value");
                    n.addEventListener("click", function(e) {
                        o()("".concat(t._menuId, ' [data-value="').concat(_C(t._viewer.rep().mode), '"]')).removeClass("active"), o()("".concat(t._menuId, " [data-value=miew-menu-toolbar-mode]")).click(), t._viewer.rep({
                            mode: r
                        }), e.preventDefault(), t._fixKeyboard()
                    })
                }), o()("".concat(t._menuId, ' [data-toggle="colorer-immediate"]')).each(function(e, n) {
                    var r = n.getAttribute("data-value");
                    n.addEventListener("click", function(e) {
                        o()("".concat(t._menuId, ' [data-value="').concat(_C(t._viewer.rep().colorer), '"]')).removeClass("active"), o()("".concat(t._menuId, " [data-value=miew-menu-toolbar-colorer]")).click(), t._viewer.rep({
                            colorer: r
                        }), e.preventDefault(), t._fixKeyboard()
                    })
                }), o()("".concat(t._menuId, ' [data-toggle="resolution-immediate"]')).each(function(e, n) {
                    var r = n.getAttribute("data-value");
                    n.addEventListener("click", function(e) {
                        o()("".concat(t._menuId, ' [data-value="').concat(dC.now.resolution, '"]')).removeClass("active"), dC.set("resolution", r), o()("".concat(t._menuId, " [data-value=miew-menu-toolbar-resolution]")).click(), t._viewer.rebuildAll(), e.preventDefault(), t._fixKeyboard()
                    })
                }), o()("".concat(t._menuId, " .titlebar [data-toggle=panel]")).on("click", function() {
                    t._onMenuOn()
                }), o()("".concat(t._menuId, " .toolbar")).on("click", function(e) {
                    var n = o()(e.target);
                    if (n.is(".toolbar")) {
                        var r = n.attr("data-toolbar-type");
                        o()("".concat(t._menuId, ' [data-value="').concat(r, '"]')).click(), t._fixKeyboard()
                    }
                })
            }, wC.prototype._initReprList = function() {
                this._fillReprList(), this._curReprIdx = this._viewer.repCurrent(), o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list .panel.valid:eq(").concat(this._curReprIdx, ") .panel-heading")).addClass("active"), o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-representation] .miew-repr-list .panel.valid:eq(").concat(this._curReprIdx, ") .panel-collapse")).collapse("show"), this._viewer.repCount() > 1 ? o()("".concat(this._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-del-repr]")).removeClass("disabled") : o()("".concat(this._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-del-repr]")).addClass("disabled"), this._viewer.repCount() < this._viewer.getMaxRepresentationCount() ? o()("".concat(this._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-add-repr]")).removeClass("disabled") : o()("".concat(this._menuId, " .miew-repr-list-controls [data-btn-type=miew-menu-btn-add-repr]")).addClass("disabled")
            }, wC.prototype._updateResolutionCombo = function() {
                this._removeActiveFromCombo("resolution");
                var e = o()("".concat(this._menuId, " [data-value=miew-menu-panel-resolution]")),
                    t = o()("".concat(this._menuId, ' [data-toggle=resolution][data-value="').concat(dC.now.resolution, '"]'));
                e[0].firstElementChild.firstElementChild.textContent = t.text(), t.addClass("active")
            }, wC.prototype.setBlur = function(e) {
                var t = this._viewer._container;
                e ? t.classList.add("blur") : t.classList.remove("blur")
            }, wC.prototype.show = function(e, t) {
                var n = this;
                (this.setBlur(!0), this._titlebar.hide(), n._getPanelSelector(n._curPanelID).hide(), o()("".concat(n._menuId, ' a[data-value="').concat(n._curMenuItem, '"]')).removeClass("active"), n._curPanelID = e, n._curMenuItem = t, !1 === this._xs) && (n._getPanelSelector(n._curPanelID).show(), o()("".concat(n._menuId, ' a[data-value="').concat(t, '"]')).addClass("active"));
                if (dC.checkpoint(), n._updateDisplayOptions("miew-menu-panel-palette", "palette", fC), n._fillSelectionColorCombo(dC.get("palette")), n._fillSourceList(), n._initReprList(), n._updateResolutionCombo(), o()("".concat(n._menuId, " input[type=checkbox][data-dir=settings]")).each(function(e, t) {
                        var r = t.getAttribute("data-toggle");
                        "theme" === r ? o()("".concat(n._menuId, ' [data-toggle="').concat(r, '"]')).bootstrapSwitch("state", "dark" === dC.get(r)) : o()("".concat(n._menuId, ' [data-toggle="').concat(r, '"]')).bootstrapSwitch("state", dC.get(r))
                    }), -1 !== n._curPanelID.indexOf("mode") || -1 !== n._curPanelID.indexOf("color") || -1 !== n._curPanelID.indexOf("matpreset")) {
                    var r = o()("".concat(n._menuId, " [data-panel-type=miew-menu-panel-representation] .miew-repr-list")).find(".panel:eq(".concat(n._curReprIdx, ') [data-value="').concat(n._curPanelID, '"]'));
                    r && r.click()
                }
                o()("".concat(n._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).show(), this._menu.show()
            }, wC.prototype.showTerminal = function() {
                this._terminal.show(), this._terminalWindow.focus(), this._term.resize()
            }, wC.prototype._removeActiveFromCombo = function(e) {
                var t = o()("".concat(this._menuId, " [data-toggle=").concat(e, "].active"));
                t && t.removeClass("active")
            }, wC.prototype.hide = function() {
                o()("".concat(this._menuId, ' [data-toggle=resolution][data-value="').concat(dC.now.resolution, '"]')).removeClass("active"), -1 !== this._curPanelID.indexOf("mode") ? this._removeActiveFromCombo("mode") : -1 !== this._curPanelID.indexOf("color") ? this._removeActiveFromCombo("colorer") : -1 !== this._curPanelID.indexOf("matpreset") && this._removeActiveFromCombo("material"), this.setBlur(!1), this._titlebar.show(), this._menu.hide()
            }, wC.prototype.hideTerminal = function() {
                this._terminal.hide(), this._terminalWindow.focus(!1)
            }, wC.prototype._hideToolbarPanel = function() {
                var e = o()("".concat(this._menuId, ' [data-toggle="toolbar"].active'));
                e && e.click()
            }, wC.prototype._onMenuOn = function() {
                this._viewer.halt(), o()("".concat(this._menuId, " .overlay")).hide(), this._reprListChanged = !1, this._initPresetsPanel(), this._hideToolbarPanel(), this.show(this._curPanelID, this._curMenuItem)
            }, wC.prototype._onTerminalOn = function() {
                o()("".concat(this._menuId, " .overlay")).hide(), this._viewer.enableHotKeys(!1), this._hideToolbarPanel(), this.showTerminal()
            }, wC.prototype._onMenuOff = function() {
                this._updateReprList(), this._reprListChanged && (this._viewer.repGet().needsRebuild = !0), this.hide(), this._viewer.run(), o()("".concat(this._menuId, " .overlay")).show(), this._fixKeyboard()
            }, wC.prototype._onTerminalOff = function() {
                this.hideTerminal(), this._viewer.enableHotKeys(!0), o()("".concat(this._menuId, " .overlay")).show(), this._fixKeyboard()
            }, wC.prototype._fixKeyboard = function() {
                if (window !== window.top) {
                    var e = window.top.document,
                        t = e.querySelector("button");
                    if (!t) {
                        var n = e.querySelector("body");
                        n && ((t = e.createElement("button")).style.visibility = "hidden", n.appendChild(t), t = e.querySelector("button"))
                    }
                    if (!t) throw new Error("Some input element should be defined in parent frame. Hidden one is ok.");
                    t.focus()
                }
            }, wC.prototype.showOverlay = function() {
                this._titlebar.show()
            }, wC.prototype.hideOverlay = function() {
                this._titlebar.hide()
            }, wC.prototype._isXS = function() {
                return document.documentElement.clientWidth < 768
            }, wC.prototype._updateDisplayOptions = function(e, t, n) {
                var r = n.get(dC.get(t)) || n.first;
                r = r.prototype || r, o()("".concat(this._menuId, ' .list-group-item[data-value="').concat(e, '"]'))[0].firstElementChild.firstElementChild.textContent = r.name
            }, wC.prototype._setTitle = function(e) {
                o()("".concat(this._menuId, ' [data-field="title"]')).text(e)
            }, wC.prototype._setMdPlayerState = function(e) {
                var t = o()("".concat(this._menuId, ' [data-btn-type="md-player-play"]')),
                    n = o()("".concat(this._menuId, ' [data-btn-type="md-player-pause"]')),
                    r = o()("".concat(this._menuId, ' [data-btn-type="md-player-loading"]'));
                e ? (e.isPlaying ? (t.hide(), n.show()) : (t.show(), n.hide()), e.isLoading ? r.show() : r.hide()) : (t.hide(), n.hide(), r.hide())
            }, wC.prototype._initMdPlayerControls = function() {
                var e = o()("".concat(this._menuId, ' [data-btn-type="md-player-play"]')),
                    t = o()("".concat(this._menuId, ' [data-btn-type="md-player-pause"]')),
                    n = this;
                e.on("click", function() {
                    n._viewer._continueAnimation()
                }), t.on("click", function() {
                    n._viewer._pauseAnimation()
                }), this._setMdPlayerState()
            }, wC.prototype._updateInfo = function(e) {
                if (!e || "Complex" === e.id) {
                    for (var t = e, n = o()(".panel-menu[data-panel-type=miew-menu-panel-info]").children(".panel-body")[0], r = n; r.firstChild;) r.removeChild(r.firstChild);
                    var i = document.createDocumentFragment();
                    if (!t) return i.appendChild(yC("p", null, "No data loaded yet.")), void n.appendChild(i);
                    var a = t.metadata,
                        s = yC("h1", null, "".concat(a.id || t.name || "Unknown data", " "));
                    a.classification && s.appendChild(yC("small", null, "/ ".concat(a.classification))), i.appendChild(s), a.title && i.appendChild(yC("p", null, a.title.join(" "))), i.appendChild(yC("hr")), i.appendChild(yC("table", {
                        class: "table"
                    }, [yC("thead", null, yC("tr", null, [yC("th", {
                        class: "col-xs-10"
                    }, "Statistics"), yC("th", {
                        class: "col-xs-2 text-center"
                    }, "Value")])), yC("tbody", null, [p("Atoms", t.getAtomCount()), p("Bonds", t.getBondCount()), p("Residues", t.getResidueCount()), p("Chains", t.getChainCount()), p("Molecules", t.getMoleculeCount())])])), i.appendChild(yC("hr"));
                    for (var l = t.getMolecules(), c = yC("ol"), u = 0; u < l.length; u++) c.appendChild(yC("li", null, l[u]._name));
                    i.appendChild(yC("table", {
                        class: "table"
                    }, [yC("thead", null, yC("tr", null, [yC("th", {
                        class: "col-xs-10"
                    }, "Molecules")])), yC("tbody", null, yC("tr", null, yC("td", null, c)))])), n.appendChild(i)
                }

                function p(e, t) {
                    return yC("tr", null, [yC("td", null, e), yC("td", {
                        class: "text-center"
                    }, String(t))])
                }
            }, wC.prototype._onResize = function() {
                !1 === this._xs && !0 === this._isXS() && (this._xs = !0, o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).hide()), !0 === this._xs && !1 === this._isXS() && (this._xs = !1, o()("".concat(this._menuId, " .panel-menu[data-panel-type=miew-menu-panel-main]")).show(), o()("".concat(this._menuId, ' a[data-value="').concat(this._curMenuItem, '"]')).addClass("active"), this._getPanelSelector(this._curPanelID).show()), this._term && this._term.resize()
            }, wC.prototype._updateReprList = function() {
                var e = this;

                function t(t, n, r, i) {
                    if (e._viewer.repGet(t)[n].id !== i) return o()(r).removeData(), i;
                    var a = o()(r).data().mvdata;
                    if (void 0 === a || l.a.isEmpty(a)) return i;
                    var s = mC.objectsDiff(a, dC.now["".concat(n, "s")][i]);
                    return l.a.isEmpty(s) ? i : [i, s]
                }
                var n = [],
                    r = null,
                    i = null,
                    a = null,
                    s = null,
                    c = null,
                    u = null,
                    p = null,
                    f = null,
                    h = null,
                    d = null,
                    m = null,
                    y = null,
                    v = null,
                    _ = null,
                    g = null,
                    b = null;

                function w() {
                    "zClip" in b.mode.opts && b.mode.opts.zClip !== y && (b.mode.opts.zClip = y, b.needsRebuild = !0), "scale" in b.mode.opts && b.mode.opts.scale !== _ && (b.mode.opts.scale = _, b.needsRebuild = !0), "isoValue" in b.mode.opts && b.mode.opts.isoValue !== v && (b.mode.opts.isoValue = v, b.needsRebuild = !0)
                }
                o()("".concat(e._menuId, " [data-panel-type=miew-menu-panel-representation] ") + ".miew-repr-list .panel").each(function(l, x) {
                    if (h = o()(x).hasClass("deleted"), d = o()(x).hasClass("added"), !h || !d)
                        if (m = "none" !== o()(x).find(".panel-heading .btn-visible").css("display"), r = o()(x).find("[data-type=selection-target]")[0].textContent, i = o()(x).find("[data-value=miew-menu-panel-mode]")[0], a = o()(x).find("[data-value=miew-menu-panel-color]")[0], s = o()(x).find("[data-value=miew-menu-panel-matpreset]")[0], c = o()(x).find("[data-value=miew-menu-panel-select-color]")[0], u = i.firstElementChild.firstElementChild.getAttribute("data-id"), p = a.firstElementChild.firstElementChild.getAttribute("data-id"), f = s.firstElementChild.firstElementChild.getAttribute("data-id"), E = c.lastChild.firstElementChild.getAttribute("data-id"), O = "0x".concat(E.substr(-6)), g = parseInt(O, 16), y = o()(x).find("[type=checkbox][data-toggle=zClip]")[0].checked, _ = parseFloat(o()(x).find("[data-type=rad]").val()), v = parseFloat(o()(x).find("[data-type=iso]").val()), h) n.push(l);
                        else if (d) {
                        var S = e._viewer.repAdd({
                            selector: r,
                            mode: u,
                            colorer: p
                        });
                        S >= 0 && (b = e._viewer.repGet(S), w(), "UN" !== p && "CB" !== p || (b.colorer.opts.color = g), b.setMaterialPreset(hC.get(f)), b.visible !== m && e._viewer.setNeedRender(), b.show(m))
                    } else {
                        var C = t(l, "mode", i, u),
                            P = t(l, "colorer", a, p);
                        l = e._viewer.repCurrent(l), e._viewer.rep(l, {
                            selector: r,
                            mode: C,
                            colorer: P,
                            material: f
                        }), b = e._viewer.repGet(), "UN" !== p && "CB" !== p || b.colorer.opts.color !== g && (b.needsRebuild = !0, b.colorer.opts.color = g), w(), b.visible !== m && e._viewer.setNeedRender(), b.show(m)
                    }
                    var E, O
                });
                for (var x = n.length - 1; x > -1; --x) e._viewer.repRemove(n[x]);
                e._viewer.repCurrent(e._curReprIdx)
            }, wC.prototype._enableToolbar = function(e) {
                e ? o()("".concat(this._menuId, " [data-toggle=toolbar]")).removeClass("disabled") : o()("".concat(this._menuId, " [data-toggle=toolbar]")).addClass("disabled")
            };
            var xC = wC;
            window.DEBUG = !0, window.onerror = function(e, t, n, r, o) {
                throw function(e) {
                    var t = document.createDocumentFragment(),
                        n = document.getElementsByClassName("miew-container"),
                        r = n.length > 0 ? n[0] : null,
                        o = document.getElementById("miew-error");
                    if (!o) {
                        for (; r && r.firstChild;) r.removeChild(r.firstChild);
                        (o = document.createElement("div")).setAttribute("class", "miew-message"), t.appendChild(o);
                        var i = o.appendChild(document.createElement("p"));
                        i.appendChild(document.createTextNode("We are sorry")), i.appendChild(document.createElement("br")), i.appendChild(document.createElement("small")).textContent = "for the failure", (o = document.createElement("div")).setAttribute("class", "miew-error"), o.id = "miew-error", t.appendChild(o)
                    }
                    var a = o.appendChild(document.createElement("p"));
                    a.appendChild(document.createTextNode("Error details:")), a = o.appendChild(document.createElement("pre")), e.stack && -1 !== String(e.stack).indexOf(String(e)) || a.appendChild(document.createTextNode("".concat(e, "\n"))), e.stack && a.appendChild(document.createTextNode("".concat(e.stack, "\n"))), r && r.appendChild(t)
                }(o = o || {
                    name: "window.onerror",
                    message: e,
                    sourceURL: t,
                    line: n,
                    column: r
                }), o
            }, window.MIEWS = [], window.addEventListener("load", function() {
                o()(".miew-container").each(function(e, t) {
                    console.log("URL input test: https://101rrgsi71.execute-api.us-east-1.amazonaws.com/dev/display?pdbUrl=https://files.rcsb.org/download/1b8c.pdb");               
                    function getUrlVars() {
                        var vars = {};
                        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                            vars[key] = value;
                        });
                        return vars;
                    }
                    function getUrlParam(parameter, defaultvalue){
                        var urlparameter = defaultvalue;
                        if(window.location.href.indexOf(parameter) > -1){
                            urlparameter = getUrlVars()[parameter];
                            }
                        return urlparameter;
                    }
                    var source = getUrlParam("pdbUrl",'Empty');
                    console.log(source);
                    // var opts = {};
                    // opts.sourceType = "url or file";
                    // opts.fileType = "pdb";
                    // opts.mdFile = "";
                    // opts.keepRepsInfo - "prevent reset of object and reps information.";
                    //sS.prototype.load(source, opts);
                    var n = window.miew = new rC(o.a.extend(!0, {
                            container: t,
                            load: source,
                            cookiePath: "/"
                        }, rC.options.fromAttr(t.getAttribute("data-miew")), rC.options.fromURL(window.location.search))),
                        r = {
                            error: "error",
                            warn: "warning",
                            report: "info"
                        };
                    a.a.options.newestOnTop = !1, n.logger.addEventListener("message", function(e) {
                        var t = r[e.level];
                        t && a.a[t](e.message)
                    }), window.MIEWS.push(n);
                    var i = new xC(t, n);
                    n.init() && n.benchmarkGfx().then(function() {
                        i.showOverlay(), n.run()
                    })
                })
            })
        }
    },
    [
        ["xGHL", 1, 2]
    ]
]);
//# sourceMappingURL=demo.4c412ae8f933cba41672.js.map